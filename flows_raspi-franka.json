[{"id":"7c56a241.1e88dc","type":"tab","label":"Telegram","disabled":false,"info":""},{"id":"168e0b9d.9c19d4","type":"tab","label":"File managment","disabled":false,"info":""},{"id":"5af1388b.ef9838","type":"tab","label":"Kodi","disabled":false,"info":""},{"id":"e00097c0.ad3088","type":"tab","label":"System","disabled":false,"info":""},{"id":"dfa0e0a5.c8001","type":"tab","label":"Admin","disabled":false,"info":""},{"id":"ba1e4f7d.a87f3","type":"tab","label":"Dev","disabled":false,"info":""},{"id":"37ee46c5.d3e98a","type":"subflow","name":"Iterate","in":[{"x":220,"y":219,"wires":[{"id":"12b1ebc3.9fb144"}]}],"out":[{"x":454,"y":174,"wires":[{"id":"12b1ebc3.9fb144","port":0}]},{"x":455,"y":259,"wires":[{"id":"12b1ebc3.9fb144","port":1}]}]},{"id":"41df38c0.fb39c8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#00506f","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#408080","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#00506f","edited":true},"page-titlebar-backgroundColor":{"value":"#00506f","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0087bb","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#00506f","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"raspi-franka","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":24,"sy":48,"gx":4,"gy":6,"cx":5,"cy":6,"px":0,"py":0}}},{"id":"cbf02e0a.18499","type":"ui_group","z":"","name":"Display Auflösung","tab":"be0e5438.eb46b8","order":2,"disp":true,"width":12,"collapse":false},{"id":"aa40158d.83bf68","type":"persist-store","z":"","filename":"/home/pi/node-red/persistant-settings/persistance.json","interval":"60"},{"id":"29050d2.fa3cef2","type":"ui_group","z":"","name":"Anwendungen","tab":"be0e5438.eb46b8","order":1,"disp":true,"width":12,"collapse":false},{"id":"5758df94.472ad","type":"ui_group","z":"","name":"Konsole","tab":"be0e5438.eb46b8","order":7,"disp":true,"width":"12","collapse":true},{"id":"be0e5438.eb46b8","type":"ui_tab","z":"","name":"Admin","icon":"build","order":5,"disabled":false,"hidden":false},{"id":"ca6d8830.a2dc48","type":"telegram bot","z":"","botname":"FrankaBilderrahmen","usernames":"","chatids":"","baseapiurl":"","updatemode":"polling","pollinterval":"300","usesocks":false,"sockshost":"","socksport":"6667","socksusername":"anonymous","sockspassword":"","bothost":"","localbotport":"8443","publicbotport":"8443","privatekey":"","certificate":"","useselfsignedcertificate":false,"sslterminated":false,"verboselogging":false},{"id":"8d10bcb3.ecd5","type":"kodi-controller","z":"","name":"","host":"127.0.0.1","port":"9090"},{"id":"bd2821f2.1ee81","type":"ui_tab","z":"","name":"Dev","icon":"dashboard","order":6,"disabled":true,"hidden":true},{"id":"838588b8.d90038","type":"ui_group","z":"","name":"fbi","tab":"bd2821f2.1ee81","order":4,"disp":true,"width":6,"collapse":false},{"id":"69cbfcd5.4478f4","type":"ui_group","z":"","name":"Power","tab":"e03e0a2.04b2ef8","order":2,"disp":true,"width":12,"collapse":false},{"id":"47e9fd6a.bb2c94","type":"ui_group","z":"","name":"omxplayer","tab":"bd2821f2.1ee81","order":6,"disp":true,"width":"6","collapse":false},{"id":"ac137d79.4eec5","type":"ui_group","z":"","name":"fim","tab":"bd2821f2.1ee81","order":5,"disp":true,"width":"6","collapse":false},{"id":"b6d48645.bc31d8","type":"ui_tab","z":"","name":"Telegram","icon":"fa-telegram","order":3,"disabled":false,"hidden":false},{"id":"f7a9f973.917ec8","type":"ui_group","z":"","name":"Navigate Images","tab":"bd2821f2.1ee81","order":2,"disp":true,"width":20,"collapse":false},{"id":"d353cd3f.37915","type":"ui_group","z":"","name":"Navigate Videos","tab":"bd2821f2.1ee81","order":3,"disp":true,"width":20,"collapse":false},{"id":"f7d8373.6ed35c8","type":"ui_spacer","name":"spacer","group":"f7a9f973.917ec8","order":2,"width":7,"height":1},{"id":"89bbbe7.8c0ce4","type":"ui_spacer","name":"spacer","group":"f7a9f973.917ec8","order":5,"width":7,"height":1},{"id":"a3b5e949.03ee68","type":"ui_spacer","name":"spacer","group":"d353cd3f.37915","order":2,"width":7,"height":1},{"id":"b168b834.dc1588","type":"ui_spacer","name":"spacer","group":"d353cd3f.37915","order":5,"width":7,"height":1},{"id":"4537c880.c405c8","type":"ui_tab","z":"","name":"Bilder","icon":"fa-picture-o","order":1,"disabled":false,"hidden":false},{"id":"43f81666.762748","type":"ui_group","z":"","name":"Navigation","tab":"4537c880.c405c8","order":1,"disp":true,"width":12,"collapse":false},{"id":"79173158.54b5a","type":"ui_group","z":"","name":"Einstellungen Allgemein","tab":"4537c880.c405c8","order":3,"disp":true,"width":12,"collapse":true},{"id":"df1cecd4.4f555","type":"ui_group","z":"","name":"Textoverlay","tab":"4537c880.c405c8","order":5,"disp":true,"width":12,"collapse":true},{"id":"6ea23321.89550c","type":"ui_group","z":"","name":"Nutzerliste","tab":"b6d48645.bc31d8","order":1,"disp":true,"width":12,"collapse":false},{"id":"3e3a5d75.a251e2","type":"ui_group","z":"","name":"Neuer Nutzer","tab":"b6d48645.bc31d8","order":2,"disp":true,"width":12,"collapse":false},{"id":"a974a1dc.2318","type":"ui_group","z":"","name":"Nutzer löschen","tab":"b6d48645.bc31d8","order":3,"disp":true,"width":12,"collapse":false},{"id":"e03e0a2.04b2ef8","type":"ui_tab","z":"","name":"System","icon":"fa-cogs","order":4,"disabled":false,"hidden":false},{"id":"98f89e13.1f66c","type":"ui_group","z":"","name":"Bildschirm","tab":"e03e0a2.04b2ef8","order":1,"disp":true,"width":12,"collapse":false},{"id":"5024c415.87ce1c","type":"ui_tab","z":"","name":"Videos","icon":"fa-video-camera","order":2,"disabled":false,"hidden":false},{"id":"ed8a86bc.a4c3c8","type":"ui_group","z":"","name":"Log","tab":"be0e5438.eb46b8","order":8,"disp":true,"width":"12","collapse":true},{"id":"1229b955.63bec7","type":"ui_group","z":"","name":"Telegram-Ordner","tab":"be0e5438.eb46b8","order":3,"disp":true,"width":12,"collapse":false},{"id":"9ed2be8.851194","type":"ui_group","z":"","name":"Bot","tab":"bd2821f2.1ee81","order":1,"disp":true,"width":8,"collapse":false},{"id":"c51c9a95.f2cb68","type":"ui_group","z":"","name":"Navigation","tab":"5024c415.87ce1c","order":1,"disp":true,"width":12,"collapse":false},{"id":"d021848d.7c9d58","type":"ui_group","z":"","name":"Einstellungen","tab":"5024c415.87ce1c","order":2,"disp":true,"width":12,"collapse":true},{"id":"b242fa6a.175d28","type":"ui_group","z":"","name":"Reset Q-Gates","tab":"be0e5438.eb46b8","order":6,"disp":true,"width":12,"collapse":false},{"id":"e4f17352.69409","type":"ui_group","z":"","name":"FreeDNS","tab":"be0e5438.eb46b8","order":4,"disp":true,"width":"12","collapse":false},{"id":"c83c4c5e.03ddf","type":"ui_group","z":"","name":"Wenn ein neues Bild ankommt...","tab":"4537c880.c405c8","order":4,"disp":true,"width":"12","collapse":true},{"id":"af0e753d.902d48","type":"ui_spacer","name":"spacer","group":"3e3a5d75.a251e2","order":2,"width":1,"height":1},{"id":"11753ef0.ea7d91","type":"ui_group","z":"","name":"Stoppe Slideshow","tab":"be0e5438.eb46b8","order":5,"disp":true,"width":12,"collapse":false},{"id":"38e9745b.aa6c1c","type":"ui_spacer","name":"spacer","group":"29050d2.fa3cef2","order":6,"width":6,"height":1},{"id":"31e0ed7e.859452","type":"ui_group","z":"","name":"Papierkorb","tab":"4537c880.c405c8","order":2,"disp":true,"width":"12","collapse":true},{"id":"57956e3d.024f2","type":"ui_spacer","name":"spacer","group":"df1cecd4.4f555","order":2,"width":7,"height":1},{"id":"96ca2e53.6aacb","type":"ui_spacer","name":"spacer","group":"df1cecd4.4f555","order":3,"width":12,"height":1},{"id":"6479d54a.e9717c","type":"ui_spacer","name":"spacer","group":"df1cecd4.4f555","order":16,"width":4,"height":1},{"id":"40594ce8.388634","type":"comment","z":"dfa0e0a5.c8001","name":"Kodi","info":"","x":110,"y":340,"wires":[]},{"id":"b1559b66.b13608","type":"persist in","z":"dfa0e0a5.c8001","name":"kodi","storageNode":"aa40158d.83bf68","x":550,"y":440,"wires":[]},{"id":"e16556a1.a6cf78","type":"persist out","z":"dfa0e0a5.c8001","name":"kodi","storageNode":"aa40158d.83bf68","x":130,"y":440,"wires":[["ee81297d.751808"]]},{"id":"ee81297d.751808","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"kodi","tooltip":"","group":"29050d2.fa3cef2","order":1,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":400,"wires":[["9030aab4.b3cae8"]]},{"id":"448d0e97.8e5ff","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":550,"y":400,"wires":[["a4de161d.ffeba8","2b05e33c.64881c"],["8b9a1ad8.074a98"]]},{"id":"a4de161d.ffeba8","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":790,"y":400,"wires":[[],[],[]]},{"id":"8b9a1ad8.074a98","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":790,"y":460,"wires":[[],[],[]]},{"id":"6cd3950b.9e00ac","type":"comment","z":"dfa0e0a5.c8001","name":"Konsole","info":"","x":120,"y":1620,"wires":[]},{"id":"3dca4bde.f1fce4","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":420,"y":1680,"wires":[["8e9eb826.48a4c8"],[],[]]},{"id":"cc6ee33b.21bbf","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"","tooltip":"","group":"5758df94.472ad","order":1,"width":12,"height":1,"passthru":true,"mode":"text","delay":"0","topic":"","x":200,"y":1680,"wires":[["3dca4bde.f1fce4"]]},{"id":"d6b46b2e.94f648","type":"telegram receiver","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","saveDataDir":"","x":120,"y":200,"wires":[["1874c46c.dc959c","fdf976eb.414d08","695fd683.0af3d8","e0dbe779.1681b8"],["1874c46c.dc959c","fdf976eb.414d08","695fd683.0af3d8","e0dbe779.1681b8"]]},{"id":"6fdc4e8e.2370d","type":"comment","z":"dfa0e0a5.c8001","name":"lightdm","info":"","x":110,"y":740,"wires":[]},{"id":"bde9ea0c.be08b8","type":"persist in","z":"dfa0e0a5.c8001","name":"lightdm","storageNode":"aa40158d.83bf68","x":560,"y":840,"wires":[]},{"id":"c5fd422f.cb21f","type":"persist out","z":"dfa0e0a5.c8001","name":"lightdm","storageNode":"aa40158d.83bf68","x":140,"y":840,"wires":[["29fdcca4.a8b3a4"]]},{"id":"29fdcca4.a8b3a4","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"lightdm","tooltip":"","group":"29050d2.fa3cef2","order":2,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":280,"y":800,"wires":[["69993e6f.1cf93"]]},{"id":"3d7a77a3.b7a3c8","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":550,"y":800,"wires":[["b396fb4e.6efd08"],["b843bc6d.a6abf"]]},{"id":"b396fb4e.6efd08","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start lightdm","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":800,"y":780,"wires":[[],[],[]]},{"id":"b843bc6d.a6abf","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop lightdm","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":800,"y":840,"wires":[[],[],[]]},{"id":"6b411980.a2ece8","type":"kodi-out","z":"5af1388b.ef9838","name":"media-server kodi","controller":"8d10bcb3.ecd5","unit_number":"1","output":"1","kodicommand":"","x":2290,"y":920,"wires":[],"info":"https://kodi.wiki/view/JSON-RPC_API/v9"},{"id":"9f706fb6.41096","type":"kodi-in","z":"5af1388b.ef9838","name":"","controller":"8d10bcb3.ecd5","x":170,"y":60,"wires":[["2a52a9ea.bcf6b6","de98e67.3745118"]]},{"id":"883c1b70.676b08","type":"function","z":"5af1388b.ef9838","name":"Player.Open (directory)","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.Open\",\n            \"args\":{\n                \"item\":{\n                    \"directory\":msg.payload   \n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":1440,"y":460,"wires":[["b2efa2c8.3efc"]]},{"id":"ffbdb28d.7c8a6","type":"function","z":"5af1388b.ef9838","name":"Player.PlayPause","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.PlayPause\",\n            \"params\":{\n                \"playerid\":2\n            }\n        }\n};","outputs":1,"noerr":0,"x":1450,"y":520,"wires":[["b2efa2c8.3efc"]]},{"id":"3e356f2e.d3986","type":"function","z":"5af1388b.ef9838","name":"Player.Open (file)","func":"return {\n    payload: \n        {\n            \"method\":\"Player.Open\",\n            \"params\":{\n                \"item\":{\n                    \"file\":msg.payload   \n                }\n                \n            }\n        }\n};","outputs":1,"noerr":0,"x":1450,"y":400,"wires":[["b2efa2c8.3efc"]]},{"id":"6941cbb5.e2c064","type":"function","z":"5af1388b.ef9838","name":"Playlist.GetPlaylists","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.GetPlaylists\"\n        }\n};","outputs":1,"noerr":0,"x":1930,"y":1660,"wires":[["b2efa2c8.3efc"]]},{"id":"dce22cd9.dca44","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1750,"y":1660,"wires":[["6941cbb5.e2c064"]]},{"id":"e71a57f2.2c0be8","type":"function","z":"5af1388b.ef9838","name":"Playlist.GetActivePlayers","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.GetActivePlayers\",\n        }\n};","outputs":1,"noerr":0,"x":1950,"y":1700,"wires":[["b2efa2c8.3efc"]]},{"id":"519686aa.b96248","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1750,"y":1700,"wires":[["e71a57f2.2c0be8"]]},{"id":"6eb6fb45.cfdac4","type":"function","z":"5af1388b.ef9838","name":"Player.Stop","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.Stop\",\n            \"params\":{\n                \"playerid\":2\n            }\n        }\n};","outputs":1,"noerr":0,"x":1470,"y":560,"wires":[["b2efa2c8.3efc","e0ee1701.429a18"]]},{"id":"6559cc36.1b5184","type":"file in","z":"5af1388b.ef9838","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":310,"y":1300,"wires":[["5cf77f2.8adb28"]]},{"id":"985e9032.56967","type":"comment","z":"5af1388b.ef9838","name":"Dashboard Preview","info":"","x":230,"y":1240,"wires":[]},{"id":"5cf77f2.8adb28","type":"base64","z":"5af1388b.ef9838","name":"","action":"str","property":"payload","x":440,"y":1300,"wires":[["b40e2a53.8af888"]]},{"id":"b40e2a53.8af888","type":"ui_template","z":"5af1388b.ef9838","group":"43f81666.762748","name":"","order":1,"width":12,"height":5,"format":"<img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":580,"y":1300,"wires":[[]]},{"id":"43f88de5.2f1884","type":"comment","z":"5af1388b.ef9838","name":"Ausgabe","info":"","x":1240,"y":40,"wires":[]},{"id":"74815107.7a996","type":"comment","z":"5af1388b.ef9838","name":"Navigation","info":"","x":220,"y":520,"wires":[]},{"id":"4b692df3.f4f474","type":"function","z":"5af1388b.ef9838","name":"get file","func":"try{\n    var filename = msg.payload.data.data.item.file.slice((msg.payload.data.data.item.file.lastIndexOf(\"/\")) + 1);\n    var status = msg.payload.notification;\n    \n    if(status === \"Player.OnPlay\"){\n        if(msg.topic){\n            \n            filename = global.get('images-dashboard') + filename.slice(0, 31) + \".dash.jpg.stick.jpg\";\n            \n        } else {\n            \n            filename = global.get('images-dashboard') + filename + \".dash.jpg\";\n            \n        }\n        msg = { filename };\n        return msg;\n    }\n} catch(e){\n    \n}\n","outputs":1,"noerr":0,"x":190,"y":1300,"wires":[["6559cc36.1b5184"]]},{"id":"6e18904b.3731","type":"function","z":"5af1388b.ef9838","name":"Playlist.Add","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.Add\",\n            \"params\":{\n                \"playlistid\":2,\n                \"item\":{\n                    \"file\":msg.payload\n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":2310,"y":280,"wires":[["b2efa2c8.3efc"]]},{"id":"2bfde3a8.6783ac","type":"function","z":"5af1388b.ef9838","name":"Playlist.GetItems","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.GetItems\",\n            \"params\":{\n                \"playlistid\":2\n        }\n    }\n};","outputs":1,"noerr":0,"x":1930,"y":1740,"wires":[["b2efa2c8.3efc"]]},{"id":"91e0d2.eadd6f3","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1750,"y":1740,"wires":[["2bfde3a8.6783ac"]]},{"id":"f6f2588b.8879f8","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo next","func":"return {\n    payload: \n        {\n            \"method\":\"Player.GoTo\",\n            \"params\":{\n                \"playerid\":2,\n                \"to\": \"next\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1450,"y":660,"wires":[["b2efa2c8.3efc"]]},{"id":"93b3653f.741c78","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo previous","func":"return {\n    payload: \n        {\n            \"method\":\"Player.GoTo\",\n            \"params\":{\n                \"playerid\":2,\n                \"to\": \"previous\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1440,"y":620,"wires":[["b2efa2c8.3efc"]]},{"id":"5d370aff.d14a34","type":"ui_button","z":"5af1388b.ef9838","name":"pause","group":"43f81666.762748","order":3,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-pause","payload":"pause","payloadType":"str","topic":"","x":390,"y":560,"wires":[["c613e3ff.4f41e","39aabebe.9aab22","868cd190.6585a"]]},{"id":"35814bc8.a20154","type":"ui_button","z":"5af1388b.ef9838","name":"stop","group":"11753ef0.ea7d91","order":1,"width":12,"height":1,"passthru":false,"label":"Stop","tooltip":"","color":"","bgcolor":"","icon":"fa-stop","payload":"stop","payloadType":"str","topic":"","x":390,"y":620,"wires":[["c613e3ff.4f41e","39aabebe.9aab22","21c3e5f9.6f75da"]]},{"id":"29ee9c53.3a5b84","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"43f81666.762748","order":4,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":390,"y":740,"wires":[["62faac09.68dee4"]]},{"id":"e94831cb.248ea","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"43f81666.762748","order":5,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":390,"y":780,"wires":[["a7a8c7d1.937c78"]]},{"id":"aa8f2459.3432d8","type":"function","z":"5af1388b.ef9838","name":"Playlist.Clear","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.Clear\",\n            \"params\":{\n                \"playlistid\":2\n            }\n        }\n};","outputs":1,"noerr":0,"x":1990,"y":380,"wires":[["b2efa2c8.3efc"]]},{"id":"24dd70b4.86387","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1850,"y":420,"wires":[["aa8f2459.3432d8"]]},{"id":"99bf7b1a.41e4f8","type":"function","z":"5af1388b.ef9838","name":"Settings.SetSettingValue","func":"return {\n    payload: \n        {\n            \"method\":\"Settings.SetSettingValue\",\n            \"params\":{\n                \"setting\":\"slideshow.staytime\",\n                \"value\":msg.payload\n            }\n        }\n};","outputs":1,"noerr":0,"x":1430,"y":1340,"wires":[["b2efa2c8.3efc"]]},{"id":"acb583ed.1f6e1","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Anzeigedauer (Sek.)","tooltip":"","group":"79173158.54b5a","order":1,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":"3","max":"60","step":"3","x":420,"y":2080,"wires":[["ab1b6e6.0cf699","af647e03.8fe05"]]},{"id":"f065e78b.0b06e8","type":"ui_button","z":"5af1388b.ef9838","name":"play","group":"43f81666.762748","order":2,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-play","payload":"play","payloadType":"str","topic":"0","x":390,"y":680,"wires":[["c613e3ff.4f41e","39aabebe.9aab22","6df57dbf.8b24e4"]]},{"id":"c613e3ff.4f41e","type":"function","z":"5af1388b.ef9838","name":"set color","func":"var msgPlay = {payload: \"#eb4034\"}; // rot\nvar msgPause = {payload: \"#ebe534\"}; // gelb\n\nif (msg.payload === \"play\" || msg.payload === \"kodiPlay\"){\n    msgPause.payload = \"\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', true);\n    return [msgPause, msgPlay];\n\n} else if (msg.payload === \"pause\"){\n    if ((context.get('colorswitchPause') || false) && context.set('colorswitchPlay')){\n        context.set('colorswitchPause', false);\n    } else {\n        msgPause.payload = \"\";\n        context.set('colorswitchPause', true);\n    }\n    return [msgPause, msgPlay];\n\n} else if (msg.payload === \"kodiPause\"){\n    context.set('colorswitchPause', false);\n    return [msgPause, msgPlay];\n\n} else if (msg.payload === \"stop\" || msg.payload === \"kodiStop\"){\n    msg.payload = \"\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', false);\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":200,"y":620,"wires":[["5d370aff.d14a34"],["f065e78b.0b06e8"]]},{"id":"c6be6051.f6e5f","type":"function","z":"5af1388b.ef9838","name":"set folder images-frameloop","func":"msg.payload = global.get('images-frameloop');\nreturn msg;","outputs":1,"noerr":0,"x":1480,"y":180,"wires":[["27faf3d3.2ce36c"]]},{"id":"6ca0a6f5.8b6858","type":"ui_button","z":"5af1388b.ef9838","name":"stick","group":"43f81666.762748","order":6,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-paperclip","payload":"stick","payloadType":"str","topic":"","x":350,"y":1040,"wires":[["833ed45c.3e3b58","c72480c6.b6957","793b21c7.52223"]]},{"id":"44c72ea3.e7ca1","type":"ui_button","z":"5af1388b.ef9838","name":"delete","group":"43f81666.762748","order":7,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"Wirklich löschen?","payloadType":"str","topic":"","x":210,"y":920,"wires":[["6eb4a9aa.8de568"]]},{"id":"3c457ef9.347f12","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Max. Anzahl Schleife","tooltip":"","group":"79173158.54b5a","order":2,"width":10,"height":1,"passthru":true,"outs":"end","topic":"","min":"1","max":"999","step":1,"x":500,"y":2300,"wires":[["9df2a546.c6cce8","9896db89.201e78"]]},{"id":"a62c991d.72a4c8","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1140,"wires":[["47a50bf1.1a7ff4"],["47a50bf1.1a7ff4"],[]]},{"id":"a2cd0a5.02febf8","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1160,"wires":[["b5b89633.bb5a78"]]},{"id":"b5b89633.bb5a78","type":"function","z":"ba1e4f7d.a87f3","name":"create fbi cmd","func":"var duration = \"4\";\nvar folder = \"/home/pi/media/telegram/\";\n\n//msg.payload = \"sudo fbi -d /dev/fb0 -T 1 -a -t \" + duration + \" --noverbose --readahead --blend 3 \" + folder + \"*.jpg\";\nmsg.payload = \"sudo fbi -d /dev/fb0 -T 1 -a -t \" + duration + \" --readahead --blend 3 \" + folder + \"*.jpg\";\n\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1140,"wires":[["a62c991d.72a4c8"]]},{"id":"47a50bf1.1a7ff4","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1140,"wires":[]},{"id":"2652e9a9.77c7f6","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"838588b8.d90038","order":1,"width":0,"height":0,"passthru":false,"label":"start slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1120,"wires":[["b5b89633.bb5a78"]]},{"id":"471bacc.085f054","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1320,"wires":[["587a4cf5.59a2b4"]]},{"id":"587a4cf5.59a2b4","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall fbi\";\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1300,"wires":[["c22a84d4.60b528"]]},{"id":"7fe7bc48.58e114","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"838588b8.d90038","order":3,"width":0,"height":0,"passthru":false,"label":"stop slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1280,"wires":[["587a4cf5.59a2b4"]]},{"id":"6884e69e.c98708","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"838588b8.d90038","order":2,"width":0,"height":0,"passthru":false,"label":"restart slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1220,"wires":[["587a4cf5.59a2b4","403bb0af.7188"]]},{"id":"403bb0af.7188","type":"delay","z":"ba1e4f7d.a87f3","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1220,"wires":[["b5b89633.bb5a78"]]},{"id":"e8000f81.969be","type":"comment","z":"ba1e4f7d.a87f3","name":"fbi","info":"","x":100,"y":1060,"wires":[]},{"id":"c22a84d4.60b528","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1300,"wires":[["5d3ab0ee.c3228"],["5d3ab0ee.c3228"],[]]},{"id":"5d3ab0ee.c3228","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1300,"wires":[]},{"id":"4c25c5a7.1f563c","type":"function","z":"ba1e4f7d.a87f3","name":"create fbi cmd","func":"var file = msg.filename;\n//var file = \"/home/pi/media/telegram/*.jpg\";\n\n//msg.payload = \"sudo fbi -d /dev/fb0 -T 1 -a --noverbose --readahead --blend 3 \" + file;\nmsg.payload = \"sudo fbi -T 1 -a --noverbose --blend 3 \" + file;\n\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":380,"wires":[["c0a34b87.0e1ef8"]]},{"id":"704160c3.4bf8c","type":"comment","z":"ba1e4f7d.a87f3","name":"Navigation","info":"","x":120,"y":100,"wires":[]},{"id":"4cf866e1.ecc2e8","type":"ui_template","z":"ba1e4f7d.a87f3","group":"f7a9f973.917ec8","name":"","order":1,"width":20,"height":8,"format":"\n \n <img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1200,"y":220,"wires":[[]]},{"id":"bcb54f00.5bf98","type":"base64","z":"ba1e4f7d.a87f3","name":"","action":"str","property":"payload","x":1060,"y":220,"wires":[["4cf866e1.ecc2e8"]]},{"id":"834ec8e6.83e348","type":"file in","z":"ba1e4f7d.a87f3","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":810,"y":220,"wires":[["bcb54f00.5bf98"]]},{"id":"fd5bc185.4357b","type":"ui_button","z":"ba1e4f7d.a87f3","name":"left","group":"f7a9f973.917ec8","order":3,"width":3,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":150,"y":300,"wires":[["8c2b87fa.9e2b08","26a4ce3.ddf7532"]]},{"id":"c43edb74.939b68","type":"ui_button","z":"ba1e4f7d.a87f3","name":"right","group":"f7a9f973.917ec8","order":4,"width":3,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":150,"y":340,"wires":[["8c2b87fa.9e2b08","26a4ce3.ddf7532"]]},{"id":"aa5ff526.cb86a8","type":"function","z":"ba1e4f7d.a87f3","name":"navigate files","func":"var fileindex = global.get('fileindex-images') || 0;\nvar filelist = global.get('filelist-images');\nvar filelistlength = filelist.length;\n\nif (msg.payload === \"r\"){\n    if (fileindex === (filelistlength - 1)){\n        fileindex = 0;\n    } else {\n        fileindex = fileindex + 1;\n    }\n    \n} else {\n    if (fileindex === 0){\n        fileindex = filelistlength - 1;\n    } else {\n        fileindex = fileindex - 1;\n    }\n}\n\nglobal.set('fileindex-images', fileindex);\n\nvar filename = filelist[fileindex];\n\nmsg.payload = fileindex;\nmsg = { filename };\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":320,"wires":[["834ec8e6.83e348","a42fab94.f93608","4c25c5a7.1f563c","80c39c43.26de2"]]},{"id":"a42fab94.f93608","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":490,"y":400,"wires":[]},{"id":"db0c45ab.1d2bc8","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"l","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":400,"wires":[["26a4ce3.ddf7532"]]},{"id":"aa32d1aa.77cd9","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"r","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":440,"wires":[["26a4ce3.ddf7532"]]},{"id":"8c2b87fa.9e2b08","type":"fs-file-lister","z":"ba1e4f7d.a87f3","name":"","start":"/home/pi/media/telegram","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":320,"y":240,"wires":[["ac49c114.f4bf1"]]},{"id":"ac49c114.f4bf1","type":"change","z":"ba1e4f7d.a87f3","name":"","rules":[{"t":"set","p":"filelist-images","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":240,"wires":[[]]},{"id":"4f2e3cdf.49a614","type":"inject","z":"ba1e4f7d.a87f3","name":"start","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":150,"y":240,"wires":[["8c2b87fa.9e2b08"]]},{"id":"7d8d3f3e.57d96","type":"comment","z":"ba1e4f7d.a87f3","name":"Ausgabe","info":"","x":780,"y":100,"wires":[]},{"id":"9d3f0f5f.9aecd","type":"comment","z":"ba1e4f7d.a87f3","name":"Dashboard","info":"","x":820,"y":160,"wires":[]},{"id":"d9edc072.e5131","type":"comment","z":"ba1e4f7d.a87f3","name":"fbi","info":"","x":810,"y":320,"wires":[]},{"id":"c0a34b87.0e1ef8","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1000,"y":380,"wires":[["13b70a3f.181016"],["13b70a3f.181016"],[]]},{"id":"13b70a3f.181016","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":380,"wires":[]},{"id":"f1f94645.e8e398","type":"comment","z":"ba1e4f7d.a87f3","name":"Images","info":"","x":130,"y":160,"wires":[]},{"id":"d77b006a.92ff1","type":"ui_button","z":"ba1e4f7d.a87f3","name":"left","group":"d353cd3f.37915","order":3,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":150,"y":820,"wires":[["cf3725bb.2048f8","970c2d9.a21f3d"]]},{"id":"598130fe.ad4a1","type":"ui_button","z":"ba1e4f7d.a87f3","name":"right","group":"d353cd3f.37915","order":4,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":150,"y":860,"wires":[["cf3725bb.2048f8","970c2d9.a21f3d"]]},{"id":"cfbd3682.bec5b8","type":"function","z":"ba1e4f7d.a87f3","name":"navigate files","func":"var fileindex = global.get('fileindex-videos') || 0;\nvar filelist = global.get('filelist-videos');\nvar filelistlength = filelist.length;\n\nif (msg.payload === \"r\"){\n    if (fileindex === (filelistlength - 1)){\n        fileindex = 0;\n    } else {\n        fileindex = fileindex + 1;\n    }\n    \n} else {\n    if (fileindex === 0){\n        fileindex = filelistlength - 1;\n    } else {\n        fileindex = fileindex - 1;\n    }\n}\n\nglobal.set('fileindex-videos', fileindex);\n\nvar filename = filelist[fileindex];\n\nmsg.payload = fileindex;\nmsg = { filename };\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":840,"wires":[["12fc1b0a.6db095","50190e2b.45b1e","7a6a8761.b8efd8"]]},{"id":"12fc1b0a.6db095","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":920,"wires":[]},{"id":"8afa9caf.ecc46","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"l","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":920,"wires":[["970c2d9.a21f3d"]]},{"id":"98ba7001.e0bc9","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"r","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":960,"wires":[["970c2d9.a21f3d"]]},{"id":"cf3725bb.2048f8","type":"fs-file-lister","z":"ba1e4f7d.a87f3","name":"","start":"/home/pi/media/telegram","pattern":"*.mp4","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":320,"y":760,"wires":[["3da6b2d5.19f27e"]]},{"id":"3da6b2d5.19f27e","type":"change","z":"ba1e4f7d.a87f3","name":"","rules":[{"t":"set","p":"filelist-videos","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":760,"wires":[[]]},{"id":"ab94beb2.5f0c7","type":"inject","z":"ba1e4f7d.a87f3","name":"start","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":760,"wires":[["cf3725bb.2048f8"]]},{"id":"646759e5.45d608","type":"comment","z":"ba1e4f7d.a87f3","name":"Videos","info":"","x":130,"y":680,"wires":[]},{"id":"d0a9483e.e4e7c8","type":"comment","z":"ba1e4f7d.a87f3","name":"omxplayer","info":"","x":820,"y":680,"wires":[]},{"id":"cd54d6f3.67e618","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1060,"y":820,"wires":[["88071f2c.6d173"],["88071f2c.6d173"],[]]},{"id":"88071f2c.6d173","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1250,"y":820,"wires":[]},{"id":"50190e2b.45b1e","type":"function","z":"ba1e4f7d.a87f3","name":"create omxplayer cmd","func":"var file = msg.filename;\n\nmsg.payload = \"sudo omxplayer -b \" + file;\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":820,"wires":[["cd54d6f3.67e618"]]},{"id":"d5bcf01b.6f5d1","type":"ui_template","z":"ba1e4f7d.a87f3","group":"d353cd3f.37915","name":"","order":1,"width":20,"height":8,"format":"\n \n <img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1200,"y":740,"wires":[[]]},{"id":"1f4fbf36.b4b801","type":"base64","z":"ba1e4f7d.a87f3","name":"","action":"str","property":"payload","x":1060,"y":740,"wires":[["d5bcf01b.6f5d1"]]},{"id":"7a6a8761.b8efd8","type":"file in","z":"ba1e4f7d.a87f3","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":810,"y":740,"wires":[["1f4fbf36.b4b801"]]},{"id":"970c2d9.a21f3d","type":"function","z":"ba1e4f7d.a87f3","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":840,"wires":[["cfbd3682.bec5b8"]]},{"id":"26a4ce3.ddf7532","type":"function","z":"ba1e4f7d.a87f3","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":320,"wires":[["aa5ff526.cb86a8"]]},{"id":"864d171b.28ec38","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1040,"y":540,"wires":[["4075bc9.bc2b144"],["4075bc9.bc2b144"],[]]},{"id":"662a25c4.b44dec","type":"function","z":"ba1e4f7d.a87f3","name":"create fim cmd","func":"//var file = msg.filename;\nvar file = \"/home/pi/media/telegram/*.jpg\";\n\nmsg.payload = \"sudo fim -a \" + file;\n\nreturn msg;","outputs":1,"noerr":0,"x":842,"y":540,"wires":[["864d171b.28ec38"]]},{"id":"4075bc9.bc2b144","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1230,"y":540,"wires":[]},{"id":"a597478f.ce79d8","type":"comment","z":"ba1e4f7d.a87f3","name":"fim","info":"","x":810,"y":480,"wires":[]},{"id":"80c39c43.26de2","type":"delay","z":"ba1e4f7d.a87f3","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":640,"y":460,"wires":[["8a6ff35e.ec044"]]},{"id":"8a6ff35e.ec044","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall fbi\";\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":420,"wires":[["c0a34b87.0e1ef8"]]},{"id":"8c730af9.2a5788","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1500,"wires":[["c398064d.3e5718"],["c398064d.3e5718"],[]]},{"id":"2d5857b7.ac2cc8","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1520,"wires":[["c840d4d3.0f7128"]]},{"id":"c840d4d3.0f7128","type":"function","z":"ba1e4f7d.a87f3","name":"create fim cmd","func":"var duration = \"4\";\nvar folder = \"/home/pi/media/telegram/\";\n\n\nmsg.payload = \"sudo fim -a --slideshow \" + duration + \" \" + folder + \"*.jpg\";\n\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1500,"wires":[["8c730af9.2a5788"]]},{"id":"c398064d.3e5718","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1500,"wires":[]},{"id":"ef5d29c9.1c9fe8","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"ac137d79.4eec5","order":1,"width":0,"height":0,"passthru":false,"label":"start slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1480,"wires":[["c840d4d3.0f7128"]]},{"id":"785822a9.c1debc","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1680,"wires":[["ac375e76.b805b"]]},{"id":"ac375e76.b805b","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall fim\";\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1660,"wires":[["74e393ec.efd44c"]]},{"id":"d6be8805.cc7ef8","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"ac137d79.4eec5","order":3,"width":0,"height":0,"passthru":false,"label":"stop slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1640,"wires":[["ac375e76.b805b"]]},{"id":"e753aea.eb2e95","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"ac137d79.4eec5","order":2,"width":0,"height":0,"passthru":false,"label":"restart slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1580,"wires":[["ac375e76.b805b","e0dd1470.4cb8d8"]]},{"id":"e0dd1470.4cb8d8","type":"delay","z":"ba1e4f7d.a87f3","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1580,"wires":[["c840d4d3.0f7128"]]},{"id":"620c9d19.e77d34","type":"comment","z":"ba1e4f7d.a87f3","name":"fim","info":"","x":100,"y":1420,"wires":[]},{"id":"74e393ec.efd44c","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1660,"wires":[["99f08f1e.a5247"],["99f08f1e.a5247"],[]]},{"id":"99f08f1e.a5247","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1660,"wires":[]},{"id":"23fd144.87a42ec","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":1880,"wires":[["16fa0e77.2ed662"],["16fa0e77.2ed662"],[]]},{"id":"4be812e8.6c5c0c","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1900,"wires":[["6630e260.67d91c"]]},{"id":"6630e260.67d91c","type":"function","z":"ba1e4f7d.a87f3","name":"create omxplayer cmd","func":"var folder = \"/home/pi/media/telegram/\";\n\nmsg.payload = \"sudo omxplayer -b \" + folder + \"*.mp4\";\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1880,"wires":[["23fd144.87a42ec"]]},{"id":"16fa0e77.2ed662","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":1880,"wires":[]},{"id":"473eaea.6e0955","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"47e9fd6a.bb2c94","order":1,"width":0,"height":0,"passthru":false,"label":"start videoshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1860,"wires":[["6630e260.67d91c"]]},{"id":"4737b0ac.35833","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":2000,"wires":[["6610924b.43c2dc"]]},{"id":"6610924b.43c2dc","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall omxplayer.bin\";\nreturn msg;","outputs":1,"noerr":0,"x":392,"y":1980,"wires":[["3e12acf.d557d54"]]},{"id":"2c1d8e1b.495b52","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"47e9fd6a.bb2c94","order":2,"width":0,"height":0,"passthru":false,"label":"stop videoshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1960,"wires":[["6610924b.43c2dc"]]},{"id":"48900a05.f1d6a4","type":"comment","z":"ba1e4f7d.a87f3","name":"omxplayer ","info":"","x":120,"y":1800,"wires":[]},{"id":"3e12acf.d557d54","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":1980,"wires":[["c3efd311.79bcf"],["c3efd311.79bcf"],[]]},{"id":"c3efd311.79bcf","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":1980,"wires":[]},{"id":"5f31aa92.80caf4","type":"comment","z":"5af1388b.ef9838","name":"delete","info":"","x":170,"y":880,"wires":[]},{"id":"6eb4a9aa.8de568","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":370,"y":920,"wires":[["8789cd73.c6c3c"]]},{"id":"583882c6.a20d2c","type":"function","z":"5af1388b.ef9838","name":"Input.SendText","func":"return {\n    payload: \n        {\n            \"cmd\":\"Input.SendText\",\n            \"params\":{\n                \"text\":\"http://192.168.11.215:1880/ui/#!/0?socketid=3HYhA_wOcocSylQ7AABp\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1920,"y":1420,"wires":[["b2efa2c8.3efc"]]},{"id":"beee446f.1b1f48","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1750,"y":1420,"wires":[["583882c6.a20d2c"]]},{"id":"ab1b6e6.0cf699","type":"function","z":"5af1388b.ef9838","name":"convert","func":"msg.payload = Math.round(msg.payload/3);\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":2040,"wires":[["5f47212b.83b2a"]]},{"id":"f7056c7a.85c5c","type":"function","z":"7c56a241.1e88dc","name":"add user","func":"if(flow.get('newuserallow')){\n    \n    msg.payload = msg.payload.chatId;\n    \n    return msg;\n    \n}\n","outputs":1,"noerr":0,"x":420,"y":3040,"wires":[["9f2c06f5.e84578","762299e2.b08378","20f4a5de.5065ba"]]},{"id":"9f2c06f5.e84578","type":"ui_text","z":"7c56a241.1e88dc","group":"3e3a5d75.a251e2","order":3,"width":12,"height":1,"name":"","label":"Chat ID:","format":"{{msg.payload}}","layout":"row-spread","x":760,"y":3080,"wires":[]},{"id":"a13b8087.ca44b","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Name","tooltip":"","group":"3e3a5d75.a251e2","order":4,"width":9,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":910,"y":3080,"wires":[["e7014a1b.9c3398"]]},{"id":"e6d51937.2ef0b8","type":"comment","z":"7c56a241.1e88dc","name":"Nachricht empfangen","info":"","x":140,"y":100,"wires":[]},{"id":"757faf3f.cc2c2","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"3e3a5d75.a251e2","order":5,"width":3,"height":1,"passthru":false,"label":"add","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":470,"y":2960,"wires":[["804ae741.99e948"]]},{"id":"451b6501.9ca6fc","type":"change","z":"7c56a241.1e88dc","name":"set newuserallow","rules":[{"t":"set","p":"newuserallow","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":3200,"wires":[[]]},{"id":"476d2ce0.c3db64","type":"ui_switch","z":"7c56a241.1e88dc","name":"","label":"Hinzufügen erlauben?","tooltip":"","group":"3e3a5d75.a251e2","order":1,"width":11,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":400,"y":3200,"wires":[["451b6501.9ca6fc","a90e0331.97fe"]]},{"id":"e7014a1b.9c3398","type":"change","z":"7c56a241.1e88dc","name":"set newusername","rules":[{"t":"set","p":"newusername","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":3080,"wires":[[]]},{"id":"804ae741.99e948","type":"function","z":"7c56a241.1e88dc","name":"add user to userlist","func":"// Variablen abspeichern\n\nvar userlist = global.get('userlist');\nvar name = flow.get('newusername');\nvar chatid = flow.get('newuserchatid') || \"\";\nvar user = { name,\n            chatid\n        }\n\n// Überprüfen ob Chat-ID bereits in Liste vorhanden\n\nif (chatid === \"\"){\n    msg.payload = \"Bitte Chat-ID eintragen\";\n    return [null, msg];\n}\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].chatid == user.chatid || userlist[i].name == user.name){\n        msg.payload = \"User oder Chat-ID bereits eingetragen\";\n        return [null, msg];\n    }\n}\n\n\nuserlist.push(user);\nglobal.set('userlist', userlist);\n\n\nmsg.payload = \"User \" + name + \" hinzugefügt!\";\n\nreturn [msg, null];","outputs":2,"noerr":0,"x":650,"y":2960,"wires":[["1b33b81b.c8c678","8e34fc29.95d0e"],["1b33b81b.c8c678"]]},{"id":"762299e2.b08378","type":"change","z":"7c56a241.1e88dc","name":"set newuserchatid","rules":[{"t":"set","p":"newuserchatid","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":3040,"wires":[[]]},{"id":"f0adc1e7.e4047","type":"function","z":"7c56a241.1e88dc","name":"reset userlist array","func":"var userlist = [];\n\nglobal.set('userlist', userlist);\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":2720,"wires":[["b1e0eefd.f5d6f"]]},{"id":"12b1ebc3.9fb144","type":"function","z":"37ee46c5.d3e98a","name":"Iterate","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    itt.outArray.push(msg.payload)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":347,"y":220,"wires":[[],[]]},{"id":"27dbf3c5.ea56ac","type":"persist in","z":"7c56a241.1e88dc","name":"userlist","storageNode":"aa40158d.83bf68","x":880,"y":2640,"wires":[]},{"id":"81133135.59e94","type":"persist out","z":"7c56a241.1e88dc","name":"userlist","storageNode":"aa40158d.83bf68","x":240,"y":2780,"wires":[["859a3652.7d91d8"]]},{"id":"dba4e951.a9efa8","type":"ui_button","z":"7c56a241.1e88dc","name":"Delete","group":"a974a1dc.2318","order":2,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"","payloadType":"str","topic":"","x":190,"y":3500,"wires":[["edf3d6a.2b23428"]]},{"id":"e8159558.7ba548","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Name","tooltip":"","group":"a974a1dc.2318","order":1,"width":9,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":250,"y":3440,"wires":[["e786a2e1.b3a2b"]]},{"id":"a0dc3f6b.e367e","type":"function","z":"7c56a241.1e88dc","name":"delete user from userlist","func":"var userlist = global.get('userlist');\nvar name = flow.get('userdel');\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].name == name){\n        userlist.splice(i, 1);\n        msg.payload = \"User \" + name + \" gelöscht!\";\n        return msg;\n    }\n}\n\nmsg.payload = \"User \" + name + \" nicht vorhanden\";\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":3500,"wires":[["6cf1a068.8292a","fb805673.96fe38"]]},{"id":"e786a2e1.b3a2b","type":"change","z":"7c56a241.1e88dc","name":"set userdel","rules":[{"t":"set","p":"userdel","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":3440,"wires":[[]]},{"id":"20f4a5de.5065ba","type":"function","z":"7c56a241.1e88dc","name":"format text","func":"msg.payload = \"Neuer Nutzer mit der ChatID \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":3120,"wires":[["ffccee7f.7a23d"]]},{"id":"ffccee7f.7a23d","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":730,"y":3120,"wires":[]},{"id":"5b81269d.e5e4c8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":2720,"wires":[["f0adc1e7.e4047"]]},{"id":"1874c46c.dc959c","type":"function","z":"7c56a241.1e88dc","name":"Gate user exists?","func":"// Variablen setzen\n\nvar userlist = global.get('userlist');\nvar chatid = msg.payload.chatId;\n\n// Überprüfen ob User in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    \n    if(userlist[i].chatid == chatid){\n        msg.payload.name = userlist[i].name;\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":370,"y":200,"wires":[["c66f4c4.35413b"]]},{"id":"acc8335f.4cf74","type":"telegram sender","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","x":580,"y":100,"wires":[[]]},{"id":"d08da02a.c9ddd","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1030,"y":880,"wires":[[],[],["f153fa65.e56d38"]]},{"id":"e21f5b8.47cd3a8","type":"function","z":"7c56a241.1e88dc","name":"wget Image","func":"try {\n    msg.payload = \"wget \" + msg.payload.weblink +\" -P \" + global.get('images-incoming');\n    return msg;\n} catch (e){}","outputs":1,"noerr":0,"x":870,"y":880,"wires":[["d08da02a.c9ddd"]]},{"id":"859e9bb8.08dea8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"25235235435","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":3040,"wires":[["6f5b8b48.395204"]]},{"id":"6f5b8b48.395204","type":"function","z":"7c56a241.1e88dc","name":"tele Message sim","func":"var chatId = msg.payload;\nvar messageId = 12;\nvar type = \"message\";\nvar content = \"blubb\"\n\nmsg.payload ={ chatId, messageId, type, content }\n\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":3100,"wires":[["f7056c7a.85c5c"]]},{"id":"9d2bef95.e1e3a","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":500,"y":3280,"wires":[["476d2ce0.c3db64"]]},{"id":"6cf1a068.8292a","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1090,"y":3500,"wires":[]},{"id":"3fc5248a.79ae4c","type":"comment","z":"7c56a241.1e88dc","name":"Nutzer löschen","info":"","x":200,"y":3380,"wires":[]},{"id":"7a84f3a9.010e6c","type":"comment","z":"7c56a241.1e88dc","name":"Nutzer hinzufügen","info":"","x":210,"y":2880,"wires":[]},{"id":"faa710fa.a3be","type":"comment","z":"7c56a241.1e88dc","name":"Nutzerliste","info":"","x":178.75,"y":2633.75,"wires":[]},{"id":"859a3652.7d91d8","type":"change","z":"7c56a241.1e88dc","name":"set userlist","rules":[{"t":"set","p":"userlist","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":2780,"wires":[["b1e0eefd.f5d6f"]]},{"id":"49556607.9cccc8","type":"function","z":"7c56a241.1e88dc","name":"format userlist","func":"var userlist = msg.payload;\nmsg.payload = \"\";\n\nfor (var i=0; i < userlist.length; i++) {\n    msg.payload = msg.payload + \"<tr><td>\" + userlist[i].name + \"</td><td>\" + userlist[i].chatid + \"</td></tr>\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":920,"y":2780,"wires":[["a3cb9891.1b4998"]]},{"id":"b1e0eefd.f5d6f","type":"change","z":"7c56a241.1e88dc","name":"get userlist","rules":[{"t":"set","p":"payload","pt":"msg","to":"userlist","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":2740,"wires":[["27dbf3c5.ea56ac","49556607.9cccc8","5ff7f213.dc881c"]]},{"id":"1b33b81b.c8c678","type":"ui_toast","z":"7c56a241.1e88dc","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":890,"y":2960,"wires":[[]]},{"id":"fdf976eb.414d08","type":"link out","z":"7c56a241.1e88dc","name":"","links":["11cd389c.d11267"],"x":235,"y":260,"wires":[]},{"id":"11cd389c.d11267","type":"link in","z":"7c56a241.1e88dc","name":"","links":["fdf976eb.414d08"],"x":280,"y":2940,"wires":[["f7056c7a.85c5c"]]},{"id":"7b771b5.e814ee4","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"234523","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":3000,"wires":[["6f5b8b48.395204"]]},{"id":"d3db6368.6ef7e","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"234","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":2960,"wires":[["6f5b8b48.395204"]]},{"id":"a90e0331.97fe","type":"function","z":"7c56a241.1e88dc","name":"true-> false","func":"if(msg.payload){\n    msg.payload = false;\n} else {\n    msg.reset = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":3280,"wires":[["9d2bef95.e1e3a"]]},{"id":"d6db478c.577268","type":"link in","z":"7c56a241.1e88dc","name":"","links":["8e34fc29.95d0e","fb805673.96fe38"],"x":615,"y":2780,"wires":[["b1e0eefd.f5d6f"]]},{"id":"8e34fc29.95d0e","type":"link out","z":"7c56a241.1e88dc","name":"","links":["d6db478c.577268"],"x":775,"y":2880,"wires":[]},{"id":"fb805673.96fe38","type":"link out","z":"7c56a241.1e88dc","name":"","links":["d6db478c.577268"],"x":1015,"y":3460,"wires":[]},{"id":"5ff7f213.dc881c","type":"ui_table","z":"7c56a241.1e88dc","group":"6ea23321.89550c","name":"","order":1,"width":12,"height":6,"columns":[{"field":"name","title":"Name","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"chatid","title":"Chat-ID","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":930,"y":2700,"wires":[["eaa29f3a.26b62"]]},{"id":"a3cb9891.1b4998","type":"template","z":"7c56a241.1e88dc","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n<head>\n<style>\nth {\n  text-align: center;\n}\n</style>\n</head>\n\n<body>\n<table style=\"width:100%; text-align:center\">\n  <tr>\n    <th>Name</th>\n    <th>Chat-ID</th> \n  </tr>\n    {{payload}}\n</table>\n\n</body>\n</html>\n","output":"str","x":1080,"y":2780,"wires":[[]]},{"id":"eaa29f3a.26b62","type":"function","z":"7c56a241.1e88dc","name":"get name","func":"try{\n    msg.payload = msg.payload.name;\n} catch (e){}\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":2700,"wires":[["4fd715d2.f30bec"]]},{"id":"4fd715d2.f30bec","type":"link out","z":"7c56a241.1e88dc","name":"","links":["8bc512af.c6d39"],"x":1215,"y":2700,"wires":[]},{"id":"8bc512af.c6d39","type":"link in","z":"7c56a241.1e88dc","name":"","links":["4fd715d2.f30bec"],"x":155,"y":3440,"wires":[["e8159558.7ba548"]]},{"id":"8b7c9098.b7c87","type":"ui_toast","z":"7c56a241.1e88dc","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":490,"y":3500,"wires":[["e0267b70.807be8"]]},{"id":"edf3d6a.2b23428","type":"function","z":"7c56a241.1e88dc","name":"delete?","func":"var name = flow.get('userdel');\n\nmsg.payload = \"User \" + name + \" wirklich löschen?\";\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":3500,"wires":[["8b7c9098.b7c87"]]},{"id":"e0267b70.807be8","type":"function","z":"7c56a241.1e88dc","name":"gate \"OK\"","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":640,"y":3500,"wires":[["a0dc3f6b.e367e"]]},{"id":"c67a9b7.e69db68","type":"comment","z":"7c56a241.1e88dc","name":"Add Text","info":"","x":1180,"y":1200,"wires":[]},{"id":"2a0f261a.c87d7a","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1410,"y":1240,"wires":[[],[],["993d21d1.50d41"]]},{"id":"47b2d8c4.6cd5c8","type":"function","z":"7c56a241.1e88dc","name":"convert image add text","func":"var imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\n\nimagepath = imagepath + flow.get('filenameResize');\nresultpath = resultpath + flow.get('filenameResize') + \".addText.jpg\";\n\nvar bgalpha = flow.get('bgalpha') || \"00\";\nvar bgcolor = flow.get('bgcolor') || \"000000\";\nvar text = flow.get('lastTelegramMessage') || \"no text entered\";\n// Prepare string for bash -> convert special characters\ntext = text.replace(/\\\\/g , \"\\\\\\\\\").replace(/\"/g , \"\\\\\\\"\");\n\nvar textsize = \"\";\nif (flow.get('textsize') > 0){\n    textsize = \" -pointsize \" + (flow.get('textsize') || 30);\n}\nvar sizeX = ((flow.get('lastImageWidth')) * (flow.get('lastImageResize'))/100) - flow.get('cropX');\nvar sizeY = ((flow.get('lastImageHeight')) * (flow.get('lastImageResize'))/100) - flow.get('cropY');\nvar gravity = flow.get('gravity') || \"center\";\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\nvar undercolor = \"\";\nif (flow.get('undercolor') !== \"off\"){\n    undercolor = \" -undercolor \" + (flow.get('undercolor') || black);\n}\n\nmsg.topic = \"textTrueText\";\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + undercolor + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:\\\"\" + text + \"\\\" \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":1240,"wires":[["2a0f261a.c87d7a"]]},{"id":"90f79f30.5128a","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Beispieltext","tooltip":"","group":"df1cecd4.4f555","order":14,"width":12,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":310,"y":1900,"wires":[["e6038caa.89d","6660cfe.4d8bc3"]]},{"id":"ac2280f9.16249","type":"ui_slider","z":"7c56a241.1e88dc","name":"","label":"Textgröße (0 = Auto)","tooltip":"","group":"df1cecd4.4f555","order":4,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"300","step":1,"x":340,"y":1940,"wires":[["fbf4878e.4717a8","6660cfe.4d8bc3"]]},{"id":"fbf4878e.4717a8","type":"change","z":"7c56a241.1e88dc","name":"set textsize","rules":[{"t":"set","p":"textsize","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1940,"wires":[["cfed2e53.218c4"]]},{"id":"dbda7118.3ce1","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"cropX","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":2000,"wires":[["4044d43a.bedd7c"]]},{"id":"40429ec1.98ae4","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"cropY","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":2060,"wires":[["28352150.11049e"]]},{"id":"3d21531.919c4ac","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Textfarbe","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":6,"width":12,"height":1,"passthru":true,"options":[{"label":"weiß","value":"white","type":"str"},{"label":"gelb","value":"yellow","type":"str"},{"label":"grün","value":"green","type":"str"}],"payload":"","topic":"","x":300,"y":2180,"wires":[["b0e629e7.3c2188","6660cfe.4d8bc3"]]},{"id":"b0e629e7.3c2188","type":"change","z":"7c56a241.1e88dc","name":"set color","rules":[{"t":"set","p":"color","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2180,"wires":[["358d0942.7d2936"]]},{"id":"e6038caa.89d","type":"change","z":"7c56a241.1e88dc","name":"set text","rules":[{"t":"set","p":"text","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":1900,"wires":[["ed1b362e.9d5968"]]},{"id":"6d099478.6b2b4c","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"df1cecd4.4f555","order":15,"width":8,"height":1,"passthru":false,"label":"Vorschau","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"","payload":"preview","payloadType":"str","topic":"","x":1220,"y":2020,"wires":[["ef90c7f4.06d958","33dfef36.1813b"]]},{"id":"8134f650.06c6e8","type":"change","z":"7c56a241.1e88dc","name":"set undercolor","rules":[{"t":"set","p":"undercolor","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":2240,"wires":[["83dbf2f.ff19f1"]]},{"id":"975f0fbb.92c15","type":"change","z":"7c56a241.1e88dc","name":"set bgcolor","rules":[{"t":"set","p":"bgcolor","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":2300,"wires":[[]]},{"id":"ef90c7f4.06d958","type":"function","z":"7c56a241.1e88dc","name":"set color","func":"if (msg.payload === \"\"){\n    msg.payload = \"#34eb5c\"; //green\n} else {\n    msg.payload = \"#ebe534\"; //yellow\n}\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":2080,"wires":[["6d099478.6b2b4c"]]},{"id":"6660cfe.4d8bc3","type":"function","z":"7c56a241.1e88dc","name":"set bt color","func":"msg.payload = \"\";\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":2020,"wires":[["6d099478.6b2b4c"]]},{"id":"33dfef36.1813b","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":2020,"wires":[["d0a83fff.6eaba"]]},{"id":"63c3affe.9cbca","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Font","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":7,"width":12,"height":1,"passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":610,"y":2420,"wires":[["78feb7ea.4a8028","6660cfe.4d8bc3"]]},{"id":"8c8ad3b9.a0ebf","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":280,"y":2420,"wires":[["7149253a.796c3c"]]},{"id":"8254dada.b94d58","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Crop X","tooltip":"","group":"df1cecd4.4f555","order":10,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":290,"y":2000,"wires":[["dbda7118.3ce1","6660cfe.4d8bc3"]]},{"id":"1aa8b429.d2cb4c","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Crop Y","tooltip":"","group":"df1cecd4.4f555","order":11,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":300,"y":2060,"wires":[["40429ec1.98ae4","6660cfe.4d8bc3"]]},{"id":"5d9fbd8b.699e44","type":"change","z":"7c56a241.1e88dc","name":"set gravity","rules":[{"t":"set","p":"gravity","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":2120,"wires":[["bd6139aa.649098"]]},{"id":"d180f32d.9e311","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Position","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":5,"width":12,"height":1,"passthru":true,"options":[{"label":"Mitte","value":"center","type":"str"},{"label":"Oben","value":"north","type":"str"},{"label":"Unten","value":"south","type":"str"},{"label":"Links","value":"west","type":"str"},{"label":"Rechts","value":"east","type":"str"},{"label":"Oben-links","value":"northwest","type":"str"},{"label":"Oben-rechts","value":"northeast","type":"str"},{"label":"Unten-links","value":"southwest","type":"str"},{"label":"Unten-rechts","value":"southeast","type":"str"}],"payload":"","topic":"","x":300,"y":2120,"wires":[["5d9fbd8b.699e44","6660cfe.4d8bc3"]]},{"id":"78feb7ea.4a8028","type":"change","z":"7c56a241.1e88dc","name":"set font","rules":[{"t":"set","p":"font","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":2420,"wires":[["ae65c529.28aca8"]]},{"id":"6d59b988.e1fa18","type":"ui_slider","z":"7c56a241.1e88dc","name":"","label":"Transparenz (0 = max)","tooltip":"","group":"df1cecd4.4f555","order":9,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"255","step":"1","x":340,"y":2360,"wires":[["fbafa881.198c28","25f04c65.41db54"]]},{"id":"bea0cf56.50f72","type":"change","z":"7c56a241.1e88dc","name":"set bgalpha","rules":[{"t":"set","p":"bgalpha","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":2360,"wires":[[]]},{"id":"585a7ad.f3eb984","type":"ui_colour_picker","z":"7c56a241.1e88dc","name":"","label":"Texthintergrundfarbe","group":"df1cecd4.4f555","format":"hex","outformat":"string","showSwatch":true,"showPicker":false,"showValue":false,"showHue":false,"showAlpha":false,"showLightness":true,"square":"false","dynOutput":"false","order":8,"width":12,"height":1,"passthru":true,"topic":"","x":340,"y":2300,"wires":[["6874c671.202dd8","1ffe1d7c.c14403"]]},{"id":"fbafa881.198c28","type":"function","z":"7c56a241.1e88dc","name":"-> hex","func":"msg.payload = msg.payload.toString(16);\n\nif(msg.payload.length < 2){\n    msg.payload = \"0\" + msg.payload;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":2360,"wires":[["bea0cf56.50f72","6660cfe.4d8bc3"]]},{"id":"7149253a.796c3c","type":"function","z":"7c56a241.1e88dc","name":"fonts options","func":"var options = [\"AvantGarde-Book\",\"AvantGarde-BookOblique\",\"AvantGarde-Demi\",\"AvantGarde-DemiOblique\",\"Bookman-Demi\",\"Bookman-DemiItalic\",\"Bookman-Light\",\"Bookman-LightItalic\",\"Century-Schoolbook-L-Bold\",\"Century-School\",\"ook-L-Bold-Italic\",\"Century-Schoolbook-L-Italic\",\"Century-Schoolbook-L-Roman\",\"Courier\",\"Courier-Bold\",\"Courier-BoldOblique\",\"Courier-Oblique\",\"DejaVuMathTeXGyre-Regular\",\"DejaVu-Sans\",\"DejaVu-Sans-Bold\",\"DejaVu-Sans-Bold-Oblique\",\"DejaVu-Sans-Condensed\",\"DejaVu-Sans-Condensed-Bold\",\"DejaVu-Sans-Condensed-Bold-Oblique\",\"DejaVu-Sans-Condensed-Oblique\",\"DejaVu-Sans-ExtraLight\",\"DejaVu-Sans-Mono\",\"DejaVu-Sans-Mono-Bold\",\"DejaVu-Sans-Mono-Bold-Oblique\",\"DejaVu-Sans-Mono-Oblique\",\"DejaVu-Sans-Oblique\",\"DejaVu-Serif\",\"DejaVu-Serif-Bold\",\"DejaVu-Serif-Bold-Italic\",\"DejaVu-Serif-Condensed\",\"DejaVu-Serif-Condensed-Bold\",\"DejaVu-Serif-Condensed-Bold-Italic\",\"DejaVu-Serif-Condensed-Italic\",\"DejaVu-Serif-Italic\",\"Dingbats\",\"Droid-Sans-Fallback\",\"fixed\",\"FreeMono\",\"FreeMono-Bold\",\"FreeMono-Bold-Oblique\",\"FreeMono-Oblique\",\"FreeSans\",\"FreeSans-Bold\",\"FreeSans-Bold-Oblique\",\"FreeSans-Oblique\",\"FreeSerif\",\"FreeSerif-Bold\",\"FreeSerif-Bold-Italic\",\"FreeSerif-Italic\",\"Helvetica\",\"Helvetica-Bold\",\"Helvetica-BoldOblique\",\"Helvetica-Narrow\",\"Helvetica-Narrow-Bold\",\"Helvetica-Narrow-BoldOblique\",\"Helvetica-Narrow-Oblique\",\"Helvetica-Oblique\",\"Liberation-Mono\",\"Liberation-Mono-Bold\",\"Liberation-Mono-Bold-Italic\",\"Liberation-Mono-Italic\",\"Liberation-Sans\",\"Liberation-Sans-Bold\",\"Liberation-Sans-Bold-Italic\",\"Liberation-Sans-Italic\",\"Liberation-Sans-Narrow\",\"Liberation-Sans-Narrow-Bold\",\"Liberation-Sans-Narrow-Bold-Italic\",\"Liberation-Sans-Narrow-Italic\",\"Liberation-Serif\",\"Liberation-Serif-Bold\",\"Liberation-Serif-Bold-Italic\",\"Liberation-Serif-Italic\",\"NewCenturySchlbk-Bold\",\"NewCenturySchlbk-BoldItalic\",\"NewCenturySchlbk-Italic\",\"NewCenturySchlbk-Roman\",\"Nimbus-Mono-L\",\"Nimbus-Mono-L-Bold\",\"Nimbus-Mono-L-Bold-Oblique\",\"Nimbus-Mono-L-Regular-Oblique\",\"Nimbus-Roman-No9-L\",\"Nimbus-Roman-No9-L-Medium\",\"Nimbus-Roman-No9-L-Medium-Italic\",\"Nimbus-Roman-No9-L-Regular-Italic\",\"Nimbus-Sans-L\",\"Nimbus-Sans-L-Bold\",\"Nimbus-Sans-L-Bold-Condensed\",\"Nimbus-Sans-L-Bold-Condensed-Italic\",\"Nimbus-Sans-L-Bold-Italic\",\"Nimbus-Sans-L-Regular-Condensed\",\"Nimbus-Sans-L-Regular-Condensed-Italic\",\"Nimbus-Sans-L-Regular-Italic\",\"Noto-Mono\",\"Palatino-Bold\",\"Palatino-BoldItalic\",\"Palatino-Italic\",\"Palatino-Roman\",\"Piboto-Bold\",\"Piboto-Bold-Italic\",\"Piboto-Condensed-Bold\",\"Piboto-Condensed-Bold-Italic\",\"Piboto-Condensed-Italic\",\"Piboto-Condensed-Regular\",\"Piboto-Italic\",\"Piboto-Light\",\"Piboto-Light-Italic\",\"PibotoLt-Bold\",\"PibotoLt-Bold-Italic\",\"PibotoLt-Italic\",\"PibotoLt-Regular\",\"Piboto-Regular\",\"Piboto-Thin\",\"Piboto-Thin-Italic\",\"Quicksand-Bold\",\"Quicksand-Light\",\"Quicksand-Medium\",\"Quicksand-Regular\",\"Standard-Symbols-L\",\"Symbol\",\"Times-Bold\",\"Times-BoldItalic\",\"Times-Italic\",\"Times-Roman\",\"URW-Bookman-L-Demi-Bold\",\"URW-Bookman-L-Demi-Bold-Italic\",\"URW-Bookman-L-Light\",\"URW-Bookman-L-Light-Italic\",\"URW-Chancery-L-Medium-Italic\",\"URW-Gothic-L-Book\",\"URW-Gothic-L-Book-Oblique\",\"URW-Gothic-L-Demi\",\"URW-Gothic-L-Demi-Oblique\",\"URW-Palladio-L-Bold\",\"URW-Palladio-L-Bold-Italic\",\"URW-Palladio-L-Italic\",\"URW-Palladio-L-Roman\"];\nmsg = {options};\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":2420,"wires":[["63c3affe.9cbca"]]},{"id":"91e306eb.14ef18","type":"file in","z":"7c56a241.1e88dc","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":1410,"y":2300,"wires":[["6054f05a.f0311"]]},{"id":"6054f05a.f0311","type":"base64","z":"7c56a241.1e88dc","name":"","action":"str","property":"payload","x":1560,"y":2300,"wires":[["a1cf66a1.500238"]]},{"id":"a1cf66a1.500238","type":"ui_template","z":"7c56a241.1e88dc","group":"df1cecd4.4f555","name":"Vorschau","order":17,"width":12,"height":5,"format":"<img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1700,"y":2300,"wires":[[]]},{"id":"47377c6c.b062e4","type":"function","z":"7c56a241.1e88dc","name":"set file","func":"var filename = \"/home/pi/media/telegram/preview/previewText.jpg\";\nmsg = { filename };\nreturn msg;\n","outputs":1,"noerr":0,"x":1710,"y":2220,"wires":[["91e306eb.14ef18"]]},{"id":"9dfe85ae.25ea38","type":"comment","z":"7c56a241.1e88dc","name":"Resize incoming Images","info":"","x":190,"y":1200,"wires":[]},{"id":"bc5c689d.b3fa98","type":"comment","z":"dfa0e0a5.c8001","name":"Displayauflösung","info":"","x":140,"y":80,"wires":[]},{"id":"e27c7715.f4ce48","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"y","tooltip":"","group":"cbf02e0a.18499","order":2,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":290,"y":220,"wires":[["7836b6e0.a8b778"]]},{"id":"f7532169.84116","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"x","tooltip":"","group":"cbf02e0a.18499","order":1,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":290,"y":180,"wires":[["bc339cc2.9fc39"]]},{"id":"7836b6e0.a8b778","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"displayHeight","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":220,"wires":[["d0308973.9e7a18"]]},{"id":"bc339cc2.9fc39","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"displayWidth","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":180,"wires":[["6a9d0ab7.38fd44"]]},{"id":"2b7c62e2.d3c16e","type":"image-info","z":"7c56a241.1e88dc","name":"","x":630,"y":1060,"wires":[["dfb12308.fde7e"]]},{"id":"d8607587.5f2828","type":"function","z":"7c56a241.1e88dc","name":"set file","func":"var lastTelegramFilename = flow.get('lastTelegramFilename');\nvar filename = global.get('images-preprocessing') + lastTelegramFilename;\nmsg = { filename,\n        lastTelegramFilename };\nreturn msg;\n","outputs":1,"noerr":0,"x":290,"y":1060,"wires":[["4f5819a7.f38628"]]},{"id":"4f5819a7.f38628","type":"file in","z":"7c56a241.1e88dc","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":430,"y":1080,"wires":[["2b7c62e2.d3c16e"]]},{"id":"78b61229.97257c","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"lastImageWidth","pt":"flow","to":"width","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1090,"y":1060,"wires":[["c13975e4.57fb78"]]},{"id":"dfb12308.fde7e","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"lastImageHeight","pt":"flow","to":"height","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":1060,"wires":[["78b61229.97257c"]]},{"id":"cb9542d9.58ab5","type":"inject","z":"7c56a241.1e88dc","name":"Start","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":1080,"wires":[["d8607587.5f2828"]]},{"id":"c13975e4.57fb78","type":"function","z":"7c56a241.1e88dc","name":"convert image resize","func":"var imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\n\nimagepath = imagepath + msg.lastTelegramFilename;\nresultpath = resultpath + msg.lastTelegramFilename + \".resize.jpg\";\n\nvar displayWidth = global.get('displayWidth');\nvar displayHeight = global.get('displayHeight');\nvar lastImageWidth = flow.get('lastImageWidth');\nvar lastImageHeight = flow.get('lastImageHeight');\n\nflow.set('filenameResize', (msg.lastTelegramFilename + \".resize.jpg\"));\n\nvar resize = \"\";\nif (lastImageWidth/lastImageHeight > displayWidth/displayHeight){\n    \n    resize = (displayWidth / lastImageWidth * 100);\n    \n} else {\n    \n    resize = (displayHeight / lastImageHeight * 100);\n}\n\nflow.set('lastImageResize', resize);\n\nmsg.payload = \"convert \" + imagepath + \" -size \" + displayWidth + \"x\" + displayHeight + \" -auto-orient -resize \" + resize + \"%\" + \" xc:black +swap -gravity center -composite \" + resultpath;\n\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"x":460,"y":1200,"wires":[["361dacd6.b27bd4"]]},{"id":"361dacd6.b27bd4","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":650,"y":1200,"wires":[[],[],["c0a9ff00.fadfe"]]},{"id":"695fd683.0af3d8","type":"debug","z":"7c56a241.1e88dc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":160,"wires":[]},{"id":"911c282a.81a5f8","type":"fs-file-lister","z":"7c56a241.1e88dc","name":"","start":"global.get('images-incoming')","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":570,"y":960,"wires":[["cbf661c0.35f29"]]},{"id":"cbf661c0.35f29","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"lastTelegramFilename","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":960,"wires":[["6792b03c.50821"]]},{"id":"6792b03c.50821","type":"function","z":"7c56a241.1e88dc","name":"rename + mv -> preproc-folder","func":"var filename = \"1001.jpg\";\nmsg.payload = \"mv \" + global.get('images-incoming') + (flow.get('lastTelegramFilename')) + \" \" + global.get('images-preprocessing') + filename;\nflow.set('lastTelegramFilename', filename);\n\nreturn msg;","outputs":1,"noerr":0,"x":1060,"y":960,"wires":[["e111055e.e9f098"]]},{"id":"e111055e.e9f098","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1280,"y":960,"wires":[[],[],["635f03a6.5b896c"]]},{"id":"3eb469a9.a3f486","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramUsername","func":"// Variablen abspeichern\n\nvar userlist = global.get('userlist');\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].chatid == msg.payload.chatId){\n        msg.payload = userlist[i].name;\n        flow.set('lastTelegramUsername', msg.payload);\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":770,"y":780,"wires":[[]]},{"id":"fd4afe8c.3fa31","type":"function","z":"7c56a241.1e88dc","name":"convert image add name","func":"// set variables\nvar imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\nvar sizeX = global.get('displayWidth');\nvar sizeY = global.get('displayHeight');\nvar gravity = (flow.get('gravityName')) || \"southeast\";\nvar undercolor = \"black\"; //\n\n// fix variables\n\nif (msg.topic === \"textTrue\"){\n    imagepath = imagepath + flow.get('filenameResize') + \".addText.jpg\";\n    resultpath = resultpath + flow.get('filenameResize') + \".addText.jpg\";\n    \n} else {\n    imagepath = imagepath + flow.get('filenameResize');\n    resultpath = resultpath + flow.get('filenameResize') + \".addName.jpg\";\n}\n\nvar textsize = (flow.get('nameTextsize')) || 40;\nvar bgalpha = \"00\";\nvar bgcolor = \"000000\";\nvar text = flow.get('lastTelegramUsername') || \"no text entered\";\n// Prepare string for bash -> convert special characters\ntext = text.replace(/\\\\/g , \"\\\\\\\\\").replace(/\"/g , \"\\\\\\\"\");\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\n\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + \" -undercolor \" + undercolor + \" -pointsize \" + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:\\\"\" + text + \"\\\" \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\nmsg.filepath = resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":1340,"wires":[["6bc46fb3.9cc96"]]},{"id":"6bc46fb3.9cc96","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1410,"y":1340,"wires":[[],[],["d8cfda78.815aa8"]]},{"id":"6eff0982.4d8e18","type":"comment","z":"7c56a241.1e88dc","name":"Add Name","info":"","x":1180,"y":1300,"wires":[]},{"id":"96e17660.84c2d8","type":"ui_slider","z":"7c56a241.1e88dc","name":"","label":"Textgröße Name","tooltip":"","group":"df1cecd4.4f555","order":12,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"300","step":1,"x":1260,"y":2380,"wires":[["e3208cfc.d7d2b"]]},{"id":"e3208cfc.d7d2b","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"nameTextsize","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1470,"y":2380,"wires":[["dc56b1d6.a55fa"]]},{"id":"2acfda59.b19246","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"gravityName","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1470,"y":2440,"wires":[["7597dbe9.10b6c4"]]},{"id":"4a5f8ce2.694264","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Position Name","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":13,"width":12,"height":1,"passthru":true,"options":[{"label":"Mitte","value":"center","type":"str"},{"label":"Oben","value":"north","type":"str"},{"label":"Unten","value":"south","type":"str"},{"label":"Links","value":"west","type":"str"},{"label":"Rechts","value":"east","type":"str"},{"label":"Oben-links","value":"northwest","type":"str"},{"label":"Oben-rechts","value":"northeast","type":"str"},{"label":"Unten-links","value":"southwest","type":"str"},{"label":"Unten-rechts","value":"southeast","type":"str"}],"payload":"","topic":"","x":1260,"y":2440,"wires":[["2acfda59.b19246"]]},{"id":"7a0d1fb4.a96cb","type":"comment","z":"5af1388b.ef9838","name":"experimentieren","info":"","x":1780,"y":1360,"wires":[]},{"id":"84851945.fe0028","type":"function","z":"7c56a241.1e88dc","name":"downsize image for dashboard","func":"var resize = 42;\nvar quality = 50;\n\nvar imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\n\nvar filename = flow.get('filenameResize') + \".addName.jpg\";\nif (msg.topic === \"textTrueText\"){\n    filename = flow.get('filenameResize') + \".addText.jpg\";\n}\n\nimagepath = imagepath + filename;\nresultpath = resultpath + filename + \".dash.jpg\";\n\nmsg.payload = \"convert \" + imagepath + \" -resize \" + resize + \"% \" + \"-quality \" + quality + \" \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":1420,"wires":[["ececc511.da15c8"]]},{"id":"ececc511.da15c8","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":650,"y":1420,"wires":[[],[],["831c855e.b960c8"]]},{"id":"23a08705.fbb988","type":"function","z":"7c56a241.1e88dc","name":"delete source files","func":"if (msg.topic === \"textTrueText\" || msg.topic === \"textFalseName\"){\n    \n    var path = global.get('images-preprocessing');\n    msg.payload = \"rm \" + path + \"*\";\n    \n} else {\n    msg.payload = \"\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":1620,"wires":[["7064ec00.eec2c4"]]},{"id":"7064ec00.eec2c4","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":650,"y":1620,"wires":[[],[],["e744adc5.91cdb"]]},{"id":"c66f4c4.35413b","type":"function","z":"7c56a241.1e88dc","name":"image/video?","func":"var chatId = 0;\nvar type = \"message\";\nvar content = \"\";\nvar payload = { chatId,\n                type,\n                content\n};\nvar msg2 = {payload};\n\nglobal.set('lastMimeVideo', \"mp4\");\n\nif (msg.payload.type === \"document\"){\n    var mimetype = msg.payload.weblink.slice(msg.payload.weblink.lastIndexOf(\".\") + 1);\n    if (mimetype === \"jpg\" || mimetype === \"JPG\"){\n        msg.payload.type = \"photo\";\n    }\n    if (mimetype === \"mp4\" || mimetype === \"MP4\" || mimetype === \"mov\" || mimetype === \"MOV\" || mimetype === \"mkv\" || mimetype === \"MKV\"){\n        msg.payload.type = \"video\";\n        global.set('lastMimeVideo', mimetype);\n    }\n}\n\nif (msg.payload.type === \"photo\"){\n    msg2.payload.chatId = msg.payload.chatId;\n    msg2.payload.content = \"Danke \" + msg.payload.name + \"! Dein Bild ist angekommen.\";\n    return [msg2, null, msg];\n\n} else if (msg.payload.type === \"video\"){\n    msg2.payload.chatId = msg.payload.chatId;\n    msg2.payload.content = \"Danke \" + msg.payload.name + \"! Dein Video ist angekommen! Du bekommst eine Nachricht, sobald es verfügbar ist.\";\n    return [msg2, msg, null];\n\n} else {\n    msg2.payload.chatId = msg.payload.chatId;\n    msg2.payload.content = \"Sorry \" + msg.payload.name + \", Nachrichten kommen leider nur an, wenn sie ein Foto oder ein Video enthalten :-( !\";\n    return [msg2, null, null];\n}","outputs":3,"noerr":0,"x":580,"y":220,"wires":[["acc8335f.4cf74"],["2efa3db1.b53b02"],["4e160b83.17c294"]]},{"id":"7042f23b.40a91c","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramMessage","func":"try{\n    flow.set('lastTelegramMessage', msg.payload.caption);\n} catch(e){}","outputs":1,"noerr":0,"x":770,"y":740,"wires":[[]]},{"id":"ed1b362e.9d5968","type":"persist in","z":"7c56a241.1e88dc","name":"text","storageNode":"aa40158d.83bf68","x":710,"y":1900,"wires":[]},{"id":"627cd965.29f9b8","type":"persist out","z":"7c56a241.1e88dc","name":"text","storageNode":"aa40158d.83bf68","x":170,"y":1900,"wires":[["90f79f30.5128a"]]},{"id":"941919ea.591298","type":"persist out","z":"7c56a241.1e88dc","name":"textsize","storageNode":"aa40158d.83bf68","x":160,"y":1940,"wires":[["ac2280f9.16249"]]},{"id":"423001b7.fec31","type":"persist out","z":"7c56a241.1e88dc","name":"cropX","storageNode":"aa40158d.83bf68","x":170,"y":2000,"wires":[["8254dada.b94d58"]]},{"id":"18ae099d.f64776","type":"persist out","z":"7c56a241.1e88dc","name":"cropY","storageNode":"aa40158d.83bf68","x":170,"y":2060,"wires":[["1aa8b429.d2cb4c"]]},{"id":"b489b02d.1c24a","type":"persist out","z":"7c56a241.1e88dc","name":"gravity","storageNode":"aa40158d.83bf68","x":170,"y":2120,"wires":[["d180f32d.9e311"]]},{"id":"f1719bff.7db518","type":"persist out","z":"7c56a241.1e88dc","name":"color","storageNode":"aa40158d.83bf68","x":170,"y":2180,"wires":[["3d21531.919c4ac"]]},{"id":"36027ae8.bee566","type":"persist out","z":"7c56a241.1e88dc","name":"undercolor","storageNode":"aa40158d.83bf68","x":150,"y":2240,"wires":[["38184a7b.3270c6"]]},{"id":"f034466e.9f5538","type":"persist out","z":"7c56a241.1e88dc","name":"bgcolor","storageNode":"aa40158d.83bf68","x":160,"y":2300,"wires":[["585a7ad.f3eb984"]]},{"id":"27e44bc4.7c4484","type":"persist out","z":"7c56a241.1e88dc","name":"bgalpha","storageNode":"aa40158d.83bf68","x":160,"y":2360,"wires":[["6d59b988.e1fa18"]]},{"id":"867c6ca3.d1996","type":"persist out","z":"7c56a241.1e88dc","name":"font","storageNode":"aa40158d.83bf68","x":270,"y":2480,"wires":[["79c38f03.88609"]]},{"id":"cfed2e53.218c4","type":"persist in","z":"7c56a241.1e88dc","name":"textsize","storageNode":"aa40158d.83bf68","x":720,"y":1940,"wires":[]},{"id":"4044d43a.bedd7c","type":"persist in","z":"7c56a241.1e88dc","name":"cropX","storageNode":"aa40158d.83bf68","x":710,"y":2000,"wires":[]},{"id":"28352150.11049e","type":"persist in","z":"7c56a241.1e88dc","name":"cropY","storageNode":"aa40158d.83bf68","x":710,"y":2060,"wires":[]},{"id":"bd6139aa.649098","type":"persist in","z":"7c56a241.1e88dc","name":"gravity","storageNode":"aa40158d.83bf68","x":710,"y":2120,"wires":[]},{"id":"358d0942.7d2936","type":"persist in","z":"7c56a241.1e88dc","name":"color","storageNode":"aa40158d.83bf68","x":710,"y":2180,"wires":[]},{"id":"83dbf2f.ff19f1","type":"persist in","z":"7c56a241.1e88dc","name":"undercolor","storageNode":"aa40158d.83bf68","x":730,"y":2240,"wires":[]},{"id":"1ffe1d7c.c14403","type":"persist in","z":"7c56a241.1e88dc","name":"bgcolor","storageNode":"aa40158d.83bf68","x":840,"y":2280,"wires":[]},{"id":"25f04c65.41db54","type":"persist in","z":"7c56a241.1e88dc","name":"bgalpha","storageNode":"aa40158d.83bf68","x":840,"y":2340,"wires":[]},{"id":"ae65c529.28aca8","type":"persist in","z":"7c56a241.1e88dc","name":"font","storageNode":"aa40158d.83bf68","x":890,"y":2420,"wires":[]},{"id":"5a3cd9b0.9e2848","type":"persist out","z":"7c56a241.1e88dc","name":"nameTextsize","storageNode":"aa40158d.83bf68","x":1080,"y":2380,"wires":[["96e17660.84c2d8"]]},{"id":"dc56b1d6.a55fa","type":"persist in","z":"7c56a241.1e88dc","name":"nameTextsize","storageNode":"aa40158d.83bf68","x":1680,"y":2380,"wires":[]},{"id":"49929ebb.ba7cb","type":"persist out","z":"7c56a241.1e88dc","name":"gravityName","storageNode":"aa40158d.83bf68","x":1090,"y":2440,"wires":[["4a5f8ce2.694264"]]},{"id":"7597dbe9.10b6c4","type":"persist in","z":"7c56a241.1e88dc","name":"gravityName","storageNode":"aa40158d.83bf68","x":1670,"y":2440,"wires":[]},{"id":"1599a9f1.7608d6","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1440,"y":2140,"wires":[[],[],["5dafe331.de7f3c"]]},{"id":"d0a83fff.6eaba","type":"function","z":"7c56a241.1e88dc","name":"convert image add text","func":"var imagepath = global.get('path-preview') + \"preview1280x800.jpg\";\nvar resultpath = global.get('path-preview') + \"previewText.jpg\";\n\nvar bgalpha = flow.get('bgalpha') || \"00\";\nvar bgcolor = flow.get('bgcolor') || \"000000\";\nvar text = flow.get('text') || \"no text entered\";\n// Prepare string for bash -> convert special characters\ntext = text.replace(/\\\\/g , \"\\\\\\\\\").replace(/\"/g , \"\\\\\\\"\");\nvar textsize = \"\";\nif (flow.get('textsize') > 0){\n    textsize = \" -pointsize \" + (flow.get('textsize') || 30);\n}\nvar sizeX = global.get('displayWidth') - flow.get('cropX');\nvar sizeY = global.get('displayHeight') - flow.get('cropY');\nvar gravity = flow.get('gravity') || \"center\";\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\nvar undercolor = \"\";\nif (flow.get('undercolor') !== \"off\"){\n    undercolor = \" -undercolor \" + (flow.get('undercolor') || black);\n}\n\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + undercolor + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:\\\"\" + text + \"\\\" \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":2140,"wires":[["1599a9f1.7608d6"]]},{"id":"5dafe331.de7f3c","type":"function","z":"7c56a241.1e88dc","name":"if ok","func":"if (msg.payload.code === 0){\n    return msg;\n}","outputs":1,"noerr":0,"x":1590,"y":2140,"wires":[["ec06cd21.3584f"]]},{"id":"838d0fa3.dfdf4","type":"persist out","z":"5af1388b.ef9838","name":"anzeigedauer","storageNode":"aa40158d.83bf68","x":200,"y":2080,"wires":[["acb583ed.1f6e1"]]},{"id":"af647e03.8fe05","type":"persist in","z":"5af1388b.ef9838","name":"anzeigedauer","storageNode":"aa40158d.83bf68","x":960,"y":2080,"wires":[]},{"id":"6a9d0ab7.38fd44","type":"persist in","z":"dfa0e0a5.c8001","name":"displayX","storageNode":"aa40158d.83bf68","x":740,"y":180,"wires":[]},{"id":"a6bd4590.053718","type":"persist out","z":"dfa0e0a5.c8001","name":"displayX","storageNode":"aa40158d.83bf68","x":140,"y":180,"wires":[["f7532169.84116"]]},{"id":"d0308973.9e7a18","type":"persist in","z":"dfa0e0a5.c8001","name":"displayY","storageNode":"aa40158d.83bf68","x":740,"y":220,"wires":[]},{"id":"3b565283.bda0de","type":"persist out","z":"dfa0e0a5.c8001","name":"displayY","storageNode":"aa40158d.83bf68","x":140,"y":220,"wires":[["e27c7715.f4ce48"]]},{"id":"79c38f03.88609","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":430,"y":2480,"wires":[["63c3affe.9cbca"]]},{"id":"6874c671.202dd8","type":"function","z":"7c56a241.1e88dc","name":"no #","func":"if (msg.payload.includes('#')){\n    msg.payload = msg.payload.slice(1);\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":2300,"wires":[["975f0fbb.92c15","6660cfe.4d8bc3"]]},{"id":"e0bd1910.7e6ac8","type":"comment","z":"7c56a241.1e88dc","name":"Settings Textoverlay","info":"","x":170,"y":1820,"wires":[]},{"id":"3e32eae9.dd5636","type":"function","z":"7c56a241.1e88dc","name":"switch if text","func":"if((flow.get('lastTelegramMessage') || false ) === false){\n    msg.topic = \"textFalseName\";\n    return [null, msg];\n} else {\n    msg.topic = \"textTrueName\";\n    flow.set('triggerControl', 2);\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":970,"y":1240,"wires":[["47b2d8c4.6cd5c8"],["fd4afe8c.3fa31"]]},{"id":"e1aec8f5.2b7b28","type":"comment","z":"7c56a241.1e88dc","name":"create thumbnails","info":"","x":370,"y":1360,"wires":[]},{"id":"a1bd3724.340b78","type":"comment","z":"7c56a241.1e88dc","name":"delete source files","info":"","x":290,"y":1580,"wires":[]},{"id":"ec06cd21.3584f","type":"function","z":"7c56a241.1e88dc","name":"convert image add name","func":"// set variables\nvar imagepath = global.get('path-preview');\nvar resultpath = imagepath;\nvar sizeX = global.get('displayWidth');\nvar sizeY = global.get('displayHeight');\nvar gravity = (flow.get('gravityName')) || \"southeast\";\nvar undercolor = \"black\"; //\n\n// fix variables\n\nimagepath = imagepath + \"previewText.jpg\";\nresultpath = resultpath + \"previewText.jpg\";\n\nvar textsize = (flow.get('nameTextsize')) || 40;\nvar bgalpha = \"00\";\nvar bgcolor = \"000000\";\nvar text = \"Name\";\n// Prepare string for bash -> convert special characters\ntext = text.replace(/\\\\/g , \"\\\\\\\\\").replace(/\"/g , \"\\\\\\\"\");\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\n\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + \" -undercolor \" + undercolor + \" -pointsize \" + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:\\\"\" + text + \"\\\" \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":2220,"wires":[["ef800132.712b4"]]},{"id":"ef800132.712b4","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1440,"y":2220,"wires":[["ef90c7f4.06d958"],[],["cc682995.5cfca8"]]},{"id":"cc682995.5cfca8","type":"function","z":"7c56a241.1e88dc","name":"if ok","func":"if (msg.payload.code === 0){\n    return msg;\n}","outputs":1,"noerr":0,"x":1590,"y":2220,"wires":[["47377c6c.b062e4"]]},{"id":"1bc5e035.452d1","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Max. Anzahl Papierkorb","tooltip":"","group":"79173158.54b5a","order":5,"width":10,"height":1,"passthru":true,"outs":"end","topic":"","min":"1","max":"999","step":1,"x":490,"y":2440,"wires":[["a9b46012.6e6f7","cf0a036c.6296d"]]},{"id":"cc323c1e.9684c","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":690,"y":2300,"wires":[["a6961568.21e038"],["a6961568.21e038"],["a6961568.21e038"]]},{"id":"d94018d9.852338","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"sudo cat /dev/tty1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":530,"y":2280,"wires":[["cc323c1e.9684c"]]},{"id":"a6961568.21e038","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":2300,"wires":[]},{"id":"d088436c.e3048","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"sudo killall cat","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":510,"y":2320,"wires":[["cc323c1e.9684c"]]},{"id":"8936fbaa.4e7a78","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Aus / Ein","tooltip":"","group":"df1cecd4.4f555","order":1,"width":5,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":320,"y":2160,"wires":[["22757c1.e629b84"]]},{"id":"f34c1177.b2b79","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"textActive","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":2160,"wires":[["ac44fda1.7d4db"]]},{"id":"2de84ae9.85c9d6","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"loopMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":2320,"wires":[[]]},{"id":"4b9edd86.f48ea4","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":140,"wires":[["ec056cf1.92b03"]]},{"id":"afd767a1.e9d978","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"trashMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":2460,"wires":[[]]},{"id":"1113e99f.336446","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1310,"y":540,"wires":[[],[],["93ae52c8.5c9d5","fa5a8487.7ff8c8"]]},{"id":"9864f6a2.cf29a8","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-trash')","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":980,"y":540,"wires":[["a6dd565f.ad3e98"]]},{"id":"a6dd565f.ad3e98","type":"function","z":"168e0b9d.9c19d4","name":"trash: rename + 1","func":"if (msg.payload.length > 0){\n    \n    var file;\n    var fileNew;\n    var folder;\n    var cmd = \"\";\n    var x;\n    var postfix;\n    \n    // FileLister-Array rückwärts durchlaufen\n    for (var i=msg.payload.length-1; i >= 0; i--) {\n        \n        // Datei- und Ordnername extrahieren\n        file = msg.payload[i].slice(msg.payload[i].lastIndexOf(\"/\") + 1);\n        folder = msg.payload[i].slice(0, msg.payload[i].lastIndexOf(\"/\") + 1);\n        \n        // inkrementieren\n        x = parseInt(file.slice(0, 4));\n        postfix = file.slice(4);\n        \n        if (Number.isInteger(x)){\n\n            x = x + 1;\n\n            if(x > global.get('trashMax')){\n                // Datei löschen\n                cmd = cmd + \"rm \" + folder + file + \" && \";\n    \n            } else {\n                // Umbenennen nach neuem Dateinamen und an cmd anhängen\n                fileNew = x + postfix;\n                cmd = cmd + \"mv \" + folder + file + \" \" + folder + fileNew + \" && \";\n            }\n        }\n    }\n    // letztes '&&' hinten abschneiden\n    msg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);\n    \n} else {\n    msg.payload = \"\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":540,"wires":[["1113e99f.336446"]]},{"id":"f0b57d5c.3e53e","type":"link in","z":"168e0b9d.9c19d4","name":"loop filenr +1","links":["98da01cf.24f5d","36ccb8a5.9a9e78"],"x":155,"y":180,"wires":[["ec056cf1.92b03"]]},{"id":"98da01cf.24f5d","type":"link out","z":"7c56a241.1e88dc","name":"","links":["f0b57d5c.3e53e"],"x":895,"y":1280,"wires":[]},{"id":"4e79dda9.59f3b4","type":"comment","z":"5af1388b.ef9838","name":"Settings","info":"","x":180,"y":2000,"wires":[]},{"id":"a8cc1088.83d24","type":"function","z":"5af1388b.ef9838","name":"move files","func":"if(msg.payload){\n  \n    msg.payload = \"mv \" + global.get('images-stackText') + \"*.*.*.*.addText.*.dash.* \" + global.get('images-dashboard') + \" && mv \" + global.get('images-stackText') + \"*.*.*.*.addText.* \" + global.get('images-frameloop');\n    \n} else {\n    \n    msg.payload = \"mv \" + global.get('images-dashboard') + \"*.*.*.*.addText.*.dash.* \" + global.get('images-stackText') + \" && mv \" + global.get('images-frameloop') + \"*.*.*.*.addText.* \" + global.get('images-stackText');\n}\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":2220,"wires":[["35723607.2c8e9a"]]},{"id":"35723607.2c8e9a","type":"exec","z":"5af1388b.ef9838","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":710,"y":2220,"wires":[[],[],["280a718e.3cdc7e"]]},{"id":"eca4f699.a2e5e8","type":"persist out","z":"5af1388b.ef9838","name":"textActive","storageNode":"aa40158d.83bf68","x":180,"y":2160,"wires":[["8936fbaa.4e7a78"]]},{"id":"ac44fda1.7d4db","type":"persist in","z":"5af1388b.ef9838","name":"textActive","storageNode":"aa40158d.83bf68","x":940,"y":2160,"wires":[]},{"id":"ed0af056.6b6d5","type":"persist out","z":"5af1388b.ef9838","name":"loopMax","storageNode":"aa40158d.83bf68","x":220,"y":2300,"wires":[["3c457ef9.347f12"]]},{"id":"b1c05f38.e988c","type":"persist out","z":"5af1388b.ef9838","name":"trashMax","storageNode":"aa40158d.83bf68","x":220,"y":2440,"wires":[["1bc5e035.452d1"]]},{"id":"9896db89.201e78","type":"persist in","z":"5af1388b.ef9838","name":"loopMax","storageNode":"aa40158d.83bf68","x":700,"y":2280,"wires":[]},{"id":"a9b46012.6e6f7","type":"persist in","z":"5af1388b.ef9838","name":"trashMax","storageNode":"aa40158d.83bf68","x":700,"y":2420,"wires":[]},{"id":"c4d060eb.a68cb","type":"ui_dropdown","z":"e00097c0.ad3088","name":"","label":"","tooltip":"","place":"","group":"98f89e13.1f66c","order":3,"width":10,"height":1,"passthru":true,"options":[{"label":"Timer Off","value":"timerOff","type":"str"},{"label":"06:00","value":"06:00","type":"str"},{"label":"","value":"06:15","type":"str"},{"label":"","value":"06:30","type":"str"},{"label":"","value":"06:45","type":"str"},{"label":"","value":"07:00","type":"str"},{"label":"","value":"07:15","type":"str"},{"label":"","value":"07:30","type":"str"},{"label":"","value":"07:45","type":"str"},{"label":"","value":"08:00","type":"str"},{"label":"","value":"08:15","type":"str"},{"label":"","value":"08:30","type":"str"},{"label":"","value":"08:45","type":"str"},{"label":"","value":"09:00","type":"str"},{"label":"","value":"09:15","type":"str"},{"label":"","value":"09:30","type":"str"},{"label":"","value":"09:45","type":"str"},{"label":"","value":"10:00","type":"str"},{"label":"","value":"10:15","type":"str"},{"label":"","value":"10:30","type":"str"},{"label":"","value":"10:45","type":"str"},{"label":"","value":"11:00","type":"str"},{"label":"","value":"11:15","type":"str"},{"label":"","value":"11:30","type":"str"},{"label":"","value":"11:45","type":"str"},{"label":"","value":"12:00","type":"str"},{"label":"","value":"12:15","type":"str"},{"label":"","value":"12:30","type":"str"},{"label":"","value":"12:45","type":"str"},{"label":"","value":"13:00","type":"str"},{"label":"","value":"13:15","type":"str"},{"label":"","value":"13:30","type":"str"},{"label":"","value":"13:45","type":"str"},{"label":"","value":"14:00","type":"str"},{"label":"","value":"14:15","type":"str"},{"label":"","value":"14:30","type":"str"},{"label":"","value":"14:45","type":"str"},{"label":"","value":"15:00","type":"str"},{"label":"","value":"15:15","type":"str"},{"label":"","value":"15:30","type":"str"},{"label":"","value":"15:45","type":"str"},{"label":"","value":"16:00","type":"str"},{"label":"","value":"16:15","type":"str"},{"label":"","value":"16:30","type":"str"},{"label":"","value":"16:45","type":"str"},{"label":"","value":"17:00","type":"str"},{"label":"","value":"17:15","type":"str"},{"label":"","value":"17:30","type":"str"},{"label":"","value":"17:45","type":"str"},{"label":"","value":"18:00","type":"str"},{"label":"","value":"18:15","type":"str"},{"label":"","value":"18:30","type":"str"},{"label":"","value":"18:45","type":"str"},{"label":"","value":"19:00","type":"str"},{"label":"","value":"19:15","type":"str"},{"label":"","value":"19:30","type":"str"},{"label":"","value":"19:45","type":"str"},{"label":"","value":"20:00","type":"str"},{"label":"","value":"20:15","type":"str"},{"label":"","value":"20:30","type":"str"},{"label":"","value":"20:45","type":"str"},{"label":"","value":"21:00","type":"str"},{"label":"","value":"21:15","type":"str"},{"label":"","value":"21:30","type":"str"},{"label":"","value":"21:45","type":"str"},{"label":"","value":"22:00","type":"str"},{"label":"","value":"22:15","type":"str"},{"label":"","value":"","type":"str"},{"label":"","value":"22:30","type":"str"},{"label":"","value":"22:45","type":"str"},{"label":"","value":"23:00","type":"str"},{"label":"","value":"23:15","type":"str"},{"label":"","value":"23:30","type":"str"},{"label":"","value":"23:45","type":"str"},{"label":"","value":"00:00","type":"str"},{"label":"","value":"00:15","type":"str"},{"label":"","value":"00:30","type":"str"},{"label":"","value":"00:45","type":"str"},{"label":"","value":"01:00","type":"str"},{"label":"","value":"01:15","type":"str"},{"label":"","value":"01:30","type":"str"},{"label":"","value":"01:45","type":"str"},{"label":"","value":"02:00","type":"str"},{"label":"","value":"02:15","type":"str"},{"label":"","value":"02:30","type":"str"},{"label":"","value":"02:45","type":"str"},{"label":"","value":"03:00","type":"str"},{"label":"","value":"03:15","type":"str"},{"label":"","value":"03:30","type":"str"},{"label":"","value":"03:45","type":"str"},{"label":"","value":"04:00","type":"str"},{"label":"","value":"04:15","type":"str"},{"label":"","value":"04:30","type":"str"},{"label":"","value":"04:45","type":"str"},{"label":"","value":"05:00","type":"str"},{"label":"","value":"05:15","type":"str"},{"label":"","value":"05:30","type":"str"},{"label":"","value":"05:45","type":"str"}],"payload":"","topic":"timeOn","x":350,"y":460,"wires":[["fc007af8.4b0098","2f2c6d12.96cd32"]]},{"id":"fc007af8.4b0098","type":"function","z":"e00097c0.ad3088","name":"create timer input","func":"if (msg.payload === \"timerOff\"){\n    msg.payload = { suspended:true };\n} else if (msg.topic === \"timeOn\"){\n    msg.payload = { ontime:msg.payload, suspended:false };\n} else if (msg.topic === \"timeOff\"){\n    msg.payload = { offtime:msg.payload, suspended:false };\n} else return null;\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":540,"wires":[["3062f612.357daa"]]},{"id":"3062f612.357daa","type":"schedex","z":"e00097c0.ad3088","name":"Timer","passthroughunhandled":false,"suspended":false,"lat":"","lon":"","ontime":"","ontopic":"","onpayload":"1","onoffset":0,"onrandomoffset":0,"offtime":"","offtopic":"","offpayload":"0","offoffset":0,"offrandomoffset":0,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":790,"y":540,"wires":[["219171dc.c5a49e"]]},{"id":"219171dc.c5a49e","type":"function","z":"e00097c0.ad3088","name":"convert string -> int","func":"if (msg.payload === \"1\") {\n    msg.payload = 1;\n}\nelse {\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":540,"wires":[["65b2fd66.a9b1e4"]]},{"id":"588ec493.a2088c","type":"ui_dropdown","z":"e00097c0.ad3088","name":"","label":"","tooltip":"","place":"","group":"98f89e13.1f66c","order":6,"width":10,"height":1,"passthru":true,"options":[{"label":"Timer Off","value":"timerOff","type":"str"},{"label":"","value":"06:00","type":"str"},{"label":"","value":"06:15","type":"str"},{"label":"","value":"06:30","type":"str"},{"label":"","value":"06:45","type":"str"},{"label":"","value":"07:00","type":"str"},{"label":"","value":"07:15","type":"str"},{"label":"","value":"07:30","type":"str"},{"label":"","value":"07:45","type":"str"},{"label":"","value":"08:00","type":"str"},{"label":"","value":"08:15","type":"str"},{"label":"","value":"08:30","type":"str"},{"label":"","value":"08:45","type":"str"},{"label":"","value":"09:00","type":"str"},{"label":"","value":"09:15","type":"str"},{"label":"","value":"09:30","type":"str"},{"label":"","value":"09:45","type":"str"},{"label":"","value":"10:00","type":"str"},{"label":"","value":"10:15","type":"str"},{"label":"","value":"10:30","type":"str"},{"label":"","value":"10:45","type":"str"},{"label":"","value":"11:00","type":"str"},{"label":"","value":"11:15","type":"str"},{"label":"","value":"11:30","type":"str"},{"label":"","value":"11:45","type":"str"},{"label":"","value":"12:00","type":"str"},{"label":"","value":"12:15","type":"str"},{"label":"","value":"12:30","type":"str"},{"label":"","value":"12:45","type":"str"},{"label":"","value":"13:00","type":"str"},{"label":"","value":"13:15","type":"str"},{"label":"","value":"13:30","type":"str"},{"label":"","value":"13:45","type":"str"},{"label":"","value":"14:00","type":"str"},{"label":"","value":"14:15","type":"str"},{"label":"","value":"14:30","type":"str"},{"label":"","value":"14:45","type":"str"},{"label":"","value":"15:00","type":"str"},{"label":"","value":"15:15","type":"str"},{"label":"","value":"15:30","type":"str"},{"label":"","value":"15:45","type":"str"},{"label":"","value":"16:00","type":"str"},{"label":"","value":"16:15","type":"str"},{"label":"","value":"16:30","type":"str"},{"label":"","value":"16:45","type":"str"},{"label":"","value":"17:00","type":"str"},{"label":"","value":"17:15","type":"str"},{"label":"","value":"17:30","type":"str"},{"label":"","value":"17:45","type":"str"},{"label":"","value":"18:00","type":"str"},{"label":"","value":"18:15","type":"str"},{"label":"","value":"18:30","type":"str"},{"label":"","value":"18:45","type":"str"},{"label":"","value":"19:00","type":"str"},{"label":"","value":"19:15","type":"str"},{"label":"","value":"19:30","type":"str"},{"label":"","value":"19:45","type":"str"},{"label":"","value":"20:00","type":"str"},{"label":"","value":"20:15","type":"str"},{"label":"","value":"20:30","type":"str"},{"label":"","value":"20:45","type":"str"},{"label":"","value":"21:00","type":"str"},{"label":"","value":"21:15","type":"str"},{"label":"","value":"21:30","type":"str"},{"label":"","value":"21:45","type":"str"},{"label":"","value":"22:00","type":"str"},{"label":"","value":"22:15","type":"str"},{"label":"","value":"22:30","type":"str"},{"label":"","value":"22:45","type":"str"},{"label":"","value":"23:00","type":"str"},{"label":"","value":"23:15","type":"str"},{"label":"","value":"23:30","type":"str"},{"label":"","value":"23:45","type":"str"},{"label":"","value":"00:00","type":"str"},{"label":"","value":"00:15","type":"str"},{"label":"","value":"00:30","type":"str"},{"label":"","value":"00:45","type":"str"},{"label":"","value":"01:00","type":"str"},{"label":"","value":"01:15","type":"str"},{"label":"","value":"01:30","type":"str"},{"label":"","value":"01:45","type":"str"},{"label":"","value":"02:00","type":"str"},{"label":"","value":"02:15","type":"str"},{"label":"","value":"02:30","type":"str"},{"label":"","value":"02:45","type":"str"},{"label":"","value":"03:00","type":"str"},{"label":"","value":"03:15","type":"str"},{"label":"","value":"03:30","type":"str"},{"label":"","value":"03:45","type":"str"},{"label":"","value":"04:00","type":"str"},{"label":"","value":"04:15","type":"str"},{"label":"","value":"04:30","type":"str"},{"label":"","value":"04:45","type":"str"},{"label":"","value":"05:00","type":"str"},{"label":"","value":"05:15","type":"str"},{"label":"","value":"05:30","type":"str"},{"label":"","value":"05:45","type":"str"}],"payload":"","topic":"timeOff","x":350,"y":600,"wires":[["fc007af8.4b0098","83242b7b.dca458"]]},{"id":"a8c60203.b8af1","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":4,"width":2,"height":1,"name":"","label":"Uhr","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":500,"wires":[]},{"id":"fa2ce4df.75bec8","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":7,"width":2,"height":1,"name":"","label":"Uhr","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":640,"wires":[]},{"id":"cf226409.f192c8","type":"comment","z":"e00097c0.ad3088","name":"Display On/Off","info":"","x":180,"y":100,"wires":[]},{"id":"bcbbb945.48f918","type":"exec","z":"e00097c0.ad3088","command":"vcgencmd display_power 0","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":880,"y":280,"wires":[[],[],[]]},{"id":"2951b8b6.676678","type":"exec","z":"e00097c0.ad3088","command":"vcgencmd display_power 1","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":880,"y":220,"wires":[[],[],[]]},{"id":"5f4c3995.ed98f8","type":"inject","z":"e00097c0.ad3088","name":"Display off","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":180,"wires":[["bcbbb945.48f918"]]},{"id":"89f91e00.3f566","type":"inject","z":"e00097c0.ad3088","name":"Display on","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":140,"wires":[["2951b8b6.676678"]]},{"id":"65b2fd66.a9b1e4","type":"ui_switch","z":"e00097c0.ad3088","name":"","label":"Aus / An","tooltip":"","group":"98f89e13.1f66c","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":360,"y":260,"wires":[["ed6040e4.f77e3"]]},{"id":"1d8775e4.7c3f0a","type":"switch","z":"e00097c0.ad3088","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":260,"wires":[["2951b8b6.676678"],["bcbbb945.48f918"]]},{"id":"f6e96d1d.c2c99","type":"persist in","z":"e00097c0.ad3088","name":"displayOnOff","storageNode":"aa40158d.83bf68","x":630,"y":300,"wires":[]},{"id":"74c7673f.dd4d28","type":"persist out","z":"e00097c0.ad3088","name":"displayOnOff","storageNode":"aa40158d.83bf68","x":170,"y":260,"wires":[["65b2fd66.a9b1e4"]]},{"id":"9c0d31fe.b5e8c","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":2,"width":12,"height":1,"name":"","label":"Bildschirm an","format":"{{msg.payload}}","layout":"row-spread","x":340,"y":420,"wires":[]},{"id":"8489dec8.3f46b","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":5,"width":12,"height":1,"name":"","label":"Bildschirm aus","format":"{{msg.payload}}","layout":"row-spread","x":340,"y":560,"wires":[]},{"id":"b6697f46.5fd87","type":"persist out","z":"e00097c0.ad3088","name":"turnOnTime","storageNode":"aa40158d.83bf68","x":170,"y":460,"wires":[["c4d060eb.a68cb"]]},{"id":"11a7bd67.c88f33","type":"persist out","z":"e00097c0.ad3088","name":"turnOffTime","storageNode":"aa40158d.83bf68","x":170,"y":600,"wires":[["588ec493.a2088c"]]},{"id":"2f2c6d12.96cd32","type":"persist in","z":"e00097c0.ad3088","name":"turnOnTime","storageNode":"aa40158d.83bf68","x":550,"y":460,"wires":[]},{"id":"83242b7b.dca458","type":"persist in","z":"e00097c0.ad3088","name":"turnOffTime","storageNode":"aa40158d.83bf68","x":550,"y":600,"wires":[]},{"id":"57bc4739.705b68","type":"comment","z":"168e0b9d.9c19d4","name":"increment filenr @Loop","info":"","x":240,"y":120,"wires":[]},{"id":"e84b8926.5492f8","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":740,"wires":[["798c5829.61a1a8"]]},{"id":"798c5829.61a1a8","type":"function","z":"168e0b9d.9c19d4","name":"global.get currentFile","func":"msg.payload = global.get('currentFile');\nflow.set('currentFileDel', global.get('currentFile'));\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":780,"wires":[["653e16f.0009ae8"]]},{"id":"1ff305c8.393f9a","type":"link in","z":"168e0b9d.9c19d4","name":"delete file","links":["b64ff816.331a88"],"x":155,"y":780,"wires":[["798c5829.61a1a8"]]},{"id":"4d06230b.8ecc3c","type":"comment","z":"168e0b9d.9c19d4","name":"delete file","info":"","x":200,"y":700,"wires":[]},{"id":"419474a5.fd8ecc","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1310,"y":780,"wires":[[],[],["f9c3ea3d.aa6888"]]},{"id":"28f4d1ba.a8ea5e","type":"function","z":"168e0b9d.9c19d4","name":"move to trash","func":"if (msg.payload.length > 0){\n    \n    var file;\n    var cmd = \"\";\n    \n    // FileLister-Array vorwärts durchlaufen\n    for (var i=0; i < msg.payload.length; i++) {\n        \n        // Dateiname extrahieren\n        file = msg.payload[i].slice(msg.payload[i].lastIndexOf(\"/\") + 1);\n        \n        // Umbenennen nach neuem Dateinamen und an cmd anhängen\n        cmd = cmd + \"mv \" + msg.payload[i] + \" \" + global.get('images-trash') + \"1000.trash.\" + file + \" && \";\n\n    }\n    // letztes '&&' hinten abschneiden\n    msg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);\n    \n    return msg;    \n}","outputs":1,"noerr":0,"x":1160,"y":780,"wires":[["419474a5.fd8ecc"]]},{"id":"13194866.0b12b8","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-loop')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":"1","stat":false,"showWarnings":true,"x":980,"y":780,"wires":[["28f4d1ba.a8ea5e"]]},{"id":"50d656c2.bd1d18","type":"function","z":"168e0b9d.9c19d4","name":"set FL file pattern (nr) + folder","func":"var startfile = msg.payload.lastIndexOf(\"/\") + 1;\nvar start = global.get('images-loop');\nvar pattern = msg.payload.slice(startfile, startfile+4) + \".*\";\n\nmsg.payload = {start, pattern};\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":780,"wires":[["13194866.0b12b8"]]},{"id":"e34da76.5634d58","type":"link in","z":"168e0b9d.9c19d4","name":"trash filenr +1","links":["a5ef733e.6cb3a","d83da989.712c18"],"x":155,"y":540,"wires":[["9742198d.4b0aa8"]]},{"id":"a5ef733e.6cb3a","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["e34da76.5634d58","300fc85d.3126d8"],"x":1815,"y":780,"wires":[]},{"id":"8789cd73.c6c3c","type":"function","z":"5af1388b.ef9838","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":510,"y":920,"wires":[["b64ff816.331a88","c6dfd6ad.5a9d78"]]},{"id":"af1fd754.2f7da8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"currentFile","pt":"global","to":"payload.data.data.item.file","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":300,"wires":[["d478b536.e92718"]]},{"id":"b64ff816.331a88","type":"link out","z":"5af1388b.ef9838","name":"","links":["1ff305c8.393f9a"],"x":655,"y":920,"wires":[]},{"id":"924eb351.0aacd","type":"function","z":"168e0b9d.9c19d4","name":"stick file","func":"return msg;","outputs":1,"noerr":0,"x":620,"y":940,"wires":[["702a3df4.7558c4"]]},{"id":"aa6fc960.ab2d08","type":"link in","z":"168e0b9d.9c19d4","name":"(un-)stick file","links":["793b21c7.52223"],"x":155,"y":980,"wires":[["cb711e58.62298"]]},{"id":"22ba6e36.135602","type":"comment","z":"168e0b9d.9c19d4","name":"(un-)stick file","info":"","x":210,"y":900,"wires":[]},{"id":"3fa5e56f.a066ca","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1370,"y":940,"wires":[[],[],[]]},{"id":"eabbc1ef.5dcca","type":"function","z":"168e0b9d.9c19d4","name":"add 'stick'","func":"if(msg.payload.length > 0){\n    \n    var cmd = \"\";\n    var file;\n    var folder;\n    \n    // FileLister-Array vorwärts durchlaufen\n    for (var i=0; i < msg.payload.length; i++) {\n\n        // Umbenennen nach neuem Dateinamen und an cmd anhängen\n        cmd = cmd + \"mv \" + msg.payload[i] + \" \" + msg.payload[i] + \".stick.jpg\" + \" && \";\n    }\n    // letztes '&&' hinten abschneiden\n    msg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":1230,"y":940,"wires":[["3fa5e56f.a066ca"]]},{"id":"6363796d.970b38","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-loop')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":"1","stat":false,"showWarnings":true,"x":1060,"y":940,"wires":[["eabbc1ef.5dcca"]]},{"id":"10b21058.f480c","type":"comment","z":"5af1388b.ef9838","name":"stick","info":"","x":190,"y":980,"wires":[]},{"id":"793b21c7.52223","type":"link out","z":"5af1388b.ef9838","name":"","links":["aa6fc960.ab2d08"],"x":475,"y":1040,"wires":[]},{"id":"bf63c1dd.c767b","type":"function","z":"5af1388b.ef9838","name":"set color","func":"if(msg.topic){\n    msg.payload = \"#eb4034\";\n} else {\n    msg.payload = \"\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":1040,"wires":[["6ca0a6f5.8b6858"]]},{"id":"2a52a9ea.bcf6b6","type":"debug","z":"5af1388b.ef9838","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":330,"y":140,"wires":[]},{"id":"6407c025.f7455","type":"function","z":"5af1388b.ef9838","name":"set topic: if stick","func":"try{\n    if (msg.payload.notification === \"Player.OnPlay\"){\n    \n        var file = msg.payload.data.data.item.file;\n        var index = file.lastIndexOf('jpg');\n        \n        if (file.slice(index -6, index -1) === \"stick\"){\n            msg.topic = true;\n        } else {\n            msg.topic = false;\n        }\n        \n        return msg;   \n    }\n} catch(e){}","outputs":1,"noerr":0,"x":240,"y":1160,"wires":[["bf63c1dd.c767b","4b692df3.f4f474","cd835703.413928"]]},{"id":"cd835703.413928","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"stickFlag","pt":"flow","to":"topic","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1160,"wires":[[]]},{"id":"3f1fff6a.78965","type":"function","z":"168e0b9d.9c19d4","name":"unstick file","func":"return msg;","outputs":1,"noerr":0,"x":630,"y":1020,"wires":[["2ff22d2b.2cdc72"]]},{"id":"f09dafcf.319c4","type":"function","z":"168e0b9d.9c19d4","name":"delete 'stick'","func":"if(msg.payload.length > 0){\n\n    var cmd = \"\";\n    var file;\n    var fileNew;\n    var folder;    \n    \n    // FileLister-Array vorwärts durchlaufen\n    for (var i=0; i < msg.payload.length; i++) {\n        \n        // Datei- und Ordnername extrahieren\n        file = msg.payload[i].slice((msg.payload[i].lastIndexOf(\"/\")) + 1);\n        folder = msg.payload[i].slice(0, (msg.payload[i].lastIndexOf(\"/\")) + 1);\n        \n        // 'stick.jpg' abschneiden\n        fileNew = (file.slice(0, file.lastIndexOf('jpg') - 7));\n        \n        // Umbenennen nach neuem Dateinamen und an cmd anhängen\n        cmd = cmd + \"mv \" + msg.payload[i] + \" \" + folder + fileNew + \" && \";\n    }\n    \n    // letztes '&&' hinten abschneiden\n    msg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":1230,"y":1020,"wires":[["5a66ec3f.74a8c4"]]},{"id":"5a66ec3f.74a8c4","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1370,"y":1020,"wires":[[],[],[]]},{"id":"9f0cbd7a.e5653","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-loop')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":"1","stat":false,"showWarnings":true,"x":1060,"y":1020,"wires":[["f09dafcf.319c4"]]},{"id":"19f420bd.ed901f","type":"function","z":"7c56a241.1e88dc","name":"wget video","func":"try {\n    msg.payload = \"wget \" + msg.payload.weblink + \" -P \" + global.get('videos-incoming');\n    return msg;\n} catch (e){}","outputs":1,"noerr":0,"x":1290,"y":220,"wires":[["103f13b1.59e58c","50774bbf.0fa3a4"]]},{"id":"103f13b1.59e58c","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1450,"y":220,"wires":[[],[],["f7d23ddc.32e82"]]},{"id":"4c611dba.ec1c54","type":"comment","z":"dfa0e0a5.c8001","name":"Log","info":"","x":110,"y":1780,"wires":[]},{"id":"3e3aa4c4.10f0ac","type":"link in","z":"dfa0e0a5.c8001","name":"Log","links":["e0dbe779.1681b8"],"x":220,"y":1840,"wires":[["13850e93.5260c1"]]},{"id":"e0dbe779.1681b8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["3e3aa4c4.10f0ac"],"x":235,"y":300,"wires":[]},{"id":"5e07aefb.00bfb","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"","tooltip":"Ordnerpfad","group":"1229b955.63bec7","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":"100","topic":"","x":280,"y":2000,"wires":[["4052e58d.3b49bc","1b8f0442.7e744c"]]},{"id":"d74046c4.67d498","type":"comment","z":"dfa0e0a5.c8001","name":"telegrampath","info":"","x":130,"y":1940,"wires":[]},{"id":"bdc73cbc.476d8","type":"persist out","z":"dfa0e0a5.c8001","name":"telegrampath","storageNode":"aa40158d.83bf68","x":150,"y":2060,"wires":[["5e07aefb.00bfb"]]},{"id":"4052e58d.3b49bc","type":"persist in","z":"dfa0e0a5.c8001","name":"telegrampath","storageNode":"aa40158d.83bf68","x":450,"y":2060,"wires":[]},{"id":"1b8f0442.7e744c","type":"function","z":"dfa0e0a5.c8001","name":"add \"/\"","func":"if(msg.payload.slice(-1) !== \"/\"){\n    msg.payload = msg.payload + \"/\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":2000,"wires":[["6cfad06a.94f4f"]]},{"id":"6cfad06a.94f4f","type":"function","z":"dfa0e0a5.c8001","name":"set folders","func":"// Images\nvar imagefolder = \"images/\";\nimagefolder = msg.payload + imagefolder;\n\nglobal.set('path-images', imagefolder);\nglobal.set('images-incoming', (imagefolder + \"01.incoming/\"));\nglobal.set('images-preprocessing', (imagefolder + \"02.preprocessing/\"));\nglobal.set('images-loop', (imagefolder + \"03.loop/\"));\nglobal.set('images-frameloop', (imagefolder + \"03.loop/01.frameloop/\"));\nglobal.set('images-dashboard', (imagefolder + \"03.loop/02.dashboard/\"));\nglobal.set('images-stackText', (imagefolder + \"03.loop/03.stackText/\"));\nglobal.set('images-trash', (imagefolder + \"04.trash/\"));\n\n\n// Videos\nvar videofolder = \"videos/\";\nvideofolder = msg.payload + videofolder;\n\nglobal.set('path-videos', videofolder);\nglobal.set('videos-incoming', (videofolder + \"01.incoming/\"));\nglobal.set('videos-preprocessing', (videofolder + \"02.preprocessing/\"));\nglobal.set('videos-frameloop', (videofolder + \"03.frameloop/\"));\n\n\n// Preview\nvar previewfolder = \"preview/\";\npreviewfolder = msg.payload + previewfolder;\n\nglobal.set('path-preview', previewfolder);","outputs":1,"noerr":0,"x":710,"y":2000,"wires":[[]]},{"id":"c52d3fad.85dbf","type":"function","z":"7c56a241.1e88dc","name":"set FL Folder","func":"msg.payload = {start: global.get('images-incoming')};\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":960,"wires":[["911c282a.81a5f8"]]},{"id":"9742198d.4b0aa8","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder (trash)","func":"msg.payload = {start: global.get('images-trash')};\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":540,"wires":[["a377348b.c9e318","95337ecc.2b917"]]},{"id":"6dcb1ff9.6492a","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Botname","tooltip":"","group":"9ed2be8.851194","order":1,"width":8,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":220,"y":3640,"wires":[["c74df752.9be8d8"]]},{"id":"c74df752.9be8d8","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"botname","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":3640,"wires":[[]]},{"id":"6960b4be.57d08c","type":"comment","z":"7c56a241.1e88dc","name":"Bot","info":"","x":170,"y":3580,"wires":[]},{"id":"bb264c6b.11645","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Token","tooltip":"","group":"9ed2be8.851194","order":2,"width":8,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":210,"y":3680,"wires":[["250a2aca.4bd9d6"]]},{"id":"250a2aca.4bd9d6","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"bottoken","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":3680,"wires":[[]]},{"id":"53e50bc7.b9b854","type":"comment","z":"5af1388b.ef9838","name":"IMAGES","info":"","x":140,"y":220,"wires":[]},{"id":"4e5fff10.24769","type":"comment","z":"5af1388b.ef9838","name":"VIDEOS","info":"","x":150,"y":2900,"wires":[]},{"id":"df26ac7e.fef28","type":"ui_button","z":"5af1388b.ef9838","name":"pause","group":"c51c9a95.f2cb68","order":5,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-pause","payload":"pause","payloadType":"str","topic":"","x":730,"y":3020,"wires":[["20afec52.82efa4","bbcc94e4.472028","228c29b0.337986"]]},{"id":"927e6904.449578","type":"ui_button","z":"5af1388b.ef9838","name":"stop","group":"c51c9a95.f2cb68","order":6,"width":2,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-stop","payload":"stop","payloadType":"str","topic":"","x":730,"y":3080,"wires":[["1bc2dc85.dafca3","bbcc94e4.472028","228c29b0.337986"]]},{"id":"2e1296c7.66d7ca","type":"ui_button","z":"5af1388b.ef9838","name":"play","group":"c51c9a95.f2cb68","order":4,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-play","payload":"play","payloadType":"str","topic":"","x":730,"y":3140,"wires":[["25ecf2e8.488cfe","bbcc94e4.472028","3dc142d0.bec18e","21fd1787.3c13b8"]]},{"id":"5e8cf1c6.62138","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"c51c9a95.f2cb68","order":7,"width":2,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":330,"y":3460,"wires":[["20d45bdb.5dda64","27175ae3.331876"]]},{"id":"3d27329c.35b44e","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"c51c9a95.f2cb68","order":8,"width":2,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":330,"y":3500,"wires":[["20d45bdb.5dda64","27175ae3.331876"]]},{"id":"76bd882a.b637c8","type":"ui_button","z":"5af1388b.ef9838","name":"delete","group":"c51c9a95.f2cb68","order":9,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"Wirklich löschen?","payloadType":"str","topic":"","x":410,"y":3560,"wires":[["f97aa165.c7016"]]},{"id":"f97aa165.c7016","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":550,"y":3560,"wires":[["1d9b5bde.6fb704"]]},{"id":"da1ff016.0093","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification top (5sec)","func":"return {\n    payload: \n        {\n            \"method\":\"GUI.ShowNotification\",\n            \"params\":{\n                \"title\":msg.payload,\n                \"message\":\"\",\n                \"displaytime\":5000\n            }\n        }\n};","outputs":1,"noerr":0,"x":1410,"y":860,"wires":[["b2efa2c8.3efc"]]},{"id":"683c6b5e.62fc74","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification (5sec) [msg.payload]","links":[],"x":1175,"y":860,"wires":[["da1ff016.0093"]]},{"id":"1c6d8031.edaa7","type":"link in","z":"5af1388b.ef9838","name":"Player.PlayPause","links":["841060cb.d13c4","868cd190.6585a","5b173a11.dc2234"],"x":1295,"y":520,"wires":[["ffbdb28d.7c8a6"]]},{"id":"f4cce95d.56b828","type":"link in","z":"5af1388b.ef9838","name":"Player.Stop","links":["d4a38631.f4e108","1f3ff909.cbf857","21c3e5f9.6f75da"],"x":1295,"y":560,"wires":[["6eb6fb45.cfdac4"]]},{"id":"8a4057ea.301c48","type":"link in","z":"5af1388b.ef9838","name":"Player.Open (directory) [msg.payload]","links":[],"x":1295,"y":460,"wires":[["883c1b70.676b08"]]},{"id":"d49976cb.46b698","type":"link in","z":"5af1388b.ef9838","name":"Player.Open (file) [msg.payload]","links":["1f3ff909.cbf857"],"x":1295,"y":400,"wires":[["3e356f2e.d3986"]]},{"id":"92da4955.9fdbf8","type":"link in","z":"5af1388b.ef9838","name":"Player.Open \"images-frameloop\" (play || pause)","links":["442ce2f1.aae81c","620371c7.3effe","dc11438c.48568","d462771d.909b28"],"x":1195,"y":240,"wires":[["90b8f088.745ed"]]},{"id":"dc11438c.48568","type":"link out","z":"7c56a241.1e88dc","name":"","links":["8fc9fac9.cd53f8","92da4955.9fdbf8"],"x":1635,"y":1660,"wires":[]},{"id":"86802c5.4587dd","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"msg.payload = \"Neue Nachricht von \" + flow.get('lastTelegramUsername') + \"!\"\nreturn msg;","outputs":1,"noerr":0,"x":1550,"y":1780,"wires":[["228bd998.c359d6"]]},{"id":"228bd998.c359d6","type":"link out","z":"7c56a241.1e88dc","name":"","links":["844330d1.62789"],"x":1655,"y":1780,"wires":[]},{"id":"21caab0.4054556","type":"function","z":"5af1388b.ef9838","name":"Start/Stop Notification","func":"if(msg.payload === \"kodiPause\"){\n    msg.payload = \"Stop\";\n    return msg;\n} else if (msg.payload === \"kodiPlay\"){\n    msg.payload = \"Start\";\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1220,"y":800,"wires":[["941d2d96.42468"]]},{"id":"1ab6439d.6ea0dc","type":"rbe","z":"5af1388b.ef9838","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":570,"y":400,"wires":[["21caab0.4054556","c613e3ff.4f41e","f0febbb2.cdecf8","1f9144a2.57693b"]]},{"id":"941d2d96.42468","type":"function","z":"5af1388b.ef9838","name":"gate if DashPressed","func":"if(!global.get('dashPressed')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1440,"y":800,"wires":[["da1ff016.0093"]]},{"id":"39aabebe.9aab22","type":"link out","z":"5af1388b.ef9838","name":"","links":["8fc9fac9.cd53f8"],"x":515,"y":520,"wires":[]},{"id":"442ce2f1.aae81c","type":"link out","z":"5af1388b.ef9838","name":"","links":["92da4955.9fdbf8","8fc9fac9.cd53f8"],"x":1475,"y":280,"wires":[]},{"id":"f0febbb2.cdecf8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"kodiPlayerStatus","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":400,"wires":[[]]},{"id":"bbf54ac6.e639a8","type":"comment","z":"5af1388b.ef9838","name":"GUI Notification","info":"","x":1420,"y":740,"wires":[]},{"id":"8fc9fac9.cd53f8","type":"link in","z":"5af1388b.ef9838","name":"DashPressed","links":["39aabebe.9aab22","dc11438c.48568","442ce2f1.aae81c"],"x":1255,"y":1000,"wires":[["c6e667df.ca8978"]]},{"id":"c6e667df.ca8978","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"dashPressed","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1410,"y":1000,"wires":[["2a80d81d.87e388"]]},{"id":"51399278.a350fc","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"dashPressed","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1410,"y":1120,"wires":[[]]},{"id":"2a80d81d.87e388","type":"stoptimer","z":"5af1388b.ef9838","duration":"4000","units":"Millisecond","payloadtype":"num","payloadval":"0","name":"","x":1430,"y":1060,"wires":[["51399278.a350fc"],[]]},{"id":"b2efa2c8.3efc","type":"function","z":"5af1388b.ef9838","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2110,"y":920,"wires":[["6b411980.a2ece8","8b17631a.2904f"]]},{"id":"8b17631a.2904f","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2250,"y":980,"wires":[]},{"id":"90b8f088.745ed","type":"function","z":"5af1388b.ef9838","name":"if playerStatus play || pause","func":"if (global.get('kodiPlayerStatus') === \"kodiPlay\" || global.get('kodiPlayerStatus') === \"kodiPause\"){\n    return msg;\n}\n\n\n\n","outputs":1,"noerr":0,"x":1360,"y":240,"wires":[["c6be6051.f6e5f"]]},{"id":"571e5a0d.8510f4","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1380,"y":1780,"wires":[["86802c5.4587dd","2d21f7f6.6b8dc8"]]},{"id":"91926304.7daef","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification top (10sec)","func":"return {\n    payload: \n        {\n            \"method\":\"GUI.ShowNotification\",\n            \"params\":{\n                \"title\":msg.payload,\n                \"message\":\"\",\n                \"displaytime\":10000\n            }\n        }\n};","outputs":1,"noerr":0,"x":1400,"y":900,"wires":[["b2efa2c8.3efc"]]},{"id":"844330d1.62789","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification (10sec) [msg.payload]","links":["228bd998.c359d6"],"x":1175,"y":900,"wires":[["91926304.7daef"]]},{"id":"af2ac4df.613cf8","type":"ui_media","z":"5af1388b.ef9838","group":"c51c9a95.f2cb68","name":"","width":"12","height":"6","order":1,"category":"telegram","file":"1001.mp4","layout":"adjust","showcontrols":true,"loop":false,"onstart":false,"scope":"local","tooltip":"","x":1470,"y":3520,"wires":[[]]},{"id":"b41df9a9.decaf8","type":"function","z":"5af1388b.ef9838","name":"import file","func":"var category = \"telegram\";\nvar name = msg.payload;\nglobal.set('currentVideo', msg.payload);\nmsg.payload = { category, name }\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":3520,"wires":[["af2ac4df.613cf8"]]},{"id":"984de336.6051c","type":"function","z":"5af1388b.ef9838","name":"pause","func":"msg.play = false;\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":3480,"wires":[["af2ac4df.613cf8"]]},{"id":"1347604e.6e3f5","type":"function","z":"5af1388b.ef9838","name":"play","func":"msg.play = true;\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":3440,"wires":[["af2ac4df.613cf8"]]},{"id":"25ecf2e8.488cfe","type":"function","z":"5af1388b.ef9838","name":"add folder","func":"msg.payload = global.get('videos-frameloop')  + global.get('currentVideo');\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":3140,"wires":[["1f3ff909.cbf857","490b41ca.1b986"]]},{"id":"1f3ff909.cbf857","type":"link out","z":"5af1388b.ef9838","name":"","links":["d49976cb.46b698","f4cce95d.56b828"],"x":1075,"y":3140,"wires":[]},{"id":"20afec52.82efa4","type":"function","z":"5af1388b.ef9838","name":"Player.PlayPause","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.PlayPause\",\n            \"params\":{\n                \"playerid\":1\n            }\n        }\n};","outputs":1,"noerr":0,"x":930,"y":3020,"wires":[["78797928.e3a228","490b41ca.1b986"]]},{"id":"1bc2dc85.dafca3","type":"function","z":"5af1388b.ef9838","name":"Player.Stop","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.Stop\",\n            \"params\":{\n                \"playerid\":1\n            }\n        }\n};","outputs":1,"noerr":0,"x":910,"y":3080,"wires":[["e27f5805.51bfb8","490b41ca.1b986"]]},{"id":"74cb4c3d.327cb4","type":"link in","z":"5af1388b.ef9838","name":"","links":["e27f5805.51bfb8","78797928.e3a228"],"x":1855,"y":860,"wires":[["b2efa2c8.3efc"]]},{"id":"78797928.e3a228","type":"link out","z":"5af1388b.ef9838","name":"","links":["74cb4c3d.327cb4"],"x":1075,"y":3020,"wires":[]},{"id":"e27f5805.51bfb8","type":"link out","z":"5af1388b.ef9838","name":"","links":["74cb4c3d.327cb4","cd187329.675f9"],"x":1075,"y":3080,"wires":[]},{"id":"2208e8fb.66fdc8","type":"link in","z":"5af1388b.ef9838","name":"Player.GoTo next","links":["a7a8c7d1.937c78"],"x":1295,"y":660,"wires":[["f6f2588b.8879f8"]]},{"id":"eb78734a.657a7","type":"link in","z":"5af1388b.ef9838","name":"Player.GoTo previous","links":["62faac09.68dee4"],"x":1295,"y":620,"wires":[["93b3653f.741c78"]]},{"id":"dead4164.e5222","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo payload","func":"return {\n    payload: \n        {\n            \"method\":\"Player.GoTo\",\n            \"params\":{\n                \"playerid\":2,\n                \"to\": msg.payload\n            }\n        }\n};","outputs":1,"noerr":0,"x":1940,"y":1860,"wires":[["b2efa2c8.3efc"]]},{"id":"f1dd710c.19179","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"3","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1750,"y":1860,"wires":[["dead4164.e5222"]]},{"id":"b108c115.2edbe","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('path-images')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":"1","stat":false,"showWarnings":true,"x":980,"y":360,"wires":[["e01c60d1.eba73"]]},{"id":"e01c60d1.eba73","type":"function","z":"168e0b9d.9c19d4","name":"loop: rename -1","func":"if (msg.payload.length > 0){\n    \n    var file;\n    var fileNew;\n    var folder;\n    var cmd = \"\";\n    var x;\n    var postfix;\n    \n    // FileLister-Array vorwärts durchlaufen\n    for (var i=0; i < msg.payload.length; i++) {\n        \n        // Datei- und Ordnername extrahieren\n        file = msg.payload[i].slice(msg.payload[i].lastIndexOf(\"/\") + 1);\n        folder = msg.payload[i].slice(0, msg.payload[i].lastIndexOf(\"/\") + 1);\n        \n        // dekrementieren wenn über Schwellwert\n        x = parseInt(file.slice(0, 4));\n        postfix = file.slice(4);\n\n        if (Number.isInteger(x) && (x > flow.get('filenr'))){\n            \n            x = x - 1;\n            \n            // Umbenennen nach neuem Dateinamen und an cmd anhängen\n            fileNew = x + postfix;\n            cmd = cmd + \"mv \" + folder + file + \" \" + folder + fileNew + \" && \";\n        }\n    }\n    // letztes '&&' hinten abschneiden\n    msg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);\n    \n} else {\n    msg.payload = \"\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1160,"y":360,"wires":[["4ce75980.70c5d8"]]},{"id":"3dd9a487.5b56ac","type":"comment","z":"168e0b9d.9c19d4","name":"decrement subsequent files from postition @Loop","info":"","x":320,"y":300,"wires":[]},{"id":"4ce75980.70c5d8","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1310,"y":360,"wires":[[],[],["4913d647.cc5688","a2efcfae.2a0d8"]]},{"id":"9f85d0f1.1b0cd","type":"function","z":"168e0b9d.9c19d4","name":"set filnr","func":"var startFile = msg.payload.lastIndexOf(\"/\") + 1;\nvar nr = parseInt(msg.payload.slice(startFile, startFile+4));\nflow.set('filenr', nr);\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":360,"wires":[["ca4ca2db.60f39"]]},{"id":"300fc85d.3126d8","type":"link in","z":"168e0b9d.9c19d4","name":"filenr -1 at position","links":["a5ef733e.6cb3a"],"x":155,"y":360,"wires":[["9f85d0f1.1b0cd"]]},{"id":"833ed45c.3e3b58","type":"function","z":"5af1388b.ef9838","name":"set stickFlag","func":"if(flow.get('stickFlag')){\n    flow.set('stickFlag', false);\n    msg.topic = false;\n} else {\n    flow.set('stickFlag', true);\n    msg.topic = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":1100,"wires":[["bf63c1dd.c767b"]]},{"id":"c72480c6.b6957","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":500,"y":1000,"wires":[["868eda77.f1d128"]]},{"id":"5b173a11.dc2234","type":"link out","z":"5af1388b.ef9838","name":"","links":["1c6d8031.edaa7"],"x":1595,"y":340,"wires":[]},{"id":"5fd0e3e8.826e3c","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":640,"wires":[["38dc5900.1add38"]]},{"id":"38dc5900.1add38","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl status kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":520,"y":600,"wires":[["b6f90e5.a1af1f"],[],[]]},{"id":"b6f90e5.a1af1f","type":"function","z":"dfa0e0a5.c8001","name":"check kodi status","func":"if(msg.payload.search(\"Active: active\") > 0){\n    msg.payload = true;\n} else {\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":600,"wires":[["7a7b4064.9fef1"]]},{"id":"7a7b4064.9fef1","type":"switch","z":"dfa0e0a5.c8001","name":"if false","property":"payload","propertyType":"msg","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":540,"wires":[["d45ce864.0b1518"]]},{"id":"9104c854.65d0d8","type":"function","z":"dfa0e0a5.c8001","name":"start/stop loop","func":"var reset = true;\n\nif(msg.payload){\n    return msg;\n} else {\n    msg = { reset }\n    return msg;\n}","outputs":1,"noerr":0,"x":320,"y":520,"wires":[["31323f6d.b2ab3"]]},{"id":"31323f6d.b2ab3","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"60","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":520,"wires":[["9104c854.65d0d8","37fc5c70.a64a94"]]},{"id":"37fc5c70.a64a94","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"55","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":280,"y":600,"wires":[["38dc5900.1add38"]]},{"id":"f4df8844.e49288","type":"function","z":"5af1388b.ef9838","name":"Application.SetVolume","func":"return {\n    payload: \n        {\n            \"method\":\"Application.SetVolume\",\n            \"params\": msg.payload\n        }\n};","outputs":1,"noerr":0,"x":1440,"y":1280,"wires":[["b2efa2c8.3efc"]]},{"id":"cf430ace.a1c7a8","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Lautstärke:","tooltip":"","group":"c51c9a95.f2cb68","order":3,"width":7,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"100","step":1,"x":390,"y":3720,"wires":[["897b5e4b.2bec8","e654f1c6.d2c53"]]},{"id":"897b5e4b.2bec8","type":"link out","z":"5af1388b.ef9838","name":"","links":["f76c0a3a.f3b438"],"x":515,"y":3760,"wires":[]},{"id":"f76c0a3a.f3b438","type":"link in","z":"5af1388b.ef9838","name":"Application.SetVolume","links":["897b5e4b.2bec8"],"x":1295,"y":1280,"wires":[["f4df8844.e49288"]]},{"id":"75af0c10.faa9a4","type":"comment","z":"5af1388b.ef9838","name":"Settings","info":"","x":260,"y":3840,"wires":[]},{"id":"ad3acd0b.cbb95","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Max. Anzahl Videos im Speicher","tooltip":"","group":"d021848d.7c9d58","order":1,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"100","step":1,"x":490,"y":3900,"wires":[["7954fe1a.7e9b5","bba0d04b.f2055"]]},{"id":"7125cd28.04d1b4","type":"persist out","z":"5af1388b.ef9838","name":"storedVideosMax","storageNode":"aa40158d.83bf68","x":230,"y":3900,"wires":[["ad3acd0b.cbb95"]]},{"id":"7954fe1a.7e9b5","type":"persist in","z":"5af1388b.ef9838","name":"storedVideosMax","storageNode":"aa40158d.83bf68","x":790,"y":3900,"wires":[]},{"id":"a6d10ded.a4c82","type":"persist out","z":"5af1388b.ef9838","name":"videoVolume","storageNode":"aa40158d.83bf68","x":230,"y":3720,"wires":[["cf430ace.a1c7a8"]]},{"id":"e654f1c6.d2c53","type":"persist in","z":"5af1388b.ef9838","name":"videoVolume","storageNode":"aa40158d.83bf68","x":570,"y":3720,"wires":[]},{"id":"470a98ff.077548","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification bottom","func":"return {\n    payload: \n        {\n            \"method\":\"GUI.ShowNotification\",\n            \"params\":{\n                \"title\":\"\",\n                \"message\":msg.payload,\n                \"displaytime\":global.get('onScreenInfoTime')\n            }\n        }\n};","outputs":1,"noerr":0,"x":1410,"y":940,"wires":[["b2efa2c8.3efc"]]},{"id":"6b933baa.2f9ff4","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification bottom","links":["6901f99a.715428"],"x":1115,"y":940,"wires":[["a20e9b1f.b230e8"]]},{"id":"beec3265.79a38","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"msg.payload = \"Neue Nachricht von \" + flow.get('lastTelegramUsername') + \"!\"\nreturn msg;","outputs":1,"noerr":0,"x":1550,"y":1840,"wires":[["6901f99a.715428"]]},{"id":"6901f99a.715428","type":"link out","z":"7c56a241.1e88dc","name":"","links":["6b933baa.2f9ff4"],"x":1655,"y":1840,"wires":[]},{"id":"2d21f7f6.6b8dc8","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1380,"y":1840,"wires":[["beec3265.79a38"]]},{"id":"a20e9b1f.b230e8","type":"function","z":"5af1388b.ef9838","name":"gate","func":"if(global.get('onScreenInfo')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1210,"y":940,"wires":[["470a98ff.077548"]]},{"id":"bae46ed.a8acd9","type":"function","z":"7c56a241.1e88dc","name":"set FL Folder","func":"msg.payload = {start: global.get('videos-incoming')};\nreturn msg;","outputs":1,"noerr":0,"x":1790,"y":220,"wires":[["da9c1c87.525a7"]]},{"id":"da9c1c87.525a7","type":"fs-file-lister","z":"7c56a241.1e88dc","name":"","start":"global.get('images-incoming')","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":1940,"y":220,"wires":[["92d49688.3a73e8"]]},{"id":"92d49688.3a73e8","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"lastTelegramFilenameVideo","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":320,"wires":[["f7710099.9acc3"]]},{"id":"a4cae3d9.5fd0d","type":"function","z":"7c56a241.1e88dc","name":"rename + mv -> folder","func":"var filename = \"1001\" + flow.get('lastTelegramFilenameVideo').slice((flow.get('lastTelegramFilenameVideo').lastIndexOf(\".\")));\n\nif(flow.get('lastVideoHeight') > global.get('displayHeight') && (global.get('videoConvertFlag') || false)){\n    msg.payload = \"mv \" + global.get('videos-incoming') + (flow.get('lastTelegramFilenameVideo')) + \" \" + global.get('videos-preprocessing') + filename;\n    flow.set('lastTelegramFilenameVideo', filename);\n    return [null, msg];\n} else {\n    msg.payload = \"mv \" + global.get('videos-incoming') + (flow.get('lastTelegramFilenameVideo')) + \" \" + global.get('videos-frameloop') + filename;\n    flow.set('lastTelegramFilenameVideo', filename);\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":880,"y":420,"wires":[["11414e1a.10be62"],["5f0269e5.e50b08"]]},{"id":"11414e1a.10be62","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":440,"wires":[[],[],["afda48f.8eb1fb8"]]},{"id":"50774bbf.0fa3a4","type":"link out","z":"7c56a241.1e88dc","name":"","links":["4925047.13a76fc"],"x":1335,"y":180,"wires":[]},{"id":"410eafc9.73cb7","type":"comment","z":"168e0b9d.9c19d4","name":"IMAGES","info":"","x":120,"y":60,"wires":[]},{"id":"edaa8999.862268","type":"comment","z":"168e0b9d.9c19d4","name":"VIDEOS","info":"","x":150,"y":1180,"wires":[]},{"id":"563c4f7f.082f1","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":410,"y":1240,"wires":[["ae57aa2a.cd4c28"]]},{"id":"ae57aa2a.cd4c28","type":"function","z":"168e0b9d.9c19d4","name":"incr. filenr","func":"\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1300,"wires":[["9d2e5aca.ee58a8"]]},{"id":"9d2e5aca.ee58a8","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder","func":"msg.payload = {start: global.get('videos-frameloop')};\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":1300,"wires":[["7faeee9a.2e60d"]]},{"id":"7faeee9a.2e60d","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-frameloop')","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":740,"y":1300,"wires":[["50b2720e.4a1dec"]]},{"id":"50b2720e.4a1dec","type":"function","z":"168e0b9d.9c19d4","name":"frameloop: rename + 1","func":"if(msg.payload.length > 0){\n    \n    var cmd = \"\";\n    var file;\n    var fileNew;\n    var folder;\n    var x;\n    var postfix;\n\n    // FileLister-Array rückwärts durchlaufen\n    for (var i=msg.payload.length-1; i >= 0; i--) {\n        \n        // Datei- und Ordnername extrahieren\n        file = msg.payload[i].slice(msg.payload[i].lastIndexOf(\"/\") + 1);\n        folder = msg.payload[i].slice(0, msg.payload[i].lastIndexOf(\"/\") + 1);\n        \n        // inkrementieren\n        x = parseInt(file.slice(0, 4));\n        postfix = file.slice(4);\n        \n        if (Number.isInteger(x)){\n            \n            x = x + 1;\n    \n            if(x > global.get('storedVideosMax')){\n                // Datei löschen\n                cmd = cmd + \"rm \" + folder + file + \" && \";\n\n            } else {\n                // Umbenennen nach neuem Dateinamen und an cmd anhängen\n                fileNew = x + postfix;\n                cmd = cmd + \"mv \" + folder + file + \" \" + folder + fileNew + \" && \";\n            }\n        }\n    }\n    // letztes '&&' hinten abschneiden\n    msg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":940,"y":1300,"wires":[["4bf82265.eb6e8c"]]},{"id":"4bf82265.eb6e8c","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1110,"y":1300,"wires":[[],[],[]]},{"id":"698ba4d3.4d460c","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"storedVideosMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":3960,"wires":[[]]},{"id":"4925047.13a76fc","type":"link in","z":"168e0b9d.9c19d4","name":"incr. filenr videos","links":["50774bbf.0fa3a4"],"x":155,"y":1300,"wires":[["ae57aa2a.cd4c28"]]},{"id":"2ee6133.932a1ec","type":"comment","z":"7c56a241.1e88dc","name":"IMAGES","info":"","x":260,"y":680,"wires":[]},{"id":"205b49ad.7c7bc6","type":"comment","z":"7c56a241.1e88dc","name":"VIDEOS","info":"","x":810,"y":160,"wires":[]},{"id":"f2f6a38.3e3456","type":"q-gate","z":"7c56a241.1e88dc","name":"","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":1110,"y":220,"wires":[["636bd24c.cb112c","19f420bd.ed901f","4a2b200a.861aa","f25cb36f.09898"]]},{"id":"f497dcbc.95ac","type":"function","z":"7c56a241.1e88dc","name":"trigger gate","func":"msg.payload = \"trigger\";\nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":640,"wires":[["eaf3347e.d1bcf8","d53f797b.347198","6b1fc388.85afac"]]},{"id":"eaf3347e.d1bcf8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["721a2160.2ab1c"],"x":1935,"y":620,"wires":[]},{"id":"721a2160.2ab1c","type":"link in","z":"7c56a241.1e88dc","name":"","links":["eaf3347e.d1bcf8"],"x":935,"y":260,"wires":[["f2f6a38.3e3456"]]},{"id":"7579cd34.da5794","type":"q-gate","z":"7c56a241.1e88dc","name":"","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":350,"y":820,"wires":[["7042f23b.40a91c","3eb469a9.a3f486","98b8ca51.fe0458","85e552a1.fba43","e21f5b8.47cd3a8","98d6148b.a85dc8"]]},{"id":"98b8ca51.fe0458","type":"function","z":"7c56a241.1e88dc","name":"set triggerControl 1","func":"flow.set('triggerControl', 1);\n","outputs":1,"noerr":0,"x":490,"y":880,"wires":[[]]},{"id":"7cd117f2.69c9e8","type":"function","z":"7c56a241.1e88dc","name":"trigger gate","func":"var triggerControl = flow.get('triggerControl');\ntriggerControl = triggerControl - 1;\nflow.set('triggerControl', triggerControl);\n\nif (triggerControl === 0){\n    msg.payload = \"trigger\";\n    msg.topic = \"control\";\n    return msg;\n}","outputs":1,"noerr":0,"x":1210,"y":1580,"wires":[["bb5fc45c.c23d28","91ab1713.418f88"]]},{"id":"bb5fc45c.c23d28","type":"link out","z":"7c56a241.1e88dc","name":"","links":["85c98d5d.3969"],"x":1375,"y":1560,"wires":[]},{"id":"85c98d5d.3969","type":"link in","z":"7c56a241.1e88dc","name":"","links":["bb5fc45c.c23d28"],"x":215,"y":820,"wires":[["7579cd34.da5794"]]},{"id":"f7710099.9acc3","type":"function","z":"7c56a241.1e88dc","name":"ffprobe (get video res.)","func":"msg.payload = \"ffprobe -v quiet -print_format json -show_format -show_streams \" + global.get('videos-incoming') + flow.get('lastTelegramFilenameVideo');\nreturn msg;","outputs":1,"noerr":0,"x":1440,"y":320,"wires":[["4de2421.fccdbbc"]]},{"id":"4de2421.fccdbbc","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1610,"y":320,"wires":[["5ccfd479.98db4c"],[],["80c27756.dc37a8"]]},{"id":"5ccfd479.98db4c","type":"json","z":"7c56a241.1e88dc","name":"","property":"payload","action":"","pretty":false,"x":1750,"y":320,"wires":[["657aae50.e4cf7"]]},{"id":"4a7cd7ee.60f248","type":"function","z":"7c56a241.1e88dc","name":"if error","func":"msg.payload = \"sudo rm -rf \" + global.get('videos-incoming') + \"* && rm -rf \" + global.get('videos-preprocessing') + \"*\";\nreturn msg;\n","outputs":1,"noerr":0,"x":1790,"y":500,"wires":[["ad49ff1e.8974b","f497dcbc.95ac","90f93e17.9dce9"]]},{"id":"fcb4b999.51c3b8","type":"link in","z":"7c56a241.1e88dc","name":"if video error ","links":["4d122063.c606b","e4408f27.40fa7","ef093438.0da098","218fba47.5eccb6","50707f01.e68c6","12baf267.a1255e","12cd364b.7e356a","2bb3d940.2e4a26","2a80e21f.ac415e","34c3fcd6.c0f464","a184344e.42a328","e57f2a84.ef08d8","425c5a.673893a8","c00cbab3.8f7718"],"x":1695,"y":500,"wires":[["4a7cd7ee.60f248"]]},{"id":"ad49ff1e.8974b","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1950,"y":500,"wires":[[],[],[]]},{"id":"4d3649a4.d33218","type":"function","z":"7c56a241.1e88dc","name":"if error","func":"\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1230,"y":1500,"wires":[["4e9ca213.3d056c","7cd117f2.69c9e8","4e6cccb1.b71404"]]},{"id":"c83370c8.48945","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1630,"y":1460,"wires":[[],[],[]]},{"id":"46c8e873.b01a88","type":"link in","z":"7c56a241.1e88dc","name":"if image error ","links":["722656da.556c18","5d59ba7d.48c784","641823b2.89a2ec","bd729108.a8b66","1a18fb2b.a9feb5","f7528269.e3f37","c6f19bf8.ca97d8","dad59521.45c408","73c987ec.d39ab8","8679564f.58e298","3d6d789b.565ee8","af7658f5.2d7f78","752fdb30.528944","401843c8.f4d2dc","598f636f.837b1c","37966aa1.cfaed6","ce0076c8.8fb808"],"x":1135,"y":1500,"wires":[["4d3649a4.d33218"]]},{"id":"657aae50.e4cf7","type":"function","z":"7c56a241.1e88dc","name":"flow.set video res.","func":"try{\n    flow.set('lastVideoWidth', msg.payload.streams[0].width);\n    flow.set('lastVideoHeight', msg.payload.streams[0].coded_height);\n    \n} catch(e){}\n\nvar msg2 = {payload: \"\"};\nreturn msg2;","outputs":1,"noerr":0,"x":1910,"y":320,"wires":[["a4cae3d9.5fd0d"]]},{"id":"f605d689.b29478","type":"function","z":"7c56a241.1e88dc","name":"ffmpeg","func":"global.get('lastMimeVideo');\n\nmsg.payload = \"ffmpeg -i \" + global.get('videos-preprocessing') + msg.payload + \" -vf scale=-1:\" + global.get('displayHeight') + \" \" + global.get('videos-preprocessing') + \"tmp.\" + msg.payload;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1200,"y":540,"wires":[["4688a835.e5e458"]]},{"id":"5f0269e5.e50b08","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":540,"wires":[[],[],["754dccc3.6cf1e4"]]},{"id":"e78683dd.58ce9","type":"comment","z":"7c56a241.1e88dc","name":"resize using ffmpeg if height > displayHeight","info":"","x":1090,"y":500,"wires":[]},{"id":"dc9d5266.a89f4","type":"function","z":"7c56a241.1e88dc","name":"set FL Folder","func":"msg.payload = {start: global.get('videos-preprocessing')};\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":540,"wires":[["d27845d5.80ea68"]]},{"id":"d27845d5.80ea68","type":"fs-file-lister","z":"7c56a241.1e88dc","name":"","start":"global.get('images-preprocessing')","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":1060,"y":540,"wires":[["f605d689.b29478"]]},{"id":"4688a835.e5e458","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":540,"wires":[[],[],["f086681c.bfe8b8"]]},{"id":"7328fe2e.e840c","type":"function","z":"7c56a241.1e88dc","name":"rename + mv -> folder","func":"msg.payload = \"mv \" + global.get('videos-preprocessing') + \"tmp.01.\" + global.get('lastMimeVideo') + \" \" + global.get('videos-frameloop') + \"01.\" + global.get('lastMimeVideo') + \" && rm \" + global.get('videos-preprocessing') + \"01.\" + global.get('lastMimeVideo');\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1160,"y":620,"wires":[["8af81c35.06ae1"]]},{"id":"8af81c35.06ae1","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":620,"wires":[[],[],["fa7e0ea.63f90f"]]},{"id":"f7d23ddc.32e82","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1600,"y":220,"wires":[["12cd364b.7e356a"],["bae46ed.a8acd9"]]},{"id":"6a2b3bc7.b395d4","type":"ui_button","z":"5af1388b.ef9838","name":"active","group":"c51c9a95.f2cb68","order":10,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-arrow-circle-down","payload":"","payloadType":"str","topic":"","x":450,"y":3640,"wires":[[]]},{"id":"a2416246.4cc2b","type":"function","z":"5af1388b.ef9838","name":"set color","func":"if(msg.payload){\n    msg.payload = \"#eb4034\";\n} else {\n    msg.payload = \"\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":3640,"wires":[["6a2b3bc7.b395d4"]]},{"id":"5e85c279.d9f46c","type":"link in","z":"5af1388b.ef9838","name":"busy","links":["245967b5.d39638","8a993ebd.32626"],"x":215,"y":3640,"wires":[["a2416246.4cc2b"]]},{"id":"245967b5.d39638","type":"link out","z":"7c56a241.1e88dc","name":"","links":["5e85c279.d9f46c"],"x":1395,"y":100,"wires":[]},{"id":"cb9645f6.a71318","type":"function","z":"7c56a241.1e88dc","name":"send video ready","func":"var chatId = flow.get('lastTelegramChatidVideo');\nvar type = \"message\";\nvar content = \"Fertig! Dein Video kannst du ab jetzt unter http://\" + global.get('domain') + \":1880/ui/#!/0?socketid=s-Yqvg1PLkovDlowAAAU aufrufen und abspielen.\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1850,"y":740,"wires":[["628f7588.5cbbbc"]]},{"id":"628f7588.5cbbbc","type":"telegram sender","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","x":2100,"y":740,"wires":[[]]},{"id":"12cd364b.7e356a","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1735,"y":180,"wires":[]},{"id":"afda48f.8eb1fb8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1480,"y":440,"wires":[["2bb3d940.2e4a26"],["f497dcbc.95ac","cb9645f6.a71318"]]},{"id":"2bb3d940.2e4a26","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1595,"y":420,"wires":[]},{"id":"f086681c.bfe8b8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1480,"y":540,"wires":[["2a80e21f.ac415e"],["7328fe2e.e840c"]]},{"id":"2a80e21f.ac415e","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1595,"y":520,"wires":[]},{"id":"fa7e0ea.63f90f","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1480,"y":620,"wires":[["34c3fcd6.c0f464"],["f497dcbc.95ac","cb9645f6.a71318"]]},{"id":"34c3fcd6.c0f464","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1595,"y":600,"wires":[]},{"id":"f153fa65.e56d38","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1180,"y":880,"wires":[["73c987ec.d39ab8"],["c52d3fad.85dbf"]]},{"id":"73c987ec.d39ab8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1285,"y":870,"wires":[]},{"id":"635f03a6.5b896c","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1420,"y":960,"wires":[["8679564f.58e298"],["d8607587.5f2828"]]},{"id":"8679564f.58e298","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1525,"y":950,"wires":[]},{"id":"c0a9ff00.fadfe","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":800,"y":1200,"wires":[["3d6d789b.565ee8"],["3e32eae9.dd5636","98da01cf.24f5d"]]},{"id":"3d6d789b.565ee8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":895,"y":1180,"wires":[]},{"id":"993d21d1.50d41","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1560,"y":1240,"wires":[["af7658f5.2d7f78"],["fd4afe8c.3fa31"]]},{"id":"af7658f5.2d7f78","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1675,"y":1240,"wires":[]},{"id":"d8cfda78.815aa8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1560,"y":1340,"wires":[["752fdb30.528944"],["84851945.fe0028"]]},{"id":"752fdb30.528944","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1675,"y":1340,"wires":[]},{"id":"e744adc5.91cdb","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":800,"y":1620,"wires":[["598f636f.837b1c"],["7cd117f2.69c9e8","3f8e28b3.1245d8"]]},{"id":"598f636f.837b1c","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":955,"y":1580,"wires":[]},{"id":"831c855e.b960c8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":800,"y":1420,"wires":[["37966aa1.cfaed6"],["504b0d03.1c2514"]]},{"id":"37966aa1.cfaed6","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":955,"y":1420,"wires":[]},{"id":"a184344e.42a328","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":855,"y":500,"wires":[]},{"id":"754dccc3.6cf1e4","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":740,"y":540,"wires":[["a184344e.42a328"],["dc9d5266.a89f4"]]},{"id":"636bd24c.cb112c","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramChatidVideo","func":"flow.set('lastTelegramChatidVideo', msg.payload.chatId);","outputs":1,"noerr":0,"x":1360,"y":60,"wires":[[]]},{"id":"bd4a312.50889d","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"b242fa6a.175d28","order":2,"width":6,"height":1,"passthru":false,"label":"Reset Q-Gate Videos","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":820,"y":360,"wires":[["c3de6857.ab3b68"]]},{"id":"c9ccef4c.121da","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"b242fa6a.175d28","order":1,"width":6,"height":1,"passthru":false,"label":"Reset Q-Gate Images","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":140,"y":960,"wires":[["8fc7a884.818988"]]},{"id":"ff5edf4a.f2d6f","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1180,"y":1780,"wires":[["86802c5.4587dd"]]},{"id":"b089cb87.b44da8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1180,"y":1840,"wires":[["beec3265.79a38"]]},{"id":"abd4ce3.6fb663","type":"function","z":"7c56a241.1e88dc","name":"send image ready","func":"var chatId = flow.get('lastTelegramChatidImage');\nvar type = \"message\";\nvar content = \"Dein Bild wird ab jetzt angezeigt!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1390,"y":1700,"wires":[["aafb3fbd.52af3"]]},{"id":"aafb3fbd.52af3","type":"telegram sender","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","x":1620,"y":1700,"wires":[[]]},{"id":"85e552a1.fba43","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramChatidImage","func":"flow.set('lastTelegramChatidImage', msg.payload.chatId);","outputs":1,"noerr":0,"x":1080,"y":740,"wires":[[]]},{"id":"c3de6857.ab3b68","type":"function","z":"7c56a241.1e88dc","name":"reset q-gate","func":"global.set('qgateBufferVideos', 0);\n\nmsg.topic = \"control\";\nmsg.payload = \"reset\";\n\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":300,"wires":[["f2f6a38.3e3456"]]},{"id":"8fc7a884.818988","type":"function","z":"7c56a241.1e88dc","name":"reset q-gate","func":"flow.set('qgateBufferImages', 0);\nflow.set('triggerControl', 0);\n\nmsg.topic = \"control\";\nmsg.payload = \"reset\";\n\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":900,"wires":[["7579cd34.da5794"]]},{"id":"25e42f88.5da1f","type":"function","z":"5af1388b.ef9838","name":"navigate files","func":"var filelist = msg.payload;\nvar fileindex = flow.get('fileListVideoIndex') || 0;\nvar filelistlength = filelist.length;\n\nif (msg.navi === \"r\"){\n    if (fileindex >= (filelistlength - 1)){\n        fileindex = 0;\n    } else {\n        fileindex = fileindex + 1;\n    }\n    \n} else if (msg.navi === \"l\"){\n    if (fileindex <= 0){\n        fileindex = filelistlength - 1;\n    } else {\n        fileindex = fileindex - 1;\n    }\n}\n\nflow.set('fileListVideoIndex', fileindex);\n\nglobal.set('currentVideo', filelist[fileindex]);\nmsg.payload = filelist[fileindex];\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1030,"y":3480,"wires":[["b41df9a9.decaf8"]]},{"id":"8ce178f.023f988","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":1480,"wires":[["aaa9b328.089d8"]]},{"id":"aaa9b328.089d8","type":"function","z":"168e0b9d.9c19d4","name":"delete file","func":"msg.file = global.get('currentVideo');\nmsg.payload = \"rm \" + global.get('videos-frameloop') + global.get('currentVideo');\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1520,"wires":[["4fc8b8a1.377b88"]]},{"id":"6e3607df.ad23e8","type":"link in","z":"168e0b9d.9c19d4","name":"delete videoFile","links":["ef4fb262.7acf7"],"x":155,"y":1520,"wires":[["aaa9b328.089d8"]]},{"id":"71bd1282.325d9c","type":"comment","z":"168e0b9d.9c19d4","name":"delete file","info":"","x":200,"y":1400,"wires":[]},{"id":"4fc8b8a1.377b88","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":1520,"wires":[[],[],["d80f555f.4e3f18"]]},{"id":"e6f1145e.5f0a08","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('path-videos')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":"1","stat":false,"showWarnings":true,"x":800,"y":1680,"wires":[["bf72c106.89ba2"]]},{"id":"bf72c106.89ba2","type":"function","z":"168e0b9d.9c19d4","name":"rename -1","func":"if(msg.payload.length > 0){\n    \n    var filenrThreshold = flow.get('filenr');\n    var file;\n    var fileNew;\n    var folder;\n    var cmd = \"\";\n    var x;\n    var postfix;\n    \n    // FileLister-Array vorwärts durchlaufen\n    for (var i=0; i < msg.payload.length; i++) {\n        \n        // Datei- und Ordnername extrahieren\n        file = msg.payload[i].slice(msg.payload[i].lastIndexOf(\"/\") + 1);\n        folder = msg.payload[i].slice(0, msg.payload[i].lastIndexOf(\"/\") + 1);\n        \n        // dekrementieren wenn über Schwellwert\n        x = parseInt(file.slice(0, 4));\n        postfix = file.slice(4);\n\n        if (Number.isInteger(x) && (x > filenrThreshold)){\n            \n            x = x - 1;\n            \n            // Umbenennen nach neuem Dateinamen und an cmd anhängen\n            fileNew = x + postfix;\n            cmd = cmd + \"mv \" + folder + file + \" \" + folder + fileNew + \" && \";\n        }\n    }\n    // letztes '&&' hinten abschneiden\n    msg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":970,"y":1680,"wires":[["d11144dd.78c048"]]},{"id":"f710f158.ead4d","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder (frameloop)","func":"msg.payload = {start: global.get('videos-frameloop')};\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":1680,"wires":[["e6f1145e.5f0a08"]]},{"id":"48a50281.b1577c","type":"comment","z":"168e0b9d.9c19d4","name":"decrement subsequent files","info":"","x":260,"y":1600,"wires":[]},{"id":"d11144dd.78c048","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1110,"y":1680,"wires":[[],[],[]]},{"id":"b5e81859.023db8","type":"function","z":"168e0b9d.9c19d4","name":"flow.set filenrThreshold","func":"flow.set('filenrThreshold', parseInt(msg.file.slice(0, 4)));\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1680,"wires":[["f710f158.ead4d"]]},{"id":"d7ececf4.8bae7","type":"comment","z":"168e0b9d.9c19d4","name":"increment filenr","info":"","x":220,"y":1240,"wires":[]},{"id":"1d9b5bde.6fb704","type":"function","z":"5af1388b.ef9838","name":"if ok delete","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":710,"y":3560,"wires":[["ef4fb262.7acf7","3d27329c.35b44e"]]},{"id":"ef4fb262.7acf7","type":"link out","z":"5af1388b.ef9838","name":"","links":["6e3607df.ad23e8"],"x":835,"y":3560,"wires":[]},{"id":"d80f555f.4e3f18","type":"function","z":"168e0b9d.9c19d4","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":740,"y":1520,"wires":[[],["7bd9f5bc.40208c","b5e81859.023db8"]]},{"id":"c6e1ce9b.3035","type":"fs-file-lister","z":"5af1388b.ef9838","name":"","start":"global.get('images-frameloop')","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":840,"y":3480,"wires":[["b0aa4d5.14c34b","25e42f88.5da1f"]]},{"id":"b0aa4d5.14c34b","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"fileListVideo","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":3440,"wires":[[]]},{"id":"20d45bdb.5dda64","type":"function","z":"5af1388b.ef9838","name":"set FL Folder, store nav commands","func":"var navi = msg.payload;\nmsg = {navi};\nmsg.payload = {start: global.get('videos-frameloop')};\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":3480,"wires":[["c6e1ce9b.3035"]]},{"id":"f9c3ea3d.aa6888","type":"function","z":"168e0b9d.9c19d4","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1460,"y":780,"wires":[[],["8acfb3b1.1e7c9"]]},{"id":"8acfb3b1.1e7c9","type":"function","z":"168e0b9d.9c19d4","name":"flow.get currentFileDel","func":"msg.payload = flow.get('currentFileDel');\nreturn msg;","outputs":1,"noerr":0,"x":1660,"y":780,"wires":[["a5ef733e.6cb3a","ae8d8002.3d3fd"]]},{"id":"cb711e58.62298","type":"function","z":"168e0b9d.9c19d4","name":"get currentFile","func":"msg.payload = global.get('currentFile');\nflow.set('currentFileStick', global.get('currentFile'));\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":980,"wires":[["9f6874a1.eec9b8"]]},{"id":"5556ae61.0e312","type":"ui_toast","z":"168e0b9d.9c19d4","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1130,"y":1520,"wires":[]},{"id":"7bd9f5bc.40208c","type":"function","z":"168e0b9d.9c19d4","name":"set message","func":"msg.payload = \"Video gelöscht!\";\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":1520,"wires":[["5556ae61.0e312"]]},{"id":"ae8d8002.3d3fd","type":"function","z":"168e0b9d.9c19d4","name":"set message","func":"msg.payload = \"Bild gelöscht!\";\nreturn msg;","outputs":1,"noerr":0,"x":1650,"y":840,"wires":[["ffc4fd59.845a"]]},{"id":"ffc4fd59.845a","type":"ui_toast","z":"168e0b9d.9c19d4","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1830,"y":840,"wires":[]},{"id":"aca9ebc6.e394b8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"noDashPressed","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1760,"y":3080,"wires":[[]]},{"id":"110ad02.332b43","type":"stoptimer","z":"5af1388b.ef9838","duration":"5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1520,"y":3080,"wires":[["aca9ebc6.e394b8"],[]]},{"id":"490b41ca.1b986","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"noDashPressed","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1300,"y":3080,"wires":[["110ad02.332b43"]]},{"id":"bbcc94e4.472028","type":"function","z":"5af1388b.ef9838","name":"set color","func":"if (msg.payload === \"play\" || msg.payload === \"kodiPlay\"){\n    var payload = \"\";\n    var msg2 = {payload};\n    msg.payload = \"#eb4034\"; // red\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', true);\n    return [msg2, msg];\n\n} else if (msg.payload === \"pause\"){\n    if ((context.get('colorswitchPause') || false) && context.set('colorswitchPlay')){\n        msg.payload = \"#ebe534\"; // yellow\n        context.set('colorswitchPause', false);\n    } else {\n        msg.payload = \"\";\n        context.set('colorswitchPause', true);\n    }\n    return [msg, null];\n\n} else if (msg.payload === \"kodiPause\"){\n    msg.payload = \"#ebe534\"; // yellow\n    context.set('colorswitchPause', false);\n    return [msg, null];\n\n} else if (msg.payload === \"stop\" || msg.payload === \"kodiStop\"){\n    msg.payload = \"\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', false);\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":540,"y":3080,"wires":[["df26ac7e.fef28"],["2e1296c7.66d7ca"]]},{"id":"623c93eb.43012c","type":"rbe","z":"5af1388b.ef9838","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":350,"y":3080,"wires":[["bbcc94e4.472028","690a4ce2.2ba8f4","efe1988.7c76268","27175ae3.331876"]]},{"id":"690a4ce2.2ba8f4","type":"function","z":"5af1388b.ef9838","name":"gate \"kodiStop\"","func":"if(msg.payload === \"kodiStop\"){\n    if (flow.get('stopLock')){\n        flow.set('stopLock', false);\n    } else {\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":540,"y":3000,"wires":[["927e6904.449578"]]},{"id":"cbdf7fed.a48c1","type":"function","z":"5af1388b.ef9838","name":"gate images","func":"try{\n    if (msg.payload.data.data.item.type === \"picture\"){\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":210,"y":360,"wires":[["82df6bdd.e98f78","ad1ea8ed.3c9d48","9f55bb60.063888","3dfba2cd.eddf1e"]]},{"id":"ad1ea8ed.3c9d48","type":"function","z":"5af1388b.ef9838","name":"get stop","func":"try{\n    if (msg.payload.notification === \"Player.OnStop\"){\n        msg.payload = \"kodiStop\";\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":420,"y":380,"wires":[["1ab6439d.6ea0dc"]]},{"id":"82df6bdd.e98f78","type":"function","z":"5af1388b.ef9838","name":"get speed","func":"try{\n    if (msg.payload.data.data.player.speed === 0){\n        msg.payload = \"kodiPause\";\n        return msg;\n    } else if (msg.payload.data.data.player.speed === 1){\n        msg.payload = \"kodiPlay\";\n        return msg;\n    }\n\n} catch(e){}\n","outputs":1,"noerr":0,"x":420,"y":420,"wires":[["1ab6439d.6ea0dc"]]},{"id":"413ecc2f.d1b544","type":"function","z":"5af1388b.ef9838","name":"gate videos","func":"try{\n    if (msg.payload.data.data.item.type === \"movie\"){\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":210,"y":2980,"wires":[["999114d1.275808","b0cfd4bd.6afb78","27175ae3.331876"]]},{"id":"b0cfd4bd.6afb78","type":"function","z":"5af1388b.ef9838","name":"get speed","func":"try{\n    if (msg.payload.data.data.player.speed === 0){\n        msg.payload = \"kodiPause\";\n        return msg;\n    } else if (msg.payload.data.data.player.speed === 1){\n        msg.payload = \"kodiPlay\";\n        return msg;\n    }\n\n} catch(e){}\n","outputs":1,"noerr":0,"x":200,"y":3100,"wires":[["623c93eb.43012c"]]},{"id":"999114d1.275808","type":"function","z":"5af1388b.ef9838","name":"get stop","func":"try{\n    if (msg.payload.notification === \"Player.OnStop\"){\n        msg.payload = \"kodiStop\";\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":200,"y":3060,"wires":[["623c93eb.43012c"]]},{"id":"cd187329.675f9","type":"link in","z":"5af1388b.ef9838","name":"Player.Open \"images-frameloop\"","links":["e27f5805.51bfb8","f42d47dd.c226b8","6df57dbf.8b24e4"],"x":1295,"y":180,"wires":[["c6be6051.f6e5f"]]},{"id":"3dc142d0.bec18e","type":"function","z":"5af1388b.ef9838","name":"flow.set stopLock","func":"if((global.get('kodiPlayerVideoStatus') === \"kodiPlay\") || (global.get('kodiPlayerVideoStatus') === \"kodiPause\")){\n    flow.set('stopLock', true);\n}","outputs":1,"noerr":0,"x":930,"y":3180,"wires":[[]]},{"id":"efe1988.7c76268","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"kodiPlayerVideoStatus","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":2960,"wires":[[]]},{"id":"4e9ca213.3d056c","type":"function","z":"7c56a241.1e88dc","name":"send 'not successfull'","func":"var chatId = flow.get('lastTelegramChatidImage');\nvar type = \"message\";\nvar content = \"Irgendwas ist leider schiefgelaufen :-(. Probiere es doch einfach nochmal!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1460,"y":1500,"wires":[["aafb3fbd.52af3"]]},{"id":"90f93e17.9dce9","type":"function","z":"7c56a241.1e88dc","name":"send video faulty","func":"var chatId = flow.get('lastTelegramChatidVideo');\nvar type = \"message\";\nvar content = \"Irgendwas ist leider schiefgelaufen :(. Probiere es doch einfach nochmal!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1990,"y":560,"wires":[["628f7588.5cbbbc"]]},{"id":"1772bc20.33bfa4","type":"comment","z":"dfa0e0a5.c8001","name":"ddns (freedns.afraid.org)","info":"","x":170,"y":2180,"wires":[]},{"id":"e15f94eb.063b48","type":"http request","z":"dfa0e0a5.c8001","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":510,"y":2260,"wires":[["83339488.7458a8"]]},{"id":"83339488.7458a8","type":"debug","z":"dfa0e0a5.c8001","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":710,"y":2260,"wires":[]},{"id":"4532964f.781bc8","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"600","crontab":"","once":true,"onceDelay":0.1,"x":160,"y":2260,"wires":[["e472071a.d6afa8"]]},{"id":"abb2fbe7.76eff8","type":"persist in","z":"dfa0e0a5.c8001","name":"ddns","storageNode":"aa40158d.83bf68","x":470,"y":2380,"wires":[]},{"id":"1c75620d.de0ade","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"Update-URL","tooltip":"Ordnerpfad","group":"e4f17352.69409","order":2,"width":0,"height":0,"passthru":true,"mode":"text","delay":"100","topic":"","x":310,"y":2380,"wires":[["abb2fbe7.76eff8","61e1a247.9fd18c"]]},{"id":"d9643cdd.6e996","type":"persist out","z":"dfa0e0a5.c8001","name":"ddns","storageNode":"aa40158d.83bf68","x":150,"y":2380,"wires":[["1c75620d.de0ade"]]},{"id":"61e1a247.9fd18c","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"freedns","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":2340,"wires":[[]]},{"id":"e472071a.d6afa8","type":"function","z":"dfa0e0a5.c8001","name":"set url","func":"var url = flow.get('freedns') || \"https://freedns.afraid.org/dynamic/update.php?cUlQenlDY3BDcWxzclgycGoyQXc5eHg0OjE5MDYzMTA5\";\nmsg = {url};\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":2260,"wires":[["e15f94eb.063b48"]]},{"id":"fb025f37.84049","type":"comment","z":"dfa0e0a5.c8001","name":"squid","info":"","x":110,"y":1400,"wires":[]},{"id":"5471ffdb.a7bbf","type":"persist in","z":"dfa0e0a5.c8001","name":"squid","storageNode":"aa40158d.83bf68","x":550,"y":1500,"wires":[]},{"id":"1e704d62.e903f3","type":"persist out","z":"dfa0e0a5.c8001","name":"squid","storageNode":"aa40158d.83bf68","x":130,"y":1500,"wires":[["d963dd26.eb315"]]},{"id":"d963dd26.eb315","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"squid","tooltip":"","group":"29050d2.fa3cef2","order":5,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":1460,"wires":[["206db579.1cf32a"]]},{"id":"d996463d.31d538","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":550,"y":1460,"wires":[["8beeb916.aa55c8"],["afe21bfb.85b978"]]},{"id":"8beeb916.aa55c8","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start squid","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":800,"y":1440,"wires":[[],[],[]]},{"id":"afe21bfb.85b978","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop squid","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":800,"y":1500,"wires":[[],[],[]]},{"id":"de4f51c9.94983","type":"comment","z":"dfa0e0a5.c8001","name":"frankabilderrahmentmp.mooo.com","info":"","x":560,"y":2220,"wires":[]},{"id":"2fd28b39.2cd434","type":"comment","z":"dfa0e0a5.c8001","name":"openvpn","info":"","x":120,"y":1180,"wires":[]},{"id":"59352b39.4a6ea4","type":"persist in","z":"dfa0e0a5.c8001","name":"openvpn","storageNode":"aa40158d.83bf68","x":560,"y":1280,"wires":[]},{"id":"9e69e5d1.7e9378","type":"persist out","z":"dfa0e0a5.c8001","name":"openvpn","storageNode":"aa40158d.83bf68","x":140,"y":1280,"wires":[["8b4c2698.95cbc8"]]},{"id":"8b4c2698.95cbc8","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"openvpn","tooltip":"","group":"29050d2.fa3cef2","order":3,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":280,"y":1240,"wires":[["7021d9f3.a489a8"]]},{"id":"779c625.b0a5e9c","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":550,"y":1240,"wires":[["5dc133a4.8b68cc"],["5b8bf566.f2229c"]]},{"id":"5dc133a4.8b68cc","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start openvpn@jablServ","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":840,"y":1220,"wires":[[],[],[]]},{"id":"5b8bf566.f2229c","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop openvpn@jablServ","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":840,"y":1280,"wires":[[],[],[]]},{"id":"b354a455.3f6448","type":"comment","z":"dfa0e0a5.c8001","name":"Ping","info":"","x":110,"y":2520,"wires":[]},{"id":"b701d55c.bfb1f8","type":"debug","z":"dfa0e0a5.c8001","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":2680,"wires":[]},{"id":"839c67b8.b8e4d8","type":"function","z":"dfa0e0a5.c8001","name":"is online","func":"var chatId = 146276326;\nvar type = \"message\";\nvar content = \"Bilderrahmen ist online!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":880,"y":2580,"wires":[["891173e7.25217"]]},{"id":"891173e7.25217","type":"telegram sender","z":"dfa0e0a5.c8001","name":"","bot":"ca6d8830.a2dc48","x":1040,"y":2580,"wires":[[]]},{"id":"26c2d35f.99a50c","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"5","x":180,"y":2600,"wires":[["cf06479b.e142d8"]]},{"id":"37d649ee.eeccc6","type":"function","z":"dfa0e0a5.c8001","name":"if ping -> true","func":"if (msg.payload === false){\n\n} else {\n    msg.payload = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":2600,"wires":[["cdd8e16.17b112","b701d55c.bfb1f8"]]},{"id":"cf06479b.e142d8","type":"adv ping","z":"dfa0e0a5.c8001","name":"","host":"8.8.8.8","x":350,"y":2600,"wires":[["37d649ee.eeccc6"]]},{"id":"cdd8e16.17b112","type":"switch","z":"dfa0e0a5.c8001","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":2600,"wires":[["839c67b8.b8e4d8"],["e9a2e1f3.4a0ae"]]},{"id":"e9a2e1f3.4a0ae","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":2680,"wires":[["cf06479b.e142d8"]]},{"id":"dadc16b7.9632e8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":3160,"wires":[["6f5b8b48.395204"]]},{"id":"2b05e33c.64881c","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"60","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":760,"y":340,"wires":[["f42d47dd.c226b8"]]},{"id":"f42d47dd.c226b8","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["cd187329.675f9"],"x":875,"y":340,"wires":[]},{"id":"aa89bc1.8eb434","type":"function","z":"5af1388b.ef9838","name":"Reverse Time","func":"if (msg.payload > 0){\n    msg.payload = 3600 - msg.payload;\n    return msg;\n}","outputs":1,"noerr":0,"x":580,"y":3380,"wires":[["cd8908c2.a3d3d8","d3e4741d.cf64b8"]]},{"id":"cd8908c2.a3d3d8","type":"function","z":"5af1388b.ef9838","name":"sek -> min:sek","func":"var time = msg.payload;\nvar min = Math.floor(time / 60)\ntime = time - min*60;\nvar sec = Math.floor(time)\n\nif(min < 10){\n    min = \"0\" + min;\n}\n\nif(sec < 10){\n    sec = \"0\" + sec;\n}\n\nmsg.payload = min + \" m \" + sec + \" s\"\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":3360,"wires":[["413bf818.7729d8"]]},{"id":"413bf818.7729d8","type":"ui_text","z":"5af1388b.ef9838","group":"c51c9a95.f2cb68","order":2,"width":5,"height":1,"name":"","label":"Zeit:","format":"{{msg.payload}}","layout":"row-spread","x":930,"y":3360,"wires":[]},{"id":"29e62cfe.2620a4","type":"mytimeout","z":"5af1388b.ef9838","name":"timeout 1h","outtopic":"","outsafe":"on","outwarning":"Warning","outunsafe":"off","warning":"5","timer":"3600","debug":false,"ndebug":false,"ignoreCase":false,"repeat":false,"again":false,"x":410,"y":3340,"wires":[[],["aa89bc1.8eb434","657f76bb.cb5818"]]},{"id":"27175ae3.331876","type":"function","z":"5af1388b.ef9838","name":"control timer","func":"msg.timeout = 3599;\n\nif(msg.payload.notification === \"Player.OnPlay\"){\n    context.set('startPlay', true);\n    msg.payload = 3600;\n    return [null, msg];\n    \n} else if ((msg.payload.notification === \"Player.OnAVChange\" && context.get('startPlay')) || (msg.payload === \"kodiPlay\" && context.get('pauseFlag'))){\n    msg.payload = 1;\n    \n    if(context.get('pauseFlag')){\n        msg.timeout = 3599 - flow.get('timecode');\n        context.set('pauseFlag', false);\n    } else {\n        context.set('pauseFlag', false);\n    }\n    context.set('startPlay', false);\n    return [msg, null];\n    \n} else if (msg.payload === \"kodiPause\"){\n    msg.payload = 0;\n    context.set('pauseFlag', true);\n    return [msg, null];\n\n} else if (msg.payload === \"kodiStop\" || msg.payload === \"r\" || msg.payload === \"l\"){\n    msg.payload = \"cancel\";\n    context.set('pauseFlag', false);\n    return [msg, null];\n}\n","outputs":2,"noerr":0,"x":230,"y":3360,"wires":[["29e62cfe.2620a4"],["aa89bc1.8eb434"]]},{"id":"d3e4741d.cf64b8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"timecode","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":3400,"wires":[[]]},{"id":"bc73c661.6f14e8","type":"comment","z":"7c56a241.1e88dc","name":"Nutzerverwaltung","info":"","x":130,"y":2593.75,"wires":[]},{"id":"165566b4.482a19","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Starte Slideshow neu wenn auf Pause","tooltip":"","group":"c83c4c5e.03ddf","order":4,"width":12,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":470,"y":2580,"wires":[["803466bd.6754e8"]]},{"id":"c812abb4.32c1d8","type":"persist out","z":"5af1388b.ef9838","name":"restartSlideshow","storageNode":"aa40158d.83bf68","x":190,"y":2580,"wires":[["165566b4.482a19"]]},{"id":"803466bd.6754e8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"restartSlideshowOnPause","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":2580,"wires":[["450dc41b.114c7c"]]},{"id":"450dc41b.114c7c","type":"persist in","z":"5af1388b.ef9838","name":"restartSlideshow","storageNode":"aa40158d.83bf68","x":1070,"y":2580,"wires":[]},{"id":"8e9eb826.48a4c8","type":"ui_template","z":"dfa0e0a5.c8001","group":"5758df94.472ad","name":"","order":2,"width":12,"height":5,"format":"<style>\n    #mylog {\n        min-height: 250px;\n        padding: 0;\n        background-color: white;\n        white-space: pre;\n    }\n</style>\n\n<div id=\"mylog\" ng-bind=\"msg.payload\" contenteditable=\"false\">\n    <!-- payload will go here -->\n    {{msg.payload}}\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":640,"y":1680,"wires":[[]]},{"id":"13850e93.5260c1","type":"ui_template","z":"dfa0e0a5.c8001","group":"ed8a86bc.a4c3c8","name":"","order":1,"width":12,"height":5,"format":"<style>\n    #mylog {\n        min-height: 250px;\n        padding: 0;\n        background-color: white;\n        white-space: pre;\n    }\n</style>\n\n<div id=\"mylog\" ng-bind=\"msg.payload\" contenteditable=\"false\">\n    <!-- payload will go here -->\n    {{msg.payload}}\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":380,"y":1840,"wires":[[]]},{"id":"971afb17.247658","type":"function","z":"7c56a241.1e88dc","name":"gate !pause && !restartSlideshow","func":"if(global.get('kodiPlayerStatus') === \"kodiPause\" && global.get('restartSlideshowOnPause') === false){\n    global.set('restartOnKodiPlay', true);\n    \n} else {\n    global.set('restartOnKodiPlay', false);\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1440,"y":1660,"wires":[["dc11438c.48568"]]},{"id":"32ae0b10.cba1a4","type":"comment","z":"7c56a241.1e88dc","name":"Error handling","info":"","x":1190,"y":1440,"wires":[]},{"id":"620500ef.801cc","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Spiele Ton ab","tooltip":"","group":"c83c4c5e.03ddf","order":3,"width":12,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":400,"y":2780,"wires":[[]]},{"id":"eee130ec.fd1ff","type":"comment","z":"e00097c0.ad3088","name":"Power","info":"","x":190,"y":780,"wires":[]},{"id":"620a225.a1a7adc","type":"exec","z":"e00097c0.ad3088","command":"sudo reboot","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":890,"y":980,"wires":[[],[],[]]},{"id":"e6b47c1d.0480e","type":"exec","z":"e00097c0.ad3088","command":"sudo poweroff","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":900,"y":900,"wires":[[],[],[]]},{"id":"3c258dba.262252","type":"ui_button","z":"e00097c0.ad3088","name":"","group":"69cbfcd5.4478f4","order":3,"width":10,"height":1,"passthru":false,"label":"Power off","tooltip":"","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":500,"y":880,"wires":[["6c5d785f.280258","198f959c.c6214a"]]},{"id":"9a6b2c82.5af59","type":"ui_button","z":"e00097c0.ad3088","name":"","group":"69cbfcd5.4478f4","order":1,"width":10,"height":1,"passthru":false,"label":"Reboot","tooltip":"","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":500,"y":980,"wires":[["ab37b1.9edf585","43bc418f.d2866"]]},{"id":"17d385c0.63330a","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Anzeigedauer (in min.)","tooltip":"","group":"c83c4c5e.03ddf","order":2,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":"1","max":"50","step":1,"x":420,"y":2720,"wires":[["6bc91c2b.049a44","3a9217cf.530498"]]},{"id":"1b9062d5.31c72d","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"onScreenInfo","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":2660,"wires":[["505bfc14.21ed74"]]},{"id":"4272969d.207d08","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Info auf Bildschirm","tooltip":"","group":"c83c4c5e.03ddf","order":1,"width":12,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":410,"y":2660,"wires":[["1b9062d5.31c72d"]]},{"id":"505bfc14.21ed74","type":"persist in","z":"5af1388b.ef9838","name":"onScreenInfo","storageNode":"aa40158d.83bf68","x":950,"y":2660,"wires":[]},{"id":"5740ec8b.7bdd14","type":"persist out","z":"5af1388b.ef9838","name":"onScreenInfo","storageNode":"aa40158d.83bf68","x":210,"y":2660,"wires":[["4272969d.207d08"]]},{"id":"44630523.e0dadc","type":"persist out","z":"5af1388b.ef9838","name":"onScreenInfoTime","storageNode":"aa40158d.83bf68","x":190,"y":2720,"wires":[["17d385c0.63330a"]]},{"id":"3a9217cf.530498","type":"persist in","z":"5af1388b.ef9838","name":"onScreenInfoTime","storageNode":"aa40158d.83bf68","x":730,"y":2760,"wires":[]},{"id":"6bc91c2b.049a44","type":"function","z":"5af1388b.ef9838","name":"set onScreenInfoTime","func":"msg.payload = 1000 * 60;\nglobal.set('onScreenInfoTime', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":2720,"wires":[[]]},{"id":"1f9144a2.57693b","type":"function","z":"5af1388b.ef9838","name":"if restartOnKodiPlay","func":"if(global.get('restartOnKodiPlay') && msg.payload === \"kodiPlay\"){\n    global.set('restartOnKodiPlay', false);\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":840,"y":360,"wires":[["620371c7.3effe"]]},{"id":"38184a7b.3270c6","type":"function","z":"7c56a241.1e88dc","name":"set off","func":"msg.payload = \"off\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":2240,"wires":[["8134f650.06c6e8","6660cfe.4d8bc3"]]},{"id":"43bc418f.d2866","type":"ui_switch","z":"e00097c0.ad3088","name":"actButt","label":"","tooltip":"","group":"69cbfcd5.4478f4","order":2,"width":2,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":640,"y":1060,"wires":[["57efe7f.0363418"]]},{"id":"ab37b1.9edf585","type":"function","z":"e00097c0.ad3088","name":"switch-gate","func":"status = flow.get('switchstate2') || 0;\nif (status === 1){\n    return msg;\n} else return null;","outputs":1,"noerr":0,"x":700,"y":980,"wires":[["620a225.a1a7adc"]]},{"id":"6c5d785f.280258","type":"function","z":"e00097c0.ad3088","name":"switch-gate","func":"status = flow.get('switchstate1') || 0;\nif (status === 1){\n    return msg;\n} else return null;","outputs":1,"noerr":0,"x":700,"y":900,"wires":[["e6b47c1d.0480e"]]},{"id":"b83d5fa9.de0ee","type":"function","z":"e00097c0.ad3088","name":"save switch-state","func":"flow.set('switchstate1', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":820,"wires":[["4eb7fb5d.8dd8c4"]]},{"id":"198f959c.c6214a","type":"ui_switch","z":"e00097c0.ad3088","name":"actButt","label":"","tooltip":"","group":"69cbfcd5.4478f4","order":4,"width":2,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":640,"y":820,"wires":[["b83d5fa9.de0ee"]]},{"id":"8f02d53.7c7f428","type":"function","z":"e00097c0.ad3088","name":"lightgrey","func":"msg.background = global.get('lightgrey');\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":940,"wires":[["3c258dba.262252","9a6b2c82.5af59"]]},{"id":"8f5e473c.b49048","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":180,"y":940,"wires":[["8f02d53.7c7f428"]]},{"id":"e3d618f0.06a1b8","type":"function","z":"e00097c0.ad3088","name":"set color background","func":"if (msg.payload === 1){\n    msg.background = \"\";\n} else msg.background = global.get('lightgrey');\nreturn msg;","outputs":1,"noerr":0,"x":1080,"y":1060,"wires":[["9a6b2c82.5af59"]]},{"id":"4eb7fb5d.8dd8c4","type":"function","z":"e00097c0.ad3088","name":"set color background","func":"if (msg.payload === 1){\n    msg.background = \"\";\n} else msg.background = global.get('lightgrey');\nreturn msg;","outputs":1,"noerr":0,"x":1080,"y":820,"wires":[["3c258dba.262252"]]},{"id":"57efe7f.0363418","type":"function","z":"e00097c0.ad3088","name":"save switch-state","func":"flow.set('switchstate2', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":1060,"wires":[["e3d618f0.06a1b8"]]},{"id":"f3491838.b5a378","type":"comment","z":"e00097c0.ad3088","name":"Colors","info":"","x":1210,"y":80,"wires":[]},{"id":"e1cb0159.03bf3","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":1290,"y":140,"wires":[["876dc52c.583c98"]]},{"id":"876dc52c.583c98","type":"function","z":"e00097c0.ad3088","name":"set colors","func":"global.set ('green', \"#4DA170\");\nglobal.set ('yellow', \"#c4b631\");\nglobal.set ('red', \"#EB7676\");\nglobal.set ('blue', \"#0DA1BF\");\nglobal.set ('lightgrey', \"#525252\");","outputs":1,"noerr":0,"x":1440,"y":140,"wires":[[]]},{"id":"66b583e0.7c2ecc","type":"comment","z":"dfa0e0a5.c8001","name":"Lösche Ordner","info":"","x":140,"y":2740,"wires":[]},{"id":"6a83edb3.fc3cb4","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":790,"y":3140,"wires":[[],[],[]]},{"id":"6c822d0f.1d5ba4","type":"inject","z":"dfa0e0a5.c8001","name":"all","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":2820,"wires":[["9e3aa130.d88a8","26ef0caa.c7ccf4","55b13cbe.3730c4","dac6155a.a69fa8","5e2035a3.50975c","95106a24.570108","3425b7de.269188","39705c86.610aa4","a7523f54.68531"]]},{"id":"9e3aa130.d88a8","type":"function","z":"dfa0e0a5.c8001","name":"images-incoming","func":"msg.payload = \"rm \" + global.get('images-incoming') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":2920,"wires":[["6a83edb3.fc3cb4"]]},{"id":"26ef0caa.c7ccf4","type":"function","z":"dfa0e0a5.c8001","name":"images-preprocessing","func":"msg.payload = \"rm \" + global.get('images-preprocessing') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":2960,"wires":[["6a83edb3.fc3cb4"]]},{"id":"55b13cbe.3730c4","type":"function","z":"dfa0e0a5.c8001","name":"images-frameloop","func":"msg.payload = \"rm \" + global.get('images-frameloop') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":3000,"wires":[["6a83edb3.fc3cb4"]]},{"id":"dac6155a.a69fa8","type":"function","z":"dfa0e0a5.c8001","name":"images-dashboard","func":"msg.payload = \"rm \" + global.get('images-dashboard') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":3040,"wires":[["6a83edb3.fc3cb4"]]},{"id":"5e2035a3.50975c","type":"function","z":"dfa0e0a5.c8001","name":"images-stackText","func":"msg.payload = \"rm \" + global.get('images-stackText') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":3080,"wires":[["6a83edb3.fc3cb4"]]},{"id":"95106a24.570108","type":"function","z":"dfa0e0a5.c8001","name":"images-trash","func":"msg.payload = \"rm \" + global.get('images-trash') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":3120,"wires":[["6a83edb3.fc3cb4"]]},{"id":"3425b7de.269188","type":"function","z":"dfa0e0a5.c8001","name":"videos-incoming","func":"msg.payload = \"rm \" + global.get('videos-incoming') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":3220,"wires":[["6a83edb3.fc3cb4"]]},{"id":"39705c86.610aa4","type":"function","z":"dfa0e0a5.c8001","name":"videos-preprocessing","func":"msg.payload = \"rm \" + global.get('videos-preprocessing') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":3260,"wires":[["6a83edb3.fc3cb4"]]},{"id":"a7523f54.68531","type":"function","z":"dfa0e0a5.c8001","name":"videos-frameloop","func":"msg.payload = \"rm \" + global.get('videos-frameloop') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":3300,"wires":[["6a83edb3.fc3cb4"]]},{"id":"4de747ac.e574e8","type":"inject","z":"dfa0e0a5.c8001","name":"images","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":2880,"wires":[["9e3aa130.d88a8","26ef0caa.c7ccf4","55b13cbe.3730c4","dac6155a.a69fa8","5e2035a3.50975c","95106a24.570108"]]},{"id":"9e48d1b3.a64c7","type":"inject","z":"dfa0e0a5.c8001","name":"incoming","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":2920,"wires":[["9e3aa130.d88a8"]]},{"id":"37d41686.c6249a","type":"inject","z":"dfa0e0a5.c8001","name":"preprocessing","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":2960,"wires":[["26ef0caa.c7ccf4"]]},{"id":"e73cda9d.5955f8","type":"inject","z":"dfa0e0a5.c8001","name":"frameloop","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":3000,"wires":[["55b13cbe.3730c4"]]},{"id":"6f109f80.8165b","type":"inject","z":"dfa0e0a5.c8001","name":"dashboard","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":3040,"wires":[["dac6155a.a69fa8"]]},{"id":"47a51b9f.ca8fc4","type":"inject","z":"dfa0e0a5.c8001","name":"stackText","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":3080,"wires":[["5e2035a3.50975c"]]},{"id":"5cd74c37.693234","type":"inject","z":"dfa0e0a5.c8001","name":"trash","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":3120,"wires":[["95106a24.570108"]]},{"id":"a64dc8b7.16b758","type":"inject","z":"dfa0e0a5.c8001","name":"incoming","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":3220,"wires":[["3425b7de.269188"]]},{"id":"8b5e710.716cb9","type":"inject","z":"dfa0e0a5.c8001","name":"preprocessing","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":3260,"wires":[["39705c86.610aa4"]]},{"id":"a6b6a610.f706f8","type":"inject","z":"dfa0e0a5.c8001","name":"frameloop","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":3300,"wires":[["a7523f54.68531"]]},{"id":"ecb98085.8873e","type":"inject","z":"dfa0e0a5.c8001","name":"videos","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":3180,"wires":[["a7523f54.68531","39705c86.610aa4","3425b7de.269188"]]},{"id":"6d48e2fd.29f93c","type":"inject","z":"5af1388b.ef9838","name":"add file","topic":"","payload":"/home/pi/media/telegram/images/03.frameloop/","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1750,"y":1960,"wires":[["fa2b528.f56f8b"]]},{"id":"fa2b528.f56f8b","type":"function","z":"5af1388b.ef9838","name":"Player.Open (directory)","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.Open\",\n            \"args\":{\n                \"item\":{\n                    \"directory\":msg.payload\n                },\n                \"playlistid\":2,\n                \"position\":3\n            }\n        }\n};","outputs":1,"noerr":0,"x":1940,"y":1960,"wires":[["b2efa2c8.3efc"]]},{"id":"fea6f6b9.164658","type":"function","z":"5af1388b.ef9838","name":"Player.Open (playlist id)","func":"return {\n    payload: \n        {\n            \"method\":\"Player.Open\",\n            \"params\":{\n                \"item\":{\n                    \"playlistid\":2,\n                    \"position\":0\n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":2230,"y":420,"wires":[["b2efa2c8.3efc"]]},{"id":"ad767800.723438","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2010,"y":440,"wires":[["fea6f6b9.164658"]]},{"id":"7590c4a8.565e5c","type":"comment","z":"5af1388b.ef9838","name":"Player Control","info":"","x":1330,"y":80,"wires":[]},{"id":"b4807c19.dfde6","type":"link in","z":"5af1388b.ef9838","name":"Playlist.Clear","links":[],"x":1835,"y":380,"wires":[["aa8f2459.3432d8"]]},{"id":"5edba122.a50e1","type":"fs-file-lister","z":"5af1388b.ef9838","name":"","start":"/","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":1800,"y":240,"wires":[["d19786c6.643a08","aa8f2459.3432d8","a7db522d.481cc"]]},{"id":"27faf3d3.2ce36c","type":"function","z":"5af1388b.ef9838","name":"set FL folder","func":"msg.payload = {start: msg.payload};\nreturn msg;","outputs":1,"noerr":0,"x":1630,"y":240,"wires":[["5edba122.a50e1","4e854f6.a31ecb"]]},{"id":"a7ce1b23.58e018","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Stop","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":560,"wires":[["6eb6fb45.cfdac4"]]},{"id":"ff3805c5.6dc878","type":"function","z":"5af1388b.ef9838","name":"Player.Open (playlist m3u)","func":"return {\n    payload: \n        {\n            \"method\":\"Player.Open\",\n            \"params\":{\n                \"item\":{\n                    \"file\":\"/home/pi/media/telegram/images/playlist.m3u\"\n\n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":1930,"y":1540,"wires":[["b2efa2c8.3efc"]]},{"id":"7d0c674.56efb98","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1750,"y":1540,"wires":[["ff3805c5.6dc878"]]},{"id":"c33b99d6.5120e8","type":"function","z":"5af1388b.ef9838","name":"GUI.ActivateWindow","func":"// https://kodi.wiki/view/Window_IDs\nreturn {\n    payload: \n        {\n            \"cmd\":\"GUI.ActivateWindow\",\n            \"params\":{\n                \"window\":\"virtualkeyboard\",\n                \"parameters\":[\"DialogKeyboard\"]\n            }\n        }\n};","outputs":1,"noerr":0,"x":1940,"y":1480,"wires":[["b2efa2c8.3efc"]]},{"id":"2cdc829c.b6c92e","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1750,"y":1480,"wires":[["c33b99d6.5120e8"]]},{"id":"bb086a54.b87bd8","type":"function","z":"5af1388b.ef9838","name":"throw out elements","func":"var list = msg.list;\nvar pos = parseInt(msg.topic);\nvar index = msg.index;\n\nmsg.payload = list[index];\n\nif (index === list.length-1){\n    msg.index = 0;\n} else {\n    msg.index = index + 1;\n}\nif ((pos) === msg.index){\n    msg.reset = \"reset\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":2170,"y":220,"wires":[["614af351.1651cc","6e18904b.3731"]]},{"id":"d19786c6.643a08","type":"function","z":"5af1388b.ef9838","name":"start loop","func":"var list = msg.payload;\nvar topic = parseInt(msg.topic);\nif(topic >= 0){} else {\n    topic = 0;\n}\nvar index = topic;\n\nmsg = {list, index, topic};\n\nif(index < list.length){\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":1960,"y":220,"wires":[["bb086a54.b87bd8","ef65ee1c.9b4dd"]]},{"id":"614af351.1651cc","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"1200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2180,"y":140,"wires":[["bb086a54.b87bd8"]]},{"id":"cbaf583f.223358","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1800,"y":100,"wires":[["4e854f6.a31ecb"]]},{"id":"4e854f6.a31ecb","type":"function","z":"5af1388b.ef9838","name":"reset","func":"msg.reset = \"reset\";\nreturn msg;\n","outputs":1,"noerr":0,"x":1970,"y":140,"wires":[["614af351.1651cc"]]},{"id":"c1790d87.1e131","type":"link in","z":"5af1388b.ef9838","name":"","links":["de98e67.3745118"],"x":95,"y":2980,"wires":[["413ecc2f.d1b544"]]},{"id":"de98e67.3745118","type":"link out","z":"5af1388b.ef9838","name":"","links":["c1790d87.1e131","199c506a.499d1"],"x":375,"y":60,"wires":[]},{"id":"199c506a.499d1","type":"link in","z":"5af1388b.ef9838","name":"","links":["de98e67.3745118"],"x":175,"y":300,"wires":[["cbdf7fed.a48c1","daf3cda0.83941"]]},{"id":"868cd190.6585a","type":"link out","z":"5af1388b.ef9838","name":"","links":["1c6d8031.edaa7"],"x":515,"y":560,"wires":[]},{"id":"21c3e5f9.6f75da","type":"link out","z":"5af1388b.ef9838","name":"","links":["f4cce95d.56b828"],"x":515,"y":620,"wires":[]},{"id":"62faac09.68dee4","type":"link out","z":"5af1388b.ef9838","name":"","links":["eb78734a.657a7"],"x":515,"y":740,"wires":[]},{"id":"a7a8c7d1.937c78","type":"link out","z":"5af1388b.ef9838","name":"","links":["2208e8fb.66fdc8"],"x":515,"y":780,"wires":[]},{"id":"632ce0a4.83576","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"/home/pi/media/telegram/images/03.frameloop/04.jpg.resize.jpg.addName.jpg","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2150,"y":280,"wires":[["6e18904b.3731"]]},{"id":"ef65ee1c.9b4dd","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"1500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2140,"y":340,"wires":[["fea6f6b9.164658"]]},{"id":"8ce91178.33527","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"e4f17352.69409","order":3,"width":0,"height":0,"passthru":false,"label":"Update","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":300,"y":2340,"wires":[["e472071a.d6afa8"]]},{"id":"42220cc2.75ff74","type":"link in","z":"5af1388b.ef9838","name":"","links":["e0ee1701.429a18"],"x":1775,"y":140,"wires":[["4e854f6.a31ecb"]]},{"id":"e0ee1701.429a18","type":"link out","z":"5af1388b.ef9838","name":"","links":["42220cc2.75ff74"],"x":1595,"y":560,"wires":[]},{"id":"620371c7.3effe","type":"link out","z":"5af1388b.ef9838","name":"","links":["92da4955.9fdbf8"],"x":995,"y":360,"wires":[]},{"id":"6df57dbf.8b24e4","type":"link out","z":"5af1388b.ef9838","name":"","links":["cd187329.675f9"],"x":515,"y":680,"wires":[]},{"id":"79278d76.f3b9e4","type":"comment","z":"5af1388b.ef9838","name":"Kodi settings","info":"","x":1470,"y":1220,"wires":[]},{"id":"5f47212b.83b2a","type":"link out","z":"5af1388b.ef9838","name":"","links":["4735cc75.25aa54"],"x":715,"y":2040,"wires":[]},{"id":"4735cc75.25aa54","type":"link in","z":"5af1388b.ef9838","name":"Settings.SetSettingValue","links":["5f47212b.83b2a"],"x":1275,"y":1340,"wires":[["99bf7b1a.41e4f8"]]},{"id":"9f55bb60.063888","type":"link out","z":"5af1388b.ef9838","name":"","links":["d9a48616.4bb068"],"x":255,"y":420,"wires":[]},{"id":"d9a48616.4bb068","type":"link in","z":"5af1388b.ef9838","name":"","links":["9f55bb60.063888"],"x":115,"y":1160,"wires":[["6407c025.f7455"]]},{"id":"a7db522d.481cc","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"fileListImages","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1810,"y":320,"wires":[[]]},{"id":"d478b536.e92718","type":"function","z":"5af1388b.ef9838","name":"global.set currentPos","func":"var file = msg.payload.data.data.item.file;\nvar list = global.get('fileListImages');\n\nfor (var i=0; i < list.length; i++) {\n    if(list[i] === file){\n        msg.payload = i;\n        global.set('currentPos', i);\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":860,"y":300,"wires":[[]]},{"id":"3dfba2cd.eddf1e","type":"function","z":"5af1388b.ef9838","name":"if Player.OnPlay","func":"if (msg.payload.notification === \"Player.OnPlay\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":440,"y":300,"wires":[["af1fd754.2f7da8"]]},{"id":"becb6073.b5164","type":"comment","z":"5af1388b.ef9838","name":"Player.Open (directory) [topic:pos]","info":"","x":1480,"y":140,"wires":[]},{"id":"22757c1.e629b84","type":"rbe","z":"5af1388b.ef9838","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":450,"y":2160,"wires":[["f34c1177.b2b79","a8cc1088.83d24"]]},{"id":"9030aab4.b3cae8","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":390,"y":400,"wires":[["448d0e97.8e5ff","b1559b66.b13608","9104c854.65d0d8"]]},{"id":"69993e6f.1cf93","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":800,"wires":[["3d7a77a3.b7a3c8","bde9ea0c.be08b8"]]},{"id":"7021d9f3.a489a8","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":1240,"wires":[["779c625.b0a5e9c","59352b39.4a6ea4"]]},{"id":"206db579.1cf32a","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":390,"y":1460,"wires":[["d996463d.31d538","5471ffdb.a7bbf"]]},{"id":"ed6040e4.f77e3","type":"rbe","z":"e00097c0.ad3088","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":490,"y":260,"wires":[["1d8775e4.7c3f0a","f6e96d1d.c2c99"]]},{"id":"ec056cf1.92b03","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder (loop)","func":"msg.payload = {start: global.get('images-loop')};\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":180,"wires":[["910d9005.590f8","1d7034be.bb7a0b"]]},{"id":"5ccae7e4.a72cb8","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-loop')","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":"1","stat":false,"showWarnings":true,"x":980,"y":180,"wires":[["49a1f7f3.92a728"]]},{"id":"49a1f7f3.92a728","type":"function","z":"168e0b9d.9c19d4","name":"loop: rename + 1","func":"if (msg.payload.length > 0){\n    \n    var cmd = \"\";\n    var file;\n    var fileNew;\n    var folder;\n    var x;\n    var postfix;\n    var index;\n    var stickFlag = false;\n    var stickFlagThreshold = false;\n    var loopMax = global.get('loopMax');\n    \n    // stickFlagThreshold aktivieren?\n    // FileLister-Array rückwärts durchlaufen\n    for (var i=msg.payload.length-1; i >= 0; i--) {\n        \n        // Dateiname extrahieren\n        file = msg.payload[i].slice(msg.payload[i].lastIndexOf(\"/\") + 1);\n        \n        // Finde filenr = loopMax\n        if (parseInt(file.slice(0, 4)) === loopMax){\n\n            // Teste ob 'stick'\n            index = file.lastIndexOf('jpg');\n            if (file.slice(index -6, index -1) === \"stick\"){\n                stickFlagThreshold = true;\n                msg.topic = \"noTrashInc\";\n            }\n            break;\n        }\n    }\n    \n    // FileLister-Array rückwärts durchlaufen\n    for (i=msg.payload.length-1; i >= 0; i--) {\n        \n        // Datei- und Ordnername extrahieren\n        file = msg.payload[i].slice(msg.payload[i].lastIndexOf(\"/\") + 1);\n        folder = msg.payload[i].slice(0, msg.payload[i].lastIndexOf(\"/\") + 1);\n        \n        // inkrementieren\n        x = parseInt(file.slice(0, 4));\n        postfix = file.slice(4);\n        \n        if (Number.isInteger(x)){\n            \n            x = x + 1;\n            \n            // stickFlag aktivieren?\n            index = file.lastIndexOf('jpg');\n            if (file.slice(index -6, index -1) === \"stick\"){\n                stickFlag = true;\n            } else {\n                stickFlag = false;\n            }\n            \n            if(x > loopMax){\n                \n                if(!stickFlag){\n                    // Nach Papierkorb verschieben und an Anfang von Papierkorb setzen\n                    fileNew = \"1000.trash.\" + file;\n                    cmd = cmd + \"mv \" + folder + file + \" \" + global.get('images-trash') + fileNew + \" && \";\n                \n                } else {\n                    if(stickFlagThreshold){\n                        // Umbenennen nach neuem Dateinamen und an cmd anhängen\n                        fileNew = x + postfix;\n                        cmd = cmd + \"mv \" + folder + file + \" \" + folder + fileNew + \" && \";\n                    }\n                }\n                \n            } else {\n                // Umbenennen nach neuem Dateinamen und an cmd anhängen\n                fileNew = x + postfix;\n                cmd = cmd + \"mv \" + folder + file + \" \" + folder + fileNew + \" && \";\n            }\n        }\n    }\n    // letztes '&&' hinten abschneiden\n    msg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);\n    \n} else {\n    msg.payload = \"\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":180,"wires":[["b52c5740.d96f88"]]},{"id":"b52c5740.d96f88","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1310,"y":180,"wires":[[],[],["7870aa74.8f94b4","10a58e3d.a2d192"]]},{"id":"7870aa74.8f94b4","type":"function","z":"168e0b9d.9c19d4","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1460,"y":200,"wires":[[],["815b7ff3.e8c37"]]},{"id":"ca4ca2db.60f39","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder (loop)","func":"msg.payload = {start: global.get('images-loop')};\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":360,"wires":[["24b35e2e.6f1402","fb86f8bf.e5d048"]]},{"id":"250a3685.0957da","type":"comment","z":"168e0b9d.9c19d4","name":"increment filenr @Trash","info":"","x":240,"y":480,"wires":[]},{"id":"893576cb.5fbd98","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":500,"wires":[["9742198d.4b0aa8"]]},{"id":"9df2a546.c6cce8","type":"function","z":"5af1388b.ef9838","name":"+1000","func":"msg.payload = msg.payload +1000;\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":2320,"wires":[["2de84ae9.85c9d6"]]},{"id":"cf0a036c.6296d","type":"function","z":"5af1388b.ef9838","name":"+1000","func":"msg.payload = msg.payload +1000;\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":2460,"wires":[["afd767a1.e9d978"]]},{"id":"9f6874a1.eec9b8","type":"function","z":"168e0b9d.9c19d4","name":"if stick","func":"var file = msg.payload;\nvar index = file.lastIndexOf('jpg');\n\nif (file.slice(index -6, index -1) === \"stick\"){\n    return [null, msg];\n} else {\n    return [msg, null];\n}\n","outputs":2,"noerr":0,"x":430,"y":980,"wires":[["924eb351.0aacd"],["3f1fff6a.78965"]]},{"id":"2ff22d2b.2cdc72","type":"function","z":"168e0b9d.9c19d4","name":"set FL file pattern (nr) + folder","func":"var startfile = msg.payload.lastIndexOf(\"/\") + 1;\n\nvar pattern = msg.payload.slice(startfile, startfile+4) + \".*\";\nvar start = global.get('images-loop');\n\nmsg.payload = {start, pattern};\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":1020,"wires":[["9f0cbd7a.e5653"]]},{"id":"702a3df4.7558c4","type":"function","z":"168e0b9d.9c19d4","name":"set FL file pattern (nr) + folder","func":"var startfile = msg.payload.lastIndexOf(\"/\") + 1;\nvar pattern = msg.payload.slice(startfile, startfile+4) + \".*\";\nvar start = global.get('images-loop');\n\nmsg.payload = {start, pattern};\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":940,"wires":[["6363796d.970b38"]]},{"id":"bba0d04b.f2055","type":"function","z":"5af1388b.ef9838","name":"+1000","func":"msg.payload = msg.payload +1000;\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":3960,"wires":[["698ba4d3.4d460c"]]},{"id":"37d37cd6.cb3ca4","type":"function","z":"5af1388b.ef9838","name":"start on current Pos","func":"msg.topic = global.get('currentPos');\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":280,"wires":[["444b6d47.818b94"]]},{"id":"910d9005.590f8","type":"q-gate","z":"168e0b9d.9c19d4","name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":850,"y":180,"wires":[["5ccae7e4.a72cb8"]]},{"id":"a377348b.c9e318","type":"q-gate","z":"168e0b9d.9c19d4","name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":850,"y":540,"wires":[["9864f6a2.cf29a8"]]},{"id":"24b35e2e.6f1402","type":"q-gate","z":"168e0b9d.9c19d4","name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":850,"y":360,"wires":[["b108c115.2edbe"]]},{"id":"10a58e3d.a2d192","type":"function","z":"168e0b9d.9c19d4","name":"open q-gate","func":"msg.payload = \"open\";\nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":160,"wires":[["c578578b.a86018"]]},{"id":"1d7034be.bb7a0b","type":"function","z":"168e0b9d.9c19d4","name":"queue q-gate","func":"msg.payload = \"queue\";\nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":140,"wires":[["3275ddc0.a7a472"]]},{"id":"c578578b.a86018","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["32600d51.c504b2","57d8c0a2.0eef3","a70ba46a.955d08","3101c169.e4088e","96c4ea7a.ff9ff8"],"x":1595,"y":160,"wires":[]},{"id":"3275ddc0.a7a472","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["32600d51.c504b2","57d8c0a2.0eef3","a70ba46a.955d08","e27dc3c5.426f3","3101c169.e4088e","96c4ea7a.ff9ff8"],"x":995,"y":140,"wires":[]},{"id":"a06004af.3b8a18","type":"link in","z":"168e0b9d.9c19d4","name":"","links":["bd0f783.1a5a088","31457fe8.2bfc3","f93704c2.9aa428","705e8981.83a778"],"x":755,"y":220,"wires":[["910d9005.590f8"]]},{"id":"a70ba46a.955d08","type":"link in","z":"168e0b9d.9c19d4","name":"","links":["3275ddc0.a7a472","c578578b.a86018"],"x":755,"y":580,"wires":[["a377348b.c9e318"]]},{"id":"57d8c0a2.0eef3","type":"link in","z":"168e0b9d.9c19d4","name":"","links":["3275ddc0.a7a472","c578578b.a86018"],"x":755,"y":400,"wires":[["24b35e2e.6f1402"]]},{"id":"95337ecc.2b917","type":"function","z":"168e0b9d.9c19d4","name":"queue q-gate","func":"msg.payload = \"queue\";\nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":500,"wires":[["31457fe8.2bfc3"]]},{"id":"31457fe8.2bfc3","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["32600d51.c504b2","a06004af.3b8a18","3101c169.e4088e","96c4ea7a.ff9ff8"],"x":995,"y":500,"wires":[]},{"id":"fb86f8bf.e5d048","type":"function","z":"168e0b9d.9c19d4","name":"queue q-gate","func":"msg.payload = \"queue\";\nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":320,"wires":[["bd0f783.1a5a088"]]},{"id":"bd0f783.1a5a088","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["32600d51.c504b2","a06004af.3b8a18","3101c169.e4088e","96c4ea7a.ff9ff8"],"x":995,"y":320,"wires":[]},{"id":"93ae52c8.5c9d5","type":"function","z":"168e0b9d.9c19d4","name":"open q-gate","func":"msg.payload = \"open\";\nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":520,"wires":[["f93704c2.9aa428"]]},{"id":"f93704c2.9aa428","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["32600d51.c504b2","a06004af.3b8a18","e27dc3c5.426f3","3101c169.e4088e","96c4ea7a.ff9ff8"],"x":1595,"y":520,"wires":[]},{"id":"4913d647.cc5688","type":"function","z":"168e0b9d.9c19d4","name":"open q-gate","func":"msg.payload = \"open\";\nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":340,"wires":[["705e8981.83a778"]]},{"id":"705e8981.83a778","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["32600d51.c504b2","a06004af.3b8a18","3101c169.e4088e","96c4ea7a.ff9ff8"],"x":1595,"y":340,"wires":[]},{"id":"c6dfd6ad.5a9d78","type":"q-gate","z":"5af1388b.ef9838","name":"","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":670,"y":860,"wires":[["9db389fc.7c1378"]]},{"id":"b0d90b01.7f85b8","type":"link in","z":"5af1388b.ef9838","name":"q-gate delete","links":["abef4dae.00e98"],"x":555,"y":860,"wires":[["c6dfd6ad.5a9d78"]]},{"id":"d83da989.712c18","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["e34da76.5634d58"],"x":1775,"y":200,"wires":[]},{"id":"653e16f.0009ae8","type":"q-gate","z":"168e0b9d.9c19d4","name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":567.5,"y":780,"wires":[["50d656c2.bd1d18"]]},{"id":"e27dc3c5.426f3","type":"link in","z":"168e0b9d.9c19d4","name":"","links":["3275ddc0.a7a472","f93704c2.9aa428"],"x":475,"y":820,"wires":[["653e16f.0009ae8"]]},{"id":"e564f0b2.c7ba2","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1500,"y":340,"wires":[["5b173a11.dc2234"]]},{"id":"444b6d47.818b94","type":"function","z":"5af1388b.ef9838","name":"restore player status","func":"if (global.get('kodiPlayerStatus') === \"kodiPlay\"){\n    return [msg, null];\n} else if (global.get('kodiPlayerStatus') === \"kodiPause\"){\n    return [msg, msg];\n}\n\n\n\n","outputs":2,"noerr":0,"x":1300,"y":340,"wires":[["442ce2f1.aae81c"],["e564f0b2.c7ba2"]]},{"id":"a2efcfae.2a0d8","type":"function","z":"168e0b9d.9c19d4","name":"trigger q-gate","func":"msg.payload = \"trigger\";\nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"x":1480,"y":380,"wires":[["abef4dae.00e98"]]},{"id":"abef4dae.00e98","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["b0d90b01.7f85b8"],"x":1595,"y":380,"wires":[]},{"id":"cc790eef.cfbef","type":"inject","z":"5af1388b.ef9838","name":"","topic":"control","payload":"queue","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":690,"y":800,"wires":[["c6dfd6ad.5a9d78"]]},{"id":"33ada742.0d0c78","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"79173158.54b5a","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":150,"y":2340,"wires":[["2684e7ee.44e3a8"]]},{"id":"23d083bb.c331fc","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"79173158.54b5a","order":4,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":150,"y":2380,"wires":[["2684e7ee.44e3a8"]]},{"id":"ddadab17.b39448","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"79173158.54b5a","order":7,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":150,"y":2520,"wires":[["4ec80947.9567b8"]]},{"id":"4232c821.e5aba8","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"79173158.54b5a","order":6,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":150,"y":2480,"wires":[["4ec80947.9567b8"]]},{"id":"2684e7ee.44e3a8","type":"function","z":"5af1388b.ef9838","name":"set value","func":"if(msg.payload === \"l\"){\n    msg.payload = (global.get('loopMax') || 1001) - 1000 - 1;\n    if (msg.payload < 1){\n        msg.payload = 1;\n    }\n} else {\n    msg.payload = (global.get('loopMax') || 1001) - 1000 + 1;\n    if (msg.payload > 999){\n        msg.payload = 999;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":2360,"wires":[["3c457ef9.347f12"]]},{"id":"4ec80947.9567b8","type":"function","z":"5af1388b.ef9838","name":"set value","func":"if(msg.payload === \"l\"){\n    msg.payload = (global.get('trashMax') || 1001) - 1000 - 1;\n    if (msg.payload < 1){\n        msg.payload = 1;\n    }\n} else {\n    msg.payload = (global.get('trashMax') || 1001) - 1000 + 1;\n    if (msg.payload > 999){\n        msg.payload = 999;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":2500,"wires":[["1bc5e035.452d1"]]},{"id":"80c27756.dc37a8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1780,"y":400,"wires":[["425c5a.673893a8"],[]]},{"id":"425c5a.673893a8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1895,"y":400,"wires":[]},{"id":"504b0d03.1c2514","type":"function","z":"7c56a241.1e88dc","name":"move to folders","func":"var file = flow.get('lastTelegramFilename');\nvar fileNew;\nvar cmd = \"\";\n\nvar imagepath = global.get('images-preprocessing');\nvar frameloop = global.get('images-frameloop');\nvar dashboard = global.get('images-dashboard');\nvar stackText = global.get('images-stackText');\n\nif (msg.topic === \"textTrueName\" || msg.topic === \"textFalseName\"){\n    \n    // move addName to frameloop\n    fileNew = file + \".resize.jpg.addName.jpg\"\n    cmd = cmd + \"mv \" + imagepath + fileNew + \" \" + frameloop + fileNew + \" && \";\n    \n    // move addName to dashboard\n    fileNew = fileNew + \".dash.jpg\"\n    cmd = cmd + \"mv \" + imagepath + fileNew + \" \" + dashboard + fileNew + \" && \";\n}\n\nif (msg.topic === \"textTrueText\"){\n    \n    fileNew = file + \".resize.jpg.addText.jpg\"\n    \n    if (global.get('textActive')){\n        // move addText to frameloop\n        cmd = cmd + \"mv \" + imagepath + fileNew + \" \" + frameloop + fileNew + \" && \";\n        \n        // move addText to dashboard\n        fileNew = fileNew + \".dash.jpg\"\n        cmd = cmd + \"mv \" + imagepath + fileNew + \" \" + dashboard + fileNew + \" && \"; \n    \n    } else {\n        // move addText to stackText\n        cmd = cmd + \"mv \" + imagepath + fileNew + \" \" + stackText + fileNew + \" && \";\n        \n        // move addText to stackText\n        fileNew = fileNew + \".dash.jpg\"\n        cmd = cmd + \"mv \" + imagepath + fileNew + \" \" + stackText + fileNew + \" && \";         \n    }\n}\n\n// letztes '&&' hinten abschneiden\nmsg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":1520,"wires":[["cd85ae0a.2ca4d"]]},{"id":"a600866c.e8f348","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":650,"y":1520,"wires":[[],[],["c2e79f5.bee4a6"]]},{"id":"c2e79f5.bee4a6","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":800,"y":1520,"wires":[["ce0076c8.8fb808"],["23a08705.fbb988"]]},{"id":"ce0076c8.8fb808","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":955,"y":1500,"wires":[]},{"id":"4f87b31c.04324c","type":"comment","z":"7c56a241.1e88dc","name":"move files to loop","info":"","x":370,"y":1480,"wires":[]},{"id":"cd85ae0a.2ca4d","type":"q-gate","z":"7c56a241.1e88dc","name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":530,"y":1520,"wires":[["a600866c.e8f348"]]},{"id":"96c4ea7a.ff9ff8","type":"link in","z":"7c56a241.1e88dc","name":"q-gate move to frameloop","links":["c578578b.a86018","f93704c2.9aa428","705e8981.83a778","3275ddc0.a7a472","31457fe8.2bfc3","bd0f783.1a5a088"],"x":435,"y":1560,"wires":[["cd85ae0a.2ca4d"]]},{"id":"6fc7188d.772e58","type":"link in","z":"5af1388b.ef9838","name":"start on current Pos","links":["9765f902.6a5578","868eda77.f1d128","9db389fc.7c1378"],"x":1135,"y":280,"wires":[["37d37cd6.cb3ca4"]]},{"id":"9db389fc.7c1378","type":"link out","z":"5af1388b.ef9838","name":"","links":["6fc7188d.772e58"],"x":755,"y":860,"wires":[]},{"id":"868eda77.f1d128","type":"link out","z":"5af1388b.ef9838","name":"","links":["6fc7188d.772e58"],"x":595,"y":1000,"wires":[]},{"id":"280a718e.3cdc7e","type":"function","z":"5af1388b.ef9838","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":860,"y":2220,"wires":[[],["43a1202b.72c62"]]},{"id":"ae5cde94.c7306","type":"link out","z":"5af1388b.ef9838","name":"","links":["d66bb54a.5ceb38"],"x":1415,"y":2220,"wires":[]},{"id":"d66bb54a.5ceb38","type":"link in","z":"5af1388b.ef9838","name":"restore player status","links":["ae5cde94.c7306"],"x":1135,"y":340,"wires":[["444b6d47.818b94"]]},{"id":"33ab0b98.8da8e4","type":"fs-file-lister","z":"5af1388b.ef9838","name":"","start":"/","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":1160,"y":2220,"wires":[["6551337a.466c3c"]]},{"id":"6551337a.466c3c","type":"function","z":"5af1388b.ef9838","name":"start on Pos","func":"// extract No. of current File\nvar currentFileNr = global.get('currentFile').slice(global.get('currentFile').lastIndexOf(\"/\") + 1).slice(0, 4);\n\n// FileLister-Array vorwärts durchlaufen\nfor (var i=0; i < msg.payload.length; i++) {\n    if (msg.payload[i].slice(0, 4) === currentFileNr){\n        \n        msg.topic = i;\n        return msg;\n    }\n}\n\n\n","outputs":1,"noerr":0,"x":1310,"y":2220,"wires":[["ae5cde94.c7306"]]},{"id":"43a1202b.72c62","type":"function","z":"5af1388b.ef9838","name":"set FL folder","func":"msg.payload = {start: global.get('images-frameloop')};\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":2220,"wires":[["33ab0b98.8da8e4"]]},{"id":"70ef066c.7f85b8","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"/home/pi/media/telegram/images/03.loop/01.frameloop","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":460,"wires":[["883c1b70.676b08"]]},{"id":"a4803a5a.33ccf8","type":"comment","z":"dfa0e0a5.c8001","name":"vnc","info":"","x":110,"y":960,"wires":[]},{"id":"f26a62a2.ede7a","type":"persist in","z":"dfa0e0a5.c8001","name":"vnc","storageNode":"aa40158d.83bf68","x":550,"y":1060,"wires":[]},{"id":"3ad31cd9.380bb4","type":"persist out","z":"dfa0e0a5.c8001","name":"vnc","storageNode":"aa40158d.83bf68","x":130,"y":1060,"wires":[["33bef5f6.dc20ba"]]},{"id":"33bef5f6.dc20ba","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"vnc","tooltip":"","group":"29050d2.fa3cef2","order":4,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":1020,"wires":[["79d71622.df8908"]]},{"id":"4a975688.aadec8","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":550,"y":1020,"wires":[["7e149c0e.fbf354"],["16ef0e45.c2ce12"]]},{"id":"7e149c0e.fbf354","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start vncserver-x11-serviced","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":850,"y":1000,"wires":[[],[],[]]},{"id":"16ef0e45.c2ce12","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop vncserver-x11-serviced","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":850,"y":1060,"wires":[[],[],[]]},{"id":"79d71622.df8908","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":1020,"wires":[["4a975688.aadec8","f26a62a2.ede7a"]]},{"id":"d45ce864.0b1518","type":"exec","z":"dfa0e0a5.c8001","command":"sudo reboot","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":910,"y":540,"wires":[[],[],[]]},{"id":"815b7ff3.e8c37","type":"function","z":"168e0b9d.9c19d4","name":"gate 'noTrashInc'","func":"if(msg.topic !== \"noTrashInc\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1650,"y":200,"wires":[["d83da989.712c18"]]},{"id":"98d6148b.a85dc8","type":"function","z":"7c56a241.1e88dc","name":"clear incoming + preprocessing folder","func":"msg.payload = \"rm \" + global.get('images-incoming') + \"* && rm \" + global.get('images-preprocessing') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":820,"wires":[["5b524e22.21b55"]]},{"id":"5b524e22.21b55","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1030,"y":800,"wires":[[],[],[]]},{"id":"4a2b200a.861aa","type":"function","z":"7c56a241.1e88dc","name":"clear incoming + preprocessing folder","func":"msg.payload = \"rm \" + global.get('videos-incoming') + \"* && rm \" + global.get('videos-preprocessing') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":1370,"y":140,"wires":[["1afc2b1.69b32d5"]]},{"id":"1afc2b1.69b32d5","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1590,"y":140,"wires":[[],[],[]]},{"id":"957a82dc.74785","type":"persist in","z":"dfa0e0a5.c8001","name":"domain","storageNode":"aa40158d.83bf68","x":480,"y":2420,"wires":[]},{"id":"f29307f3.2e54e8","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"Domain","tooltip":"Ordnerpfad","group":"e4f17352.69409","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":"100","topic":"","x":300,"y":2420,"wires":[["957a82dc.74785","55613b13.837404"]]},{"id":"c82aa55f.bdfcc8","type":"persist out","z":"dfa0e0a5.c8001","name":"domain","storageNode":"aa40158d.83bf68","x":160,"y":2420,"wires":[["f29307f3.2e54e8"]]},{"id":"55613b13.837404","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"domain","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":2460,"wires":[[]]},{"id":"daf3cda0.83941","type":"function","z":"5af1388b.ef9838","name":"if AudioLibrary.OnScanStarted (touchscreen longpress)","func":"if (msg.payload.notification === \"AudioLibrary.OnScanStarted\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":560,"y":260,"wires":[["d462771d.909b28"]]},{"id":"d462771d.909b28","type":"link out","z":"5af1388b.ef9838","name":"","links":["92da4955.9fdbf8"],"x":815,"y":260,"wires":[]},{"id":"ed60d745.d96398","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"videoConvertFlag","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":4120,"wires":[[]]},{"id":"66d773d6.8384bc","type":"persist in","z":"5af1388b.ef9838","name":"videoConvertFlag","storageNode":"aa40158d.83bf68","x":950,"y":4060,"wires":[]},{"id":"7451464f.56b1a8","type":"persist out","z":"5af1388b.ef9838","name":"videoConvertFlag","storageNode":"aa40158d.83bf68","x":230,"y":4060,"wires":[["26a4a22.d68375e"]]},{"id":"26a4a22.d68375e","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Konvertieren wenn Videoauflösung größer als Displayauflösung","tooltip":"","group":"d021848d.7c9d58","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":590,"y":4060,"wires":[["66d773d6.8384bc","ed60d745.d96398"]]},{"id":"7a0eca03.f653c4","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":3260,"wires":[["21fd1787.3c13b8"]]},{"id":"21fd1787.3c13b8","type":"function","z":"5af1388b.ef9838","name":"blink control","func":"if(context.get('blink') || false){\n    msg.payload = \"#eb4034\"; // red\n    context.set('blink', false);\n    return msg;\n} else {\n    msg.payload = \"\"; // default\n    context.set('blink', true);\n    return msg;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":3200,"wires":[["7a0eca03.f653c4","2e1296c7.66d7ca"]]},{"id":"228c29b0.337986","type":"function","z":"5af1388b.ef9838","name":"reset","func":"msg.reset = \"reset\";\nreturn msg;\n","outputs":1,"noerr":0,"x":530,"y":3260,"wires":[["7a0eca03.f653c4"]]},{"id":"657f76bb.cb5818","type":"function","z":"5af1388b.ef9838","name":"if 3599","func":"if (msg.payload === 3599){\n    msg.payload = \"#eb4034\"; // red\n    return msg;\n}\n","outputs":1,"noerr":0,"x":430,"y":3180,"wires":[["228c29b0.337986","2e1296c7.66d7ca"]]},{"id":"6d7d0a2.6372cf4","type":"comment","z":"5af1388b.ef9838","name":"Trash","info":"","x":170,"y":1440,"wires":[]},{"id":"3ff40bed.cfb384","type":"file in","z":"5af1388b.ef9838","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":350,"y":1700,"wires":[["2583c1d0.682aae"]]},{"id":"fdb17c00.30fd","type":"comment","z":"5af1388b.ef9838","name":"Dashboard Preview","info":"","x":230,"y":1640,"wires":[]},{"id":"2583c1d0.682aae","type":"base64","z":"5af1388b.ef9838","name":"","action":"str","property":"payload","x":480,"y":1700,"wires":[["e313de76.5f0b7"]]},{"id":"e313de76.5f0b7","type":"ui_template","z":"5af1388b.ef9838","group":"31e0ed7e.859452","name":"","order":1,"width":12,"height":4,"format":"<img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":620,"y":1700,"wires":[[]]},{"id":"c9c74455.4e4708","type":"ui_table","z":"5af1388b.ef9838","group":"31e0ed7e.859452","name":"","order":4,"width":12,"height":6,"columns":[{"field":"file","title":"Datei","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":850,"y":1540,"wires":[["5ff58153.be0cd","196c4ee7.7bea51"]]},{"id":"24d2d298.74aeee","type":"fs-file-lister","z":"5af1388b.ef9838","name":"","start":"/","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":480,"y":1540,"wires":[["c2a73585.184f78"]]},{"id":"582ccf04.0771d","type":"function","z":"5af1388b.ef9838","name":"set FL folder","func":"msg.payload = {start: global.get('images-trash')};\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":1540,"wires":[["24d2d298.74aeee"]]},{"id":"112dd516.a920bb","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":160,"y":1500,"wires":[["582ccf04.0771d"]]},{"id":"c2a73585.184f78","type":"function","z":"5af1388b.ef9838","name":"prepare fs-array for table ","func":"var fileList = [];\nvar file;\n\nvar j = 0;\nfor (var i=0; i < msg.payload.length; i++) {\n    if (msg.payload[i].includes(\"dash\")){\n        file = msg.payload[i];\n        fileList[j] = {file};\n        j++;        \n    }\n}\n\nmsg.payload = fileList;\n\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":1540,"wires":[["c9c74455.4e4708"]]},{"id":"5ff58153.be0cd","type":"function","z":"5af1388b.ef9838","name":"get file","func":"var filename = global.get('images-trash') + msg.payload.file;\nmsg = {filename};\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":1700,"wires":[["3ff40bed.cfb384"]]},{"id":"e83976b.93a6d88","type":"ui_button","z":"5af1388b.ef9838","name":"","group":"31e0ed7e.859452","order":3,"width":6,"height":1,"passthru":false,"label":"Wiederherstellen","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Wirklich wiederherstellen?","payloadType":"str","topic":"","x":150,"y":1860,"wires":[["60cbc43d.dc4aac"]]},{"id":"bcab2a6b.397428","type":"ui_text","z":"5af1388b.ef9838","group":"31e0ed7e.859452","order":2,"width":6,"height":1,"name":"","label":"","format":"{{msg.payload}}","layout":"row-spread","x":350,"y":1760,"wires":[]},{"id":"196c4ee7.7bea51","type":"function","z":"5af1388b.ef9838","name":"get file","func":"msg.payload = msg.payload.file.slice(0, 15);\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":1760,"wires":[["bcab2a6b.397428","eded25a2.f69158"]]},{"id":"431276b.b264a88","type":"fs-file-lister","z":"5af1388b.ef9838","name":"","start":"/","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":820,"y":1860,"wires":[["12ab5c6a.32ea74"]]},{"id":"b46a0eca.dcd8e","type":"function","z":"5af1388b.ef9838","name":"set FL folder + pattern","func":"var start = global.get('images-trash');\nvar pattern = flow.get('restoreFile') + \".*\";\nmsg.payload = {start, pattern};\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":1860,"wires":[["431276b.b264a88"]]},{"id":"eded25a2.f69158","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"restoreFile","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":1800,"wires":[[]]},{"id":"2287a13a.7d44de","type":"link in","z":"5af1388b.ef9838","name":"refresh trash table","links":["fdf69990.610428","36ccb8a5.9a9e78"],"x":195,"y":1560,"wires":[["582ccf04.0771d"]]},{"id":"fa5a8487.7ff8c8","type":"function","z":"168e0b9d.9c19d4","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1460,"y":560,"wires":[[],["fdf69990.610428"]]},{"id":"fdf69990.610428","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["2287a13a.7d44de"],"x":1595,"y":560,"wires":[]},{"id":"12ab5c6a.32ea74","type":"function","z":"5af1388b.ef9838","name":"move to folders","func":"if (msg.payload.length > 0){\n    \n    var cmd = \"\";\n    var trash = global.get('images-trash');\n    var frameloop = global.get('images-frameloop');\n    var dashboard = global.get('images-dashboard');\n    var stackText = global.get('images-stackText');\n    var index;\n    \n    // FileLister-Array vorwärts durchlaufen\n    for (var i=0; i < msg.payload.length; i++) {\n        \n        index = msg.payload[i].lastIndexOf('jpg');\n        \n        // wenn dash...\n        if (msg.payload[i].includes(\"dash\")){\n            \n            // wenn 'Text an'...\n            if (global.get('textActive')){\n                cmd = cmd + \"mv \" + trash + msg.payload[i] + \" \" + dashboard + \"1000\" + msg.payload[i].slice(15) + \" && \";\n            \n            // wenn 'Text aus'...\n            } else {\n                // wenn 'Bild mit Text'...\n                if (msg.payload[i].includes(\"addText\")){\n                    cmd = cmd + \"mv \" + trash + msg.payload[i] + \" \" + stackText + \"1000\" + msg.payload[i].slice(15) + \" && \";\n                \n                // wenn 'Bild ohne Text'...\n                } else {\n                    cmd = cmd + \"mv \" + trash + msg.payload[i] + \" \" + dashboard + \"1000\" + msg.payload[i].slice(15) + \" && \";\n                }\n            }\n        // wenn frameloop...\n        } else {\n            \n            // wenn 'Text an'...\n            if (global.get('textActive')){\n                cmd = cmd + \"mv \" + trash + msg.payload[i] + \" \" + frameloop + \"1000\" + msg.payload[i].slice(15) + \" && \";\n            \n            // wenn 'Text aus'...\n            } else {\n                // wenn 'Bild mit Text'...\n                if (msg.payload[i].includes(\"addText\")){\n                    cmd = cmd + \"mv \" + trash + msg.payload[i] + \" \" + stackText + \"1000\" + msg.payload[i].slice(15) + \" && \";\n                \n                // wenn 'Bild ohne Text'...\n                } else {\n                    cmd = cmd + \"mv \" + trash + msg.payload[i] + \" \" + frameloop + \"1000\" + msg.payload[i].slice(15) + \" && \";\n                }                \n            }\n        }\n    }\n    // letztes '&&' hinten abschneiden\n    msg.payload = cmd.slice(0, cmd.lastIndexOf(\"&&\") - 1);    \n    \n    return msg;\n}","outputs":1,"noerr":0,"x":980,"y":1860,"wires":[["580a5f9e.8ef7e"]]},{"id":"580a5f9e.8ef7e","type":"exec","z":"5af1388b.ef9838","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1130,"y":1860,"wires":[[],[],["3cae60f9.3dbeb"]]},{"id":"3cae60f9.3dbeb","type":"function","z":"5af1388b.ef9838","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1280,"y":1860,"wires":[[],["36ccb8a5.9a9e78"]]},{"id":"36ccb8a5.9a9e78","type":"link out","z":"5af1388b.ef9838","name":"","links":["2287a13a.7d44de","f0b57d5c.3e53e"],"x":1395,"y":1860,"wires":[]},{"id":"97991dc9.5e06b","type":"function","z":"5af1388b.ef9838","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":470,"y":1860,"wires":[["b46a0eca.dcd8e"]]},{"id":"60cbc43d.dc4aac","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":330,"y":1860,"wires":[["97991dc9.5e06b"]]},{"id":"4e160b83.17c294","type":"function","z":"7c56a241.1e88dc","name":"control qgate + incr qgateBuffer","func":"var qgateBuffer = flow.get('qgateBufferImages') || 0;\n\nif (qgateBuffer === 0){\n    \n    var msgC = { payload: \"trigger\",\n                 topic: \"control\"\n    }\n    \n    qgateBuffer = qgateBuffer + 1;\n    flow.set('qgateBufferImages', qgateBuffer);\n    \n    return [[msg, msgC]];\n\n} else {\n    qgateBuffer = qgateBuffer + 1;\n    flow.set('qgateBufferImages', qgateBuffer);\n    \n    return msg;\n}\n\n\n\n","outputs":1,"noerr":0,"x":250,"y":740,"wires":[["7579cd34.da5794"]]},{"id":"91ab1713.418f88","type":"function","z":"7c56a241.1e88dc","name":"dekr qgateBuffer","func":"var qgateBuffer = flow.get('qgateBufferImages') || 0;\nqgateBuffer = qgateBuffer - 1;\nflow.set('qgateBufferImages', qgateBuffer);\n\nreturn msg;","outputs":1,"noerr":0,"x":1450,"y":1600,"wires":[[]]},{"id":"2efa3db1.b53b02","type":"function","z":"7c56a241.1e88dc","name":"control qgate + incr qgateBuffer","func":"var qgateBuffer = flow.get('qgateBufferVideos') || 0;\n\nif (qgateBuffer === 0){\n    \n    var msgC = { payload: \"trigger\",\n                 topic: \"control\"\n    }\n    \n    qgateBuffer = qgateBuffer + 1;\n    flow.set('qgateBufferVideos', qgateBuffer);\n    \n    return [[msg, msgC]];\n\n} else {\n    qgateBuffer = qgateBuffer + 1;\n    flow.set('qgateBufferVideos', qgateBuffer);\n    \n    return msg;\n}\n\n\n\n","outputs":1,"noerr":0,"x":870,"y":220,"wires":[["f2f6a38.3e3456"]]},{"id":"d53f797b.347198","type":"function","z":"7c56a241.1e88dc","name":"dekr qgateBuffer","func":"var qgateBuffer = flow.get('qgateBufferVideos') || 0;\nqgateBuffer = qgateBuffer - 1;\nflow.set('qgateBufferVideos', qgateBuffer);\n\nreturn msg;","outputs":1,"noerr":0,"x":1990,"y":680,"wires":[[]]},{"id":"f25cb36f.09898","type":"function","z":"7c56a241.1e88dc","name":"busy = true","func":"msg.payload = true;\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":100,"wires":[["245967b5.d39638"]]},{"id":"8a993ebd.32626","type":"link out","z":"7c56a241.1e88dc","name":"","links":["5e85c279.d9f46c"],"x":2135,"y":640,"wires":[]},{"id":"6b1fc388.85afac","type":"function","z":"7c56a241.1e88dc","name":"busy = true","func":"msg.payload = false;\nreturn msg;","outputs":1,"noerr":0,"x":2030,"y":640,"wires":[["8a993ebd.32626"]]},{"id":"498371e2.d576d","type":"comment","z":"e00097c0.ad3088","name":"Wifi","info":"","x":190,"y":1220,"wires":[]},{"id":"3f8e28b3.1245d8","type":"function","z":"7c56a241.1e88dc","name":"if finished successfull","func":"if (msg.topic === \"textTrueText\" || msg.topic === \"textFalseName\"){\n    return msg;\n}","outputs":1,"noerr":0,"x":1080,"y":1680,"wires":[["971afb17.247658","abd4ce3.6fb663","571e5a0d.8510f4"]]},{"id":"4e6cccb1.b71404","type":"function","z":"7c56a241.1e88dc","name":"clear folders","func":"msg.payload = \"sudo rm -rf \" + global.get('images-incoming') + \"* && rm -rf \" + global.get('images-preprocessing') + \"*\";\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1430,"y":1460,"wires":[["c83370c8.48945"]]}]