[{"id":"7c56a241.1e88dc","type":"tab","label":"Telegram","disabled":false,"info":""},{"id":"5af1388b.ef9838","type":"tab","label":"Kodi","disabled":false,"info":""},{"id":"e00097c0.ad3088","type":"tab","label":"System","disabled":false,"info":""},{"id":"dfa0e0a5.c8001","type":"tab","label":"Admin","disabled":false,"info":""},{"id":"ba1e4f7d.a87f3","type":"tab","label":"Dev","disabled":false,"info":""},{"id":"37ee46c5.d3e98a","type":"subflow","name":"Iterate","in":[{"x":220,"y":219,"wires":[{"id":"12b1ebc3.9fb144"}]}],"out":[{"x":454,"y":174,"wires":[{"id":"12b1ebc3.9fb144","port":0}]},{"x":455,"y":259,"wires":[{"id":"12b1ebc3.9fb144","port":1}]}]},{"id":"41df38c0.fb39c8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#4d9378","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#408080","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#4d9378","edited":true},"page-titlebar-backgroundColor":{"value":"#4d9378","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#76b79e","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#4d9378","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"teleframe","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":24,"sy":48,"gx":4,"gy":6,"cx":5,"cy":6,"px":0,"py":0}}},{"id":"cbf02e0a.18499","type":"ui_group","z":"","name":"Display Auflösung","tab":"be0e5438.eb46b8","order":6,"disp":true,"width":"12","collapse":true},{"id":"29050d2.fa3cef2","type":"ui_group","z":"","name":"Anwendungen","tab":"be0e5438.eb46b8","order":1,"disp":true,"width":"12","collapse":true},{"id":"5758df94.472ad","type":"ui_group","z":"","name":"Konsole","tab":"be0e5438.eb46b8","order":9,"disp":true,"width":"12","collapse":true},{"id":"be0e5438.eb46b8","type":"ui_tab","z":"","name":"Admin","icon":"build","order":5,"disabled":false,"hidden":false},{"id":"ca6d8830.a2dc48","type":"telegram bot","z":"","botname":"FrankaBilderrahmen","usernames":"","chatids":"","baseapiurl":"","updatemode":"polling","pollinterval":"300","usesocks":false,"sockshost":"","socksport":"6667","socksusername":"anonymous","sockspassword":"","bothost":"","localbotport":"8443","publicbotport":"8443","privatekey":"","certificate":"","useselfsignedcertificate":false,"sslterminated":false,"verboselogging":false},{"id":"bd2821f2.1ee81","type":"ui_tab","z":"","name":"Dev","icon":"dashboard","order":6,"disabled":true,"hidden":true},{"id":"838588b8.d90038","type":"ui_group","z":"","name":"fbi","tab":"bd2821f2.1ee81","order":4,"disp":true,"width":6,"collapse":false},{"id":"69cbfcd5.4478f4","type":"ui_group","z":"","name":"Power","tab":"e03e0a2.04b2ef8","order":2,"disp":true,"width":12,"collapse":false},{"id":"47e9fd6a.bb2c94","type":"ui_group","z":"","name":"omxplayer","tab":"bd2821f2.1ee81","order":6,"disp":true,"width":"6","collapse":false},{"id":"ac137d79.4eec5","type":"ui_group","z":"","name":"fim","tab":"bd2821f2.1ee81","order":5,"disp":true,"width":"6","collapse":false},{"id":"b6d48645.bc31d8","type":"ui_tab","z":"","name":"Telegram","icon":"fa-telegram","order":3,"disabled":false,"hidden":false},{"id":"f7a9f973.917ec8","type":"ui_group","z":"","name":"Navigate Images","tab":"bd2821f2.1ee81","order":2,"disp":true,"width":20,"collapse":false},{"id":"d353cd3f.37915","type":"ui_group","z":"","name":"Navigate Videos","tab":"bd2821f2.1ee81","order":3,"disp":true,"width":20,"collapse":false},{"id":"4537c880.c405c8","type":"ui_tab","z":"","name":"Bilder","icon":"fa-picture-o","order":1,"disabled":false,"hidden":false},{"id":"43f81666.762748","type":"ui_group","z":"","name":"Navigation","tab":"4537c880.c405c8","order":1,"disp":true,"width":12,"collapse":false},{"id":"79173158.54b5a","type":"ui_group","z":"","name":"Einstellungen Allgemein","tab":"4537c880.c405c8","order":4,"disp":true,"width":12,"collapse":true},{"id":"df1cecd4.4f555","type":"ui_group","z":"","name":"Textoverlay","tab":"4537c880.c405c8","order":6,"disp":true,"width":12,"collapse":true},{"id":"6ea23321.89550c","type":"ui_group","z":"","name":"Nutzerliste","tab":"b6d48645.bc31d8","order":1,"disp":true,"width":12,"collapse":false},{"id":"3e3a5d75.a251e2","type":"ui_group","z":"","name":"Neuer Nutzer","tab":"b6d48645.bc31d8","order":2,"disp":true,"width":12,"collapse":false},{"id":"a974a1dc.2318","type":"ui_group","z":"","name":"Nutzer löschen","tab":"b6d48645.bc31d8","order":3,"disp":true,"width":12,"collapse":false},{"id":"e03e0a2.04b2ef8","type":"ui_tab","z":"","name":"System","icon":"fa-cogs","order":4,"disabled":false,"hidden":false},{"id":"98f89e13.1f66c","type":"ui_group","z":"","name":"Bildschirm","tab":"e03e0a2.04b2ef8","order":1,"disp":true,"width":12,"collapse":false},{"id":"5024c415.87ce1c","type":"ui_tab","z":"","name":"Videos","icon":"fa-video-camera","order":2,"disabled":false,"hidden":false},{"id":"ed8a86bc.a4c3c8","type":"ui_group","z":"","name":"Log","tab":"be0e5438.eb46b8","order":8,"disp":true,"width":"12","collapse":true},{"id":"1229b955.63bec7","type":"ui_group","z":"","name":"Telegram-Ordner","tab":"be0e5438.eb46b8","order":5,"disp":true,"width":"12","collapse":true},{"id":"9ed2be8.851194","type":"ui_group","z":"","name":"Bot","tab":"bd2821f2.1ee81","order":1,"disp":true,"width":8,"collapse":false},{"id":"c51c9a95.f2cb68","type":"ui_group","z":"","name":"Navigation","tab":"5024c415.87ce1c","order":1,"disp":true,"width":12,"collapse":false},{"id":"d021848d.7c9d58","type":"ui_group","z":"","name":"Einstellungen","tab":"5024c415.87ce1c","order":2,"disp":true,"width":12,"collapse":true},{"id":"b242fa6a.175d28","type":"ui_group","z":"","name":"Reset","tab":"be0e5438.eb46b8","order":7,"disp":true,"width":"12","collapse":true},{"id":"e4f17352.69409","type":"ui_group","z":"","name":"FreeDNS","tab":"e03e0a2.04b2ef8","order":4,"disp":true,"width":"12","collapse":true},{"id":"c83c4c5e.03ddf","type":"ui_group","z":"","name":"Wenn ein neues Bild ankommt...","tab":"4537c880.c405c8","order":5,"disp":true,"width":"12","collapse":true},{"id":"af0e753d.902d48","type":"ui_spacer","name":"spacer","group":"3e3a5d75.a251e2","order":2,"width":1,"height":1},{"id":"31e0ed7e.859452","type":"ui_group","z":"","name":"Papierkorb","tab":"4537c880.c405c8","order":3,"disp":true,"width":"12","collapse":true},{"id":"efb43289.68929","type":"ui_group","z":"","name":"Wifi","tab":"e03e0a2.04b2ef8","order":3,"disp":true,"width":"12","collapse":true},{"id":"fa734fb9.fe5ec","type":"ui_group","z":"","name":"Wifi","tab":"bd2821f2.1ee81","order":7,"disp":true,"width":12,"collapse":false},{"id":"286f705.ec78c9","type":"ui_spacer","name":"spacer","group":"f7a9f973.917ec8","order":2,"width":7,"height":1},{"id":"fa6acc53.1a923","type":"ui_spacer","name":"spacer","group":"f7a9f973.917ec8","order":5,"width":7,"height":1},{"id":"ea5d5825.77e118","type":"ui_spacer","name":"spacer","group":"d353cd3f.37915","order":2,"width":7,"height":1},{"id":"8180c323.ed3e2","type":"ui_spacer","name":"spacer","group":"d353cd3f.37915","order":5,"width":7,"height":1},{"id":"dfc04cd.3557fb","type":"ui_spacer","name":"spacer","group":"fa734fb9.fe5ec","order":2,"width":6,"height":1},{"id":"d3ad00bf.cf55d","type":"ui_spacer","name":"spacer","group":"fa734fb9.fe5ec","order":4,"width":6,"height":1},{"id":"2104fbff.8a1c24","type":"ui_spacer","name":"spacer","group":"fa734fb9.fe5ec","order":5,"width":6,"height":1},{"id":"cd70bfd.f03cb4","type":"ui_spacer","name":"spacer","group":"fa734fb9.fe5ec","order":6,"width":6,"height":1},{"id":"e8b1d590.eaade8","type":"ui_group","z":"","name":"Kodi","tab":"be0e5438.eb46b8","order":2,"disp":true,"width":"12","collapse":true},{"id":"6716ccf6.78cf14","type":"ui_group","z":"","name":"Image Browser","tab":"4537c880.c405c8","order":2,"disp":true,"width":12,"collapse":true},{"id":"53ced2ec.a1637c","type":"ui_spacer","name":"spacer","group":"df1cecd4.4f555","order":12,"width":2,"height":1},{"id":"86d162c4.90e27","type":"ui_spacer","name":"spacer","group":"df1cecd4.4f555","order":14,"width":2,"height":1},{"id":"202cb3cc.ad24bc","type":"ui_group","z":"","name":"Node-Red","tab":"be0e5438.eb46b8","order":4,"disp":true,"width":"12","collapse":true},{"id":"b2bcaeaa.d8f43","type":"websocket-client","z":"","path":"ws://127.0.0.1:9090/jsonrpc","tls":"","wholemsg":"false"},{"id":"24b47441.d3db5c","type":"ui_group","z":"","name":"Kodi Screen","tab":"be0e5438.eb46b8","order":3,"disp":true,"width":"12","collapse":true},{"id":"348c6236.1ef79e","type":"ui_spacer","name":"spacer","group":"29050d2.fa3cef2","order":6,"width":6,"height":1},{"id":"e6c8009a.a9067","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":2,"width":2,"height":1},{"id":"12e40382.2d2c5c","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":4,"width":2,"height":1},{"id":"e6191424.84c138","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":5,"width":1,"height":1},{"id":"88fc92f8.7b01a","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":7,"width":1,"height":1},{"id":"d6692c7.f8dffd","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":8,"width":1,"height":1},{"id":"d630b0a7.7fb3f","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":10,"width":1,"height":1},{"id":"7f81374a.2f7028","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":11,"width":1,"height":1},{"id":"734f55e.0317eac","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":13,"width":1,"height":1},{"id":"99adedc2.96792","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":14,"width":1,"height":1},{"id":"fbb562ca.5cb51","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":16,"width":1,"height":1},{"id":"51933a67.c57574","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":17,"width":2,"height":1},{"id":"2dd93110.d0a00e","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":19,"width":2,"height":1},{"id":"634bfa3e.a052f4","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":21,"width":2,"height":1},{"id":"38d1f8ed.4d5718","type":"ui_spacer","name":"spacer","group":"ed8a86bc.a4c3c8","order":24,"width":2,"height":1},{"id":"40594ce8.388634","type":"comment","z":"dfa0e0a5.c8001","name":"Kodi","info":"","x":110,"y":100,"wires":[]},{"id":"ee81297d.751808","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"kodi","tooltip":"","group":"29050d2.fa3cef2","order":1,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":170,"y":260,"wires":[["9030aab4.b3cae8"]]},{"id":"448d0e97.8e5ff","type":"function","z":"dfa0e0a5.c8001","name":"if true/false","func":"if (msg.payload) {\n    flow.set('kodiFlag', true);\n    return [ msg, null ];\n} else {\n    flow.set('kodiFlag', false);\n    return [null, msg ];\n}","outputs":2,"noerr":0,"x":450,"y":260,"wires":[["2b05e33c.64881c","385b1490.00d44c"],["fd5f912b.da1d7","429214af.3becec","1a49155a.57471b"]]},{"id":"a4de161d.ffeba8","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":2190,"y":180,"wires":[[],[],[]]},{"id":"8b9a1ad8.074a98","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":2190,"y":120,"wires":[[],[],[]]},{"id":"6cd3950b.9e00ac","type":"comment","z":"dfa0e0a5.c8001","name":"Konsole","info":"","x":120,"y":3020,"wires":[]},{"id":"3dca4bde.f1fce4","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":420,"y":3080,"wires":[["8e9eb826.48a4c8"],[],[]]},{"id":"cc6ee33b.21bbf","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"","tooltip":"","group":"5758df94.472ad","order":1,"width":12,"height":1,"passthru":true,"mode":"text","delay":"0","topic":"","x":200,"y":3080,"wires":[["3dca4bde.f1fce4"]]},{"id":"d6b46b2e.94f648","type":"telegram receiver","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","saveDataDir":"","x":120,"y":200,"wires":[["1874c46c.dc959c","fdf976eb.414d08","695fd683.0af3d8","e0dbe779.1681b8"],["1874c46c.dc959c","fdf976eb.414d08","695fd683.0af3d8","e0dbe779.1681b8"]]},{"id":"6fdc4e8e.2370d","type":"comment","z":"dfa0e0a5.c8001","name":"lightdm","info":"","x":110,"y":540,"wires":[]},{"id":"29fdcca4.a8b3a4","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"lightdm","tooltip":"","group":"29050d2.fa3cef2","order":2,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":280,"y":580,"wires":[["69993e6f.1cf93"]]},{"id":"3d7a77a3.b7a3c8","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":550,"y":580,"wires":[["b396fb4e.6efd08"],["b843bc6d.a6abf"]]},{"id":"b396fb4e.6efd08","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start lightdm","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":800,"y":560,"wires":[[],[],[]]},{"id":"b843bc6d.a6abf","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop lightdm","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":800,"y":620,"wires":[[],[],[]]},{"id":"883c1b70.676b08","type":"function","z":"5af1388b.ef9838","name":"Player.Open (directory)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.Open\",\n            \"id\": 1,\n            \"args\":{\n                \"item\":{\n                    \"directory\":msg.payload   \n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":1600,"y":680,"wires":[["b2efa2c8.3efc"]]},{"id":"ffbdb28d.7c8a6","type":"function","z":"5af1388b.ef9838","name":"Player.PlayPause (Pause)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.PlayPause\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":2,\n                \"play\":false\n            }\n        }\n};","outputs":1,"noerr":0,"x":1590,"y":820,"wires":[["b2efa2c8.3efc"]]},{"id":"3e356f2e.d3986","type":"function","z":"5af1388b.ef9838","name":"Player.Open (file)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.Open\",\n            \"id\": 1,\n            \"params\":{\n                \"item\":{\n                    \"file\":msg.payload   \n                }\n                \n            }\n        }\n};","outputs":1,"noerr":0,"x":1610,"y":640,"wires":[["b2efa2c8.3efc"]]},{"id":"6eb6fb45.cfdac4","type":"function","z":"5af1388b.ef9838","name":"Player.Stop","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.Stop\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":2\n            }\n        }\n};","outputs":1,"noerr":0,"x":1630,"y":860,"wires":[["b2efa2c8.3efc","e0ee1701.429a18"]]},{"id":"6559cc36.1b5184","type":"file in","z":"5af1388b.ef9838","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":370,"y":1300,"wires":[["5cf77f2.8adb28"]]},{"id":"985e9032.56967","type":"comment","z":"5af1388b.ef9838","name":"Dashboard Preview","info":"","x":210,"y":1240,"wires":[]},{"id":"5cf77f2.8adb28","type":"base64","z":"5af1388b.ef9838","name":"","action":"str","property":"payload","x":500,"y":1300,"wires":[["b40e2a53.8af888"]]},{"id":"b40e2a53.8af888","type":"ui_template","z":"5af1388b.ef9838","group":"43f81666.762748","name":"","order":2,"width":12,"height":5,"format":"<img width=\"100%\" height=\"100%\" alt=\"Image not loaded\" src=\"data:image/jpg;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":640,"y":1300,"wires":[[]]},{"id":"43f88de5.2f1884","type":"comment","z":"5af1388b.ef9838","name":"Ausgabe","info":"","x":1400,"y":40,"wires":[]},{"id":"74815107.7a996","type":"comment","z":"5af1388b.ef9838","name":"Navigation","info":"","x":180,"y":680,"wires":[]},{"id":"4b692df3.f4f474","type":"function","z":"5af1388b.ef9838","name":"get file","func":"try{\n    var filename = msg.payload.params.data.item.file.slice((msg.payload.params.data.item.file.lastIndexOf(\"/\")) + 1);\n    var status = msg.payload.method;\n    \n    var payload = filename;\n    \n    if(status === \"Player.OnPlay\"){\n\n        filename = global.get('images-loop') + filename.slice(0, filename.length-3) + \"dash.jpg\";\n\n        msg = { filename, payload };\n        return msg;\n    }\n} catch(e){\n    \n}\n","outputs":1,"noerr":0,"x":190,"y":1300,"wires":[["6559cc36.1b5184","3e87129b.2887ee"]]},{"id":"6e18904b.3731","type":"function","z":"5af1388b.ef9838","name":"Playlist.Clear/.Add","func":"var playlistPos = msg.playlistPos -1;   // msg.playlistPos = current pos + 1\n\nif (flow.get('arrayImagesLoopId') === msg.loopId){\n    msgAdd = {\n        payload:{\n                \"jsonrpc\": \"2.0\",\n                \"method\":\"Playlist.Add\",\n                \"id\": 1,\n                \"params\":{\n                    \"playlistid\":2,\n                    \"item\":{\n                        \"file\":msg.payload\n                    }\n                }\n            }\n    };\n    \n    var msgClear = {\n        payload:{\n                \"jsonrpc\": \"2.0\",\n                \"id\": 1,\n                \"method\":\"Playlist.Clear\",\n                \"params\":{\n                    \"playlistid\":2\n                }\n            }\n    };\n\n    if (playlistPos === 0){\n        return [[msgClear, msgAdd]];\n \n    } else {\n        return msgAdd;\n    }\n}\n\n","outputs":1,"noerr":0,"x":2550,"y":280,"wires":[["7c9f6e41.d18b","b781e63d.ef97d8"]]},{"id":"f6f2588b.8879f8","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo next","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.GoTo\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":2,\n                \"to\": \"next\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1610,"y":960,"wires":[["b2efa2c8.3efc"]]},{"id":"93b3653f.741c78","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo previous","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.GoTo\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":2,\n                \"to\": \"previous\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1600,"y":920,"wires":[["b2efa2c8.3efc"]]},{"id":"5d370aff.d14a34","type":"ui_button","z":"5af1388b.ef9838","name":"pause","group":"43f81666.762748","order":4,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-pause","payload":"pause","payloadType":"str","topic":"","x":390,"y":720,"wires":[["c613e3ff.4f41e","39aabebe.9aab22","868cd190.6585a"]]},{"id":"35814bc8.a20154","type":"ui_button","z":"5af1388b.ef9838","name":"stop","group":"e8b1d590.eaade8","order":1,"width":7,"height":1,"passthru":false,"label":"Stop Slideshow","tooltip":"","color":"","bgcolor":"","icon":"fa-stop","payload":"stop","payloadType":"str","topic":"","x":390,"y":780,"wires":[["c613e3ff.4f41e","39aabebe.9aab22","21c3e5f9.6f75da"]]},{"id":"29ee9c53.3a5b84","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"43f81666.762748","order":5,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":690,"y":720,"wires":[["62faac09.68dee4"]]},{"id":"e94831cb.248ea","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"43f81666.762748","order":6,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":690,"y":760,"wires":[["a7a8c7d1.937c78"]]},{"id":"aa8f2459.3432d8","type":"function","z":"5af1388b.ef9838","name":"Playlist.Clear","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"id\": 1,\n            \"method\":\"Playlist.Clear\",\n            \"params\":{\n                \"playlistid\":2\n            }\n        }\n};","outputs":1,"noerr":0,"x":1950,"y":400,"wires":[["b2efa2c8.3efc"]]},{"id":"24dd70b4.86387","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1950,"y":440,"wires":[["aa8f2459.3432d8"]]},{"id":"99bf7b1a.41e4f8","type":"function","z":"5af1388b.ef9838","name":"Settings.SetSettingValue: slideshow.staytime","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Settings.SetSettingValue\",\n            \"id\": 1,\n            \"params\":{\n                \"setting\":\"slideshow.staytime\",\n                \"value\":msg.payload\n            }\n        }\n};","outputs":1,"noerr":0,"x":1530,"y":1640,"wires":[["b2efa2c8.3efc"]]},{"id":"acb583ed.1f6e1","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Anzeigedauer (Sek.)","tooltip":"","group":"79173158.54b5a","order":1,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":"3","max":"60","step":"3","x":560,"y":2820,"wires":[["ab1b6e6.0cf699","f9032f92.986d8"]]},{"id":"f065e78b.0b06e8","type":"ui_button","z":"5af1388b.ef9838","name":"play","group":"43f81666.762748","order":3,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-play","payload":"play","payloadType":"str","topic":"0","x":390,"y":840,"wires":[["c613e3ff.4f41e","39aabebe.9aab22","6df57dbf.8b24e4"]]},{"id":"c613e3ff.4f41e","type":"function","z":"5af1388b.ef9838","name":"set color","func":"var msgPlay = {payload: \"#eb4034\"}; // rot\nvar msgPause = {payload: \"#ebe534\"}; // gelb\n\nif (msg.payload === \"play\" || msg.payload === \"kodiPlay\"){\n    msgPause.payload = \"\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', true);\n    return [msgPause, msgPlay];\n\n} else if (msg.payload === \"pause\"){\n    if ((context.get('colorswitchPause') || false) && context.set('colorswitchPlay')){\n        context.set('colorswitchPause', false);\n    } else {\n        msgPause.payload = \"\";\n        context.set('colorswitchPause', true);\n    }\n    return [msgPause, msgPlay];\n\n} else if (msg.payload === \"kodiPause\"){\n    context.set('colorswitchPause', false);\n    return [msgPause, msgPlay];\n\n} else if (msg.payload === \"stop\" || msg.payload === \"kodiStop\"){\n    msg.payload = \"\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', false);\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":200,"y":780,"wires":[["5d370aff.d14a34"],["f065e78b.0b06e8"]]},{"id":"c6be6051.f6e5f","type":"function","z":"5af1388b.ef9838","name":"Player.Open arrayImages","func":"msg.payload = global.get('images-loop');\nreturn msg;","outputs":1,"noerr":0,"x":1590,"y":160,"wires":[["d19786c6.643a08","d86fdfef.85095"]]},{"id":"6ca0a6f5.8b6858","type":"ui_button","z":"5af1388b.ef9838","name":"stick","group":"43f81666.762748","order":7,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-paperclip","payload":"stick","payloadType":"str","topic":"","x":410,"y":1140,"wires":[["833ed45c.3e3b58"]]},{"id":"44c72ea3.e7ca1","type":"ui_button","z":"5af1388b.ef9838","name":"delete","group":"43f81666.762748","order":8,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"Wirklich löschen?","payloadType":"str","topic":"","x":150,"y":980,"wires":[["6eb4a9aa.8de568"]]},{"id":"3c457ef9.347f12","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Max. Anzahl Schleife","tooltip":"","group":"79173158.54b5a","order":2,"width":10,"height":1,"passthru":true,"outs":"end","topic":"","min":"1","max":"999","step":1,"x":560,"y":2940,"wires":[["2de84ae9.85c9d6"]]},{"id":"a62c991d.72a4c8","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1140,"wires":[["47a50bf1.1a7ff4"],["47a50bf1.1a7ff4"],[]]},{"id":"a2cd0a5.02febf8","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1160,"wires":[["b5b89633.bb5a78"]]},{"id":"b5b89633.bb5a78","type":"function","z":"ba1e4f7d.a87f3","name":"create fbi cmd","func":"var duration = \"4\";\nvar folder = \"/home/pi/media/telegram/\";\n\n//msg.payload = \"sudo fbi -d /dev/fb0 -T 1 -a -t \" + duration + \" --noverbose --readahead --blend 3 \" + folder + \"*.jpg\";\nmsg.payload = \"sudo fbi -d /dev/fb0 -T 1 -a -t \" + duration + \" --readahead --blend 3 \" + folder + \"*.jpg\";\n\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1140,"wires":[["a62c991d.72a4c8"]]},{"id":"47a50bf1.1a7ff4","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1140,"wires":[]},{"id":"2652e9a9.77c7f6","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"838588b8.d90038","order":1,"width":0,"height":0,"passthru":false,"label":"start slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1120,"wires":[["b5b89633.bb5a78"]]},{"id":"471bacc.085f054","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1320,"wires":[["587a4cf5.59a2b4"]]},{"id":"587a4cf5.59a2b4","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall fbi\";\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1300,"wires":[["c22a84d4.60b528"]]},{"id":"7fe7bc48.58e114","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"838588b8.d90038","order":3,"width":0,"height":0,"passthru":false,"label":"stop slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1280,"wires":[["587a4cf5.59a2b4"]]},{"id":"6884e69e.c98708","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"838588b8.d90038","order":2,"width":0,"height":0,"passthru":false,"label":"restart slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1220,"wires":[["587a4cf5.59a2b4","403bb0af.7188"]]},{"id":"403bb0af.7188","type":"delay","z":"ba1e4f7d.a87f3","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1220,"wires":[["b5b89633.bb5a78"]]},{"id":"e8000f81.969be","type":"comment","z":"ba1e4f7d.a87f3","name":"fbi","info":"","x":100,"y":1060,"wires":[]},{"id":"c22a84d4.60b528","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1300,"wires":[["5d3ab0ee.c3228"],["5d3ab0ee.c3228"],[]]},{"id":"5d3ab0ee.c3228","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1300,"wires":[]},{"id":"4c25c5a7.1f563c","type":"function","z":"ba1e4f7d.a87f3","name":"create fbi cmd","func":"var file = msg.filename;\n//var file = \"/home/pi/media/telegram/*.jpg\";\n\n//msg.payload = \"sudo fbi -d /dev/fb0 -T 1 -a --noverbose --readahead --blend 3 \" + file;\nmsg.payload = \"sudo fbi -T 1 -a --noverbose --blend 3 \" + file;\n\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":380,"wires":[["c0a34b87.0e1ef8"]]},{"id":"704160c3.4bf8c","type":"comment","z":"ba1e4f7d.a87f3","name":"Navigation","info":"","x":120,"y":100,"wires":[]},{"id":"4cf866e1.ecc2e8","type":"ui_template","z":"ba1e4f7d.a87f3","group":"f7a9f973.917ec8","name":"","order":1,"width":20,"height":8,"format":"\n \n <img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1200,"y":220,"wires":[[]]},{"id":"bcb54f00.5bf98","type":"base64","z":"ba1e4f7d.a87f3","name":"","action":"str","property":"payload","x":1060,"y":220,"wires":[["4cf866e1.ecc2e8"]]},{"id":"834ec8e6.83e348","type":"file in","z":"ba1e4f7d.a87f3","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":810,"y":220,"wires":[["bcb54f00.5bf98"]]},{"id":"fd5bc185.4357b","type":"ui_button","z":"ba1e4f7d.a87f3","name":"left","group":"f7a9f973.917ec8","order":3,"width":3,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":150,"y":300,"wires":[["8c2b87fa.9e2b08","26a4ce3.ddf7532"]]},{"id":"c43edb74.939b68","type":"ui_button","z":"ba1e4f7d.a87f3","name":"right","group":"f7a9f973.917ec8","order":4,"width":3,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":150,"y":340,"wires":[["8c2b87fa.9e2b08","26a4ce3.ddf7532"]]},{"id":"aa5ff526.cb86a8","type":"function","z":"ba1e4f7d.a87f3","name":"navigate files","func":"var fileindex = global.get('fileindex-images') || 0;\nvar filelist = global.get('filelist-images');\nvar filelistlength = filelist.length;\n\nif (msg.payload === \"r\"){\n    if (fileindex === (filelistlength - 1)){\n        fileindex = 0;\n    } else {\n        fileindex = fileindex + 1;\n    }\n    \n} else {\n    if (fileindex === 0){\n        fileindex = filelistlength - 1;\n    } else {\n        fileindex = fileindex - 1;\n    }\n}\n\nglobal.set('fileindex-images', fileindex);\n\nvar filename = filelist[fileindex];\n\nmsg.payload = fileindex;\nmsg = { filename };\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":320,"wires":[["834ec8e6.83e348","a42fab94.f93608","4c25c5a7.1f563c","80c39c43.26de2"]]},{"id":"a42fab94.f93608","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":490,"y":400,"wires":[]},{"id":"db0c45ab.1d2bc8","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"l","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":400,"wires":[["26a4ce3.ddf7532"]]},{"id":"aa32d1aa.77cd9","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"r","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":440,"wires":[["26a4ce3.ddf7532"]]},{"id":"8c2b87fa.9e2b08","type":"fs-file-lister","z":"ba1e4f7d.a87f3","name":"","start":"/home/pi/media/telegram","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":320,"y":240,"wires":[["ac49c114.f4bf1"]]},{"id":"ac49c114.f4bf1","type":"change","z":"ba1e4f7d.a87f3","name":"","rules":[{"t":"set","p":"filelist-images","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":240,"wires":[[]]},{"id":"4f2e3cdf.49a614","type":"inject","z":"ba1e4f7d.a87f3","name":"start","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":150,"y":240,"wires":[["8c2b87fa.9e2b08"]]},{"id":"7d8d3f3e.57d96","type":"comment","z":"ba1e4f7d.a87f3","name":"Ausgabe","info":"","x":780,"y":100,"wires":[]},{"id":"9d3f0f5f.9aecd","type":"comment","z":"ba1e4f7d.a87f3","name":"Dashboard","info":"","x":820,"y":160,"wires":[]},{"id":"d9edc072.e5131","type":"comment","z":"ba1e4f7d.a87f3","name":"fbi","info":"","x":810,"y":320,"wires":[]},{"id":"c0a34b87.0e1ef8","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1000,"y":380,"wires":[["13b70a3f.181016"],["13b70a3f.181016"],[]]},{"id":"13b70a3f.181016","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":380,"wires":[]},{"id":"f1f94645.e8e398","type":"comment","z":"ba1e4f7d.a87f3","name":"Images","info":"","x":130,"y":160,"wires":[]},{"id":"d77b006a.92ff1","type":"ui_button","z":"ba1e4f7d.a87f3","name":"left","group":"d353cd3f.37915","order":3,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":150,"y":820,"wires":[["cf3725bb.2048f8","970c2d9.a21f3d"]]},{"id":"598130fe.ad4a1","type":"ui_button","z":"ba1e4f7d.a87f3","name":"right","group":"d353cd3f.37915","order":4,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":150,"y":860,"wires":[["cf3725bb.2048f8","970c2d9.a21f3d"]]},{"id":"cfbd3682.bec5b8","type":"function","z":"ba1e4f7d.a87f3","name":"navigate files","func":"var fileindex = global.get('fileindex-videos') || 0;\nvar filelist = global.get('filelist-videos');\nvar filelistlength = filelist.length;\n\nif (msg.payload === \"r\"){\n    if (fileindex === (filelistlength - 1)){\n        fileindex = 0;\n    } else {\n        fileindex = fileindex + 1;\n    }\n    \n} else {\n    if (fileindex === 0){\n        fileindex = filelistlength - 1;\n    } else {\n        fileindex = fileindex - 1;\n    }\n}\n\nglobal.set('fileindex-videos', fileindex);\n\nvar filename = filelist[fileindex];\n\nmsg.payload = fileindex;\nmsg = { filename };\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":840,"wires":[["12fc1b0a.6db095","50190e2b.45b1e","7a6a8761.b8efd8"]]},{"id":"12fc1b0a.6db095","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":920,"wires":[]},{"id":"8afa9caf.ecc46","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"l","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":920,"wires":[["970c2d9.a21f3d"]]},{"id":"98ba7001.e0bc9","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"r","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":960,"wires":[["970c2d9.a21f3d"]]},{"id":"cf3725bb.2048f8","type":"fs-file-lister","z":"ba1e4f7d.a87f3","name":"","start":"/home/pi/media/telegram","pattern":"*.mp4","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":320,"y":760,"wires":[["3da6b2d5.19f27e"]]},{"id":"3da6b2d5.19f27e","type":"change","z":"ba1e4f7d.a87f3","name":"","rules":[{"t":"set","p":"filelist-videos","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":760,"wires":[[]]},{"id":"ab94beb2.5f0c7","type":"inject","z":"ba1e4f7d.a87f3","name":"start","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":760,"wires":[["cf3725bb.2048f8"]]},{"id":"646759e5.45d608","type":"comment","z":"ba1e4f7d.a87f3","name":"Videos","info":"","x":130,"y":680,"wires":[]},{"id":"d0a9483e.e4e7c8","type":"comment","z":"ba1e4f7d.a87f3","name":"omxplayer","info":"","x":820,"y":680,"wires":[]},{"id":"cd54d6f3.67e618","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1060,"y":820,"wires":[["88071f2c.6d173"],["88071f2c.6d173"],[]]},{"id":"88071f2c.6d173","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1250,"y":820,"wires":[]},{"id":"50190e2b.45b1e","type":"function","z":"ba1e4f7d.a87f3","name":"create omxplayer cmd","func":"var file = msg.filename;\n\nmsg.payload = \"sudo omxplayer -b \" + file;\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":820,"wires":[["cd54d6f3.67e618"]]},{"id":"d5bcf01b.6f5d1","type":"ui_template","z":"ba1e4f7d.a87f3","group":"d353cd3f.37915","name":"","order":1,"width":20,"height":8,"format":"\n \n <img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1200,"y":740,"wires":[[]]},{"id":"1f4fbf36.b4b801","type":"base64","z":"ba1e4f7d.a87f3","name":"","action":"str","property":"payload","x":1060,"y":740,"wires":[["d5bcf01b.6f5d1"]]},{"id":"7a6a8761.b8efd8","type":"file in","z":"ba1e4f7d.a87f3","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":810,"y":740,"wires":[["1f4fbf36.b4b801"]]},{"id":"970c2d9.a21f3d","type":"function","z":"ba1e4f7d.a87f3","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":840,"wires":[["cfbd3682.bec5b8"]]},{"id":"26a4ce3.ddf7532","type":"function","z":"ba1e4f7d.a87f3","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":320,"wires":[["aa5ff526.cb86a8"]]},{"id":"864d171b.28ec38","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1040,"y":540,"wires":[["4075bc9.bc2b144"],["4075bc9.bc2b144"],[]]},{"id":"662a25c4.b44dec","type":"function","z":"ba1e4f7d.a87f3","name":"create fim cmd","func":"//var file = msg.filename;\nvar file = \"/home/pi/media/telegram/*.jpg\";\n\nmsg.payload = \"sudo fim -a \" + file;\n\nreturn msg;","outputs":1,"noerr":0,"x":842,"y":540,"wires":[["864d171b.28ec38"]]},{"id":"4075bc9.bc2b144","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1230,"y":540,"wires":[]},{"id":"a597478f.ce79d8","type":"comment","z":"ba1e4f7d.a87f3","name":"fim","info":"","x":810,"y":480,"wires":[]},{"id":"80c39c43.26de2","type":"delay","z":"ba1e4f7d.a87f3","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":640,"y":460,"wires":[["8a6ff35e.ec044"]]},{"id":"8a6ff35e.ec044","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall fbi\";\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":420,"wires":[["c0a34b87.0e1ef8"]]},{"id":"8c730af9.2a5788","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1500,"wires":[["c398064d.3e5718"],["c398064d.3e5718"],[]]},{"id":"2d5857b7.ac2cc8","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1520,"wires":[["c840d4d3.0f7128"]]},{"id":"c840d4d3.0f7128","type":"function","z":"ba1e4f7d.a87f3","name":"create fim cmd","func":"var duration = \"4\";\nvar folder = \"/home/pi/media/telegram/\";\n\n\nmsg.payload = \"sudo fim -a --slideshow \" + duration + \" \" + folder + \"*.jpg\";\n\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1500,"wires":[["8c730af9.2a5788"]]},{"id":"c398064d.3e5718","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1500,"wires":[]},{"id":"ef5d29c9.1c9fe8","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"ac137d79.4eec5","order":1,"width":0,"height":0,"passthru":false,"label":"start slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1480,"wires":[["c840d4d3.0f7128"]]},{"id":"785822a9.c1debc","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1680,"wires":[["ac375e76.b805b"]]},{"id":"ac375e76.b805b","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall fim\";\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1660,"wires":[["74e393ec.efd44c"]]},{"id":"d6be8805.cc7ef8","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"ac137d79.4eec5","order":3,"width":0,"height":0,"passthru":false,"label":"stop slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1640,"wires":[["ac375e76.b805b"]]},{"id":"e753aea.eb2e95","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"ac137d79.4eec5","order":2,"width":0,"height":0,"passthru":false,"label":"restart slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1580,"wires":[["ac375e76.b805b","e0dd1470.4cb8d8"]]},{"id":"e0dd1470.4cb8d8","type":"delay","z":"ba1e4f7d.a87f3","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1580,"wires":[["c840d4d3.0f7128"]]},{"id":"620c9d19.e77d34","type":"comment","z":"ba1e4f7d.a87f3","name":"fim","info":"","x":100,"y":1420,"wires":[]},{"id":"74e393ec.efd44c","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1660,"wires":[["99f08f1e.a5247"],["99f08f1e.a5247"],[]]},{"id":"99f08f1e.a5247","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1660,"wires":[]},{"id":"23fd144.87a42ec","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":1880,"wires":[["16fa0e77.2ed662"],["16fa0e77.2ed662"],[]]},{"id":"4be812e8.6c5c0c","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1900,"wires":[["6630e260.67d91c"]]},{"id":"6630e260.67d91c","type":"function","z":"ba1e4f7d.a87f3","name":"create omxplayer cmd","func":"var folder = \"/home/pi/media/telegram/\";\n\nmsg.payload = \"sudo omxplayer -b \" + folder + \"*.mp4\";\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1880,"wires":[["23fd144.87a42ec"]]},{"id":"16fa0e77.2ed662","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":1880,"wires":[]},{"id":"473eaea.6e0955","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"47e9fd6a.bb2c94","order":1,"width":0,"height":0,"passthru":false,"label":"start videoshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1860,"wires":[["6630e260.67d91c"]]},{"id":"4737b0ac.35833","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":2000,"wires":[["6610924b.43c2dc"]]},{"id":"6610924b.43c2dc","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall omxplayer.bin\";\nreturn msg;","outputs":1,"noerr":0,"x":392,"y":1980,"wires":[["3e12acf.d557d54"]]},{"id":"2c1d8e1b.495b52","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"47e9fd6a.bb2c94","order":2,"width":0,"height":0,"passthru":false,"label":"stop videoshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1960,"wires":[["6610924b.43c2dc"]]},{"id":"48900a05.f1d6a4","type":"comment","z":"ba1e4f7d.a87f3","name":"omxplayer ","info":"","x":120,"y":1800,"wires":[]},{"id":"3e12acf.d557d54","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":1980,"wires":[["c3efd311.79bcf"],["c3efd311.79bcf"],[]]},{"id":"c3efd311.79bcf","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":1980,"wires":[]},{"id":"5f31aa92.80caf4","type":"comment","z":"5af1388b.ef9838","name":"delete","info":"","x":170,"y":920,"wires":[]},{"id":"6eb4a9aa.8de568","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":290,"y":980,"wires":[["8789cd73.c6c3c"]]},{"id":"ab1b6e6.0cf699","type":"function","z":"5af1388b.ef9838","name":"convert","func":"msg.payload = Math.round(msg.payload/3);\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":2780,"wires":[["5f47212b.83b2a"]]},{"id":"f7056c7a.85c5c","type":"function","z":"7c56a241.1e88dc","name":"add user","func":"if(flow.get('newuserallow')){\n    \n    msg.payload = msg.payload.chatId;\n    \n    return msg;\n    \n}\n","outputs":1,"noerr":0,"x":440,"y":3440,"wires":[["9f2c06f5.e84578","762299e2.b08378","20f4a5de.5065ba"]]},{"id":"9f2c06f5.e84578","type":"ui_text","z":"7c56a241.1e88dc","group":"3e3a5d75.a251e2","order":3,"width":12,"height":1,"name":"","label":"Chat ID:","format":"{{msg.payload}}","layout":"row-spread","x":780,"y":3480,"wires":[]},{"id":"a13b8087.ca44b","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Name","tooltip":"","group":"3e3a5d75.a251e2","order":4,"width":9,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":930,"y":3480,"wires":[["e7014a1b.9c3398"]]},{"id":"e6d51937.2ef0b8","type":"comment","z":"7c56a241.1e88dc","name":"Telegram: Nachricht empfangen","info":"","x":170,"y":100,"wires":[]},{"id":"757faf3f.cc2c2","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"3e3a5d75.a251e2","order":5,"width":3,"height":1,"passthru":false,"label":"add","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":490,"y":3360,"wires":[["804ae741.99e948"]]},{"id":"451b6501.9ca6fc","type":"change","z":"7c56a241.1e88dc","name":"set newuserallow","rules":[{"t":"set","p":"newuserallow","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":3600,"wires":[[]]},{"id":"476d2ce0.c3db64","type":"ui_switch","z":"7c56a241.1e88dc","name":"","label":"Hinzufügen erlauben?","tooltip":"","group":"3e3a5d75.a251e2","order":1,"width":11,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":420,"y":3600,"wires":[["451b6501.9ca6fc","a90e0331.97fe"]]},{"id":"e7014a1b.9c3398","type":"change","z":"7c56a241.1e88dc","name":"set newusername","rules":[{"t":"set","p":"newusername","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1090,"y":3480,"wires":[[]]},{"id":"804ae741.99e948","type":"function","z":"7c56a241.1e88dc","name":"add user to userlist","func":"// Variablen abspeichern\n\nvar userlist = global.get('userlist');\nvar name = flow.get('newusername');\nvar chatid = flow.get('newuserchatid') || \"\";\nvar user = { name,\n            chatid\n        }\n\n// Überprüfen ob Chat-ID bereits in Liste vorhanden\n\nif (chatid === \"\"){\n    msg.payload = \"Bitte Chat-ID eintragen\";\n    return [null, msg];\n}\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].chatid == user.chatid || userlist[i].name == user.name){\n        msg.payload = \"User oder Chat-ID bereits eingetragen\";\n        return [null, msg];\n    }\n}\n\n\nuserlist.push(user);\nglobal.set('userlist', userlist);\n\n\nmsg.payload = \"User \" + name + \" hinzugefügt!\";\n\nreturn [msg, null];","outputs":2,"noerr":0,"x":670,"y":3360,"wires":[["1b33b81b.c8c678","8e34fc29.95d0e"],["1b33b81b.c8c678"]]},{"id":"762299e2.b08378","type":"change","z":"7c56a241.1e88dc","name":"set newuserchatid","rules":[{"t":"set","p":"newuserchatid","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":3440,"wires":[[]]},{"id":"f0adc1e7.e4047","type":"function","z":"7c56a241.1e88dc","name":"reset userlist array","func":"var userlist = [];\n\nglobal.set('userlist', userlist);\n\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":3120,"wires":[["b1e0eefd.f5d6f"]]},{"id":"12b1ebc3.9fb144","type":"function","z":"37ee46c5.d3e98a","name":"Iterate","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    itt.outArray.push(msg.payload)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":347,"y":220,"wires":[[],[]]},{"id":"dba4e951.a9efa8","type":"ui_button","z":"7c56a241.1e88dc","name":"Delete","group":"a974a1dc.2318","order":2,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"","payloadType":"str","topic":"","x":210,"y":3900,"wires":[["edf3d6a.2b23428"]]},{"id":"e8159558.7ba548","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Name","tooltip":"","group":"a974a1dc.2318","order":1,"width":9,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":270,"y":3840,"wires":[["e786a2e1.b3a2b"]]},{"id":"a0dc3f6b.e367e","type":"function","z":"7c56a241.1e88dc","name":"delete user from userlist","func":"var userlist = global.get('userlist');\nvar name = flow.get('userdel');\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].name == name){\n        userlist.splice(i, 1);\n        msg.payload = \"User \" + name + \" gelöscht!\";\n        return msg;\n    }\n}\n\nmsg.payload = \"User \" + name + \" nicht vorhanden\";\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":3900,"wires":[["6cf1a068.8292a","fb805673.96fe38"]]},{"id":"e786a2e1.b3a2b","type":"change","z":"7c56a241.1e88dc","name":"set userdel","rules":[{"t":"set","p":"userdel","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":3840,"wires":[[]]},{"id":"20f4a5de.5065ba","type":"function","z":"7c56a241.1e88dc","name":"format text","func":"msg.payload = \"Neuer Nutzer mit der ChatID \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":3520,"wires":[["ffccee7f.7a23d"]]},{"id":"ffccee7f.7a23d","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":750,"y":3520,"wires":[]},{"id":"5b81269d.e5e4c8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":3120,"wires":[["f0adc1e7.e4047"]]},{"id":"1874c46c.dc959c","type":"function","z":"7c56a241.1e88dc","name":"Gate user exists?","func":"// Variablen setzen\n\nvar userlist = global.get('userlist');\nvar chatid = msg.payload.chatId;\n\n// Überprüfen ob User in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    \n    if(userlist[i].chatid == chatid){\n        msg.payload.name = userlist[i].name;\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":370,"y":200,"wires":[["c66f4c4.35413b"]]},{"id":"acc8335f.4cf74","type":"telegram sender","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","x":580,"y":100,"wires":[[]]},{"id":"d08da02a.c9ddd","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1810,"y":1140,"wires":[[],[],["f153fa65.e56d38"]]},{"id":"e21f5b8.47cd3a8","type":"function","z":"7c56a241.1e88dc","name":"wget Image","func":"try {\n    msg.payload = \"wget \" + msg.weblink +\" -P \" + global.get('images-incoming');\n    return msg;\n} catch (e){}","outputs":1,"noerr":0,"x":1650,"y":1140,"wires":[["d08da02a.c9ddd"]]},{"id":"859e9bb8.08dea8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"25235235435","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":3440,"wires":[["6f5b8b48.395204"]]},{"id":"6f5b8b48.395204","type":"function","z":"7c56a241.1e88dc","name":"tele Message sim","func":"var chatId = msg.payload;\nvar messageId = 12;\nvar type = \"message\";\nvar content = \"blubb\"\n\nmsg.payload ={ chatId, messageId, type, content }\n\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":3500,"wires":[["f7056c7a.85c5c"]]},{"id":"9d2bef95.e1e3a","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":3680,"wires":[["476d2ce0.c3db64"]]},{"id":"6cf1a068.8292a","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1110,"y":3900,"wires":[]},{"id":"3fc5248a.79ae4c","type":"comment","z":"7c56a241.1e88dc","name":"Nutzer löschen","info":"","x":220,"y":3780,"wires":[]},{"id":"7a84f3a9.010e6c","type":"comment","z":"7c56a241.1e88dc","name":"Nutzer hinzufügen","info":"","x":230,"y":3280,"wires":[]},{"id":"faa710fa.a3be","type":"comment","z":"7c56a241.1e88dc","name":"Nutzerliste","info":"","x":180,"y":3040,"wires":[]},{"id":"859a3652.7d91d8","type":"change","z":"7c56a241.1e88dc","name":"set userlist","rules":[{"t":"set","p":"userlist","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":3180,"wires":[["b1e0eefd.f5d6f"]]},{"id":"49556607.9cccc8","type":"function","z":"7c56a241.1e88dc","name":"format userlist","func":"var userlist = msg.payload;\nmsg.payload = \"\";\n\nfor (var i=0; i < userlist.length; i++) {\n    msg.payload = msg.payload + \"<tr><td>\" + userlist[i].name + \"</td><td>\" + userlist[i].chatid + \"</td></tr>\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":3180,"wires":[["a3cb9891.1b4998"]]},{"id":"b1e0eefd.f5d6f","type":"change","z":"7c56a241.1e88dc","name":"get userlist","rules":[{"t":"set","p":"payload","pt":"msg","to":"userlist","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":3140,"wires":[["49556607.9cccc8","5ff7f213.dc881c"]]},{"id":"1b33b81b.c8c678","type":"ui_toast","z":"7c56a241.1e88dc","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":910,"y":3360,"wires":[[]]},{"id":"fdf976eb.414d08","type":"link out","z":"7c56a241.1e88dc","name":"","links":["11cd389c.d11267"],"x":235,"y":260,"wires":[]},{"id":"11cd389c.d11267","type":"link in","z":"7c56a241.1e88dc","name":"","links":["fdf976eb.414d08"],"x":300,"y":3340,"wires":[["f7056c7a.85c5c"]]},{"id":"7b771b5.e814ee4","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"234523","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":3400,"wires":[["6f5b8b48.395204"]]},{"id":"d3db6368.6ef7e","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"234","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":3360,"wires":[["6f5b8b48.395204"]]},{"id":"a90e0331.97fe","type":"function","z":"7c56a241.1e88dc","name":"true-> false","func":"if(msg.payload){\n    msg.payload = false;\n} else {\n    msg.reset = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":3680,"wires":[["9d2bef95.e1e3a"]]},{"id":"d6db478c.577268","type":"link in","z":"7c56a241.1e88dc","name":"","links":["8e34fc29.95d0e","fb805673.96fe38"],"x":635,"y":3180,"wires":[["b1e0eefd.f5d6f"]]},{"id":"8e34fc29.95d0e","type":"link out","z":"7c56a241.1e88dc","name":"","links":["d6db478c.577268"],"x":795,"y":3300,"wires":[]},{"id":"fb805673.96fe38","type":"link out","z":"7c56a241.1e88dc","name":"","links":["d6db478c.577268"],"x":1035,"y":3860,"wires":[]},{"id":"5ff7f213.dc881c","type":"ui_table","z":"7c56a241.1e88dc","group":"6ea23321.89550c","name":"","order":1,"width":12,"height":6,"columns":[{"field":"name","title":"Name","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"chatid","title":"Chat-ID","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":950,"y":3100,"wires":[["eaa29f3a.26b62"]]},{"id":"a3cb9891.1b4998","type":"template","z":"7c56a241.1e88dc","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n<head>\n<style>\nth {\n  text-align: center;\n}\n</style>\n</head>\n\n<body>\n<table style=\"width:100%; text-align:center\">\n  <tr>\n    <th>Name</th>\n    <th>Chat-ID</th> \n  </tr>\n    {{payload}}\n</table>\n\n</body>\n</html>\n","output":"str","x":1100,"y":3180,"wires":[[]]},{"id":"eaa29f3a.26b62","type":"function","z":"7c56a241.1e88dc","name":"get name","func":"try{\n    msg.payload = msg.payload.name;\n} catch (e){}\nreturn msg;","outputs":1,"noerr":0,"x":1120,"y":3100,"wires":[["4fd715d2.f30bec"]]},{"id":"4fd715d2.f30bec","type":"link out","z":"7c56a241.1e88dc","name":"","links":["8bc512af.c6d39"],"x":1235,"y":3100,"wires":[]},{"id":"8bc512af.c6d39","type":"link in","z":"7c56a241.1e88dc","name":"","links":["4fd715d2.f30bec"],"x":175,"y":3840,"wires":[["e8159558.7ba548"]]},{"id":"8b7c9098.b7c87","type":"ui_toast","z":"7c56a241.1e88dc","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":510,"y":3900,"wires":[["e0267b70.807be8"]]},{"id":"edf3d6a.2b23428","type":"function","z":"7c56a241.1e88dc","name":"delete?","func":"var name = flow.get('userdel');\n\nmsg.payload = \"User \" + name + \" wirklich löschen?\";\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":3900,"wires":[["8b7c9098.b7c87"]]},{"id":"e0267b70.807be8","type":"function","z":"7c56a241.1e88dc","name":"gate \"OK\"","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":660,"y":3900,"wires":[["a0dc3f6b.e367e"]]},{"id":"c67a9b7.e69db68","type":"comment","z":"7c56a241.1e88dc","name":"Add Text","info":"","x":1100,"y":1480,"wires":[]},{"id":"2a0f261a.c87d7a","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":1520,"wires":[[],[],["993d21d1.50d41"]]},{"id":"47b2d8c4.6cd5c8","type":"function","z":"7c56a241.1e88dc","name":"convert image add text","func":"var imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\n\nimagepath = imagepath + flow.get('filenameResize');\nvar filenameResizeText = flow.get('filenameResize') + \".text.jpg\";\nresultpath = resultpath + filenameResizeText;\nflow.set('filenameResizeText', filenameResizeText);\n\nvar bgalpha = flow.get('bgalpha') || \"00\";\nvar bgcolor = flow.get('bgcolor') || \"000000\";\nvar text = msg.image.text || \"no text entered\";\n\n// Prepare string for bash -> convert special characters\ntext = text.replace(/\\\\/g , \"\\\\\\\\\").replace(/\"/g , \"\\\\\\\"\");\n\nvar textsize = \"\";\nif (flow.get('textsize') > 0){\n    textsize = \" -pointsize \" + (flow.get('textsize') || 30);\n}\nvar sizeX = (msg.image.imageWidth * (flow.get('lastImageResize'))/100) - flow.get('cropX');\nvar sizeY = (msg.image.imageHeight * (flow.get('lastImageResize'))/100) - flow.get('cropY');\nvar gravity = flow.get('gravity') || \"center\";\nvar color = flow.get('color') || \"white\";\nvar font = flow.get('font') || \"Liberation-Sans-Bold\";\nvar undercolor = \"\";\nif (flow.get('undercolor') !== \"off\"){\n    undercolor = \" -undercolor \" + (flow.get('undercolor') || black);\n}\n\nmsg.topic = \"textTrueText\";\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + undercolor + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:\\\"\" + text + \"\\\" \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":1520,"wires":[["2a0f261a.c87d7a"]]},{"id":"9dfe85ae.25ea38","type":"comment","z":"7c56a241.1e88dc","name":"Resize incoming Images","info":"","x":170,"y":1480,"wires":[]},{"id":"bc5c689d.b3fa98","type":"comment","z":"dfa0e0a5.c8001","name":"Displayauflösung","info":"","x":140,"y":1940,"wires":[]},{"id":"e27c7715.f4ce48","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"y","tooltip":"","group":"cbf02e0a.18499","order":2,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":370,"y":2040,"wires":[["7836b6e0.a8b778"]]},{"id":"f7532169.84116","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"x","tooltip":"","group":"cbf02e0a.18499","order":1,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":370,"y":2000,"wires":[["bc339cc2.9fc39"]]},{"id":"7836b6e0.a8b778","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"displayHeight","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":2040,"wires":[[]]},{"id":"bc339cc2.9fc39","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"displayWidth","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":2000,"wires":[[]]},{"id":"2b7c62e2.d3c16e","type":"image-info","z":"7c56a241.1e88dc","name":"","x":1450,"y":1260,"wires":[["d035d701.4373e8"]]},{"id":"d8607587.5f2828","type":"function","z":"7c56a241.1e88dc","name":"set file","func":"return {filename: (global.get('images-incoming') + msg.payload)};\n","outputs":1,"noerr":0,"x":950,"y":1260,"wires":[["4f5819a7.f38628"]]},{"id":"4f5819a7.f38628","type":"file in","z":"7c56a241.1e88dc","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":1090,"y":1260,"wires":[["2b7c62e2.d3c16e"]]},{"id":"c13975e4.57fb78","type":"function","z":"7c56a241.1e88dc","name":"convert image resize","func":"var imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\n\nimagepath = imagepath + msg.image.fileId + \".jpg\";\nvar filenameResize = msg.image.fileId + \".rs.jpg\";\nresultpath = resultpath + filenameResize;\n\nflow.set('filenameResize', filenameResize);\n\nvar displayWidth = global.get('displayWidth');\nvar displayHeight = global.get('displayHeight');\nvar imageWidth = msg.image.imageWidth;\nvar imageHeight = msg.image.imageHeight;\n\nvar resize = \"\";\nif (imageWidth/imageHeight > displayWidth/displayHeight){\n    \n    resize = (displayWidth / imageWidth * 100);\n    \n} else {\n    \n    resize = (displayHeight / imageHeight * 100);\n}\n\nflow.set('lastImageResize', resize);\n\nmsg.payload = \"convert \" + imagepath + \" -size \" + displayWidth + \"x\" + displayHeight + \" -auto-orient -resize \" + resize + \"%\" + \" xc:black +swap -gravity center -composite \" + resultpath;\n\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"x":420,"y":1480,"wires":[["361dacd6.b27bd4"]]},{"id":"361dacd6.b27bd4","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":1480,"wires":[[],[],["c0a9ff00.fadfe"]]},{"id":"695fd683.0af3d8","type":"debug","z":"7c56a241.1e88dc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":160,"wires":[]},{"id":"911c282a.81a5f8","type":"fs-file-lister","z":"7c56a241.1e88dc","name":"","start":"global.get('images-incoming')","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":570,"y":1260,"wires":[["cbf661c0.35f29"]]},{"id":"cbf661c0.35f29","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"filenameIncoming","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":1260,"wires":[["d8607587.5f2828"]]},{"id":"e111055e.e9f098","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1190,"y":1360,"wires":[[],[],["635f03a6.5b896c"]]},{"id":"3eb469a9.a3f486","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramUsername","func":"// Variablen abspeichern\n\nvar userlist = global.get('userlist');\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].chatid == msg.payload.chatId){\n        msg.payload = userlist[i].name;\n        flow.set('lastTelegramUsername', msg.payload);\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":1210,"y":1040,"wires":[[]]},{"id":"fd4afe8c.3fa31","type":"function","z":"7c56a241.1e88dc","name":"convert image add name","func":"// set variables\nvar imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\n\nvar sizeX = global.get('displayWidth');\nvar sizeY = global.get('displayHeight');\nvar gravity = (flow.get('gravityName')) || \"southeast\";\nvar undercolor = \"black\"; //\n\nif (msg.topic === \"textTrueText\"){\n    imagepath = imagepath + flow.get('filenameResizeText');\n    resultpath = resultpath + msg.image.filenameText;\n    \n} else {\n    imagepath = imagepath + flow.get('filenameResize');\n    resultpath = resultpath + msg.image.filenamePic;\n}\n\nvar textsize = (flow.get('nameTextsize')) || 40;\nvar bgalpha = \"00\";\nvar bgcolor = \"000000\";\nvar text = flow.get('lastTelegramUsername') || \"no text entered\";\n// Prepare string for bash -> convert special characters\ntext = text.replace(/\\\\/g , \"\\\\\\\\\").replace(/\"/g , \"\\\\\\\"\");\nvar color = flow.get('color') || \"white\";\nvar font = flow.get('font') || \"Liberation-Sans\";\n\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + \" -undercolor \" + undercolor + \" -pointsize \" + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:\\\"\" + text + \"\\\" \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":1620,"wires":[["6bc46fb3.9cc96"]]},{"id":"6bc46fb3.9cc96","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":1620,"wires":[[],[],["d8cfda78.815aa8"]]},{"id":"6eff0982.4d8e18","type":"comment","z":"7c56a241.1e88dc","name":"Add Name","info":"","x":1100,"y":1580,"wires":[]},{"id":"84851945.fe0028","type":"function","z":"7c56a241.1e88dc","name":"downsize image for dashboard + thumb","func":"var resize = 416;\nvar resizeThumb = 113;\nvar quality = 60;\n\nvar cmd;\n\nvar imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\nvar resultpathThumb = imagepath;\n\nif (msg.topic === \"textTrueText\"){\n    imagepath = imagepath + msg.image.filenameText;\n    resultpath = resultpath + msg.image.filenameTextDash;\n    resultpathThumb = resultpathThumb + msg.image.filenameTextThumb;\n} else {\n    imagepath = imagepath + msg.image.filenamePic;\n    resultpath = resultpath + msg.image.filenamePicDash;\n    resultpathThumb = resultpathThumb + msg.image.filenamePicThumb;\n}\n\ncmd = \"convert \" + imagepath + \" -resize \" + resize + \" -quality \" + quality + \" \" + resultpath + \" && \";\ncmd = cmd + \"convert \" + imagepath + \" -resize \" + resizeThumb + \" -quality \" + quality + \" \" + resultpathThumb;\n\nmsg.payload = cmd;\n\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":1700,"wires":[["ececc511.da15c8"]]},{"id":"ececc511.da15c8","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":450,"y":1700,"wires":[[],[],["831c855e.b960c8"]]},{"id":"23a08705.fbb988","type":"function","z":"7c56a241.1e88dc","name":"delete source files","func":"if (msg.topic === \"textTrueText\" || msg.topic === \"textFalsePic\"){\n    \n    var path = global.get('images-preprocessing');\n    msg.payload = \"rm \" + path + \"*\";\n    \n} else {\n    msg.payload = \"\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":1900,"wires":[["7064ec00.eec2c4"]]},{"id":"7064ec00.eec2c4","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":450,"y":1900,"wires":[[],[],["e744adc5.91cdb"]]},{"id":"c66f4c4.35413b","type":"function","z":"7c56a241.1e88dc","name":"image/video?","func":"var chatId = 0;\nvar type = \"message\";\nvar content = \"\";\nvar payload = { chatId,\n                type,\n                content\n};\nvar msg2 = {payload};\n\nglobal.set('lastMimeVideo', \"mp4\");\n\nif (msg.payload.type === \"document\"){\n    var mimetype = msg.payload.weblink.slice(msg.payload.weblink.lastIndexOf(\".\") + 1);\n    if (mimetype === \"jpg\" || mimetype === \"JPG\"){\n        msg.payload.type = \"photo\";\n    }\n    if (mimetype === \"mp4\" || mimetype === \"MP4\" || mimetype === \"mov\" || mimetype === \"MOV\" || mimetype === \"mkv\" || mimetype === \"MKV\"){\n        msg.payload.type = \"video\";\n        global.set('lastMimeVideo', mimetype);\n    }\n}\n\nif (msg.payload.type === \"photo\"){\n    \n    if (msg.payload.chatId < 0){\n        return [null, null, msg];\n    \n    } else {\n        msg2.payload.chatId = msg.payload.chatId;\n        msg2.payload.content = \"Danke \" + msg.payload.name + \"! Dein Bild ist angekommen.\";\n        return [msg2, null, msg];        \n    }\n\n} else if (msg.payload.type === \"video\"){\n    \n    if (msg.payload.chatId < 0){\n        return [null, msg, null];\n    \n    } else {\n        msg2.payload.chatId = msg.payload.chatId;\n        msg2.payload.content = \"Danke \" + msg.payload.name + \"! Dein Video ist angekommen! Du bekommst eine Nachricht, sobald es verfügbar ist.\";\n        return [msg2, msg, null];\n    }\n\n} else {\n    if (msg.payload.chatId < 0){\n        msg2.payload.chatId = msg.payload.chatId;\n        msg2.payload.content = \"Sorry \" + msg.payload.name + \", Nachrichten kommen leider nur an, wenn sie ein Foto (jpg) oder ein Video (mp4, mov, mkv) enthalten :-( !\";\n        return [msg2, null, null];\n    }\n}","outputs":3,"noerr":0,"x":580,"y":220,"wires":[["acc8335f.4cf74"],["2efa3db1.b53b02","2804a714.736958"],["4e160b83.17c294","4fb33d12.764024"]]},{"id":"7042f23b.40a91c","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramMessage","func":"try{\n    flow.set('lastTelegramMessage', msg.payload.caption);\n} catch(e){}\n\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":1040,"wires":[["3eb469a9.a3f486"]]},{"id":"3e32eae9.dd5636","type":"function","z":"7c56a241.1e88dc","name":"switch if text","func":"if (!msg.image.textFlag){\n    msg.topic = \"textFalsePic\";\n    return [null, msg];\n} else {\n    msg.topic = \"textTruePic\";\n    flow.set('triggerControl', 2);\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":910,"y":1520,"wires":[["47b2d8c4.6cd5c8"],["fd4afe8c.3fa31"]]},{"id":"e1aec8f5.2b7b28","type":"comment","z":"7c56a241.1e88dc","name":"create thumbnails","info":"","x":170,"y":1640,"wires":[]},{"id":"a1bd3724.340b78","type":"comment","z":"7c56a241.1e88dc","name":"delete source files","info":"","x":250,"y":1860,"wires":[]},{"id":"1bc5e035.452d1","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Max. Anzahl Papierkorb","tooltip":"","group":"79173158.54b5a","order":5,"width":10,"height":1,"passthru":true,"outs":"end","topic":"","min":"1","max":"999","step":1,"x":570,"y":3040,"wires":[["afd767a1.e9d978"]]},{"id":"cc323c1e.9684c","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":690,"y":2300,"wires":[["a6961568.21e038"],["a6961568.21e038"],["a6961568.21e038"]]},{"id":"d94018d9.852338","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"sudo cat /dev/tty1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":530,"y":2280,"wires":[["cc323c1e.9684c"]]},{"id":"a6961568.21e038","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":2300,"wires":[]},{"id":"d088436c.e3048","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"sudo killall cat","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":510,"y":2320,"wires":[["cc323c1e.9684c"]]},{"id":"8936fbaa.4e7a78","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Nachrichten anzeigen","tooltip":"","group":"79173158.54b5a","order":8,"width":12,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":560,"y":2880,"wires":[["22757c1.e629b84"]]},{"id":"f34c1177.b2b79","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"textActive","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":2880,"wires":[[]]},{"id":"2de84ae9.85c9d6","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"loopMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":2940,"wires":[[]]},{"id":"afd767a1.e9d978","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"trashMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":3040,"wires":[[]]},{"id":"4e79dda9.59f3b4","type":"comment","z":"5af1388b.ef9838","name":"Settings","info":"","x":160,"y":2760,"wires":[]},{"id":"c4d060eb.a68cb","type":"ui_dropdown","z":"e00097c0.ad3088","name":"","label":"","tooltip":"","place":"","group":"98f89e13.1f66c","order":3,"width":10,"height":1,"passthru":true,"options":[{"label":"Timer Off","value":"timerOff","type":"str"},{"label":"06:00","value":"06:00","type":"str"},{"label":"","value":"06:15","type":"str"},{"label":"","value":"06:30","type":"str"},{"label":"","value":"06:45","type":"str"},{"label":"","value":"07:00","type":"str"},{"label":"","value":"07:15","type":"str"},{"label":"","value":"07:30","type":"str"},{"label":"","value":"07:45","type":"str"},{"label":"","value":"08:00","type":"str"},{"label":"","value":"08:15","type":"str"},{"label":"","value":"08:30","type":"str"},{"label":"","value":"08:45","type":"str"},{"label":"","value":"09:00","type":"str"},{"label":"","value":"09:15","type":"str"},{"label":"","value":"09:30","type":"str"},{"label":"","value":"09:45","type":"str"},{"label":"","value":"10:00","type":"str"},{"label":"","value":"10:15","type":"str"},{"label":"","value":"10:30","type":"str"},{"label":"","value":"10:45","type":"str"},{"label":"","value":"11:00","type":"str"},{"label":"","value":"11:15","type":"str"},{"label":"","value":"11:30","type":"str"},{"label":"","value":"11:45","type":"str"},{"label":"","value":"12:00","type":"str"},{"label":"","value":"12:15","type":"str"},{"label":"","value":"12:30","type":"str"},{"label":"","value":"12:45","type":"str"},{"label":"","value":"13:00","type":"str"},{"label":"","value":"13:15","type":"str"},{"label":"","value":"13:30","type":"str"},{"label":"","value":"13:45","type":"str"},{"label":"","value":"14:00","type":"str"},{"label":"","value":"14:15","type":"str"},{"label":"","value":"14:30","type":"str"},{"label":"","value":"14:45","type":"str"},{"label":"","value":"15:00","type":"str"},{"label":"","value":"15:15","type":"str"},{"label":"","value":"15:30","type":"str"},{"label":"","value":"15:45","type":"str"},{"label":"","value":"16:00","type":"str"},{"label":"","value":"16:15","type":"str"},{"label":"","value":"16:30","type":"str"},{"label":"","value":"16:45","type":"str"},{"label":"","value":"17:00","type":"str"},{"label":"","value":"17:15","type":"str"},{"label":"","value":"17:30","type":"str"},{"label":"","value":"17:45","type":"str"},{"label":"","value":"18:00","type":"str"},{"label":"","value":"18:15","type":"str"},{"label":"","value":"18:30","type":"str"},{"label":"","value":"18:45","type":"str"},{"label":"","value":"19:00","type":"str"},{"label":"","value":"19:15","type":"str"},{"label":"","value":"19:30","type":"str"},{"label":"","value":"19:45","type":"str"},{"label":"","value":"20:00","type":"str"},{"label":"","value":"20:15","type":"str"},{"label":"","value":"20:30","type":"str"},{"label":"","value":"20:45","type":"str"},{"label":"","value":"21:00","type":"str"},{"label":"","value":"21:15","type":"str"},{"label":"","value":"21:30","type":"str"},{"label":"","value":"21:45","type":"str"},{"label":"","value":"22:00","type":"str"},{"label":"","value":"22:15","type":"str"},{"label":"","value":"","type":"str"},{"label":"","value":"22:30","type":"str"},{"label":"","value":"22:45","type":"str"},{"label":"","value":"23:00","type":"str"},{"label":"","value":"23:15","type":"str"},{"label":"","value":"23:30","type":"str"},{"label":"","value":"23:45","type":"str"},{"label":"","value":"00:00","type":"str"},{"label":"","value":"00:15","type":"str"},{"label":"","value":"00:30","type":"str"},{"label":"","value":"00:45","type":"str"},{"label":"","value":"01:00","type":"str"},{"label":"","value":"01:15","type":"str"},{"label":"","value":"01:30","type":"str"},{"label":"","value":"01:45","type":"str"},{"label":"","value":"02:00","type":"str"},{"label":"","value":"02:15","type":"str"},{"label":"","value":"02:30","type":"str"},{"label":"","value":"02:45","type":"str"},{"label":"","value":"03:00","type":"str"},{"label":"","value":"03:15","type":"str"},{"label":"","value":"03:30","type":"str"},{"label":"","value":"03:45","type":"str"},{"label":"","value":"04:00","type":"str"},{"label":"","value":"04:15","type":"str"},{"label":"","value":"04:30","type":"str"},{"label":"","value":"04:45","type":"str"},{"label":"","value":"05:00","type":"str"},{"label":"","value":"05:15","type":"str"},{"label":"","value":"05:30","type":"str"},{"label":"","value":"05:45","type":"str"}],"payload":"","topic":"timeOn","x":350,"y":460,"wires":[["fc007af8.4b0098","28ca737e.ced88c"]]},{"id":"fc007af8.4b0098","type":"function","z":"e00097c0.ad3088","name":"create timer input","func":"if (msg.payload === \"timerOff\"){\n    msg.payload = { suspended:true };\n} else if (msg.topic === \"timeOn\"){\n    msg.payload = { ontime:msg.payload, suspended:false };\n} else if (msg.topic === \"timeOff\"){\n    msg.payload = { offtime:msg.payload, suspended:false };\n} else return null;\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":540,"wires":[["3062f612.357daa"]]},{"id":"3062f612.357daa","type":"schedex","z":"e00097c0.ad3088","name":"Timer","passthroughunhandled":false,"suspended":false,"lat":"","lon":"","ontime":"","ontopic":"","onpayload":"1","onoffset":0,"onrandomoffset":0,"offtime":"","offtopic":"","offpayload":"0","offoffset":0,"offrandomoffset":0,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":790,"y":540,"wires":[["219171dc.c5a49e"]]},{"id":"219171dc.c5a49e","type":"function","z":"e00097c0.ad3088","name":"convert string -> int","func":"if (msg.payload === \"1\") {\n    msg.payload = 1;\n}\nelse {\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":540,"wires":[["65b2fd66.a9b1e4"]]},{"id":"588ec493.a2088c","type":"ui_dropdown","z":"e00097c0.ad3088","name":"","label":"","tooltip":"","place":"","group":"98f89e13.1f66c","order":6,"width":10,"height":1,"passthru":true,"options":[{"label":"Timer Off","value":"timerOff","type":"str"},{"label":"","value":"06:00","type":"str"},{"label":"","value":"06:15","type":"str"},{"label":"","value":"06:30","type":"str"},{"label":"","value":"06:45","type":"str"},{"label":"","value":"07:00","type":"str"},{"label":"","value":"07:15","type":"str"},{"label":"","value":"07:30","type":"str"},{"label":"","value":"07:45","type":"str"},{"label":"","value":"08:00","type":"str"},{"label":"","value":"08:15","type":"str"},{"label":"","value":"08:30","type":"str"},{"label":"","value":"08:45","type":"str"},{"label":"","value":"09:00","type":"str"},{"label":"","value":"09:15","type":"str"},{"label":"","value":"09:30","type":"str"},{"label":"","value":"09:45","type":"str"},{"label":"","value":"10:00","type":"str"},{"label":"","value":"10:15","type":"str"},{"label":"","value":"10:30","type":"str"},{"label":"","value":"10:45","type":"str"},{"label":"","value":"11:00","type":"str"},{"label":"","value":"11:15","type":"str"},{"label":"","value":"11:30","type":"str"},{"label":"","value":"11:45","type":"str"},{"label":"","value":"12:00","type":"str"},{"label":"","value":"12:15","type":"str"},{"label":"","value":"12:30","type":"str"},{"label":"","value":"12:45","type":"str"},{"label":"","value":"13:00","type":"str"},{"label":"","value":"13:15","type":"str"},{"label":"","value":"13:30","type":"str"},{"label":"","value":"13:45","type":"str"},{"label":"","value":"14:00","type":"str"},{"label":"","value":"14:15","type":"str"},{"label":"","value":"14:30","type":"str"},{"label":"","value":"14:45","type":"str"},{"label":"","value":"15:00","type":"str"},{"label":"","value":"15:15","type":"str"},{"label":"","value":"15:30","type":"str"},{"label":"","value":"15:45","type":"str"},{"label":"","value":"16:00","type":"str"},{"label":"","value":"16:15","type":"str"},{"label":"","value":"16:30","type":"str"},{"label":"","value":"16:45","type":"str"},{"label":"","value":"17:00","type":"str"},{"label":"","value":"17:15","type":"str"},{"label":"","value":"17:30","type":"str"},{"label":"","value":"17:45","type":"str"},{"label":"","value":"18:00","type":"str"},{"label":"","value":"18:15","type":"str"},{"label":"","value":"18:30","type":"str"},{"label":"","value":"18:45","type":"str"},{"label":"","value":"19:00","type":"str"},{"label":"","value":"19:15","type":"str"},{"label":"","value":"19:30","type":"str"},{"label":"","value":"19:45","type":"str"},{"label":"","value":"20:00","type":"str"},{"label":"","value":"20:15","type":"str"},{"label":"","value":"20:30","type":"str"},{"label":"","value":"20:45","type":"str"},{"label":"","value":"21:00","type":"str"},{"label":"","value":"21:15","type":"str"},{"label":"","value":"21:30","type":"str"},{"label":"","value":"21:45","type":"str"},{"label":"","value":"22:00","type":"str"},{"label":"","value":"22:15","type":"str"},{"label":"","value":"22:30","type":"str"},{"label":"","value":"22:45","type":"str"},{"label":"","value":"23:00","type":"str"},{"label":"","value":"23:15","type":"str"},{"label":"","value":"23:30","type":"str"},{"label":"","value":"23:45","type":"str"},{"label":"","value":"00:00","type":"str"},{"label":"","value":"00:15","type":"str"},{"label":"","value":"00:30","type":"str"},{"label":"","value":"00:45","type":"str"},{"label":"","value":"01:00","type":"str"},{"label":"","value":"01:15","type":"str"},{"label":"","value":"01:30","type":"str"},{"label":"","value":"01:45","type":"str"},{"label":"","value":"02:00","type":"str"},{"label":"","value":"02:15","type":"str"},{"label":"","value":"02:30","type":"str"},{"label":"","value":"02:45","type":"str"},{"label":"","value":"03:00","type":"str"},{"label":"","value":"03:15","type":"str"},{"label":"","value":"03:30","type":"str"},{"label":"","value":"03:45","type":"str"},{"label":"","value":"04:00","type":"str"},{"label":"","value":"04:15","type":"str"},{"label":"","value":"04:30","type":"str"},{"label":"","value":"04:45","type":"str"},{"label":"","value":"05:00","type":"str"},{"label":"","value":"05:15","type":"str"},{"label":"","value":"05:30","type":"str"},{"label":"","value":"05:45","type":"str"}],"payload":"","topic":"timeOff","x":350,"y":600,"wires":[["fc007af8.4b0098","f30d6930.ad9ae8"]]},{"id":"a8c60203.b8af1","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":4,"width":2,"height":1,"name":"","label":"Uhr","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":500,"wires":[]},{"id":"fa2ce4df.75bec8","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":7,"width":2,"height":1,"name":"","label":"Uhr","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":640,"wires":[]},{"id":"cf226409.f192c8","type":"comment","z":"e00097c0.ad3088","name":"Display On/Off","info":"","x":180,"y":100,"wires":[]},{"id":"bcbbb945.48f918","type":"exec","z":"e00097c0.ad3088","command":"vcgencmd display_power 0","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":920,"y":280,"wires":[[],[],[]]},{"id":"2951b8b6.676678","type":"exec","z":"e00097c0.ad3088","command":"vcgencmd display_power 1","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":920,"y":220,"wires":[[],[],[]]},{"id":"5f4c3995.ed98f8","type":"inject","z":"e00097c0.ad3088","name":"Display off","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":620,"y":160,"wires":[["bcbbb945.48f918"]]},{"id":"89f91e00.3f566","type":"inject","z":"e00097c0.ad3088","name":"Display on","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":620,"y":120,"wires":[["2951b8b6.676678"]]},{"id":"65b2fd66.a9b1e4","type":"ui_switch","z":"e00097c0.ad3088","name":"","label":"Aus / An","tooltip":"","group":"98f89e13.1f66c","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":360,"y":260,"wires":[["ed6040e4.f77e3"]]},{"id":"1d8775e4.7c3f0a","type":"switch","z":"e00097c0.ad3088","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":260,"wires":[["2951b8b6.676678"],["bcbbb945.48f918"]]},{"id":"9c0d31fe.b5e8c","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":2,"width":12,"height":1,"name":"","label":"Bildschirm an","format":"{{msg.payload}}","layout":"row-spread","x":340,"y":420,"wires":[]},{"id":"8489dec8.3f46b","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":5,"width":12,"height":1,"name":"","label":"Bildschirm aus","format":"{{msg.payload}}","layout":"row-spread","x":340,"y":560,"wires":[]},{"id":"8789cd73.c6c3c","type":"function","z":"5af1388b.ef9838","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":430,"y":980,"wires":[["603ae859.a81b08"]]},{"id":"10b21058.f480c","type":"comment","z":"5af1388b.ef9838","name":"stick","info":"","x":170,"y":1060,"wires":[]},{"id":"bf63c1dd.c767b","type":"function","z":"5af1388b.ef9838","name":"set color","func":"var image = global.get('currentImagePlayer');\n\nif(image.stickFlag){\n    msg.payload = \"#eb4034\";\n} else {\n    msg.payload = \"\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":1140,"wires":[["6ca0a6f5.8b6858","a6b49aab.c5a378"]]},{"id":"6407c025.f7455","type":"function","z":"5af1388b.ef9838","name":"get currentImagePlayer + -index + -pos","func":"try{\n    var array = global.get('arrayImages');\n    var file = msg.payload.params.data.item.file;\n    file = file.slice(file.lastIndexOf(\"/\") + 1);\n    var id = parseInt(file.slice(0, file.indexOf(\".\")));\n    \n    var noTrashCounter = 0;\n    for (var i=0; i < array.length; i++) {\n\n        if (!array[i].trashFlag){\n            noTrashCounter++;\n        }\n        \n        if (array[i].fileId === id){\n            \n            global.set('currentImagePlayer', array[i]);\n            flow.set('currentImagePlayerIndex', i);\n            flow.set('currentImagePlayerPos', noTrashCounter);\n            \n            break;\n        }\n    }\n    \n    return msg;\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":660,"y":440,"wires":[["9f55bb60.063888","99e2e4d5.3b8d18"]]},{"id":"103f13b1.59e58c","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1410,"y":340,"wires":[[],[],["f7d23ddc.32e82"]]},{"id":"4c611dba.ec1c54","type":"comment","z":"dfa0e0a5.c8001","name":"Log","info":"","x":110,"y":2320,"wires":[]},{"id":"3e3aa4c4.10f0ac","type":"link in","z":"dfa0e0a5.c8001","name":"Log","links":["e0dbe779.1681b8"],"x":1055,"y":2500,"wires":[["56b9832e.25f3bc"]]},{"id":"e0dbe779.1681b8","type":"link out","z":"7c56a241.1e88dc","name":"Telegram out","links":["3e3aa4c4.10f0ac"],"x":235,"y":300,"wires":[]},{"id":"5e07aefb.00bfb","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"","tooltip":"Ordnerpfad","group":"1229b955.63bec7","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":"100","topic":"","x":340,"y":2160,"wires":[["1b8f0442.7e744c","c2eea243.64537"]]},{"id":"d74046c4.67d498","type":"comment","z":"dfa0e0a5.c8001","name":"telegrampath","info":"","x":130,"y":2120,"wires":[]},{"id":"1b8f0442.7e744c","type":"function","z":"dfa0e0a5.c8001","name":"add \"/\"","func":"if(msg.payload.slice(-1) !== \"/\"){\n    msg.payload = msg.payload + \"/\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":2160,"wires":[["6cfad06a.94f4f"]]},{"id":"6cfad06a.94f4f","type":"function","z":"dfa0e0a5.c8001","name":"set folders","func":"// Images\nvar imagefolder = \"images/\";\nimagefolder = msg.payload + imagefolder;\n\nglobal.set('path-images', imagefolder);\nglobal.set('images-incoming', (imagefolder + \"01.incoming/\"));\nglobal.set('images-preprocessing', (imagefolder + \"02.preprocessing/\"));\nglobal.set('images-loop', (imagefolder + \"03.loop/\"));\n\n\n// Videos\nvar videofolder = \"videos/\";\nvideofolder = msg.payload + videofolder;\n\nglobal.set('path-videos', videofolder);\nglobal.set('videos-incoming', (videofolder + \"01.incoming/\"));\nglobal.set('videos-preprocessing', (videofolder + \"02.preprocessing/\"));\nglobal.set('videos-loop', (videofolder + \"03.loop/\"));\n\n\n// Preview\nvar previewfolder = \"preview/\";\npreviewfolder = msg.payload + previewfolder;\n\nglobal.set('path-preview', previewfolder);","outputs":1,"noerr":0,"x":690,"y":2160,"wires":[[]]},{"id":"c52d3fad.85dbf","type":"function","z":"7c56a241.1e88dc","name":"set FL Folder","func":"msg.payload = {start: global.get('images-incoming')};\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1260,"wires":[["911c282a.81a5f8"]]},{"id":"6dcb1ff9.6492a","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Botname","tooltip":"","group":"9ed2be8.851194","order":1,"width":8,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":240,"y":4040,"wires":[["c74df752.9be8d8"]]},{"id":"c74df752.9be8d8","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"botname","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":4040,"wires":[[]]},{"id":"6960b4be.57d08c","type":"comment","z":"7c56a241.1e88dc","name":"Bot","info":"","x":190,"y":3980,"wires":[]},{"id":"bb264c6b.11645","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Token","tooltip":"","group":"9ed2be8.851194","order":2,"width":8,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":230,"y":4080,"wires":[["250a2aca.4bd9d6"]]},{"id":"250a2aca.4bd9d6","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"bottoken","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":4080,"wires":[[]]},{"id":"53e50bc7.b9b854","type":"comment","z":"5af1388b.ef9838","name":"IMAGES","info":"","x":140,"y":240,"wires":[]},{"id":"4e5fff10.24769","type":"comment","z":"5af1388b.ef9838","name":"VIDEOS","info":"","x":170,"y":3480,"wires":[]},{"id":"df26ac7e.fef28","type":"ui_button","z":"5af1388b.ef9838","name":"pause","group":"c51c9a95.f2cb68","order":6,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-pause","payload":"pause","payloadType":"str","topic":"","x":790,"y":3580,"wires":[["20afec52.82efa4","bbcc94e4.472028","228c29b0.337986"]]},{"id":"927e6904.449578","type":"ui_button","z":"5af1388b.ef9838","name":"stop","group":"c51c9a95.f2cb68","order":7,"width":2,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-stop","payload":"stop","payloadType":"str","topic":"","x":790,"y":3660,"wires":[["1bc2dc85.dafca3","bbcc94e4.472028","228c29b0.337986"]]},{"id":"2e1296c7.66d7ca","type":"ui_button","z":"5af1388b.ef9838","name":"play","group":"c51c9a95.f2cb68","order":5,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-play","payload":"play","payloadType":"str","topic":"","x":790,"y":3720,"wires":[["25ecf2e8.488cfe","bbcc94e4.472028","3dc142d0.bec18e","21fd1787.3c13b8"]]},{"id":"5e8cf1c6.62138","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"c51c9a95.f2cb68","order":8,"width":2,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":330,"y":4020,"wires":[["27175ae3.331876","25e42f88.5da1f"]]},{"id":"3d27329c.35b44e","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"c51c9a95.f2cb68","order":9,"width":2,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":330,"y":4060,"wires":[["27175ae3.331876","25e42f88.5da1f"]]},{"id":"76bd882a.b637c8","type":"ui_button","z":"5af1388b.ef9838","name":"delete","group":"c51c9a95.f2cb68","order":10,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"Wirklich löschen?","payloadType":"str","topic":"","x":290,"y":4200,"wires":[["f97aa165.c7016"]]},{"id":"f97aa165.c7016","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":430,"y":4200,"wires":[["1d9b5bde.6fb704"]]},{"id":"da1ff016.0093","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification top (4sec)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"GUI.ShowNotification\",\n            \"id\": 1,\n            \"params\":{\n                \"title\":msg.payload,\n                \"message\":\"\",\n                \"displaytime\":4000\n            }\n        }\n};","outputs":1,"noerr":0,"x":1570,"y":1120,"wires":[["b2efa2c8.3efc"]]},{"id":"683c6b5e.62fc74","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification (5sec) [msg.payload]","links":["8952a3c5.41966"],"x":1335,"y":1120,"wires":[["da1ff016.0093"]]},{"id":"1c6d8031.edaa7","type":"link in","z":"5af1388b.ef9838","name":"Player.PlayPause (Pause)","links":["5b173a11.dc2234"],"x":1415,"y":820,"wires":[["ffbdb28d.7c8a6"]]},{"id":"f4cce95d.56b828","type":"link in","z":"5af1388b.ef9838","name":"Player.Stop","links":["d4a38631.f4e108","1f3ff909.cbf857","21c3e5f9.6f75da","d5a6eaa1.a7c8a8","d731bb2a.1f4028"],"x":1415,"y":860,"wires":[["6eb6fb45.cfdac4"]]},{"id":"8a4057ea.301c48","type":"link in","z":"5af1388b.ef9838","name":"Player.Open (directory) [msg.payload]","links":[],"x":1415,"y":680,"wires":[["883c1b70.676b08"]]},{"id":"d49976cb.46b698","type":"link in","z":"5af1388b.ef9838","name":"Player.Open (file) [msg.payload]","links":["1f3ff909.cbf857"],"x":1415,"y":640,"wires":[["3e356f2e.d3986"]]},{"id":"92da4955.9fdbf8","type":"link in","z":"5af1388b.ef9838","name":"start if playerStatus play || pause","links":["620371c7.3effe","dc11438c.48568"],"x":1375,"y":200,"wires":[["90b8f088.745ed"]]},{"id":"dc11438c.48568","type":"link out","z":"7c56a241.1e88dc","name":"","links":["6a4a0105.c45da","92da4955.9fdbf8"],"x":1495,"y":1980,"wires":[]},{"id":"86802c5.4587dd","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"msg.payload = \"Neue Nachricht von \" + flow.get('lastTelegramUsername') + \"!\"\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":2140,"wires":[["228bd998.c359d6"]]},{"id":"228bd998.c359d6","type":"link out","z":"7c56a241.1e88dc","name":"","links":["844330d1.62789"],"x":1515,"y":2140,"wires":[]},{"id":"21caab0.4054556","type":"function","z":"5af1388b.ef9838","name":"Start/Stop Notification","func":"if(msg.payload === \"kodiPause\"){\n    msg.payload = \"Stop\";\n    return msg;\n} else if (msg.payload === \"kodiPlay\"){\n    msg.payload = \"Start\";\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1380,"y":1060,"wires":[["941d2d96.42468"]]},{"id":"1ab6439d.6ea0dc","type":"rbe","z":"5af1388b.ef9838","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":530,"y":520,"wires":[["c613e3ff.4f41e","1f9144a2.57693b","cf207f67.3c883","a5306045.8471f"]]},{"id":"941d2d96.42468","type":"function","z":"5af1388b.ef9838","name":"gate if DashPressed","func":"if(!global.get('dashPressed')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1600,"y":1060,"wires":[["da1ff016.0093"]]},{"id":"39aabebe.9aab22","type":"link out","z":"5af1388b.ef9838","name":"","links":["8fc9fac9.cd53f8"],"x":515,"y":680,"wires":[]},{"id":"442ce2f1.aae81c","type":"link out","z":"5af1388b.ef9838","name":"","links":["8fc9fac9.cd53f8"],"x":1795,"y":260,"wires":[]},{"id":"f0febbb2.cdecf8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"kodiPlayerStatus","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":580,"wires":[[]]},{"id":"bbf54ac6.e639a8","type":"comment","z":"5af1388b.ef9838","name":"GUI Notification","info":"","x":1560,"y":1020,"wires":[]},{"id":"8fc9fac9.cd53f8","type":"link in","z":"5af1388b.ef9838","name":"DashPressed (4sec)","links":["39aabebe.9aab22","442ce2f1.aae81c","71203b2.77436c4"],"x":1415,"y":1300,"wires":[["c6e667df.ca8978"]]},{"id":"c6e667df.ca8978","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"dashPressed","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1590,"y":1300,"wires":[["2a80d81d.87e388"]]},{"id":"2a80d81d.87e388","type":"stoptimer","z":"5af1388b.ef9838","duration":"4000","units":"Millisecond","payloadtype":"num","payloadval":"0","name":"","x":1590,"y":1360,"wires":[["aca9ebc6.e394b8"],[]]},{"id":"b2efa2c8.3efc","type":"function","z":"5af1388b.ef9838","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2270,"y":900,"wires":[["53cc86d9.f90978"]]},{"id":"8b17631a.2904f","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2630,"y":780,"wires":[]},{"id":"90b8f088.745ed","type":"function","z":"5af1388b.ef9838","name":"start if playerStatus play || pause","func":"if (global.get('kodiPlayerStatus') === \"kodiPlay\" || global.get('kodiPlayerStatus') === \"kodiPause\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1570,"y":200,"wires":[["c6be6051.f6e5f"]]},{"id":"571e5a0d.8510f4","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1240,"y":2140,"wires":[["86802c5.4587dd","2d21f7f6.6b8dc8"]]},{"id":"91926304.7daef","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification top (10sec)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"GUI.ShowNotification\",\n            \"id\": 1,\n            \"params\":{\n                \"title\":msg.payload,\n                \"message\":\"\",\n                \"displaytime\":10000\n            }\n        }\n};","outputs":1,"noerr":0,"x":1560,"y":1160,"wires":[["b2efa2c8.3efc"]]},{"id":"844330d1.62789","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification (10sec) [msg.payload]","links":["228bd998.c359d6"],"x":1335,"y":1160,"wires":[["91926304.7daef"]]},{"id":"af2ac4df.613cf8","type":"ui_media","z":"5af1388b.ef9838","group":"c51c9a95.f2cb68","name":"","width":12,"height":6,"order":2,"category":"telegram","file":"1004.mp4","layout":"adjust","showcontrols":true,"loop":false,"onstart":false,"scope":"local","tooltip":"","x":990,"y":4060,"wires":[[]]},{"id":"b41df9a9.decaf8","type":"function","z":"5af1388b.ef9838","name":"import file","func":"global.set('currentVideo', msg.payload);\n\nvar domain = global.get('domain');\nif (domain.slice(-1) !== \"/\"){\n    domain = domain + \"/\";\n}\nmsg = { src: \"http://\" + domain + \"telegram/videos/03.loop/\" + msg.payload, payload: msg.payload};\n\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":4060,"wires":[["af2ac4df.613cf8","9b5c2a6f.4bd398"]]},{"id":"984de336.6051c","type":"function","z":"5af1388b.ef9838","name":"pause","func":"msg.play = false;\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":4020,"wires":[["af2ac4df.613cf8"]]},{"id":"1347604e.6e3f5","type":"function","z":"5af1388b.ef9838","name":"play","func":"msg.play = true;\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":3980,"wires":[["af2ac4df.613cf8"]]},{"id":"25ecf2e8.488cfe","type":"function","z":"5af1388b.ef9838","name":"add folder","func":"msg.payload = global.get('videos-loop')  + global.get('currentVideo');\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":3720,"wires":[["5a1ebbfa.ac23b4","98c00bb2.6f0578"]]},{"id":"1f3ff909.cbf857","type":"link out","z":"5af1388b.ef9838","name":"","links":["d49976cb.46b698","f4cce95d.56b828"],"x":1375,"y":3720,"wires":[]},{"id":"20afec52.82efa4","type":"function","z":"5af1388b.ef9838","name":"Player.PlayPause","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.PlayPause\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":1\n            }\n        }\n};","outputs":1,"noerr":0,"x":1030,"y":3580,"wires":[["78797928.e3a228","5a1ebbfa.ac23b4"]]},{"id":"1bc2dc85.dafca3","type":"function","z":"5af1388b.ef9838","name":"Player.Stop","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.Stop\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":1\n            }\n        }\n};","outputs":1,"noerr":0,"x":1010,"y":3660,"wires":[["f3f4154.56e5de8","5a1ebbfa.ac23b4"]]},{"id":"74cb4c3d.327cb4","type":"link in","z":"5af1388b.ef9838","name":"","links":["78797928.e3a228","f3f4154.56e5de8"],"x":1935,"y":960,"wires":[["b2efa2c8.3efc"]]},{"id":"78797928.e3a228","type":"link out","z":"5af1388b.ef9838","name":"","links":["74cb4c3d.327cb4"],"x":1175,"y":3580,"wires":[]},{"id":"e27f5805.51bfb8","type":"link out","z":"5af1388b.ef9838","name":"","links":["6fc7188d.772e58"],"x":1175,"y":3620,"wires":[]},{"id":"2208e8fb.66fdc8","type":"link in","z":"5af1388b.ef9838","name":"Player.GoTo next","links":["a7a8c7d1.937c78"],"x":1415,"y":960,"wires":[["f6f2588b.8879f8"]]},{"id":"eb78734a.657a7","type":"link in","z":"5af1388b.ef9838","name":"Player.GoTo previous","links":["62faac09.68dee4"],"x":1415,"y":920,"wires":[["93b3653f.741c78"]]},{"id":"833ed45c.3e3b58","type":"function","z":"5af1388b.ef9838","name":"set stickFlag","func":"var image = global.get('currentImagePlayer');\n\nif (image.stickFlag){\n    \n    image.stickFlag = false;\n    msg.payload.stickFlag = false;\n\n} else {\n    image.stickFlag =  true;\n    msg.payload.stickFlag = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1200,"wires":[["bf63c1dd.c767b"]]},{"id":"5b173a11.dc2234","type":"link out","z":"5af1388b.ef9838","name":"","links":["1c6d8031.edaa7"],"x":1975,"y":300,"wires":[]},{"id":"5fd0e3e8.826e3c","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1680,"y":360,"wires":[["38dc5900.1add38"]]},{"id":"38dc5900.1add38","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl status kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":2080,"y":360,"wires":[["b6f90e5.a1af1f"],[],[]]},{"id":"b6f90e5.a1af1f","type":"function","z":"dfa0e0a5.c8001","name":"check kodi status","func":"if(msg.payload.search(\"Active: active\") > 0){\n    msg.payload = true;\n} else {\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2330,"y":360,"wires":[["7a7b4064.9fef1"]]},{"id":"7a7b4064.9fef1","type":"switch","z":"dfa0e0a5.c8001","name":"if false","property":"payload","propertyType":"msg","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":2210,"y":300,"wires":[[]]},{"id":"9104c854.65d0d8","type":"function","z":"dfa0e0a5.c8001","name":"start/stop loop","func":"var reset = true;\n\nif(msg.payload){\n    return msg;\n} else {\n    msg = { reset }\n    return msg;\n}","outputs":1,"noerr":0,"x":1800,"y":280,"wires":[["31323f6d.b2ab3"]]},{"id":"31323f6d.b2ab3","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"60","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1960,"y":280,"wires":[["9104c854.65d0d8","37fc5c70.a64a94"]]},{"id":"37fc5c70.a64a94","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"55","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1860,"y":360,"wires":[["38dc5900.1add38"]]},{"id":"f4df8844.e49288","type":"function","z":"5af1388b.ef9838","name":"Application.SetVolume","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Application.SetVolume\",\n            \"id\": 1,\n            \"params\": msg.payload\n        }\n};","outputs":1,"noerr":0,"x":1600,"y":1600,"wires":[["b2efa2c8.3efc"]]},{"id":"cf430ace.a1c7a8","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Lautstärke:","tooltip":"","group":"c51c9a95.f2cb68","order":4,"width":7,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"100","step":1,"x":470,"y":4320,"wires":[["897b5e4b.2bec8","26fa3df5.c462f2"]]},{"id":"897b5e4b.2bec8","type":"link out","z":"5af1388b.ef9838","name":"","links":["f76c0a3a.f3b438"],"x":595,"y":4360,"wires":[]},{"id":"f76c0a3a.f3b438","type":"link in","z":"5af1388b.ef9838","name":"Application.SetVolume","links":["897b5e4b.2bec8"],"x":1455,"y":1600,"wires":[["f4df8844.e49288"]]},{"id":"75af0c10.faa9a4","type":"comment","z":"5af1388b.ef9838","name":"Settings","info":"","x":260,"y":4640,"wires":[]},{"id":"ad3acd0b.cbb95","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Max. Anzahl Videos im Speicher","tooltip":"","group":"d021848d.7c9d58","order":1,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"100","step":1,"x":530,"y":4700,"wires":[["698ba4d3.4d460c"]]},{"id":"470a98ff.077548","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification bottom","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"GUI.ShowNotification\",\n            \"id\": 1,\n            \"params\":{\n                \"title\":\"\",\n                \"message\":msg.payload,\n                \"displaytime\":global.get('onScreenInfoTime')\n            }\n        }\n};","outputs":1,"noerr":0,"x":1570,"y":1200,"wires":[["b2efa2c8.3efc"]]},{"id":"6b933baa.2f9ff4","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification bottom","links":["6901f99a.715428"],"x":1275,"y":1200,"wires":[["a20e9b1f.b230e8"]]},{"id":"beec3265.79a38","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"msg.payload = \"Neue Nachricht von \" + flow.get('lastTelegramUsername') + \"!\"\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":2200,"wires":[["6901f99a.715428"]]},{"id":"6901f99a.715428","type":"link out","z":"7c56a241.1e88dc","name":"","links":["6b933baa.2f9ff4"],"x":1515,"y":2200,"wires":[]},{"id":"2d21f7f6.6b8dc8","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"12","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1240,"y":2200,"wires":[["beec3265.79a38"]]},{"id":"a20e9b1f.b230e8","type":"function","z":"5af1388b.ef9838","name":"gate","func":"if(global.get('onScreenInfo')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1370,"y":1200,"wires":[["470a98ff.077548"]]},{"id":"92d49688.3a73e8","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"filenameVideoIncoming","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2090,"y":340,"wires":[["f7710099.9acc3"]]},{"id":"a4cae3d9.5fd0d","type":"function","z":"7c56a241.1e88dc","name":"rename + mv -> folder","func":"if (global.get('videoConvertFlag') || false){\n    \n    msg.payload = \"mv \" + global.get('videos-incoming') + flow.get('filenameVideoIncoming') + \" \" + global.get('videos-preprocessing') + msg.video.filename;\n    return [null, msg];\n    \n} else {\n    msg.payload = \"mv \" + global.get('videos-incoming') + flow.get('filenameVideoIncoming') + \" \" + global.get('videos-loop') + msg.video.filename;\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1660,"y":460,"wires":[["11414e1a.10be62"],["5f0269e5.e50b08"]]},{"id":"11414e1a.10be62","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1870,"y":460,"wires":[[],[],["afda48f.8eb1fb8"]]},{"id":"698ba4d3.4d460c","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"storedVideosMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":4700,"wires":[[]]},{"id":"2ee6133.932a1ec","type":"comment","z":"7c56a241.1e88dc","name":"IMAGES","info":"","x":220,"y":900,"wires":[]},{"id":"205b49ad.7c7bc6","type":"comment","z":"7c56a241.1e88dc","name":"VIDEOS","info":"","x":830,"y":140,"wires":[]},{"id":"f2f6a38.3e3456","type":"q-gate","z":"7c56a241.1e88dc","name":"","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":1130,"y":220,"wires":[["82c9e878.fb1c58","cd76f8c3.9e0868","f25cb36f.09898","c7902211.1744e"]]},{"id":"f497dcbc.95ac","type":"function","z":"7c56a241.1e88dc","name":"trigger gate","func":"msg.payload = \"trigger\";\nmsg.topic = \"control\";\nreturn msg;","outputs":1,"noerr":0,"x":2050,"y":560,"wires":[["eaf3347e.d1bcf8","d53f797b.347198","6b1fc388.85afac"]]},{"id":"eaf3347e.d1bcf8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["721a2160.2ab1c"],"x":2155,"y":520,"wires":[]},{"id":"721a2160.2ab1c","type":"link in","z":"7c56a241.1e88dc","name":"","links":["eaf3347e.d1bcf8"],"x":935,"y":260,"wires":[["f2f6a38.3e3456"]]},{"id":"7579cd34.da5794","type":"q-gate","z":"7c56a241.1e88dc","name":"","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":390,"y":1040,"wires":[["85e552a1.fba43","98d6148b.a85dc8","6475acf3.e11544"]]},{"id":"98b8ca51.fe0458","type":"function","z":"7c56a241.1e88dc","name":"set triggerControl 1","func":"flow.set('triggerControl', 1);\nreturn msg;\n","outputs":1,"noerr":0,"x":1450,"y":1140,"wires":[["e21f5b8.47cd3a8"]]},{"id":"7cd117f2.69c9e8","type":"function","z":"7c56a241.1e88dc","name":"trigger gate","func":"var triggerControl = flow.get('triggerControl');\ntriggerControl = triggerControl - 1;\nflow.set('triggerControl', triggerControl);\n\nif (triggerControl === 0){\n    msg.payload = \"trigger\";\n    msg.topic = \"control\";\n    return msg;\n}","outputs":1,"noerr":0,"x":1050,"y":1860,"wires":[["bb5fc45c.c23d28","91ab1713.418f88"]]},{"id":"bb5fc45c.c23d28","type":"link out","z":"7c56a241.1e88dc","name":"","links":["85c98d5d.3969"],"x":1175,"y":1840,"wires":[]},{"id":"85c98d5d.3969","type":"link in","z":"7c56a241.1e88dc","name":"","links":["bb5fc45c.c23d28"],"x":255,"y":1040,"wires":[["7579cd34.da5794"]]},{"id":"f7710099.9acc3","type":"function","z":"7c56a241.1e88dc","name":"ffprobe (get video res.)","func":"msg.payload = \"ffprobe -v quiet -print_format json -show_format -show_streams \" + global.get('videos-incoming') + flow.get('filenameVideoIncoming');\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":460,"wires":[["4de2421.fccdbbc"]]},{"id":"4de2421.fccdbbc","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":910,"y":460,"wires":[["5ccfd479.98db4c"],[],["80c27756.dc37a8"]]},{"id":"5ccfd479.98db4c","type":"json","z":"7c56a241.1e88dc","name":"","property":"payload","action":"","pretty":false,"x":1050,"y":440,"wires":[["671bf4a1.795e0c"]]},{"id":"4a7cd7ee.60f248","type":"function","z":"7c56a241.1e88dc","name":"if error","func":"return msg;\n","outputs":1,"noerr":0,"x":1990,"y":660,"wires":[["f497dcbc.95ac","90f93e17.9dce9","90c15ace.744d38","542bc0a0.667d9"]]},{"id":"fcb4b999.51c3b8","type":"link in","z":"7c56a241.1e88dc","name":"if video error ","links":["4d122063.c606b","e4408f27.40fa7","ef093438.0da098","218fba47.5eccb6","50707f01.e68c6","12baf267.a1255e","12cd364b.7e356a","2bb3d940.2e4a26","2a80e21f.ac415e","34c3fcd6.c0f464","a184344e.42a328","e57f2a84.ef08d8","425c5a.673893a8","c00cbab3.8f7718","b1b77da8.ffabd","c82976a9.e61b38","e77e35ba.be7f28","7746634f.84282c","d2a29d7b.73c96"],"x":1915,"y":600,"wires":[["4a7cd7ee.60f248"]]},{"id":"ad49ff1e.8974b","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":2350,"y":660,"wires":[[],[],[]]},{"id":"4d3649a4.d33218","type":"function","z":"7c56a241.1e88dc","name":"if error","func":"\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1070,"y":1780,"wires":[["4e9ca213.3d056c","7cd117f2.69c9e8","4e6cccb1.b71404","94528a65.a7c5a8"]]},{"id":"c83370c8.48945","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1470,"y":1740,"wires":[[],[],[]]},{"id":"46c8e873.b01a88","type":"link in","z":"7c56a241.1e88dc","name":"if image error ","links":["722656da.556c18","5d59ba7d.48c784","641823b2.89a2ec","bd729108.a8b66","1a18fb2b.a9feb5","f7528269.e3f37","c6f19bf8.ca97d8","dad59521.45c408","73c987ec.d39ab8","8679564f.58e298","3d6d789b.565ee8","af7658f5.2d7f78","752fdb30.528944","401843c8.f4d2dc","598f636f.837b1c","37966aa1.cfaed6","ce0076c8.8fb808","c078b833.d19cd8"],"x":975,"y":1780,"wires":[["4d3649a4.d33218"]]},{"id":"f605d689.b29478","type":"function","z":"7c56a241.1e88dc","name":"ffmpeg","func":"msg.payload = \"ffmpeg -i \" + global.get('videos-preprocessing') + msg.video.filename + \" -vf scale=-1:\" + global.get('displayHeight') + \" \" + global.get('videos-preprocessing') + \"tmp.\" + msg.video.fileId + \".mp4\";\n\nmsg.video.container = \"mp4\";\nmsg.video.filename = msg.video.fileId + \".mp4\";\n\nreturn msg;\n","outputs":1,"noerr":0,"x":560,"y":700,"wires":[["4688a835.e5e458"]]},{"id":"5f0269e5.e50b08","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":810,"y":580,"wires":[[],[],["754dccc3.6cf1e4"]]},{"id":"e78683dd.58ce9","type":"comment","z":"7c56a241.1e88dc","name":"resize using ffmpeg if height > displayHeight","info":"","x":710,"y":660,"wires":[]},{"id":"4688a835.e5e458","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":690,"y":700,"wires":[[],[],["f086681c.bfe8b8"]]},{"id":"7328fe2e.e840c","type":"function","z":"7c56a241.1e88dc","name":"rename + mv -> folder","func":"msg.payload = \"mv \" + global.get('videos-preprocessing') + \"tmp.\" + msg.video.filename + \" \" + global.get('videos-loop') + msg.video.filename + \" && rm \" + global.get('videos-preprocessing') + msg.video.filename;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1060,"y":700,"wires":[["8af81c35.06ae1"]]},{"id":"8af81c35.06ae1","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1230,"y":700,"wires":[[],[],["fa7e0ea.63f90f"]]},{"id":"f7d23ddc.32e82","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1560,"y":340,"wires":[["12cd364b.7e356a"],["bae46ed.a8acd9"]]},{"id":"6a2b3bc7.b395d4","type":"ui_button","z":"5af1388b.ef9838","name":"active","group":"c51c9a95.f2cb68","order":11,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-arrow-circle-down","payload":"","payloadType":"str","topic":"","x":490,"y":4260,"wires":[[]]},{"id":"a2416246.4cc2b","type":"function","z":"5af1388b.ef9838","name":"set color","func":"if(msg.payload){\n    msg.payload = \"#eb4034\";\n} else {\n    msg.payload = \"\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":4260,"wires":[["6a2b3bc7.b395d4"]]},{"id":"5e85c279.d9f46c","type":"link in","z":"5af1388b.ef9838","name":"busy","links":["245967b5.d39638","8a993ebd.32626","3ab9ee56.530ec2"],"x":255,"y":4260,"wires":[["a2416246.4cc2b"]]},{"id":"cb9645f6.a71318","type":"function","z":"7c56a241.1e88dc","name":"send video ready","func":"var chatId = flow.get('lastTelegramChatidVideo');\n\nif (chatId > 0){\n    var type = \"message\";\n    var content = \"Fertig! Dein Video kannst du ab jetzt unter http://\" + global.get('domain') + \":1880/ui/#!/0?socketid=s-Yqvg1PLkovDlowAAAU aufrufen und abspielen.\";\n    \n    msg.payload = { chatId,\n                    type,\n                    content\n    };\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":2050,"y":780,"wires":[["628f7588.5cbbbc"]]},{"id":"628f7588.5cbbbc","type":"telegram sender","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","x":2280,"y":780,"wires":[[]]},{"id":"12cd364b.7e356a","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1675,"y":300,"wires":[]},{"id":"afda48f.8eb1fb8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":2020,"y":460,"wires":[["7746634f.84282c"],["b3990b58.8c4038"]]},{"id":"f086681c.bfe8b8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":840,"y":700,"wires":[["2a80e21f.ac415e"],["7328fe2e.e840c"]]},{"id":"2a80e21f.ac415e","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":955,"y":660,"wires":[]},{"id":"fa7e0ea.63f90f","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1380,"y":700,"wires":[["d2a29d7b.73c96"],["b3990b58.8c4038"]]},{"id":"f153fa65.e56d38","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1960,"y":1140,"wires":[["73c987ec.d39ab8"],["c52d3fad.85dbf"]]},{"id":"73c987ec.d39ab8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":2065,"y":1130,"wires":[]},{"id":"635f03a6.5b896c","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1330,"y":1360,"wires":[["8679564f.58e298"],["c13975e4.57fb78"]]},{"id":"8679564f.58e298","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1435,"y":1350,"wires":[]},{"id":"c0a9ff00.fadfe","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":740,"y":1480,"wires":[["3d6d789b.565ee8"],["3e32eae9.dd5636"]]},{"id":"3d6d789b.565ee8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":835,"y":1460,"wires":[]},{"id":"993d21d1.50d41","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1480,"y":1520,"wires":[["af7658f5.2d7f78"],["fd4afe8c.3fa31"]]},{"id":"af7658f5.2d7f78","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1595,"y":1520,"wires":[]},{"id":"d8cfda78.815aa8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1480,"y":1620,"wires":[["752fdb30.528944"],["84851945.fe0028"]]},{"id":"752fdb30.528944","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1595,"y":1620,"wires":[]},{"id":"e744adc5.91cdb","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":600,"y":1900,"wires":[["598f636f.837b1c"],["7cd117f2.69c9e8","3f8e28b3.1245d8"]]},{"id":"598f636f.837b1c","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":755,"y":1860,"wires":[]},{"id":"831c855e.b960c8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":600,"y":1700,"wires":[["37966aa1.cfaed6"],["504b0d03.1c2514"]]},{"id":"37966aa1.cfaed6","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":755,"y":1700,"wires":[]},{"id":"a184344e.42a328","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1095,"y":580,"wires":[]},{"id":"754dccc3.6cf1e4","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":960,"y":580,"wires":[["a184344e.42a328"],["f605d689.b29478"]]},{"id":"ff5edf4a.f2d6f","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1000,"y":2140,"wires":[["86802c5.4587dd"]]},{"id":"b089cb87.b44da8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1020,"y":2200,"wires":[["beec3265.79a38"]]},{"id":"abd4ce3.6fb663","type":"function","z":"7c56a241.1e88dc","name":"send image ready","func":"var chatId = flow.get('lastTelegramChatid');\n\nif (chatId > 0){\n    var type = \"message\";\n    var content = \"Dein Bild wird ab jetzt angezeigt!\";\n    \n    msg.payload = { chatId,\n                    type,\n                    content\n    };\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":1250,"y":2020,"wires":[["aafb3fbd.52af3"]]},{"id":"aafb3fbd.52af3","type":"telegram sender","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","x":1480,"y":2020,"wires":[[]]},{"id":"85e552a1.fba43","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramChatid","func":"flow.set('lastTelegramChatid', msg.payload.chatId);\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":1040,"wires":[["7042f23b.40a91c"]]},{"id":"c3de6857.ab3b68","type":"function","z":"7c56a241.1e88dc","name":"reset q-gate","func":"flow.set('qgateBufferVideos', 0);\n\nmsg.topic = \"control\";\nmsg.payload = \"reset\";\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":300,"wires":[["f2f6a38.3e3456","56433867.4a50d8"]]},{"id":"8fc7a884.818988","type":"function","z":"7c56a241.1e88dc","name":"reset q-gate","func":"flow.set('qgateBufferImages', 0);\nflow.set('triggerControl', 0);\n\nmsg.topic = \"control\";\nmsg.payload = \"reset\";\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":1120,"wires":[["7579cd34.da5794","6e917fa1.ce641"]]},{"id":"25e42f88.5da1f","type":"function","z":"5af1388b.ef9838","name":"navigate files","func":"var array = global.get('arrayVideos') || [];\n\nif (array.length > 0){\n    \n    var currentVideoIndex = flow.get('currentVideoIndex') || 0;\n    \n    if (msg.payload === \"l\"){\n    \n        if (currentVideoIndex >= (array.length - 1)){\n            currentVideoIndex = 0;\n        } else {\n            currentVideoIndex = currentVideoIndex + 1;\n        }\n        \n    } else if (msg.payload === \"r\"){\n        \n        if (currentVideoIndex <= 0){\n            currentVideoIndex = array.length - 1;\n        } else {\n            currentVideoIndex = currentVideoIndex - 1;\n        }\n        \n    } else if (msg.payload === \"start\"){\n        currentVideoIndex = 0;\n    }\n    \n    flow.set('currentVideoIndex', currentVideoIndex);\n    global.set('currentVideo', array[currentVideoIndex].filename);\n    msg.payload = array[currentVideoIndex].filename;\n    \n} else {\n    global.set('currentVideo', \"\");\n    msg.payload = \"\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":4040,"wires":[["b41df9a9.decaf8"]]},{"id":"1d9b5bde.6fb704","type":"function","z":"5af1388b.ef9838","name":"if ok delete","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":590,"y":4200,"wires":[["f0b0fca1.b92ca"]]},{"id":"aca9ebc6.e394b8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"dashPressed","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1850,"y":1400,"wires":[[]]},{"id":"110ad02.332b43","type":"stoptimer","z":"5af1388b.ef9838","duration":"5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1560,"y":1420,"wires":[["aca9ebc6.e394b8"],[]]},{"id":"490b41ca.1b986","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"dashPressed","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1590,"y":1480,"wires":[["110ad02.332b43"]]},{"id":"bbcc94e4.472028","type":"function","z":"5af1388b.ef9838","name":"set color","func":"if (msg.payload === \"play\" || msg.payload === \"kodiPlay\"){\n    var payload = \"\";\n    var msg2 = {payload};\n    msg.payload = \"#eb4034\"; // red\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', true);\n    return [msg2, msg];\n\n} else if (msg.payload === \"pause\"){\n    if ((context.get('colorswitchPause') || false) && context.set('colorswitchPlay')){\n        msg.payload = \"#ebe534\"; // yellow\n        context.set('colorswitchPause', false);\n    } else {\n        msg.payload = \"\";\n        context.set('colorswitchPause', true);\n    }\n    return [msg, null];\n\n} else if (msg.payload === \"kodiPause\"){\n    msg.payload = \"#ebe534\"; // yellow\n    context.set('colorswitchPause', false);\n    return [msg, null];\n\n} else if (msg.payload === \"stop\" || msg.payload === \"kodiStop\"){\n    msg.payload = \"\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', false);\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":600,"y":3660,"wires":[["df26ac7e.fef28"],["2e1296c7.66d7ca"]]},{"id":"623c93eb.43012c","type":"rbe","z":"5af1388b.ef9838","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":3660,"wires":[["bbcc94e4.472028","690a4ce2.2ba8f4","efe1988.7c76268","27175ae3.331876"]]},{"id":"690a4ce2.2ba8f4","type":"function","z":"5af1388b.ef9838","name":"gate \"kodiStop\"","func":"if(msg.payload === \"kodiStop\"){\n    if (flow.get('stopLock')){\n        flow.set('stopLock', false);\n    } else {\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":1020,"y":3620,"wires":[["e27f5805.51bfb8","5a1ebbfa.ac23b4"]]},{"id":"cbdf7fed.a48c1","type":"function","z":"5af1388b.ef9838","name":"gate images","func":"try{\n    if (msg.payload.params.data.item.type === \"picture\"){\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":210,"y":480,"wires":[["82df6bdd.e98f78","ad1ea8ed.3c9d48","df045419.0c29b8","12c9de36.7ecd72"]]},{"id":"ad1ea8ed.3c9d48","type":"function","z":"5af1388b.ef9838","name":"get stop","func":"try{\n    if (msg.payload.method === \"Player.OnStop\"){\n        msg.payload = \"kodiStop\";\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":380,"y":500,"wires":[["1ab6439d.6ea0dc"]]},{"id":"82df6bdd.e98f78","type":"function","z":"5af1388b.ef9838","name":"get speed","func":"try{\n    if (msg.payload.params.data.player.speed === 0){\n        msg.payload = \"kodiPause\";\n        return msg;\n    } else if (msg.payload.params.data.player.speed === 1){\n        msg.payload = \"kodiPlay\";\n        return msg;\n    }\n\n} catch(e){}\n","outputs":1,"noerr":0,"x":380,"y":540,"wires":[["1ab6439d.6ea0dc"]]},{"id":"413ecc2f.d1b544","type":"function","z":"5af1388b.ef9838","name":"gate videos","func":"try{\n    if (msg.payload.params.data.item.type === \"movie\"){\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":270,"y":3560,"wires":[["999114d1.275808","b0cfd4bd.6afb78","27175ae3.331876"]]},{"id":"b0cfd4bd.6afb78","type":"function","z":"5af1388b.ef9838","name":"get speed","func":"try{\n    if (msg.payload.params.data.player.speed === 0){\n        msg.payload = \"kodiPause\";\n        return msg;\n    } else if (msg.payload.params.data.player.speed === 1){\n        msg.payload = \"kodiPlay\";\n        return msg;\n    }\n\n} catch(e){}\n","outputs":1,"noerr":0,"x":260,"y":3680,"wires":[["623c93eb.43012c"]]},{"id":"999114d1.275808","type":"function","z":"5af1388b.ef9838","name":"get stop","func":"try{\n    if (msg.payload.method === \"Player.OnStop\"){\n        msg.payload = \"kodiStop\";\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":260,"y":3640,"wires":[["623c93eb.43012c"]]},{"id":"cd187329.675f9","type":"link in","z":"5af1388b.ef9838","name":"Player.Open arrayImages","links":["6df57dbf.8b24e4"],"x":1415,"y":160,"wires":[["c6be6051.f6e5f"]]},{"id":"3dc142d0.bec18e","type":"function","z":"5af1388b.ef9838","name":"flow.set stopLock","func":"if((global.get('kodiPlayerVideoStatus') === \"kodiPlay\") || (global.get('kodiPlayerVideoStatus') === \"kodiPause\")){\n    flow.set('stopLock', true);\n}","outputs":1,"noerr":0,"x":1030,"y":3760,"wires":[[]]},{"id":"efe1988.7c76268","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"kodiPlayerVideoStatus","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":3520,"wires":[[]]},{"id":"4e9ca213.3d056c","type":"function","z":"7c56a241.1e88dc","name":"send 'not successfull'","func":"var chatId = flow.get('lastTelegramChatid');\nvar type = \"message\";\nvar content = \"Irgendwas ist leider schiefgelaufen :-(. Probiere es doch einfach nochmal!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1300,"y":1780,"wires":[["aafb3fbd.52af3"]]},{"id":"90f93e17.9dce9","type":"function","z":"7c56a241.1e88dc","name":"send 'not successfull'","func":"var chatId = flow.get('lastTelegramChatidVideo');\nvar type = \"message\";\nvar content = \"Irgendwas ist leider schiefgelaufen :(. Probiere es doch einfach nochmal!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":2060,"y":720,"wires":[["628f7588.5cbbbc"]]},{"id":"fb025f37.84049","type":"comment","z":"dfa0e0a5.c8001","name":"squid","info":"","x":110,"y":1080,"wires":[]},{"id":"d963dd26.eb315","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"squid","tooltip":"","group":"29050d2.fa3cef2","order":5,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":1120,"wires":[["206db579.1cf32a"]]},{"id":"d996463d.31d538","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":550,"y":1120,"wires":[["8beeb916.aa55c8"],["afe21bfb.85b978"]]},{"id":"8beeb916.aa55c8","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start squid","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":800,"y":1100,"wires":[[],[],[]]},{"id":"afe21bfb.85b978","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop squid","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":800,"y":1160,"wires":[[],[],[]]},{"id":"2fd28b39.2cd434","type":"comment","z":"dfa0e0a5.c8001","name":"openvpn","info":"","x":120,"y":900,"wires":[]},{"id":"8b4c2698.95cbc8","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"openvpn","tooltip":"","group":"29050d2.fa3cef2","order":3,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":280,"y":940,"wires":[["7021d9f3.a489a8"]]},{"id":"779c625.b0a5e9c","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":550,"y":940,"wires":[["5dc133a4.8b68cc"],["5b8bf566.f2229c"]]},{"id":"5dc133a4.8b68cc","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start openvpn@jablServ","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":840,"y":920,"wires":[[],[],[]]},{"id":"5b8bf566.f2229c","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop openvpn@jablServ","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":840,"y":980,"wires":[[],[],[]]},{"id":"dadc16b7.9632e8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":3560,"wires":[["6f5b8b48.395204"]]},{"id":"2b05e33c.64881c","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"40","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":700,"y":120,"wires":[["9ce79b53.76cc08","f42d47dd.c226b8"]]},{"id":"f42d47dd.c226b8","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["6fc7188d.772e58","9244cd4e.75e28"],"x":995,"y":100,"wires":[]},{"id":"aa89bc1.8eb434","type":"function","z":"5af1388b.ef9838","name":"Reverse Time","func":"if (msg.payload > 0){\n    msg.payload = 3600 - msg.payload;\n    return msg;\n}","outputs":1,"noerr":0,"x":580,"y":3900,"wires":[["cd8908c2.a3d3d8","d3e4741d.cf64b8"]]},{"id":"cd8908c2.a3d3d8","type":"function","z":"5af1388b.ef9838","name":"sek -> min:sek","func":"var time = msg.payload;\nvar min = Math.floor(time / 60)\ntime = time - min*60;\nvar sec = Math.floor(time)\n\nif(min < 10){\n    min = \"0\" + min;\n}\n\nif(sec < 10){\n    sec = \"0\" + sec;\n}\n\nmsg.payload = min + \" m \" + sec + \" s\"\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":3880,"wires":[["413bf818.7729d8"]]},{"id":"413bf818.7729d8","type":"ui_text","z":"5af1388b.ef9838","group":"c51c9a95.f2cb68","order":3,"width":5,"height":1,"name":"","label":"Zeit:","format":"{{msg.payload}}","layout":"row-spread","x":930,"y":3880,"wires":[]},{"id":"29e62cfe.2620a4","type":"mytimeout","z":"5af1388b.ef9838","name":"timeout 1h","outtopic":"","outsafe":"on","outwarning":"Warning","outunsafe":"off","warning":"5","timer":"3600","debug":false,"ndebug":false,"ignoreCase":false,"repeat":false,"again":false,"x":410,"y":3800,"wires":[[],["aa89bc1.8eb434","657f76bb.cb5818"]]},{"id":"27175ae3.331876","type":"function","z":"5af1388b.ef9838","name":"control timer","func":"msg.timeout = 3599;\n\nif(msg.payload.method === \"Player.OnPlay\"){\n    context.set('startPlay', true);\n    msg.payload = 3600;\n    return [null, msg];\n    \n} else if ((msg.payload.method === \"Player.OnAVChange\" && context.get('startPlay')) || (msg.payload === \"kodiPlay\" && context.get('pauseFlag'))){\n    msg.payload = 1;\n    \n    if(context.get('pauseFlag')){\n        msg.timeout = 3599 - flow.get('timecode');\n        context.set('pauseFlag', false);\n    } else {\n        context.set('pauseFlag', false);\n    }\n    context.set('startPlay', false);\n    return [msg, null];\n    \n} else if (msg.payload === \"kodiPause\"){\n    msg.payload = 0;\n    context.set('pauseFlag', true);\n    return [msg, null];\n\n} else if (msg.payload === \"kodiStop\" || msg.payload === \"r\" || msg.payload === \"l\"){\n    msg.payload = \"cancel\";\n    context.set('pauseFlag', false);\n    return [msg, null];\n}\n","outputs":2,"noerr":0,"x":250,"y":3860,"wires":[["29e62cfe.2620a4"],["aa89bc1.8eb434"]]},{"id":"d3e4741d.cf64b8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"timecode","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":3920,"wires":[[]]},{"id":"bc73c661.6f14e8","type":"comment","z":"7c56a241.1e88dc","name":"Nutzerverwaltung","info":"","x":160,"y":3000,"wires":[]},{"id":"165566b4.482a19","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Kein Slideshow-Neustart wenn auf Pause","tooltip":"","group":"c83c4c5e.03ddf","order":4,"width":12,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"false","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"true","offvalueType":"bool","officon":"","offcolor":"","x":620,"y":3140,"wires":[["803466bd.6754e8"]]},{"id":"803466bd.6754e8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"restartSlideshowOnPause","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":3140,"wires":[[]]},{"id":"8e9eb826.48a4c8","type":"ui_template","z":"dfa0e0a5.c8001","group":"5758df94.472ad","name":"","order":2,"width":12,"height":5,"format":"<style>\n    #mylog {\n        min-height: 250px;\n        padding: 0;\n        background-color: white;\n        white-space: pre;\n    }\n</style>\n\n<div id=\"mylog\" ng-bind=\"msg.payload\" contenteditable=\"false\">\n    <!-- payload will go here -->\n    {{msg.payload}}\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":640,"y":3080,"wires":[[]]},{"id":"13850e93.5260c1","type":"ui_template","z":"dfa0e0a5.c8001","group":"ed8a86bc.a4c3c8","name":"","order":26,"width":12,"height":3,"format":"<style>\n    div.logViewer {\n        min-height: 250px;\n        width: auto;\n        padding: 0;\n        background-color: white;\n        white-space: pre;\n    }\n</style>\n\n<div id=\"logViewer\" ng-bind=\"msg.payload\" contenteditable=\"false\">\n    {{msg.payload}}\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1840,"y":2580,"wires":[[]]},{"id":"971afb17.247658","type":"function","z":"7c56a241.1e88dc","name":"gate !pause && !restartSlideshow","func":"if (global.get('kodiPlayerStatus') === \"kodiPause\" && !global.get('restartSlideshowOnPause')){\n    global.set('restartOnKodiPlay', true);\n    \n} else {\n    global.set('restartOnKodiPlay', false);\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1300,"y":1980,"wires":[["dc11438c.48568"]]},{"id":"32ae0b10.cba1a4","type":"comment","z":"7c56a241.1e88dc","name":"Error handling","info":"","x":1030,"y":1720,"wires":[]},{"id":"620500ef.801cc","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Spiele Ton ab","tooltip":"","group":"c83c4c5e.03ddf","order":3,"width":12,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":540,"y":3320,"wires":[[]]},{"id":"eee130ec.fd1ff","type":"comment","z":"e00097c0.ad3088","name":"Power","info":"","x":150,"y":820,"wires":[]},{"id":"620a225.a1a7adc","type":"exec","z":"e00097c0.ad3088","command":"sudo reboot","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":670,"y":1040,"wires":[[],[],[]]},{"id":"e6b47c1d.0480e","type":"exec","z":"e00097c0.ad3088","command":"sudo poweroff","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":680,"y":940,"wires":[[],[],[]]},{"id":"3c258dba.262252","type":"ui_button","z":"e00097c0.ad3088","name":"","group":"69cbfcd5.4478f4","order":2,"width":6,"height":1,"passthru":false,"label":"Herunterfahren","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Wirklich herunterfahren?","payloadType":"str","topic":"","x":200,"y":900,"wires":[["b80d9bb0.bb4fd8"]]},{"id":"9a6b2c82.5af59","type":"ui_button","z":"e00097c0.ad3088","name":"","group":"69cbfcd5.4478f4","order":1,"width":6,"height":1,"passthru":false,"label":"Neu Starten","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Wirklich neu starten?","payloadType":"str","topic":"","x":190,"y":1020,"wires":[["6125e22.fbeca1c"]]},{"id":"17d385c0.63330a","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Anzeigedauer (in min.)","tooltip":"","group":"c83c4c5e.03ddf","order":2,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":"1","max":"50","step":1,"x":560,"y":3260,"wires":[["adbe2b90.cfee08"]]},{"id":"1b9062d5.31c72d","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"onScreenInfo","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1010,"y":3200,"wires":[[]]},{"id":"4272969d.207d08","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Info auf Bildschirm","tooltip":"","group":"c83c4c5e.03ddf","order":1,"width":12,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":550,"y":3200,"wires":[["1b9062d5.31c72d"]]},{"id":"6bc91c2b.049a44","type":"function","z":"5af1388b.ef9838","name":"min -> millisec","func":"msg.payload = msg.payload * 1000 * 60;\nglobal.set('onScreenInfoTime', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1080,"y":3260,"wires":[["f487f34c.aa417"]]},{"id":"1f9144a2.57693b","type":"function","z":"5af1388b.ef9838","name":"if restartOnKodiPlay","func":"if (global.get('restartOnKodiPlay') && msg.payload === \"kodiPlay\"){\n    global.set('restartOnKodiPlay', false);\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":760,"y":500,"wires":[["620371c7.3effe"]]},{"id":"f3491838.b5a378","type":"comment","z":"e00097c0.ad3088","name":"Colors","info":"","x":1210,"y":80,"wires":[]},{"id":"e1cb0159.03bf3","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":1290,"y":140,"wires":[["876dc52c.583c98"]]},{"id":"876dc52c.583c98","type":"function","z":"e00097c0.ad3088","name":"set colors","func":"global.set ('green', \"#4DA170\");\nglobal.set ('yellow', \"#c4b631\");\nglobal.set ('red', \"#EB7676\");\nglobal.set ('blue', \"#0DA1BF\");\nglobal.set ('lightgrey', \"#525252\");","outputs":1,"noerr":0,"x":1440,"y":140,"wires":[[]]},{"id":"66b583e0.7c2ecc","type":"comment","z":"dfa0e0a5.c8001","name":"Lösche Ordner","info":"","x":200,"y":3700,"wires":[]},{"id":"6a83edb3.fc3cb4","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1050,"y":3960,"wires":[[],[],[]]},{"id":"9e3aa130.d88a8","type":"function","z":"dfa0e0a5.c8001","name":"images-incoming","func":"msg.payload = \"rm \" + global.get('images-incoming') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":3860,"wires":[["6a83edb3.fc3cb4"]]},{"id":"26ef0caa.c7ccf4","type":"function","z":"dfa0e0a5.c8001","name":"images-preprocessing","func":"msg.payload = \"rm \" + global.get('images-preprocessing') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":3900,"wires":[["6a83edb3.fc3cb4"]]},{"id":"55b13cbe.3730c4","type":"function","z":"dfa0e0a5.c8001","name":"images-loop","func":"msg.payload = \"rm \" + global.get('images-loop') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":3940,"wires":[["6a83edb3.fc3cb4"]]},{"id":"3425b7de.269188","type":"function","z":"dfa0e0a5.c8001","name":"videos-incoming","func":"msg.payload = \"rm \" + global.get('videos-incoming') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":4040,"wires":[["6a83edb3.fc3cb4"]]},{"id":"39705c86.610aa4","type":"function","z":"dfa0e0a5.c8001","name":"videos-preprocessing","func":"msg.payload = \"rm \" + global.get('videos-preprocessing') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":4080,"wires":[["6a83edb3.fc3cb4"]]},{"id":"a7523f54.68531","type":"function","z":"dfa0e0a5.c8001","name":"videos-loop","func":"msg.payload = \"rm \" + global.get('videos-loop') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":4120,"wires":[["6a83edb3.fc3cb4"]]},{"id":"4de747ac.e574e8","type":"inject","z":"dfa0e0a5.c8001","name":"images","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":3820,"wires":[["18ccf7d5.67e628"]]},{"id":"9e48d1b3.a64c7","type":"inject","z":"dfa0e0a5.c8001","name":"incoming","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":400,"y":3860,"wires":[["9e3aa130.d88a8"]]},{"id":"37d41686.c6249a","type":"inject","z":"dfa0e0a5.c8001","name":"preprocessing","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":410,"y":3900,"wires":[["26ef0caa.c7ccf4"]]},{"id":"e73cda9d.5955f8","type":"inject","z":"dfa0e0a5.c8001","name":"loop","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":390,"y":3940,"wires":[["55b13cbe.3730c4"]]},{"id":"a64dc8b7.16b758","type":"inject","z":"dfa0e0a5.c8001","name":"incoming","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":400,"y":4040,"wires":[["3425b7de.269188"]]},{"id":"8b5e710.716cb9","type":"inject","z":"dfa0e0a5.c8001","name":"preprocessing","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":410,"y":4080,"wires":[["39705c86.610aa4"]]},{"id":"a6b6a610.f706f8","type":"inject","z":"dfa0e0a5.c8001","name":"loop","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":390,"y":4120,"wires":[["a7523f54.68531"]]},{"id":"ecb98085.8873e","type":"inject","z":"dfa0e0a5.c8001","name":"videos","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":4000,"wires":[["f9a57e9a.d198f"]]},{"id":"7590c4a8.565e5c","type":"comment","z":"5af1388b.ef9838","name":"Player Control","info":"","x":1450,"y":80,"wires":[]},{"id":"b4807c19.dfde6","type":"link in","z":"5af1388b.ef9838","name":"Playlist.Clear","links":[],"x":1815,"y":400,"wires":[["aa8f2459.3432d8"]]},{"id":"a7ce1b23.58e018","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Stop","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":860,"wires":[["6eb6fb45.cfdac4"]]},{"id":"bb086a54.b87bd8","type":"function","z":"5af1388b.ef9838","name":"throw out elements","func":"if (flow.get('arrayImagesLoopId') === msg.loopId){\n    \n    var i = msg.index;\n    var array = global.get('arrayImages');\n    var twoSlotFlag = context.get('twoSlotFlag', 'mem') || false;\n    var textActive = global.get('textActive') || false;\n    var msgRes = {reset: \"reset\"};\n    \n    // if trashFlag -> inkrement\n    while (array[i].trashFlag){\n        \n        if (i === array.length-1){\n            i = 0;\n        } else {\n            i++;\n        }\n        if (i === msg.indexStart){\n            context.set('twoSlotFlag', false);\n            return msgRes;\n        }    \n    }\n    \n    // set Slot-flag\n    if (array[i].textFlag && textActive && !twoSlotFlag){\n        twoSlotFlag = true;\n    } else {\n        twoSlotFlag = false;\n    }\n    context.set('twoSlotFlag', twoSlotFlag, 'mem');\n    \n    // Ausgeben an der Stelle index\n    if (twoSlotFlag){\n        array[i].playlistPosText = msg.playlistPos;\n        msg.payload = global.get('images-loop') + array[i].filenameText;\n    \n    } else {\n        array[i].playlistPosPic = msg.playlistPos;\n        msg.payload = global.get('images-loop') + array[i].filenamePic;\n    }\n    \n    // index inkrementieren wenn nur ein slot\n    if (!twoSlotFlag){\n        if (i === array.length-1){\n            msg.index = 0;\n        } else {\n            msg.index = i + 1;\n        }\n        if (msg.indexStart === msg.index){\n            msg.reset = \"reset\";\n        }\n    }\n    \n    // stelle delays ein je nach aktueller Playlist Postiton\n    if (msg.playlistPos === 0){\n        msg.delay= 300;\n    }\n    if (msg.playlistPos === 1){\n        msg.delay= 900;\n    }\n    \n    // erhöhe Playlist Postiton\n    msg.playlistPos = msg.playlistPos +1;\n\n    return msg;\n}","outputs":1,"noerr":0,"x":2550,"y":200,"wires":[["614af351.1651cc","807d48e.4b80db8","6e18904b.3731"]]},{"id":"d19786c6.643a08","type":"function","z":"5af1388b.ef9838","name":"start loop","func":"var array = global.get('arrayImages');\nvar indexStart = parseInt(msg.index);\nif (indexStart >= 0){} else {indexStart = 0;}\n\nif (indexStart < array.length){\n\n    // springe x elemente zurück -> reduziere index um x\n    // überspringe trashFlag\n    \n    // setze Anzahl Schritte zurück\n    var backStep = 2;\n    \n    var j = backStep;\n    var i = indexStart;\n\n    while (j > 0){\n        \n        // array index -1\n        if (i <= 0){\n            i = array.length - 1;\n        } else {\n            i--;\n        }\n        // stoppe, wenn einmal komplett durchlaufen\n        if (i === indexStart){\n            break;\n        }\n        // wenn kein Trash -> zähle\n        if (!array[i].trashFlag){\n            j--;\n        }\n    }\n    // wenn neues Element gefunden wurde, übergebe neuen Index an indexStart\n    if (backStep > j){\n        indexStart = i;\n        \n        // Setze neue Startosition für Kodi-Playlist\n        flow.set('playlistPosStart', (backStep - j), 'mem');\n    } else {\n        flow.set('playlistPosStart', 0, 'mem');    // sollte kein Element gefunden worden sein, setzte Start auf 0\n    }\n    \n    // Zähler für Schleife initalisieren\n    var index = indexStart;\n    var playlistPos = 0;\n    \n    // assign LoopId to make sure just one loop is running\n    var loopId = flow.get('arrayImagesLoopId') || 0;\n    loopId++;\n    if (loopId === 100){\n        loopId = 0;\n    }\n    flow.set('arrayImagesLoopId', loopId);\n    \n    // ausgeben\n    return {index, indexStart, loopId, playlistPos};\n\n}\n\n","outputs":1,"noerr":0,"x":1840,"y":200,"wires":[["bbd5709b.4a53b"]]},{"id":"614af351.1651cc","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"800","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2550,"y":140,"wires":[["bb086a54.b87bd8"]]},{"id":"4e854f6.a31ecb","type":"function","z":"5af1388b.ef9838","name":"reset","func":"msg.reset = \"reset\";\nreturn msg;\n","outputs":1,"noerr":0,"x":2310,"y":100,"wires":[["614af351.1651cc","51a2c83.e7a1c38","839c9774.ce9878"]]},{"id":"c1790d87.1e131","type":"link in","z":"5af1388b.ef9838","name":"","links":["de98e67.3745118"],"x":155,"y":3560,"wires":[["413ecc2f.d1b544"]]},{"id":"de98e67.3745118","type":"link out","z":"5af1388b.ef9838","name":"Kodi out","links":["199c506a.499d1","c1790d87.1e131","686d5e.720612a4"],"x":155,"y":160,"wires":[]},{"id":"199c506a.499d1","type":"link in","z":"5af1388b.ef9838","name":"","links":["de98e67.3745118"],"x":115,"y":300,"wires":[["cbdf7fed.a48c1","daf3cda0.83941","610523e1.b745ac"]]},{"id":"868cd190.6585a","type":"link out","z":"5af1388b.ef9838","name":"","links":["902bfa2c.7ce158"],"x":515,"y":720,"wires":[]},{"id":"21c3e5f9.6f75da","type":"link out","z":"5af1388b.ef9838","name":"","links":["f4cce95d.56b828"],"x":515,"y":780,"wires":[]},{"id":"62faac09.68dee4","type":"link out","z":"5af1388b.ef9838","name":"","links":["eb78734a.657a7"],"x":815,"y":720,"wires":[]},{"id":"a7a8c7d1.937c78","type":"link out","z":"5af1388b.ef9838","name":"","links":["2208e8fb.66fdc8"],"x":815,"y":760,"wires":[]},{"id":"42220cc2.75ff74","type":"link in","z":"5af1388b.ef9838","name":"reset create playlist","links":["e0ee1701.429a18","d731bb2a.1f4028"],"x":2155,"y":120,"wires":[["4e854f6.a31ecb"]]},{"id":"e0ee1701.429a18","type":"link out","z":"5af1388b.ef9838","name":"","links":["42220cc2.75ff74"],"x":1755,"y":860,"wires":[]},{"id":"620371c7.3effe","type":"link out","z":"5af1388b.ef9838","name":"","links":["92da4955.9fdbf8"],"x":915,"y":500,"wires":[]},{"id":"6df57dbf.8b24e4","type":"link out","z":"5af1388b.ef9838","name":"","links":["cd187329.675f9"],"x":515,"y":840,"wires":[]},{"id":"79278d76.f3b9e4","type":"comment","z":"5af1388b.ef9838","name":"Kodi settings","info":"","x":1630,"y":1560,"wires":[]},{"id":"5f47212b.83b2a","type":"link out","z":"5af1388b.ef9838","name":"","links":["4735cc75.25aa54"],"x":855,"y":2780,"wires":[]},{"id":"4735cc75.25aa54","type":"link in","z":"5af1388b.ef9838","name":"slideshow.staytime","links":["5f47212b.83b2a","f487f34c.aa417"],"x":1315,"y":1640,"wires":[["99bf7b1a.41e4f8"]]},{"id":"9f55bb60.063888","type":"link out","z":"5af1388b.ef9838","name":"","links":["d9a48616.4bb068"],"x":855,"y":440,"wires":[]},{"id":"d9a48616.4bb068","type":"link in","z":"5af1388b.ef9838","name":"","links":["9f55bb60.063888"],"x":75,"y":1160,"wires":[["bf63c1dd.c767b","4b692df3.f4f474"]]},{"id":"becb6073.b5164","type":"comment","z":"5af1388b.ef9838","name":"Player.Open (directory) [topic:index]","info":"","x":1560,"y":120,"wires":[]},{"id":"22757c1.e629b84","type":"rbe","z":"5af1388b.ef9838","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":750,"y":2880,"wires":[["f34c1177.b2b79","ae5cde94.c7306"]]},{"id":"9030aab4.b3cae8","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":290,"y":260,"wires":[["448d0e97.8e5ff","4108f15b.bdb3"]]},{"id":"69993e6f.1cf93","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":580,"wires":[["3d7a77a3.b7a3c8","d5c3cb4b.1bbe28"]]},{"id":"7021d9f3.a489a8","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":940,"wires":[["779c625.b0a5e9c","c6fef062.0c30d"]]},{"id":"206db579.1cf32a","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":390,"y":1120,"wires":[["d996463d.31d538","75383c5b.0dd894"]]},{"id":"ed6040e4.f77e3","type":"rbe","z":"e00097c0.ad3088","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":490,"y":260,"wires":[["1d8775e4.7c3f0a","eb647660.fdf8f8"]]},{"id":"37d37cd6.cb3ca4","type":"function","z":"5af1388b.ef9838","name":"start on current index","func":"msg.topic = flow.get('currentImagePlayerIndex');\nif (msg.index >= global.get('arrayImages').length){\n    msg.index = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1600,"y":320,"wires":[["444b6d47.818b94"]]},{"id":"e564f0b2.c7ba2","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"4000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1860,"y":300,"wires":[["5b173a11.dc2234"]]},{"id":"444b6d47.818b94","type":"function","z":"5af1388b.ef9838","name":"restore player status","func":"if (global.get('kodiPlayerStatus') === \"kodiPlay\"){\n    return [msg, null];\n} else if (global.get('kodiPlayerStatus') === \"kodiPause\"){\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":1600,"y":260,"wires":[["442ce2f1.aae81c","90b8f088.745ed"],["e564f0b2.c7ba2"]]},{"id":"33ada742.0d0c78","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"79173158.54b5a","order":3,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":130,"y":2960,"wires":[["2684e7ee.44e3a8"]]},{"id":"23d083bb.c331fc","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"79173158.54b5a","order":4,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":130,"y":3000,"wires":[["2684e7ee.44e3a8"]]},{"id":"ddadab17.b39448","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"79173158.54b5a","order":7,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":130,"y":3100,"wires":[["4ec80947.9567b8"]]},{"id":"4232c821.e5aba8","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"79173158.54b5a","order":6,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":130,"y":3060,"wires":[["4ec80947.9567b8"]]},{"id":"2684e7ee.44e3a8","type":"function","z":"5af1388b.ef9838","name":"set value","func":"if(msg.payload === \"l\"){\n    msg.payload = (global.get('loopMax') || 1) - 1;\n    if (msg.payload < 1){\n        msg.payload = 1;\n    }\n} else {\n    msg.payload = (global.get('loopMax') || 1) + 1;\n    if (msg.payload > 999){\n        msg.payload = 999;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2980,"wires":[["3c457ef9.347f12"]]},{"id":"4ec80947.9567b8","type":"function","z":"5af1388b.ef9838","name":"set value","func":"if(msg.payload === \"l\"){\n    msg.payload = (global.get('trashMax') || 1) - 1;\n    if (msg.payload < 1){\n        msg.payload = 1;\n    }\n} else {\n    msg.payload = (global.get('trashMax') || 1) + 1;\n    if (msg.payload > 999){\n        msg.payload = 999;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":3080,"wires":[["1bc5e035.452d1"]]},{"id":"80c27756.dc37a8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1040,"y":480,"wires":[["425c5a.673893a8"],[]]},{"id":"425c5a.673893a8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1155,"y":500,"wires":[]},{"id":"504b0d03.1c2514","type":"function","z":"7c56a241.1e88dc","name":"move to folders","func":"var cmd = \"\";\n\nvar imagepath = global.get('images-preprocessing');\nvar loop = global.get('images-loop');\n\nif (msg.topic === \"textTruePic\" || msg.topic === \"textFalsePic\"){\n    \n    // move pic to loop\n    cmd = cmd + \"mv \" + imagepath + msg.image.filenamePic + \" \" + loop + msg.image.filenamePic + \" && \";\n    cmd = cmd + \"mv \" + imagepath + msg.image.filenamePicDash + \" \" + loop + msg.image.filenamePicDash + \" && \";\n    cmd = cmd + \"mv \" + imagepath + msg.image.filenamePicThumb + \" \" + loop + msg.image.filenamePicThumb;\n}\n\nif (msg.topic === \"textTrueText\"){\n    \n    // move addText to loop\n    cmd = cmd + \"mv \" + imagepath + msg.image.filenameText + \" \" + loop + msg.image.filenameText + \" && \";\n    cmd = cmd + \"mv \" + imagepath + msg.image.filenameTextDash + \" \" + loop + msg.image.filenameTextDash + \" && \";\n    cmd = cmd + \"mv \" + imagepath + msg.image.filenameTextThumb + \" \" + loop + msg.image.filenameTextThumb;\n}\n\nmsg.payload = cmd;\n\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":1800,"wires":[["a600866c.e8f348"]]},{"id":"a600866c.e8f348","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":450,"y":1800,"wires":[[],[],["c2e79f5.bee4a6"]]},{"id":"c2e79f5.bee4a6","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":600,"y":1800,"wires":[["ce0076c8.8fb808"],["23a08705.fbb988"]]},{"id":"ce0076c8.8fb808","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":755,"y":1780,"wires":[]},{"id":"4f87b31c.04324c","type":"comment","z":"7c56a241.1e88dc","name":"move files to loop","info":"","x":270,"y":1760,"wires":[]},{"id":"6fc7188d.772e58","type":"link in","z":"5af1388b.ef9838","name":"start on current index","links":["e27f5805.51bfb8","ae5cde94.c7306","e1f2705d.dcf9c","f42d47dd.c226b8"],"x":1415,"y":320,"wires":[["37d37cd6.cb3ca4"]]},{"id":"ae5cde94.c7306","type":"link out","z":"5af1388b.ef9838","name":"","links":["6fc7188d.772e58"],"x":855,"y":2860,"wires":[]},{"id":"d66bb54a.5ceb38","type":"link in","z":"5af1388b.ef9838","name":"restore player status","links":["bf2a065e.2545f8","f92cc322.9e0af"],"x":1415,"y":260,"wires":[["444b6d47.818b94"]]},{"id":"70ef066c.7f85b8","type":"inject","z":"5af1388b.ef9838","name":"tmp","topic":"","payload":"/home/pi/media/telegram/images/tmp","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":680,"wires":[["883c1b70.676b08"]]},{"id":"a4803a5a.33ccf8","type":"comment","z":"dfa0e0a5.c8001","name":"vnc","info":"","x":110,"y":720,"wires":[]},{"id":"33bef5f6.dc20ba","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"vnc","tooltip":"","group":"29050d2.fa3cef2","order":4,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":760,"wires":[["79d71622.df8908"]]},{"id":"4a975688.aadec8","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":550,"y":760,"wires":[["7e149c0e.fbf354"],["16ef0e45.c2ce12"]]},{"id":"7e149c0e.fbf354","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start vncserver-x11-serviced","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":850,"y":740,"wires":[[],[],[]]},{"id":"16ef0e45.c2ce12","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop vncserver-x11-serviced","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":850,"y":800,"wires":[[],[],[]]},{"id":"79d71622.df8908","type":"rbe","z":"dfa0e0a5.c8001","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":760,"wires":[["4a975688.aadec8","fe5c44fe.dd4d58"]]},{"id":"98d6148b.a85dc8","type":"function","z":"7c56a241.1e88dc","name":"clear incoming folder + extract weblink","func":"var weblink = msg.payload.weblink;\nvar payload = \"rm \" + global.get('images-incoming') + \"*\";\nreturn {weblink, payload};","outputs":1,"noerr":0,"x":670,"y":1140,"wires":[["5b524e22.21b55"]]},{"id":"5b524e22.21b55","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":890,"y":1140,"wires":[[],[],["6daa7f30.d2cf"]]},{"id":"daf3cda0.83941","type":"function","z":"5af1388b.ef9838","name":"if AudioLibrary.OnScanStarted (touchscreen 1p longpress)","func":"if (msg.payload.method === \"AudioLibrary.OnScanStarted\"){\n    msg.restoreStatus = true;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":570,"y":340,"wires":[["d462771d.909b28","4784ec03.8580f4","42fa4686.b84728"]]},{"id":"d462771d.909b28","type":"link out","z":"5af1388b.ef9838","name":"","links":["6a49db86.c09794"],"x":835,"y":340,"wires":[]},{"id":"ed60d745.d96398","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"videoConvertFlag","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":4760,"wires":[[]]},{"id":"26a4a22.d68375e","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Eingehende Videos konvertieren (nur aktivieren, wenn nicht abspielbar)","tooltip":"","group":"d021848d.7c9d58","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":650,"y":4760,"wires":[["ed60d745.d96398"]]},{"id":"7a0eca03.f653c4","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":3820,"wires":[["21fd1787.3c13b8"]]},{"id":"21fd1787.3c13b8","type":"function","z":"5af1388b.ef9838","name":"flash control","func":"if(context.get('flash') || false){\n    msg.payload = \"#eb4034\"; // red\n    context.set('flash', false);\n    return msg;\n} else {\n    msg.payload = \"\"; // default\n    context.set('flash', true);\n    return msg;    \n}\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":3780,"wires":[["7a0eca03.f653c4","2e1296c7.66d7ca"]]},{"id":"228c29b0.337986","type":"function","z":"5af1388b.ef9838","name":"reset","func":"msg.reset = \"reset\";\nreturn msg;\n","outputs":1,"noerr":0,"x":610,"y":3820,"wires":[["7a0eca03.f653c4"]]},{"id":"657f76bb.cb5818","type":"function","z":"5af1388b.ef9838","name":"if 3599","func":"if (msg.payload === 3599){\n    msg.payload = \"#eb4034\"; // red\n    return msg;\n}\n","outputs":1,"noerr":0,"x":510,"y":3740,"wires":[["228c29b0.337986","2e1296c7.66d7ca"]]},{"id":"6d7d0a2.6372cf4","type":"comment","z":"5af1388b.ef9838","name":"Image Browser","info":"","x":160,"y":1440,"wires":[]},{"id":"3ff40bed.cfb384","type":"file in","z":"5af1388b.ef9838","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":350,"y":1680,"wires":[["2583c1d0.682aae"]]},{"id":"fdb17c00.30fd","type":"comment","z":"5af1388b.ef9838","name":"Browser Dashboard Preview","info":"","x":260,"y":1620,"wires":[]},{"id":"2583c1d0.682aae","type":"base64","z":"5af1388b.ef9838","name":"","action":"str","property":"payload","x":480,"y":1680,"wires":[["e313de76.5f0b7"]]},{"id":"e313de76.5f0b7","type":"ui_template","z":"5af1388b.ef9838","group":"6716ccf6.78cf14","name":"","order":2,"width":12,"height":4,"format":"<img width=\"100%\" height=\"100%\" alt=\"\" src=\"data:image/jpg;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":640,"y":1680,"wires":[[]]},{"id":"c9c74455.4e4708","type":"ui_table","z":"5af1388b.ef9838","group":"6716ccf6.78cf14","name":"","order":6,"width":12,"height":8,"columns":[{"field":"id","title":"ID","width":"15","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"pic","title":"Bild","width":"115","align":"center","formatter":"image","formatterParams":{"target":"_blank"}},{"field":"text","title":"Nachricht","width":"99","align":"left","formatter":"html","formatterParams":{"target":"_blank"}},{"field":"user","title":"Absender","width":"75","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":750,"y":1539,"wires":[["5ff58153.be0cd","196c4ee7.7bea51"]]},{"id":"112dd516.a920bb","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":180,"y":1500,"wires":[["c2a73585.184f78"]]},{"id":"c2a73585.184f78","type":"function","z":"5af1388b.ef9838","name":"prepare fs-array for table ","func":"var fileList = [];\n\nvar pic;\nvar text;\nvar user;\nvar id;\n\nvar array = global.get('arrayImages');\n\nvar domain = global.get('domain');\nif (domain.slice(-1) !== \"/\"){\n    domain = domain + \"/\";\n}\n\nvar j = 0;\nfor (var i=0; i < array.length; i++) {\n    \n    if (!array[i].trashFlag){\n        \n        id = array[i].fileId;\n        user = array[i].user;\n        pic = \"http://\" + domain + \"telegram/images/03.loop/\" + array[i].filenamePicThumb;\n        \n        if (array[i].textFlag){\n            text = \"<small>\" + array[i].text + \"</small>\";\n        } else {\n            text = \"\";\n        }\n        fileList[j] = {id, pic, text, user};\n        j++;        \n    }\n}\n\nmsg.payload = fileList;\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1540,"wires":[["9f38cce1.b5138"]]},{"id":"5ff58153.be0cd","type":"function","z":"5af1388b.ef9838","name":"get file","func":"var file;\n\nif (msg.topic === \"text\" && msg.payload.text !== \"\"){\n    file = msg.payload.id + \".text.dash.jpg\";\n\n} else {\n    file = msg.payload.id + \".pic.dash.jpg\";\n}\n\nvar filename = global.get('images-loop') + file;\n\nreturn {filename};","outputs":1,"noerr":0,"x":210,"y":1680,"wires":[["3ff40bed.cfb384"]]},{"id":"e83976b.93a6d88","type":"ui_button","z":"5af1388b.ef9838","name":"","group":"6716ccf6.78cf14","order":3,"width":8,"height":1,"passthru":false,"label":" Von hier starten","tooltip":"","color":"","bgcolor":"","icon":"fa-play","payload":"Wirklich wiederherstellen?","payloadType":"str","topic":"","x":220,"y":2000,"wires":[["d49dfd93.4345e"]]},{"id":"bcab2a6b.397428","type":"ui_text","z":"5af1388b.ef9838","group":"6716ccf6.78cf14","order":1,"width":12,"height":1,"name":"","label":"","format":"{{msg.payload}}","layout":"row-right","x":630,"y":1740,"wires":[]},{"id":"196c4ee7.7bea51","type":"function","z":"5af1388b.ef9838","name":"get fileId","func":"msg.payload = msg.payload.id;\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":1740,"wires":[["eded25a2.f69158","29dd9e83.ffdb92"]]},{"id":"eded25a2.f69158","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"currentBrowserFileId","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1780,"wires":[["19e4855d.8a60bb"]]},{"id":"4e160b83.17c294","type":"function","z":"7c56a241.1e88dc","name":"control qgate + incr qgateBuffer","func":"var qgateBuffer = flow.get('qgateBufferImages') || 0;\n\nif (qgateBuffer === 0){\n    \n    var msgC = { payload: \"trigger\",\n                 topic: \"control\"\n    }\n    \n    qgateBuffer = qgateBuffer + 1;\n    flow.set('qgateBufferImages', qgateBuffer);\n    \n    return [[msg, msgC]];\n\n} else {\n    qgateBuffer = qgateBuffer + 1;\n    flow.set('qgateBufferImages', qgateBuffer);\n    \n    return msg;\n}\n\n\n\n","outputs":1,"noerr":0,"x":250,"y":960,"wires":[["7579cd34.da5794"]]},{"id":"91ab1713.418f88","type":"function","z":"7c56a241.1e88dc","name":"dekr qgateBuffer","func":"var qgateBuffer = flow.get('qgateBufferImages') || 0;\nqgateBuffer--;\nflow.set('qgateBufferImages', qgateBuffer);\n\nreturn msg;","outputs":1,"noerr":0,"x":1250,"y":1880,"wires":[[]]},{"id":"2efa3db1.b53b02","type":"function","z":"7c56a241.1e88dc","name":"control qgate + incr qgateBuffer","func":"var qgateBuffer = flow.get('qgateBufferVideos') || 0;\n\nif (qgateBuffer === 0){\n    \n    var msgC = { payload: \"trigger\",\n                 topic: \"control\"\n    }\n    \n    qgateBuffer = qgateBuffer + 1;\n    flow.set('qgateBufferVideos', qgateBuffer);\n    \n    return [[msg, msgC]];\n\n} else {\n    qgateBuffer = qgateBuffer + 1;\n    flow.set('qgateBufferVideos', qgateBuffer);\n    \n    return msg;\n}\n\n\n\n","outputs":1,"noerr":0,"x":890,"y":220,"wires":[["f2f6a38.3e3456"]]},{"id":"d53f797b.347198","type":"function","z":"7c56a241.1e88dc","name":"dekr qgateBuffer","func":"var qgateBuffer = flow.get('qgateBufferVideos') || 0;\nqgateBuffer--;\nflow.set('qgateBufferVideos', qgateBuffer);\n\nreturn msg;","outputs":1,"noerr":0,"x":2250,"y":600,"wires":[[]]},{"id":"8a993ebd.32626","type":"link out","z":"7c56a241.1e88dc","name":"","links":["5e85c279.d9f46c"],"x":2375,"y":560,"wires":[]},{"id":"6b1fc388.85afac","type":"function","z":"7c56a241.1e88dc","name":"busy = false","func":"msg.payload = false;\nreturn msg;","outputs":1,"noerr":0,"x":2270,"y":560,"wires":[["8a993ebd.32626"]]},{"id":"498371e2.d576d","type":"comment","z":"e00097c0.ad3088","name":"Wifi","info":"","x":150,"y":1580,"wires":[]},{"id":"3f8e28b3.1245d8","type":"function","z":"7c56a241.1e88dc","name":"if finished successfull","func":"if (msg.topic === \"textTrueText\" || msg.topic === \"textFalsePic\"){\n    return msg;\n}","outputs":1,"noerr":0,"x":940,"y":1940,"wires":[["971afb17.247658","abd4ce3.6fb663","571e5a0d.8510f4","fd75240b.e493f8","8b397f84.e77f4","d184c84f.6b9258"]]},{"id":"4e6cccb1.b71404","type":"function","z":"7c56a241.1e88dc","name":"clear folders","func":"msg.payload = \"sudo rm -rf \" + global.get('images-incoming') + \"* && rm -rf \" + global.get('images-preprocessing') + \"*\";\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1270,"y":1740,"wires":[["c83370c8.48945"]]},{"id":"829a6121.9e9b3","type":"wifiscan","z":"e00097c0.ad3088","name":"","x":350,"y":1660,"wires":[["67a9330b.60c60c"]]},{"id":"2ad140bf.b498","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":1720,"wires":[["829a6121.9e9b3"]]},{"id":"67a9330b.60c60c","type":"ui_table","z":"e00097c0.ad3088","group":"fa734fb9.fe5ec","name":"","order":3,"width":"12","height":3,"columns":[{"field":"signal_level","title":"S","width":"13%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"ssid","title":"SSID","width":"47%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"mac","title":"Mac-Addr.","width":"40%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":490,"y":1660,"wires":[["b96408ac.ff8c08"]]},{"id":"5ad71a79.0e9874","type":"ui_text_input","z":"e00097c0.ad3088","name":"","label":"SSID","tooltip":"","group":"efb43289.68929","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"","x":770,"y":1660,"wires":[["dce96d47.1a946"]]},{"id":"a9dcd044.57fed","type":"ui_text_input","z":"e00097c0.ad3088","name":"","label":"Passwort (WPA2)","tooltip":"","group":"efb43289.68929","order":2,"width":0,"height":0,"passthru":false,"mode":"text","delay":"0","topic":"","x":810,"y":1700,"wires":[["2d03b208.06c82e","4c01d487.6885ac"]]},{"id":"b96408ac.ff8c08","type":"function","z":"e00097c0.ad3088","name":"get ssid","func":"msg.payload = msg.payload.ssid\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":1660,"wires":[["5ad71a79.0e9874"]]},{"id":"3a5a4b8.fbf83b4","type":"ui_button","z":"e00097c0.ad3088","name":"","group":"efb43289.68929","order":3,"width":12,"height":1,"passthru":false,"label":"speichern","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":800,"y":1820,"wires":[["f41d53.a437f2b"]]},{"id":"2d03b208.06c82e","type":"function","z":"e00097c0.ad3088","name":"hide text","func":"var x = msg.payload.length;\nmsg.payload = \"\";\n\nfor (var i=0; i<x; i++){\n    msg.payload = msg.payload + \"*\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":1760,"wires":[["a9dcd044.57fed"]]},{"id":"f41d53.a437f2b","type":"function","z":"e00097c0.ad3088","name":"gen wpa Passhrase","func":"msg.payload = \"wpa_passphrase \" + flow.get('wifiSsid') + \" \" + flow.get('wifiPass');\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":1820,"wires":[["28ccd973.a33c66"]]},{"id":"dce96d47.1a946","type":"change","z":"e00097c0.ad3088","name":"","rules":[{"t":"set","p":"wifiSsid","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":1660,"wires":[[]]},{"id":"4c01d487.6885ac","type":"change","z":"e00097c0.ad3088","name":"","rules":[{"t":"set","p":"wifiPass","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":1700,"wires":[[]]},{"id":"28ccd973.a33c66","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1190,"y":1820,"wires":[["31d2a62.f9c685a"],[],[]]},{"id":"b31c52a3.e4953","type":"change","z":"e00097c0.ad3088","name":"","rules":[{"t":"set","p":"wifiPhrase","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1850,"y":1840,"wires":[[]]},{"id":"31d2a62.f9c685a","type":"function","z":"e00097c0.ad3088","name":"generate user feedback","func":"if(msg.rc.code === 0){\n    \n    var msg2 = {payload: msg.payload};\n    msg.payload = \"Wifi Zugangsdaten erfolgreich eingetragen. Versuche mit neuem Access-Point zu verbinden.\";\n    return [msg, msg2];\n\n} else {\n    return [msg, null];\n}\n\n","outputs":2,"noerr":0,"x":1390,"y":1820,"wires":[["4f57f4a3.c53f0c"],["9f2bfca4.365fe"]]},{"id":"4f57f4a3.c53f0c","type":"ui_toast","z":"e00097c0.ad3088","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1610,"y":1780,"wires":[[]]},{"id":"9f2bfca4.365fe","type":"function","z":"e00097c0.ad3088","name":"extract psk","func":"msg.payload = msg.payload.slice(msg.payload.lastIndexOf(\"psk=\")+4, msg.payload.lastIndexOf(\"}\"));\nreturn msg;","outputs":1,"noerr":0,"x":1610,"y":1840,"wires":[["b31c52a3.e4953","9632a594.b5b8b8","829a82e2.9db1a"]]},{"id":"9632a594.b5b8b8","type":"change","z":"e00097c0.ad3088","name":"set flow.wifiPass = empty","rules":[{"t":"set","p":"wifiPass","pt":"flow","to":"empty","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1870,"y":1800,"wires":[[]]},{"id":"c955e023.c4b39","type":"file in","z":"e00097c0.ad3088","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":1010,"y":1960,"wires":[["c68425cd.c7ffa8"]]},{"id":"1896682a.418d28","type":"function","z":"e00097c0.ad3088","name":"set file","func":"msg.filename = \"/etc/network/interfaces.nr.client\";\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":1960,"wires":[["c955e023.c4b39"]]},{"id":"aae98cc6.657ce","type":"function","z":"e00097c0.ad3088","name":"set file","func":"msg.filename = \"/etc/network/interfaces.nr.client\";\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":1960,"wires":[["d95baf0e.15aed"]]},{"id":"d95baf0e.15aed","type":"file","z":"e00097c0.ad3088","name":"","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"true","encoding":"none","x":1550,"y":1960,"wires":[["3c834287.096fde"]]},{"id":"c68425cd.c7ffa8","type":"function","z":"e00097c0.ad3088","name":"replace wpa credentials","func":"msg.payload = msg.payload.slice(0, msg.payload.lastIndexOf(\"wpa-ssid\")+8) + \" \\\"\" + flow.get('wifiSsid') + \"\\\"\\n\\twpa-psk \" + flow.get('wifiPhrase');\nreturn msg;","outputs":1,"noerr":0,"x":1210,"y":1960,"wires":[["aae98cc6.657ce"]]},{"id":"5e9aca13.c099a4","type":"comment","z":"e00097c0.ad3088","name":"replace wpa credentials","info":"","x":1200,"y":1920,"wires":[]},{"id":"6c567f1f.f4b42","type":"ui_button","z":"e00097c0.ad3088","name":"","group":"fa734fb9.fe5ec","order":1,"width":"12","height":1,"passthru":false,"label":"aktualisieren","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1660,"wires":[["829a6121.9e9b3"]]},{"id":"71eccaf3.161774","type":"comment","z":"e00097c0.ad3088","name":"ddns (freedns.afraid.org)","info":"","x":210,"y":1180,"wires":[]},{"id":"262a3347.5375fc","type":"http request","z":"e00097c0.ad3088","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":550,"y":1260,"wires":[["9189d18d.0c7dd","701fd117.9dcde","f9f22923.5381e8"]]},{"id":"9189d18d.0c7dd","type":"debug","z":"e00097c0.ad3088","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":910,"y":1240,"wires":[]},{"id":"3f46df12.8b857","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"600","crontab":"","once":true,"onceDelay":0.1,"x":200,"y":1260,"wires":[["e4b01711.0eb648"]]},{"id":"536ec725.4d5598","type":"ui_text_input","z":"e00097c0.ad3088","name":"","label":"Update-URL","tooltip":"Ordnerpfad","group":"e4f17352.69409","order":2,"width":0,"height":0,"passthru":true,"mode":"text","delay":"100","topic":"","x":350,"y":1400,"wires":[["c4f5667f.895c38"]]},{"id":"c4f5667f.895c38","type":"change","z":"e00097c0.ad3088","name":"","rules":[{"t":"set","p":"freedns","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1400,"wires":[[]]},{"id":"e4b01711.0eb648","type":"function","z":"e00097c0.ad3088","name":"set url","func":"var url = flow.get('freedns') || \"https://freedns.afraid.org/dynamic/update.php?cUlQenlDY3BDcWxzclgycGoyQXc5eHg0OjE5MDYzMTA5\";\nmsg = {url};\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1260,"wires":[["262a3347.5375fc"]]},{"id":"9e21e57d.2ae628","type":"comment","z":"e00097c0.ad3088","name":"frankabilderrahmentmp.mooo.com","info":"","x":600,"y":1220,"wires":[]},{"id":"5a324441.ece43c","type":"ui_button","z":"e00097c0.ad3088","name":"","group":"e4f17352.69409","order":3,"width":0,"height":0,"passthru":false,"label":"Update","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":340,"y":1340,"wires":[["e4b01711.0eb648","10ec70b9.e1049f"]]},{"id":"2436afd4.10e09","type":"ui_text_input","z":"e00097c0.ad3088","name":"","label":"Domain","tooltip":"Ordnerpfad","group":"e4f17352.69409","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":"100","topic":"","x":340,"y":1440,"wires":[["594cca5e.657da4"]]},{"id":"594cca5e.657da4","type":"change","z":"e00097c0.ad3088","name":"","rules":[{"t":"set","p":"domainDdns","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":1440,"wires":[[]]},{"id":"56323baf.821714","type":"comment","z":"e00097c0.ad3088","name":"activate hotspot","info":"","x":360,"y":2380,"wires":[]},{"id":"fec0f541.099ce8","type":"function","z":"e00097c0.ad3088","name":"start dnsmasq","func":"msg.payload = \"sudo systemctl start dnsmasq\";\nreturn msg;","outputs":1,"noerr":0,"x":1440,"y":2480,"wires":[["4f1bbc82.152994"]]},{"id":"4f1bbc82.152994","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1590,"y":2480,"wires":[[],[],[]]},{"id":"a1e132e2.44883","type":"function","z":"e00097c0.ad3088","name":"start hostapd","func":"msg.payload = \"sudo /usr/sbin/hostapd /etc/hostapd/hostapd.conf\";\nreturn msg;","outputs":1,"noerr":0,"x":1450,"y":2400,"wires":[["e5484309.c4c69"]]},{"id":"e5484309.c4c69","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1590,"y":2400,"wires":[[],[],[]]},{"id":"289d29f7.d76636","type":"function","z":"e00097c0.ad3088","name":"cp interfaces.nr.hotspot","func":"msg.payload = \"sudo cp /etc/network/interfaces.nr.hotspot /etc/network/interfaces\";\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":2440,"wires":[["61f2abf9.5b71a4"]]},{"id":"61f2abf9.5b71a4","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":550,"y":2440,"wires":[[],[],["ce23d949.d0a388"]]},{"id":"f264cb22.b8e5f8","type":"comment","z":"e00097c0.ad3088","name":"activate client / new credentials","info":"","x":390,"y":2040,"wires":[]},{"id":"69eb5f91.68b66","type":"function","z":"e00097c0.ad3088","name":"sudo ifdown wlan0","func":"msg.payload = \"sudo ifdown wlan0\";\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":2100,"wires":[["25d1da12.c94576"]]},{"id":"25d1da12.c94576","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1250,"y":2100,"wires":[[],[],["22c466de.dac62a"]]},{"id":"22c466de.dac62a","type":"function","z":"e00097c0.ad3088","name":"sudo ifup wlan0","func":"msg.payload = \"sudo ifup wlan0\";\nreturn msg;","outputs":1,"noerr":0,"x":1420,"y":2100,"wires":[["71d3aeee.1a4f9"]]},{"id":"71d3aeee.1a4f9","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1570,"y":2100,"wires":[[],[],["b85be261.b0aa"]]},{"id":"e50d296c.508468","type":"function","z":"e00097c0.ad3088","name":"stop dnsmasq","func":"msg.payload = \"sudo systemctl stop dnsmasq\";\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":2140,"wires":[["9539f93.6be9308"]]},{"id":"9539f93.6be9308","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":910,"y":2140,"wires":[[],[],["69eb5f91.68b66"]]},{"id":"845995c5.5d91e8","type":"function","z":"e00097c0.ad3088","name":"kill hostapd","func":"msg.payload = \"sudo killall hostapd\";\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":2220,"wires":[["2aec6950.a15f06"]]},{"id":"2aec6950.a15f06","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":910,"y":2220,"wires":[[],[],[]]},{"id":"3c834287.096fde","type":"function","z":"e00097c0.ad3088","name":"cp interfaces.nr.client","func":"msg.payload = \"sudo cp /etc/network/interfaces.nr.client /etc/network/interfaces\";\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":2100,"wires":[["9c910a0a.436d28"]]},{"id":"9c910a0a.436d28","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":550,"y":2100,"wires":[[],[],["845995c5.5d91e8","e50d296c.508468"]]},{"id":"51014ebb.453b2","type":"comment","z":"e00097c0.ad3088","name":"install wifi driver: \"sudo install-wifi\" (https://www.raspberrypi.org/forums/viewtopic.php?uid=81098&f=28&t=62371&start=0#p462982)","info":"","x":730,"y":2940,"wires":[]},{"id":"ce23d949.d0a388","type":"function","z":"e00097c0.ad3088","name":"sudo ifdown wlan0","func":"msg.payload = \"sudo ifdown wlan0\";\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":2440,"wires":[["60d2f50.e34010c"]]},{"id":"60d2f50.e34010c","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":910,"y":2440,"wires":[[],[],["aa98b6c5.c1b0e8"]]},{"id":"aa98b6c5.c1b0e8","type":"function","z":"e00097c0.ad3088","name":"sudo ifup wlan0","func":"msg.payload = \"sudo ifup wlan0\";\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":2440,"wires":[["55b2a1f2.f9299"]]},{"id":"55b2a1f2.f9299","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1250,"y":2440,"wires":[[],[],["a1e132e2.44883","fec0f541.099ce8"]]},{"id":"f94a9dba.4baa4","type":"comment","z":"e00097c0.ad3088","name":"Ping","info":"","x":310,"y":2580,"wires":[]},{"id":"918472ed.9fc99","type":"function","z":"e00097c0.ad3088","name":"is online","func":"var chatId = 146276326;\nvar type = \"message\";\nvar content = \"Bilderrahmen ist online!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1380,"y":2640,"wires":[["2498f957.715656"]]},{"id":"2498f957.715656","type":"telegram sender","z":"e00097c0.ad3088","name":"","bot":"ca6d8830.a2dc48","x":1560,"y":2640,"wires":[[]]},{"id":"77649185.791ce","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"5","x":300,"y":2700,"wires":[["57f2322f.48e20c"]]},{"id":"68506877.f00218","type":"function","z":"e00097c0.ad3088","name":"if ping -> true","func":"if (msg.payload === false){\n\n} else {\n    msg.payload = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":980,"y":2640,"wires":[["3a91e537.8b4dba"]]},{"id":"26338e72.e8bc72","type":"adv ping","z":"e00097c0.ad3088","name":"","host":"8.8.8.8","x":830,"y":2640,"wires":[["68506877.f00218"]]},{"id":"98f7d71b.f58228","type":"delay","z":"e00097c0.ad3088","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":960,"y":2740,"wires":[["26338e72.e8bc72"]]},{"id":"3a91e537.8b4dba","type":"function","z":"e00097c0.ad3088","name":"if ping true/false","func":"if (msg.payload){\n    \n    flow.set('pingCounter', 12);\n    \n    if (!(flow.get('onlineFlag'))){\n        \n        flow.set('onlineFlag', true);\n        msg.payload = \"firstOnline\";\n        return [null, msg, null, msg];  \n        \n    } else {\n    \n        flow.set('onlineFlag', true);\n        msg.payload = \"online\";\n        return [null, null, null, msg];        \n    }\n    \n} else {\n    \n    flow.set('onlineFlag', false);\n    flow.set('pingCounter', flow.get('pingCounter') -1);\n    \n    if (flow.get('pingCounter') <= 0){\n        msg.payload = \"offline, pingCounter = \" + (flow.get('pingCounter') + \" -> stop\");\n        return [msg, null, null, null];\n        \n    } else {\n        msg.payload = \"offline, pingCounter = \" + (flow.get('pingCounter'));\n        return [null, null, msg, null];\n    }\n}\n","outputs":4,"noerr":0,"x":1160,"y":2640,"wires":[["289d29f7.d76636","822fa1d4.cf1f"],["918472ed.9fc99"],["98f7d71b.f58228"],["2d6be685.a56d0a","356be6b3.1cd41a"]]},{"id":"2d6be685.a56d0a","type":"delay","z":"e00097c0.ad3088","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":960,"y":2800,"wires":[["26338e72.e8bc72"]]},{"id":"6f572619.fc0518","type":"link in","z":"e00097c0.ad3088","name":"ping","links":["b85be261.b0aa"],"x":300,"y":2640,"wires":[["57f2322f.48e20c"]]},{"id":"b85be261.b0aa","type":"link out","z":"e00097c0.ad3088","name":"","links":["6f572619.fc0518"],"x":1695,"y":2100,"wires":[]},{"id":"57f2322f.48e20c","type":"function","z":"e00097c0.ad3088","name":"flow.set onlineFlag + pingCounter","func":"flow.set('onlineFlag', false);\nflow.set('pingCounter', 12);\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":2640,"wires":[["26338e72.e8bc72","ed65f9f3.c240a8"]]},{"id":"ed65f9f3.c240a8","type":"function","z":"e00097c0.ad3088","name":"reset","func":"msg.reset = \"reset\";\nreturn msg;\n","outputs":1,"noerr":0,"x":770,"y":2760,"wires":[["98f7d71b.f58228","2d6be685.a56d0a"]]},{"id":"f3f4154.56e5de8","type":"link out","z":"5af1388b.ef9838","name":"","links":["74cb4c3d.327cb4"],"x":1175,"y":3660,"wires":[]},{"id":"822fa1d4.cf1f","type":"change","z":"e00097c0.ad3088","name":"set.global domain to 'teleframe'","rules":[{"t":"set","p":"domain","pt":"global","to":"teleframe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":2600,"wires":[[]]},{"id":"356be6b3.1cd41a","type":"change","z":"e00097c0.ad3088","name":"set.global domain to domainDdns","rules":[{"t":"set","p":"domain","pt":"global","to":"domainDdns","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1460,"y":2700,"wires":[[]]},{"id":"a4f736bf.d2aae8","type":"link in","z":"e00097c0.ad3088","name":"Display on/off [1|0]","links":["aa15e72a.015958"],"x":275,"y":200,"wires":[["65b2fd66.a9b1e4"]]},{"id":"610523e1.b745ac","type":"function","z":"5af1388b.ef9838","name":"if VideoLibrary.OnScanStarted (touchscreen 2p longpress)","func":"if (msg.payload.method === \"VideoLibrary.OnScanStarted\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":570,"y":300,"wires":[["5ed4717b.c343"]]},{"id":"aa15e72a.015958","type":"link out","z":"5af1388b.ef9838","name":"","links":["a4f736bf.d2aae8"],"x":975,"y":280,"wires":[]},{"id":"4784ec03.8580f4","type":"function","z":"5af1388b.ef9838","name":"1","func":"return {payload: 1};","outputs":1,"noerr":0,"x":870,"y":300,"wires":[["aa15e72a.015958"]]},{"id":"5ed4717b.c343","type":"function","z":"5af1388b.ef9838","name":"1/0","func":"if (global.get('displayOnoff') === 0){\n    msg.payload = 1;\n} else {\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":260,"wires":[["aa15e72a.015958"]]},{"id":"eb647660.fdf8f8","type":"change","z":"e00097c0.ad3088","name":"","rules":[{"t":"set","p":"displayOnoff","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":320,"wires":[[]]},{"id":"5a1ebbfa.ac23b4","type":"link out","z":"5af1388b.ef9838","name":"","links":["6a4a0105.c45da"],"x":1295,"y":3660,"wires":[]},{"id":"6a4a0105.c45da","type":"link in","z":"5af1388b.ef9838","name":"DashPressed (5sec)","links":["5a1ebbfa.ac23b4","dc11438c.48568"],"x":1415,"y":1480,"wires":[["490b41ca.1b986"]]},{"id":"5c570762.884528","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":800,"y":340,"wires":[["c3de6857.ab3b68"]]},{"id":"b52b9630.7e52d8","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Beispieltext","tooltip":"","group":"df1cecd4.4f555","order":11,"width":12,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":330,"y":2320,"wires":[["d592afd.cf5be5","f26652ba.54b1b"]]},{"id":"5e500273.9d68ec","type":"ui_slider","z":"7c56a241.1e88dc","name":"","label":"Textgröße (0 = Auto)","tooltip":"","group":"df1cecd4.4f555","order":1,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"300","step":1,"x":360,"y":2380,"wires":[["8d35f8cd.0efc48","f26652ba.54b1b"]]},{"id":"8d35f8cd.0efc48","type":"change","z":"7c56a241.1e88dc","name":"set textsize","rules":[{"t":"set","p":"textsize","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":2380,"wires":[[]]},{"id":"98c76297.ad1c1","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"cropX","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":2440,"wires":[[]]},{"id":"a494f563.2836c8","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"cropY","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":2500,"wires":[[]]},{"id":"12b3fe5e.ae3b52","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Textfarbe","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":3,"width":12,"height":1,"passthru":true,"options":[{"label":"weiß","value":"white","type":"str"},{"label":"gelb","value":"yellow","type":"str"},{"label":"grün","value":"green","type":"str"}],"payload":"","topic":"","x":320,"y":2620,"wires":[["6184b7af.e64a48","f26652ba.54b1b"]]},{"id":"6184b7af.e64a48","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"color","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":2620,"wires":[[]]},{"id":"d592afd.cf5be5","type":"change","z":"7c56a241.1e88dc","name":"set text","rules":[{"t":"set","p":"text","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":2320,"wires":[[]]},{"id":"1a6f3cee.4ac063","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"df1cecd4.4f555","order":13,"width":8,"height":1,"passthru":false,"label":"Vorschau","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"","payload":"preview","payloadType":"str","topic":"","x":1230,"y":2466.25,"wires":[["860a9535.369c18","b0fb0989.7eed08"]]},{"id":"351bd445.2677bc","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"undercolor","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":2680,"wires":[[]]},{"id":"294f1c0d.4e7704","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"bgcolorDash","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":2740,"wires":[["908c30c9.3b162"]]},{"id":"860a9535.369c18","type":"function","z":"7c56a241.1e88dc","name":"set color","func":"if (msg.payload === \"\"){\n    msg.payload = \"#34eb5c\"; //green\n} else {\n    msg.payload = \"#ebe534\"; //yellow\n}\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":2526.25,"wires":[["1a6f3cee.4ac063"]]},{"id":"f26652ba.54b1b","type":"function","z":"7c56a241.1e88dc","name":"set bt color","func":"msg.payload = \"\";\nreturn msg;","outputs":1,"noerr":0,"x":1040,"y":2466.25,"wires":[["1a6f3cee.4ac063"]]},{"id":"b0fb0989.7eed08","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1430,"y":2466.25,"wires":[["fea9f78b.ee8638"]]},{"id":"c9f03717.10aa48","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Font","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":4,"width":12,"height":1,"passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":630,"y":2860,"wires":[["14b3ec10.1006a4","f26652ba.54b1b"]]},{"id":"b86eb783.12fc98","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":300,"y":2860,"wires":[["beeef9ab.9c5038"]]},{"id":"ef2c8b3d.753a08","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Crop X","tooltip":"","group":"df1cecd4.4f555","order":7,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":310,"y":2440,"wires":[["98c76297.ad1c1","f26652ba.54b1b"]]},{"id":"aaac89fc.329128","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Crop Y","tooltip":"","group":"df1cecd4.4f555","order":8,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":320,"y":2500,"wires":[["a494f563.2836c8","f26652ba.54b1b"]]},{"id":"87315785.dbbdf8","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"gravity","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":2560,"wires":[[]]},{"id":"9410ef73.863ed","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Position","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":2,"width":12,"height":1,"passthru":true,"options":[{"label":"Mitte","value":"center","type":"str"},{"label":"Oben","value":"north","type":"str"},{"label":"Unten","value":"south","type":"str"},{"label":"Links","value":"west","type":"str"},{"label":"Rechts","value":"east","type":"str"},{"label":"Oben-links","value":"northwest","type":"str"},{"label":"Oben-rechts","value":"northeast","type":"str"},{"label":"Unten-links","value":"southwest","type":"str"},{"label":"Unten-rechts","value":"southeast","type":"str"}],"payload":"","topic":"","x":320,"y":2560,"wires":[["87315785.dbbdf8","f26652ba.54b1b"]]},{"id":"14b3ec10.1006a4","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"font","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":2860,"wires":[[]]},{"id":"957d0e2c.271cf","type":"ui_slider","z":"7c56a241.1e88dc","name":"","label":"Transparenz (0 = max)","tooltip":"","group":"df1cecd4.4f555","order":6,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"255","step":"1","x":360,"y":2800,"wires":[["e53baaca.04d4a8"]]},{"id":"e53baaca.04d4a8","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"bgalphaDash","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":2800,"wires":[["574a411d.99e17"]]},{"id":"3c091299.6313ae","type":"ui_colour_picker","z":"7c56a241.1e88dc","name":"","label":"Texthintergrundfarbe","group":"df1cecd4.4f555","format":"hex","outformat":"string","showSwatch":true,"showPicker":false,"showValue":false,"showHue":false,"showAlpha":false,"showLightness":true,"square":"false","dynOutput":"false","order":5,"width":12,"height":1,"passthru":true,"topic":"","x":360,"y":2740,"wires":[["294f1c0d.4e7704"]]},{"id":"574a411d.99e17","type":"function","z":"7c56a241.1e88dc","name":"-> hex","func":"msg.payload = msg.payload.toString(16);\n\nif(msg.payload.length < 2){\n    msg.payload = \"0\" + msg.payload;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":2800,"wires":[["f26652ba.54b1b","9b34581b.181418"]]},{"id":"beeef9ab.9c5038","type":"function","z":"7c56a241.1e88dc","name":"fonts options","func":"var options = [\"AvantGarde-Book\",\"AvantGarde-BookOblique\",\"AvantGarde-Demi\",\"AvantGarde-DemiOblique\",\"Bookman-Demi\",\"Bookman-DemiItalic\",\"Bookman-Light\",\"Bookman-LightItalic\",\"Century-Schoolbook-L-Bold\",\"Century-School\",\"ook-L-Bold-Italic\",\"Century-Schoolbook-L-Italic\",\"Century-Schoolbook-L-Roman\",\"Courier\",\"Courier-Bold\",\"Courier-BoldOblique\",\"Courier-Oblique\",\"DejaVuMathTeXGyre-Regular\",\"DejaVu-Sans\",\"DejaVu-Sans-Bold\",\"DejaVu-Sans-Bold-Oblique\",\"DejaVu-Sans-Condensed\",\"DejaVu-Sans-Condensed-Bold\",\"DejaVu-Sans-Condensed-Bold-Oblique\",\"DejaVu-Sans-Condensed-Oblique\",\"DejaVu-Sans-ExtraLight\",\"DejaVu-Sans-Mono\",\"DejaVu-Sans-Mono-Bold\",\"DejaVu-Sans-Mono-Bold-Oblique\",\"DejaVu-Sans-Mono-Oblique\",\"DejaVu-Sans-Oblique\",\"DejaVu-Serif\",\"DejaVu-Serif-Bold\",\"DejaVu-Serif-Bold-Italic\",\"DejaVu-Serif-Condensed\",\"DejaVu-Serif-Condensed-Bold\",\"DejaVu-Serif-Condensed-Bold-Italic\",\"DejaVu-Serif-Condensed-Italic\",\"DejaVu-Serif-Italic\",\"Dingbats\",\"Droid-Sans-Fallback\",\"fixed\",\"FreeMono\",\"FreeMono-Bold\",\"FreeMono-Bold-Oblique\",\"FreeMono-Oblique\",\"FreeSans\",\"FreeSans-Bold\",\"FreeSans-Bold-Oblique\",\"FreeSans-Oblique\",\"FreeSerif\",\"FreeSerif-Bold\",\"FreeSerif-Bold-Italic\",\"FreeSerif-Italic\",\"Helvetica\",\"Helvetica-Bold\",\"Helvetica-BoldOblique\",\"Helvetica-Narrow\",\"Helvetica-Narrow-Bold\",\"Helvetica-Narrow-BoldOblique\",\"Helvetica-Narrow-Oblique\",\"Helvetica-Oblique\",\"Liberation-Mono\",\"Liberation-Mono-Bold\",\"Liberation-Mono-Bold-Italic\",\"Liberation-Mono-Italic\",\"Liberation-Sans\",\"Liberation-Sans-Bold\",\"Liberation-Sans-Bold-Italic\",\"Liberation-Sans-Italic\",\"Liberation-Sans-Narrow\",\"Liberation-Sans-Narrow-Bold\",\"Liberation-Sans-Narrow-Bold-Italic\",\"Liberation-Sans-Narrow-Italic\",\"Liberation-Serif\",\"Liberation-Serif-Bold\",\"Liberation-Serif-Bold-Italic\",\"Liberation-Serif-Italic\",\"NewCenturySchlbk-Bold\",\"NewCenturySchlbk-BoldItalic\",\"NewCenturySchlbk-Italic\",\"NewCenturySchlbk-Roman\",\"Nimbus-Mono-L\",\"Nimbus-Mono-L-Bold\",\"Nimbus-Mono-L-Bold-Oblique\",\"Nimbus-Mono-L-Regular-Oblique\",\"Nimbus-Roman-No9-L\",\"Nimbus-Roman-No9-L-Medium\",\"Nimbus-Roman-No9-L-Medium-Italic\",\"Nimbus-Roman-No9-L-Regular-Italic\",\"Nimbus-Sans-L\",\"Nimbus-Sans-L-Bold\",\"Nimbus-Sans-L-Bold-Condensed\",\"Nimbus-Sans-L-Bold-Condensed-Italic\",\"Nimbus-Sans-L-Bold-Italic\",\"Nimbus-Sans-L-Regular-Condensed\",\"Nimbus-Sans-L-Regular-Condensed-Italic\",\"Nimbus-Sans-L-Regular-Italic\",\"Noto-Mono\",\"Palatino-Bold\",\"Palatino-BoldItalic\",\"Palatino-Italic\",\"Palatino-Roman\",\"Piboto-Bold\",\"Piboto-Bold-Italic\",\"Piboto-Condensed-Bold\",\"Piboto-Condensed-Bold-Italic\",\"Piboto-Condensed-Italic\",\"Piboto-Condensed-Regular\",\"Piboto-Italic\",\"Piboto-Light\",\"Piboto-Light-Italic\",\"PibotoLt-Bold\",\"PibotoLt-Bold-Italic\",\"PibotoLt-Italic\",\"PibotoLt-Regular\",\"Piboto-Regular\",\"Piboto-Thin\",\"Piboto-Thin-Italic\",\"Quicksand-Bold\",\"Quicksand-Light\",\"Quicksand-Medium\",\"Quicksand-Regular\",\"Standard-Symbols-L\",\"Symbol\",\"Times-Bold\",\"Times-BoldItalic\",\"Times-Italic\",\"Times-Roman\",\"URW-Bookman-L-Demi-Bold\",\"URW-Bookman-L-Demi-Bold-Italic\",\"URW-Bookman-L-Light\",\"URW-Bookman-L-Light-Italic\",\"URW-Chancery-L-Medium-Italic\",\"URW-Gothic-L-Book\",\"URW-Gothic-L-Book-Oblique\",\"URW-Gothic-L-Demi\",\"URW-Gothic-L-Demi-Oblique\",\"URW-Palladio-L-Bold\",\"URW-Palladio-L-Bold-Italic\",\"URW-Palladio-L-Italic\",\"URW-Palladio-L-Roman\"];\nmsg = {options};\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":2860,"wires":[["c9f03717.10aa48"]]},{"id":"38870ba3.0f08c4","type":"file in","z":"7c56a241.1e88dc","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":1420,"y":2746.25,"wires":[["e0b004cd.d2bbe8"]]},{"id":"e0b004cd.d2bbe8","type":"base64","z":"7c56a241.1e88dc","name":"","action":"str","property":"payload","x":1570,"y":2746.25,"wires":[["b4c3c2da.347f6"]]},{"id":"b4c3c2da.347f6","type":"ui_template","z":"7c56a241.1e88dc","group":"df1cecd4.4f555","name":"Vorschau","order":15,"width":12,"height":5,"format":"<img width=\"100%\" height=\"100%\" alt=\" Noch keine Vorschau erstellt\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1710,"y":2746.25,"wires":[[]]},{"id":"5fd34017.e184e","type":"function","z":"7c56a241.1e88dc","name":"set file","func":"var filename = \"/home/pi/media/telegram/preview/previewText.jpg\";\nmsg = { filename };\nreturn msg;\n","outputs":1,"noerr":0,"x":1720,"y":2666.25,"wires":[["38870ba3.0f08c4"]]},{"id":"a735c698.a32dc8","type":"ui_slider","z":"7c56a241.1e88dc","name":"","label":"Textgröße Name","tooltip":"","group":"df1cecd4.4f555","order":9,"width":12,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"300","step":1,"x":1380,"y":2820,"wires":[["a383aab7.271d18"]]},{"id":"a383aab7.271d18","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"nameTextsize","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1590,"y":2820,"wires":[[]]},{"id":"fe9fedf4.54676","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"gravityName","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1590,"y":2880,"wires":[[]]},{"id":"ffb27b45.5c72e8","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Position Name","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":10,"width":12,"height":1,"passthru":true,"options":[{"label":"Mitte","value":"center","type":"str"},{"label":"Oben","value":"north","type":"str"},{"label":"Unten","value":"south","type":"str"},{"label":"Links","value":"west","type":"str"},{"label":"Rechts","value":"east","type":"str"},{"label":"Oben-links","value":"northwest","type":"str"},{"label":"Oben-rechts","value":"northeast","type":"str"},{"label":"Unten-links","value":"southwest","type":"str"},{"label":"Unten-rechts","value":"southeast","type":"str"}],"payload":"","topic":"","x":1380,"y":2880,"wires":[["fe9fedf4.54676"]]},{"id":"e4bc7f3a.da335","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1450,"y":2586.25,"wires":[[],[],["dcd6b58d.a98958"]]},{"id":"fea9f78b.ee8638","type":"function","z":"7c56a241.1e88dc","name":"convert image add text","func":"var imagepath = global.get('path-preview') + \"preview1280x800.jpg\";\nvar resultpath = global.get('path-preview') + \"previewText.jpg\";\n\nvar bgalpha = flow.get('bgalpha') || \"00\";\nvar bgcolor = flow.get('bgcolor') || \"000000\";\nvar text = flow.get('text') || \"no text entered\";\n// Prepare string for bash -> convert special characters\ntext = text.replace(/\\\\/g , \"\\\\\\\\\").replace(/\"/g , \"\\\\\\\"\");\nvar textsize = \"\";\nif (flow.get('textsize') > 0){\n    textsize = \" -pointsize \" + (flow.get('textsize') || 30);\n}\nvar sizeX = global.get('displayWidth') - flow.get('cropX');\nvar sizeY = global.get('displayHeight') - flow.get('cropY');\nvar gravity = flow.get('gravity') || \"center\";\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\nvar undercolor = \"\";\nif (flow.get('undercolor') !== \"off\"){\n    undercolor = \" -undercolor \" + (flow.get('undercolor') || black);\n}\n\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + undercolor + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:\\\"\" + text + \"\\\" \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":2586.25,"wires":[["e4bc7f3a.da335"]]},{"id":"dcd6b58d.a98958","type":"function","z":"7c56a241.1e88dc","name":"if ok","func":"if (msg.payload.code === 0){\n    return msg;\n}","outputs":1,"noerr":0,"x":1600,"y":2586.25,"wires":[["9e0fd394.17812"]]},{"id":"283f2e15.58bb02","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":2920,"wires":[["c9f03717.10aa48"]]},{"id":"908c30c9.3b162","type":"function","z":"7c56a241.1e88dc","name":"no #","func":"if (msg.payload.includes('#')){\n    msg.payload = msg.payload.slice(1);\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":2740,"wires":[["f26652ba.54b1b","c6a7fd6f.da907"]]},{"id":"c7590100.0d2bb","type":"comment","z":"7c56a241.1e88dc","name":"Settings Textoverlay","info":"","x":170,"y":2260,"wires":[]},{"id":"9e0fd394.17812","type":"function","z":"7c56a241.1e88dc","name":"convert image add name","func":"// set variables\nvar imagepath = global.get('path-preview');\nvar resultpath = imagepath;\nvar sizeX = global.get('displayWidth');\nvar sizeY = global.get('displayHeight');\nvar gravity = (flow.get('gravityName')) || \"southeast\";\nvar undercolor = \"black\"; //\n\n// fix variables\n\nimagepath = imagepath + \"previewText.jpg\";\nresultpath = resultpath + \"previewText.jpg\";\n\nvar textsize = (flow.get('nameTextsize')) || 40;\nvar bgalpha = \"00\";\nvar bgcolor = \"000000\";\nvar text = \"Name\";\n// Prepare string for bash -> convert special characters\ntext = text.replace(/\\\\/g , \"\\\\\\\\\").replace(/\"/g , \"\\\\\\\"\");\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\n\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + \" -undercolor \" + undercolor + \" -pointsize \" + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:\\\"\" + text + \"\\\" \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":2666.25,"wires":[["93777794.af9968"]]},{"id":"93777794.af9968","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1450,"y":2666.25,"wires":[["860a9535.369c18"],[],["d1546bb8.883dd8"]]},{"id":"d1546bb8.883dd8","type":"function","z":"7c56a241.1e88dc","name":"if ok","func":"if (msg.payload.code === 0){\n    return msg;\n}","outputs":1,"noerr":0,"x":1600,"y":2666.25,"wires":[["5fd34017.e184e"]]},{"id":"ee937359.72093","type":"function","z":"7c56a241.1e88dc","name":"set off","func":"msg.payload = \"off\";\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":2680,"wires":[["351bd445.2677bc","f26652ba.54b1b"]]},{"id":"1c0cb11e.18ab2f","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":200,"y":1180,"wires":[["8fc7a884.818988"]]},{"id":"5938ea78.30ac94","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification reset","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"GUI.ShowNotification\",\n            \"id\": 1,\n            \"params\":{\n                \"title\":\"\",\n                \"message\":\"\",\n                \"displaytime\":1500\n            }\n        }\n};","outputs":1,"noerr":0,"x":1580,"y":1240,"wires":[["b2efa2c8.3efc"]]},{"id":"69bf6843.e240b8","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification reset","links":["bae63218.2434c"],"x":1335,"y":1240,"wires":[["5938ea78.30ac94"]]},{"id":"bae63218.2434c","type":"link out","z":"7c56a241.1e88dc","name":"","links":["69bf6843.e240b8"],"x":1515,"y":2240,"wires":[]},{"id":"c7ff2b40.398788","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"reset","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1050,"y":2240,"wires":[["fd75240b.e493f8"]]},{"id":"fd75240b.e493f8","type":"function","z":"7c56a241.1e88dc","name":"reset GUI notification","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":2240,"wires":[["bae63218.2434c"]]},{"id":"8f68afa1.5f6cc","type":"ui_text","z":"5af1388b.ef9838","group":"43f81666.762748","order":1,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-spread","x":510,"y":1360,"wires":[]},{"id":"3e87129b.2887ee","type":"function","z":"5af1388b.ef9838","name":"get Position","func":"msg.payload = \"Position: \" + flow.get('currentImagePlayerPos');\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":1360,"wires":[["8f68afa1.5f6cc"]]},{"id":"49949265.e73eec","type":"ui_text","z":"5af1388b.ef9838","group":"c51c9a95.f2cb68","order":1,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-spread","x":990,"y":4120,"wires":[]},{"id":"9b5c2a6f.4bd398","type":"function","z":"5af1388b.ef9838","name":"get Position","func":"msg.payload = \"Position: \" + (flow.get('currentVideoIndex') +1);\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":4120,"wires":[["49949265.e73eec"]]},{"id":"56433867.4a50d8","type":"link out","z":"7c56a241.1e88dc","name":"reset q-gate video","links":[],"x":1055,"y":300,"wires":[]},{"id":"6e917fa1.ce641","type":"link out","z":"7c56a241.1e88dc","name":"reset q-gates images","links":["96c4ea7a.ff9ff8","a06004af.3b8a18","57d8c0a2.0eef3","a70ba46a.955d08","e27dc3c5.426f3","b0d90b01.7f85b8","d610f5fc.efe428"],"x":395,"y":1120,"wires":[]},{"id":"b11cb61d.0e3508","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl restart kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":2200,"y":240,"wires":[[],[],[]]},{"id":"d731bb2a.1f4028","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["42220cc2.75ff74","f4cce95d.56b828"],"x":855,"y":440,"wires":[]},{"id":"e97188a9.769958","type":"function","z":"7c56a241.1e88dc","name":"rename filename + mv to preproc folder","func":"msg.payload = \"mv \" + global.get('images-incoming') + flow.get('filenameIncoming') + \" \" + global.get('images-preprocessing') + msg.image.fileId + \".jpg\";\n\nreturn msg;","outputs":1,"noerr":0,"x":960,"y":1360,"wires":[["e111055e.e9f098"]]},{"id":"ccb45686.9fbc68","type":"comment","z":"7c56a241.1e88dc","name":"extract image data","info":"","x":430,"y":1220,"wires":[]},{"id":"a6e5860a.bc06d8","type":"function","z":"7c56a241.1e88dc","name":"build array element","func":"var fileId = msg.payload;\n\nvar filenamePic = fileId + \".pic.jpg\";\nvar filenamePicDash = fileId + \".pic.dash.jpg\";\nvar filenamePicThumb = fileId + \".pic.thumb.jpg\";\nvar filenameText;\nvar filenameTextDash;\nvar filenameTextThumb;\nvar text;\nvar textFlag;\nvar playlistPosPic = -1;\nvar playlistPosText = -1;\n\nif ((flow.get('lastTelegramMessage') || false ) === false){\n    text = false;\n    textFlag = false;\n    filenameText = false;\n    filenameTextDash = false;\n    filenameTextThumb = false;\n} else {\n    text = flow.get('lastTelegramMessage');\n    textFlag = true;\n    filenameText = fileId + \".text.jpg\";\n    filenameTextDash = fileId + \".text.dash.jpg\";\n    filenameTextThumb = fileId + \".text.thumb.jpg\";\n}\n\nvar imageHeight = msg.height;\nvar imageWidth = msg.width;\n\nvar user = flow.get('lastTelegramUsername');\nvar chatId = flow.get('lastTelegramChatid');\n\nvar stickFlag = false;\nvar trashFlag = false;\nvar timestamp = Date.now();\n\nvar image = {   fileId, \n                filenamePic, \n                filenamePicDash,\n                filenamePicThumb,\n                filenameText,\n                filenameTextDash,\n                filenameTextThumb,\n                text,\n                textFlag,\n                imageHeight,\n                imageWidth,\n                user,\n                chatId,\n                stickFlag,\n                trashFlag,\n                playlistPosPic,\n                playlistPosText,\n                timestamp\n}\n\n// global.set('currentImage', image);\n\nmsg = { image };\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1360,"wires":[["e97188a9.769958"]]},{"id":"d035d701.4373e8","type":"function","z":"7c56a241.1e88dc","name":"assign file ID","func":"var idCounterImages = global.get('idCounterImages') || false;\nidCounterImages++;\nglobal.set('idCounterImages', idCounterImages);\n\nmsg.payload = idCounterImages;\nreturn msg;\n","outputs":1,"noerr":0,"x":510,"y":1360,"wires":[["a6e5860a.bc06d8"]]},{"id":"ae325692.95b7d8","type":"comment","z":"7c56a241.1e88dc","name":"download image","info":"","x":1660,"y":1100,"wires":[]},{"id":"40a08453.eb46fc","type":"comment","z":"7c56a241.1e88dc","name":"extract user data","info":"","x":620,"y":1000,"wires":[]},{"id":"64b10d22.d32444","type":"comment","z":"7c56a241.1e88dc","name":"prepare processing","info":"","x":630,"y":1100,"wires":[]},{"id":"edd84f65.2b35d","type":"comment","z":"7c56a241.1e88dc","name":"create array element + move to folders","info":"","x":210,"y":1360,"wires":[]},{"id":"6daa7f30.d2cf","type":"function","z":"7c56a241.1e88dc","name":"clear preprocessing folder","func":"msg.payload = \"rm \" + global.get('images-preprocessing') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":1140,"wires":[["40e01118.651df"]]},{"id":"40e01118.651df","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1270,"y":1140,"wires":[[],[],["98b8ca51.fe0458"]]},{"id":"8b397f84.e77f4","type":"function","z":"7c56a241.1e88dc","name":"add image element to arrayImages","func":"var array = global.get('arrayImages') || [];\narray.unshift(msg.image);\n\nvar payload = array;\n\nreturn {payload};","outputs":1,"noerr":0,"x":1300,"y":1940,"wires":[["d31afcc4.0f88d"]]},{"id":"f420adbe.25723","type":"comment","z":"dfa0e0a5.c8001","name":"Reset","info":"","x":110,"y":3180,"wires":[]},{"id":"6ac78096.cc16a","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":140,"y":3420,"wires":[["5c3a2a01.24f274"]]},{"id":"5c3a2a01.24f274","type":"function","z":"dfa0e0a5.c8001","name":"lightgrey","func":"msg.background = \"#525252\"; // lightgrey\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":3420,"wires":[["27f5b222.e811fe"]]},{"id":"27f5b222.e811fe","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"b242fa6a.175d28","order":1,"width":10,"height":1,"passthru":false,"label":"Reset / Initalize System","tooltip":"","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"0","payloadType":"num","topic":"","x":210,"y":3500,"wires":[["4ce60af6.3012c4","edb9f52c.fee7c8"]]},{"id":"edb9f52c.fee7c8","type":"ui_switch","z":"dfa0e0a5.c8001","name":"actButt","label":"","tooltip":"","group":"b242fa6a.175d28","order":2,"width":2,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":500,"y":3420,"wires":[["19a713b.86e68ec"]]},{"id":"19a713b.86e68ec","type":"function","z":"dfa0e0a5.c8001","name":"save switch-state","func":"flow.set('switchstate1', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":3420,"wires":[["37c21c83.d0f0b4"]]},{"id":"37c21c83.d0f0b4","type":"function","z":"dfa0e0a5.c8001","name":"set color background","func":"if (msg.payload === 1){\n    msg.background = \"\";\n} else msg.background = global.get('lightgrey');\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":3420,"wires":[["27f5b222.e811fe"]]},{"id":"4ce60af6.3012c4","type":"function","z":"dfa0e0a5.c8001","name":"switch-gate","func":"status = flow.get('switchstate1') || 0;\nif (status === 1){\n    return msg;\n} else return null;","outputs":1,"noerr":0,"x":450,"y":3500,"wires":[["f1204427.126728"]]},{"id":"7f61f291.98e2ac","type":"function","z":"dfa0e0a5.c8001","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":3760,"wires":[["18ccf7d5.67e628","f9a57e9a.d198f"]]},{"id":"5ae6433c.47881c","type":"inject","z":"dfa0e0a5.c8001","name":"all","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":350,"y":3760,"wires":[["7f61f291.98e2ac"]]},{"id":"18ccf7d5.67e628","type":"function","z":"dfa0e0a5.c8001","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":3820,"wires":[["9e3aa130.d88a8","26ef0caa.c7ccf4","55b13cbe.3730c4"]]},{"id":"f9a57e9a.d198f","type":"function","z":"dfa0e0a5.c8001","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":4000,"wires":[["3425b7de.269188","39705c86.610aa4","a7523f54.68531"]]},{"id":"9ecc2a87.5dea58","type":"function","z":"dfa0e0a5.c8001","name":"reset arrayImages","func":"global.set('arrayImages', []);\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":3580,"wires":[["b9c1dcf5.e51d2"]]},{"id":"fbb06c1c.887b4","type":"function","z":"dfa0e0a5.c8001","name":"reset arrayVideos","func":"global.set('arrayVideos', []);\nreturn msg;","outputs":1,"noerr":0,"x":1330,"y":3620,"wires":[["11628bbf.cfe534"]]},{"id":"4ed088bd.01c288","type":"function","z":"dfa0e0a5.c8001","name":"reset idCounterImages","func":"global.set('idCounterImages', 0);\nreturn msg;","outputs":1,"noerr":0,"x":1340,"y":3660,"wires":[[]]},{"id":"e4a68d8d.087a6","type":"function","z":"dfa0e0a5.c8001","name":"reset idCounterVideos","func":"global.set('idCounterVideos', 0);\nreturn msg;","outputs":1,"noerr":0,"x":1340,"y":3700,"wires":[[]]},{"id":"d31afcc4.0f88d","type":"link out","z":"7c56a241.1e88dc","name":"","links":["25cf5a7a.8e31c6","9da2920a.d3dcf","a287912.886f77","afffc469.d39e48"],"x":1495,"y":1940,"wires":[]},{"id":"db913bc8.8286f8","type":"link in","z":"7c56a241.1e88dc","name":"reset q-gate Images","links":["cc21b846.ab0698","ed232a9f.5e3a98"],"x":135,"y":1120,"wires":[["8fc7a884.818988"]]},{"id":"607aa6dd.047058","type":"link in","z":"7c56a241.1e88dc","name":"reset q-gate Videos","links":["ed232a9f.5e3a98","f529d98e.b7f7e8"],"x":815,"y":300,"wires":[["c3de6857.ab3b68"]]},{"id":"1144b3ff.80b1fc","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"b242fa6a.175d28","order":6,"width":6,"height":1,"passthru":false,"label":"Reset Q-Gate Videos","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":340,"y":3300,"wires":[["f529d98e.b7f7e8","d00ee512.ee34d8"]]},{"id":"fe5ee820.37f408","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"b242fa6a.175d28","order":5,"width":6,"height":1,"passthru":false,"label":"Reset Q-Gate Images","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":340,"y":3260,"wires":[["cc21b846.ab0698","ddad25d5.843a38"]]},{"id":"cc21b846.ab0698","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["db913bc8.8286f8"],"x":1275,"y":3300,"wires":[]},{"id":"f529d98e.b7f7e8","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["607aa6dd.047058"],"x":1275,"y":3340,"wires":[]},{"id":"8d1a10cd.21cff","type":"ui_toast","z":"dfa0e0a5.c8001","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":750,"y":3500,"wires":[["ebdff964.367368"]]},{"id":"ebdff964.367368","type":"function","z":"dfa0e0a5.c8001","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":890,"y":3500,"wires":[["9ecc2a87.5dea58","7f61f291.98e2ac","fbb06c1c.887b4","4ed088bd.01c288","e4a68d8d.087a6","cc21b846.ab0698","f529d98e.b7f7e8","cbdbc703.86aa48","d5a6eaa1.a7c8a8"]]},{"id":"f1204427.126728","type":"function","z":"dfa0e0a5.c8001","name":"\"sicher?\"","func":"return {payload: \"Sämtliche Bilder und Videos werden gelöscht! Trotzdem fortfahren?\"};","outputs":1,"noerr":0,"x":600,"y":3500,"wires":[["8d1a10cd.21cff"]]},{"id":"b9c1dcf5.e51d2","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["afffc469.d39e48","9da2920a.d3dcf"],"x":1495,"y":3580,"wires":[]},{"id":"11628bbf.cfe534","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["85c423a5.b5f07"],"x":1495,"y":3620,"wires":[]},{"id":"df045419.0c29b8","type":"function","z":"5af1388b.ef9838","name":"if Player.OnPlay","func":"if (msg.payload.method === \"Player.OnPlay\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":400,"y":440,"wires":[["6407c025.f7455"]]},{"id":"1dd5f8cf.e8a767","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"e8b1d590.eaade8","order":3,"width":7,"height":1,"passthru":false,"label":"Restore Kodi Settings","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Kodi settings wiederherstellen?","payloadType":"str","topic":"","x":180,"y":1360,"wires":[["bf68e56.c6b7318"]]},{"id":"6c0aaeae.f5bf7","type":"comment","z":"dfa0e0a5.c8001","name":"Kodi settings","info":"","x":130,"y":1300,"wires":[]},{"id":"55824b5a.c257b4","type":"function","z":"dfa0e0a5.c8001","name":"rename to .bak","func":"var cmd = \"sudo mv /usr/share/kodi/addons/skin.estouchy/xml/DialogNotification.xml /usr/share/kodi/addons/skin.estouchy/xml/DialogNotification.xml.bak && \";\ncmd = cmd + \"sudo mv /usr/share/kodi/addons/skin.estouchy/xml/Font.xml /usr/share/kodi/addons/skin.estouchy/xml/Font.xml.bak && \";\ncmd = cmd + \"sudo mv /usr/share/kodi/addons/skin.estouchy/xml/Pointer.xml /usr/share/kodi/addons/skin.estouchy/xml/Pointer.xml.bak && \";\ncmd = cmd + \"sudo mv /usr/share/kodi/addons/skin.estouchy/xml/MyPrograms.xml /usr/share/kodi/addons/skin.estouchy/xml/MyPrograms.xml.bak && \";\ncmd = cmd + \"sudo mv /home/pi/.kodi/userdata/keymaps/touchscreen.xml /home/pi/.kodi/userdata/keymaps/touchscreen.xml.bak\";\n\nmsg.payload = cmd;\nreturn msg;\n","outputs":1,"noerr":0,"x":660,"y":1360,"wires":[["60789c9d.e545e4","356200b1.eccec"]]},{"id":"60789c9d.e545e4","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":830,"y":1360,"wires":[[],[],["e5ecb29a.86ded"]]},{"id":"5a3ce8db.4f1ef8","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1690,"y":1380,"wires":[]},{"id":"ba852979.e6b358","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Settings restored! Please restart Kodi!\"};","outputs":1,"noerr":0,"x":1450,"y":1360,"wires":[["5a3ce8db.4f1ef8"]]},{"id":"683b5111.9d863","type":"function","z":"dfa0e0a5.c8001","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1280,"y":1360,"wires":[["cba0c8d0.9630b8"],["ba852979.e6b358"]]},{"id":"855bc464.35f718","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1550,"y":3300,"wires":[]},{"id":"cbdbc703.86aa48","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"System reset / initalized!\"};","outputs":1,"noerr":0,"x":1310,"y":3400,"wires":[["855bc464.35f718"]]},{"id":"ddad25d5.843a38","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"G-Gate Image reset!\"};","outputs":1,"noerr":0,"x":990,"y":3200,"wires":[["855bc464.35f718"]]},{"id":"d00ee512.ee34d8","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"G-Gate Video reset!\"};","outputs":1,"noerr":0,"x":991.25,"y":3238.75,"wires":[["855bc464.35f718"]]},{"id":"cba0c8d0.9630b8","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Restore settings failed!\"};","outputs":1,"noerr":0,"x":1450,"y":1320,"wires":[["5a3ce8db.4f1ef8"]]},{"id":"4fb33d12.764024","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"return {payload: \"Neue Nachricht angekommen!\"};","outputs":1,"noerr":0,"x":350,"y":840,"wires":[["4a82a6ef.069d68"]]},{"id":"4a82a6ef.069d68","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":410,"y":900,"wires":[]},{"id":"d184c84f.6b9258","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"return {payload: \"Neues Bild wird angezeigt!\"};","outputs":1,"noerr":0,"x":1230,"y":2080,"wires":[["afb4042.6d45bf8","94528a65.a7c5a8"]]},{"id":"afb4042.6d45bf8","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1430,"y":2080,"wires":[]},{"id":"6a3df8b8.9f18c8","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"return {payload: \"Bild wird verarbeitet...\"};","outputs":1,"noerr":0,"x":730,"y":940,"wires":[["49b00b7a.202f74"]]},{"id":"49b00b7a.202f74","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"200","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":910,"y":940,"wires":[]},{"id":"50dd2f3e.76258","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"e8b1d590.eaade8","order":2,"width":5,"height":2,"passthru":false,"label":"Restart Kodi","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Kodi neu starten?","payloadType":"str","topic":"","x":150,"y":1420,"wires":[["92c15287.e352a"]]},{"id":"b5fc07be.191678","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl restart kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":760,"y":1420,"wires":[[],[],["ff72f9e1.5cce18"]]},{"id":"ff72f9e1.5cce18","type":"function","z":"dfa0e0a5.c8001","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":960,"y":1420,"wires":[["cdea9ae4.8125d8"],["260d64d9.e1728c"]]},{"id":"260d64d9.e1728c","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Kodi restarted!\"};","outputs":1,"noerr":0,"x":1450,"y":1440,"wires":[["5a3ce8db.4f1ef8"]]},{"id":"cdea9ae4.8125d8","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Kodi restart failed!\"};","outputs":1,"noerr":0,"x":1450,"y":1400,"wires":[["5a3ce8db.4f1ef8"]]},{"id":"6475acf3.e11544","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":940,"wires":[["6a3df8b8.9f18c8"]]},{"id":"4ca2b9d4.858158","type":"ui_toast","z":"e00097c0.ad3088","position":"top right","displayTime":"4","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":930,"y":1340,"wires":[]},{"id":"701fd117.9dcde","type":"function","z":"e00097c0.ad3088","name":"set message","func":"if(msg.payload.slice(0, 7) === \"Updated\"){\n    return msg;    \n}\n","outputs":1,"noerr":0,"x":730,"y":1320,"wires":[["4ca2b9d4.858158"]]},{"id":"10ec70b9.e1049f","type":"function","z":"e00097c0.ad3088","name":"set message","func":"return {payload: \"Update durchgeführt!\"};","outputs":1,"noerr":0,"x":730,"y":1360,"wires":[["4ca2b9d4.858158"]]},{"id":"4a6eb097.dc7a2","type":"function","z":"e00097c0.ad3088","name":"set message","func":"return {payload: \"System wird heruntergefahren!\"};","outputs":1,"noerr":0,"x":670,"y":900,"wires":[["9a8d4490.a9ff58"]]},{"id":"9a8d4490.a9ff58","type":"ui_toast","z":"e00097c0.ad3088","position":"top right","displayTime":"7","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":990,"y":960,"wires":[]},{"id":"5d0078d8.20eb18","type":"function","z":"e00097c0.ad3088","name":"set message","func":"return {payload: \"System wird neu gestarted!\"};","outputs":1,"noerr":0,"x":670,"y":1000,"wires":[["9a8d4490.a9ff58"]]},{"id":"ad8b39be.e1d3d8","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Pause","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":820,"wires":[["ffbdb28d.7c8a6"]]},{"id":"356200b1.eccec","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Restoring...\"};","outputs":1,"noerr":0,"x":850,"y":1300,"wires":[["55235865.afc8b8"]]},{"id":"55235865.afc8b8","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"10","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1030,"y":1300,"wires":[]},{"id":"aac401ba.e30c","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"200","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1430,"y":220,"wires":[]},{"id":"6d7cc497.b0585c","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Kodi wird neu gestartet! Bitte warten...\"};","outputs":1,"noerr":0,"x":1250,"y":220,"wires":[["aac401ba.e30c"]]},{"id":"cbc21a24.48fd08","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"4","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1230,"y":140,"wires":[]},{"id":"9ce79b53.76cc08","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Kodi gestartet!\"};","outputs":1,"noerr":0,"x":1050,"y":140,"wires":[["cbc21a24.48fd08"]]},{"id":"d5a6eaa1.a7c8a8","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["f4cce95d.56b828"],"x":1315,"y":3540,"wires":[]},{"id":"f2f09b1c.d32e58","type":"function","z":"5af1388b.ef9838","name":"Gelöscht!","func":"return {payload: \"Gelöscht!\"};","outputs":1,"noerr":0,"x":780,"y":940,"wires":[["be4e7fcc.1ab88"]]},{"id":"be4e7fcc.1ab88","type":"ui_toast","z":"5af1388b.ef9838","position":"bottom right","displayTime":"5","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":950,"y":940,"wires":[]},{"id":"603ae859.a81b08","type":"function","z":"5af1388b.ef9838","name":"trashFlag = true","func":"var arrayElement = global.get('currentImagePlayer');\narrayElement.trashFlag = true;\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":980,"wires":[["f2f09b1c.d32e58","7c84dde4.99eb74"]]},{"id":"7c84dde4.99eb74","type":"link out","z":"5af1388b.ef9838","name":"","links":["26f4be78.7f8d82","2287a13a.7d44de","afffc469.d39e48","9da2920a.d3dcf"],"x":735,"y":980,"wires":[]},{"id":"97e04528.79f438","type":"comment","z":"5af1388b.ef9838","name":"arrayImages operations","info":"","x":1380,"y":2140,"wires":[]},{"id":"afffc469.d39e48","type":"link in","z":"5af1388b.ef9838","name":"refresh image browser","links":["13cc72f0.8531ad","1664a1ac.abc21e","207052dd.0e26ee","7c84dde4.99eb74","ada16f09.67681","b9c1dcf5.e51d2","d31afcc4.0f88d","e1f2705d.dcf9c","f92cc322.9e0af","9f266d4.c4d2f9"],"x":215,"y":1540,"wires":[["c2a73585.184f78"]]},{"id":"3ab4d801.884c28","type":"function","z":"5af1388b.ef9838","name":"auto mark trash in arrayImages","func":"var array = global.get('arrayImages');\n\nfor (var i=global.get('loopMax'); i < array.length; i++) {\n    \n    if (!array[i].stickFlag){\n        array[i].trashFlag = true;\n    }\n}\n\nmsg.payload = array;\n\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":2220,"wires":[["13cc72f0.8531ad"]]},{"id":"91dc5cee.d6f91","type":"function","z":"5af1388b.ef9838","name":"auto remove trash-file from arrayImages","func":"var array = global.get('arrayImages');\ncmd = \"\";\n\nvar max = global.get('trashMax') + global.get('loopMax');\n\nfor (var i=array.length-1; i >= max; i--) {\n    \n    if (!array[i].stickFlag){\n        \n        cmd = cmd + \"rm \" + global.get('images-loop') + array[i].filenamePic + \" \";\n        cmd = cmd + global.get('images-loop') + array[i].filenamePicDash + \" \";\n        cmd = cmd + global.get('images-loop') + array[i].filenamePicThumb + \" \";\n        \n        if (array[i].textFlag){\n            \n            cmd = cmd + global.get('images-loop') + array[i].filenameText + \" \";\n            cmd = cmd + global.get('images-loop') + array[i].filenameTextDash + \" \";\n            cmd = cmd + global.get('images-loop') + array[i].filenameTextThumb + \" \";\n        }\n        \n        array.splice(i, 1);\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1440,"y":2280,"wires":[["133d2f71.98bee1","9f266d4.c4d2f9"]]},{"id":"133d2f71.98bee1","type":"exec","z":"5af1388b.ef9838","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1710,"y":2280,"wires":[[],[],[]]},{"id":"a287912.886f77","type":"link in","z":"5af1388b.ef9838","name":"auto mark trash in arrayImages","links":["bf2a065e.2545f8","d31afcc4.0f88d","f92cc322.9e0af"],"x":1235,"y":2220,"wires":[["3ab4d801.884c28"]]},{"id":"25cf5a7a.8e31c6","type":"link in","z":"5af1388b.ef9838","name":"auto remove trash-file from arrayImages","links":["d31afcc4.0f88d"],"x":1235,"y":2280,"wires":[["91dc5cee.d6f91"]]},{"id":"213e6fd3.80a72","type":"function","z":"5af1388b.ef9838","name":"start on current index +1","func":"if (flow.get('currentImagePlayerIndex') === global.get('arrayImages').length-1){\n    msg.index = 0;\n} else {\n    msg.index = flow.get('currentImagePlayerIndex') +1;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1590,"y":360,"wires":[["444b6d47.818b94"]]},{"id":"26f4be78.7f8d82","type":"link in","z":"5af1388b.ef9838","name":"start on current index +1","links":["7c84dde4.99eb74"],"x":1415,"y":360,"wires":[["213e6fd3.80a72"]]},{"id":"29dd9e83.ffdb92","type":"function","z":"5af1388b.ef9838","name":"format text","func":"msg.payload = \"ID: \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1740,"wires":[["bcab2a6b.397428"]]},{"id":"2e34fec8.f25f62","type":"function","z":"5af1388b.ef9838","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":470,"y":2060,"wires":[["756bb1ab.440ed"]]},{"id":"7314feb7.545db","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":330,"y":2060,"wires":[["2e34fec8.f25f62"]]},{"id":"19e4855d.8a60bb","type":"function","z":"5af1388b.ef9838","name":"set flow.currentBrowserIndex","func":"array = global.get('arrayImages');\n\nfor (var i=0; i < array.length; i++) {\n \n    if (array[i].fileId === msg.payload){\n        flow.set('currentBrowserIndex', i);\n        return {payload: i}\n    }\n}\n","outputs":1,"noerr":0,"x":720,"y":1780,"wires":[["2b61fb66.23dd04"]]},{"id":"807d48e.4b80db8","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2750,"y":200,"wires":[]},{"id":"9f38cce1.b5138","type":"function","z":"5af1388b.ef9838","name":"if empty","func":"if (msg.payload.length === 0){\n    \n    var msg2 = {payload: \"Papierkorb leer\"};\n    return [msg, msg2];\n    \n} else {\n    var msg2 = {payload: \"Kein Element ausgewählt\"};\n    return [msg, msg2];\n}\n","outputs":2,"noerr":0,"x":580,"y":1540,"wires":[["c9c74455.4e4708"],["e313de76.5f0b7","bcab2a6b.397428"]]},{"id":"85c423a5.b5f07","type":"link in","z":"5af1388b.ef9838","name":"refresh video browser","links":["11628bbf.cfe534","22e0cc04.f962f4","8f3c42f6.f4e8"],"x":295,"y":4480,"wires":[["82174c6e.c7915"]]},{"id":"13cc72f0.8531ad","type":"link out","z":"5af1388b.ef9838","name":"","links":["2287a13a.7d44de","afffc469.d39e48","9da2920a.d3dcf"],"x":1595,"y":2220,"wires":[]},{"id":"a0962bd1.ff01d8","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Log viewer","tooltip":"","group":"ed8a86bc.a4c3c8","order":1,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":390,"y":2380,"wires":[["d0ae4b2f.427088"]]},{"id":"566f496d.8f83a8","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Telegram","tooltip":"","group":"ed8a86bc.a4c3c8","order":6,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":400,"y":2500,"wires":[["90a74ae0.467da8"]]},{"id":"94528a65.a7c5a8","type":"link out","z":"7c56a241.1e88dc","name":"image processing log","links":["8955e407.c229a8"],"x":1295,"y":1820,"wires":[]},{"id":"90c15ace.744d38","type":"link out","z":"7c56a241.1e88dc","name":"video processing log","links":["7db82604.766668"],"x":2275,"y":720,"wires":[]},{"id":"cb0302ed.86b68","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Image processing","tooltip":"","group":"ed8a86bc.a4c3c8","order":9,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":430,"y":2560,"wires":[["7062d5.ae079d2c"]]},{"id":"c848e772.3372c8","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Video processing","tooltip":"","group":"ed8a86bc.a4c3c8","order":12,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":430,"y":2620,"wires":[["9e7aa6b9.a3aec8"]]},{"id":"92315135.c375","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Kodi","tooltip":"","group":"ed8a86bc.a4c3c8","order":15,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":390,"y":2680,"wires":[["ed82e0a.7178e2"]]},{"id":"a9f1d6c0.bdad98","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Notification","tooltip":"","group":"ed8a86bc.a4c3c8","order":18,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":450,"y":2740,"wires":[["765398a4.b9e368"]]},{"id":"43ba01e7.71d22","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Loaded file","tooltip":"","group":"ed8a86bc.a4c3c8","order":20,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":450,"y":2800,"wires":[["4620b04a.2cb87"]]},{"id":"dac1c7a9.36f708","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Playlist position","tooltip":"","group":"ed8a86bc.a4c3c8","order":22,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":460,"y":2860,"wires":[["94272a3.f8fe7d8"]]},{"id":"686d5e.720612a4","type":"link in","z":"dfa0e0a5.c8001","name":"","links":["de98e67.3745118"],"x":1055,"y":2680,"wires":[["2722e227.c155ce","af8a1bd5.70fd88","bbae2266.5191b","130ec80f.42e838"]]},{"id":"8955e407.c229a8","type":"link in","z":"dfa0e0a5.c8001","name":"","links":["94528a65.a7c5a8"],"x":1055,"y":2560,"wires":[["bed2a344.88ac9"]]},{"id":"7db82604.766668","type":"link in","z":"dfa0e0a5.c8001","name":"","links":["90c15ace.744d38"],"x":1055,"y":2620,"wires":[["623898a8.818cc8"]]},{"id":"d0ae4b2f.427088","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logViewer","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":2380,"wires":[[]]},{"id":"90a74ae0.467da8","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logTelegram","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":2500,"wires":[[]]},{"id":"7062d5.ae079d2c","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logImageProcessing","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":2560,"wires":[[]]},{"id":"9e7aa6b9.a3aec8","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logVideoProcessing","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":2620,"wires":[[]]},{"id":"ed82e0a.7178e2","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logKodi","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":2680,"wires":[[]]},{"id":"765398a4.b9e368","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logKodiNotification","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":2740,"wires":[[]]},{"id":"4620b04a.2cb87","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logKodiLoadedFile","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":2800,"wires":[[]]},{"id":"94272a3.f8fe7d8","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logKodiPlaylistPostition","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":2860,"wires":[[]]},{"id":"8e6050ec.de18","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Log notification","tooltip":"","group":"ed8a86bc.a4c3c8","order":3,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":400,"y":2440,"wires":[["88bd5003.c3dd6"]]},{"id":"88bd5003.c3dd6","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logNotification","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":2440,"wires":[[]]},{"id":"2f725b3.8d712a4","type":"ui_text","z":"dfa0e0a5.c8001","group":"ed8a86bc.a4c3c8","order":25,"width":0,"height":0,"name":"","label":"","format":"Log Viewer","layout":"row-left","x":1830,"y":2520,"wires":[]},{"id":"30d31201.b8a49e","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"20","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1870,"y":2680,"wires":[]},{"id":"51e8903c.e8918","type":"function","z":"dfa0e0a5.c8001","name":"gate logViewer","func":"if (flow.get('logViewer')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1660,"y":2580,"wires":[["13850e93.5260c1"]]},{"id":"b160453e.e811d8","type":"function","z":"dfa0e0a5.c8001","name":"gate logNotification","func":"if (flow.get('logNotification')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1670,"y":2680,"wires":[["30d31201.b8a49e"]]},{"id":"56b9832e.25f3bc","type":"function","z":"dfa0e0a5.c8001","name":"gate logTelegram","func":"if (flow.get('logTelegram')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1210,"y":2500,"wires":[["1132d409.47429c"]]},{"id":"bed2a344.88ac9","type":"function","z":"dfa0e0a5.c8001","name":"gate logImageProcessing","func":"if (flow.get('logImageProcessing')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1230,"y":2560,"wires":[["8e46c22a.24e92"]]},{"id":"623898a8.818cc8","type":"function","z":"dfa0e0a5.c8001","name":"gate logVideoProcessing","func":"if (flow.get('logVideoProcessing')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1230,"y":2620,"wires":[["bdbb26a4.908cf8"]]},{"id":"2722e227.c155ce","type":"function","z":"dfa0e0a5.c8001","name":"gate logKodi","func":"if (flow.get('logKodi')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1210,"y":2680,"wires":[["7fce3eb4.f6485"]]},{"id":"af8a1bd5.70fd88","type":"function","z":"dfa0e0a5.c8001","name":"gate logKodiNotification","func":"try{\n    if (flow.get('logKodiNotification')){\n        msg.payload = msg.payload.method;\n        if (msg.payload !== undefined){\n            return msg;\n        }\n    }\n} catch (e){}","outputs":1,"noerr":0,"x":1250,"y":2740,"wires":[["51e8903c.e8918","b160453e.e811d8"]]},{"id":"bbae2266.5191b","type":"function","z":"dfa0e0a5.c8001","name":"gate logKodiLoadedFile","func":"try {\n    if (flow.get('logKodiLoadedFile')){\n        msg.payload = msg.payload.params.data.item.file;\n        if (msg.payload !== undefined){\n            return msg;\n        }\n    }\n} catch (e){}","outputs":1,"noerr":0,"x":1250,"y":2800,"wires":[["51e8903c.e8918","b160453e.e811d8"]]},{"id":"130ec80f.42e838","type":"function","z":"dfa0e0a5.c8001","name":"gate logKodiPlaylistPostition","func":"try {\n    if (flow.get('logKodiPlaylistPostition')){\n        msg.payload = msg.payload.params.data.position;\n        if (msg.payload !== undefined){\n            return msg;\n        }\n    }\n} catch (e){}","outputs":1,"noerr":0,"x":1260,"y":2860,"wires":[["51e8903c.e8918","b160453e.e811d8"]]},{"id":"7fce3eb4.f6485","type":"json","z":"dfa0e0a5.c8001","name":"","property":"payload","action":"","pretty":false,"x":1350,"y":2680,"wires":[["51e8903c.e8918","b160453e.e811d8"]]},{"id":"1132d409.47429c","type":"json","z":"dfa0e0a5.c8001","name":"","property":"payload","action":"","pretty":false,"x":1370,"y":2500,"wires":[["51e8903c.e8918","b160453e.e811d8"]]},{"id":"802f2087.1a5db","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"return {payload: \"Neues Video bereit!\"};","outputs":1,"noerr":0,"x":2070,"y":840,"wires":[["d073c6c8.b0c938","90c15ace.744d38"]]},{"id":"d073c6c8.b0c938","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":2270,"y":840,"wires":[]},{"id":"8e46c22a.24e92","type":"json","z":"dfa0e0a5.c8001","name":"","property":"payload","action":"","pretty":false,"x":1410,"y":2560,"wires":[["51e8903c.e8918","b160453e.e811d8"]]},{"id":"bdbb26a4.908cf8","type":"json","z":"dfa0e0a5.c8001","name":"","property":"payload","action":"","pretty":false,"x":1410,"y":2620,"wires":[["51e8903c.e8918","b160453e.e811d8"]]},{"id":"bae46ed.a8acd9","type":"function","z":"7c56a241.1e88dc","name":"set FL Folder","func":"msg.payload = {start: global.get('videos-incoming')};\nreturn msg;","outputs":1,"noerr":0,"x":1730,"y":340,"wires":[["da9c1c87.525a7"]]},{"id":"da9c1c87.525a7","type":"fs-file-lister","z":"7c56a241.1e88dc","name":"","start":"global.get('images-incoming')","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":1880,"y":340,"wires":[["92d49688.3a73e8"]]},{"id":"4933f282.11bdac","type":"function","z":"7c56a241.1e88dc","name":"wget video","func":"try {\n    msg.payload = \"wget \" + msg.weblink + \" -P \" + global.get('videos-incoming');\n    return msg;\n} catch (e){}","outputs":1,"noerr":0,"x":1250,"y":340,"wires":[["103f13b1.59e58c"]]},{"id":"82c9e878.fb1c58","type":"function","z":"7c56a241.1e88dc","name":"clear incoming folder + extract weblink","func":"var weblink = msg.payload.weblink;\nvar payload = \"rm \" + global.get('videos-incoming') + \"*\";\nreturn {weblink, payload};","outputs":1,"noerr":0,"x":1390,"y":220,"wires":[["86961ee5.7ce62"]]},{"id":"86961ee5.7ce62","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1610,"y":220,"wires":[[],[],["474f5e86.da04c"]]},{"id":"474f5e86.da04c","type":"function","z":"7c56a241.1e88dc","name":"clear preprocessing folder","func":"msg.payload = \"rm \" + global.get('videos-preprocessing') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":220,"wires":[["b02278e4.468e78"]]},{"id":"b02278e4.468e78","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1990,"y":220,"wires":[[],[],["4933f282.11bdac"]]},{"id":"30c4b416.1f49bc","type":"comment","z":"7c56a241.1e88dc","name":"download video","info":"","x":1240,"y":280,"wires":[]},{"id":"e3c7e497.d96b48","type":"comment","z":"7c56a241.1e88dc","name":"check video resolution","info":"","x":780,"y":400,"wires":[]},{"id":"671bf4a1.795e0c","type":"function","z":"7c56a241.1e88dc","name":"assign file ID","func":"var idCounterVideos = global.get('idCounterVideos') || false;\nidCounterVideos++;\nglobal.set('idCounterVideos', idCounterVideos);\n\nmsg.fileId = idCounterVideos;\nreturn msg;\n","outputs":1,"noerr":0,"x":1210,"y":460,"wires":[["a0f475fb.d70448","159c8022.4d496"]]},{"id":"b2587076.700d2","type":"comment","z":"7c56a241.1e88dc","name":"create array element + move to folders","info":"","x":1290,"y":420,"wires":[]},{"id":"a0f475fb.d70448","type":"function","z":"7c56a241.1e88dc","name":"build array element","func":"var fileId = msg.fileId;\nvar container = flow.get('filenameVideoIncoming').slice(flow.get('filenameVideoIncoming').lastIndexOf('.')+1, flow.get('filenameVideoIncoming').length);\nvar filename = fileId + \".\" + container;\nvar filenameThumb = fileId + \".thumb.jpg\";\n\nvar duration = parseFloat(parseFloat(msg.payload.format.duration).toFixed(1));\n\nfor (var i=0; i < msg.payload.streams.length; i++) {\n    if (msg.payload.streams[i].coded_height >= 0){\n        var videoHeight = msg.payload.streams[i].coded_height;\n        var videoWidth = msg.payload.streams[i].coded_width;\n        break;\n    }\n}\n\nvar user = flow.get('lastTelegramUsernameVideo');\nvar chatId = flow.get('lastTelegramChatidVideo');\n\nvar timestamp = Date.now();\n\nvar video = {   fileId,\n                container,\n                filename,\n                filenameThumb,\n                duration,\n                videoHeight,\n                videoWidth,\n                user,\n                chatId,\n                timestamp\n}\n\nmsg = { video };\n\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":460,"wires":[["a4cae3d9.5fd0d","4f985e66.ad72a"]]},{"id":"cd76f8c3.9e0868","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramChatidVideo","func":"flow.set('lastTelegramChatidVideo', msg.payload.chatId);\nreturn msg;","outputs":1,"noerr":0,"x":1380,"y":160,"wires":[["b649b8ce.b72af8"]]},{"id":"1c0992ef.589c0d","type":"comment","z":"7c56a241.1e88dc","name":"extract user data","info":"","x":1320,"y":120,"wires":[]},{"id":"b649b8ce.b72af8","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramUsernameVideo","func":"// Variablen abspeichern\n\nvar userlist = global.get('userlist');\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].chatid == msg.payload.chatId){\n        msg.payload = userlist[i].name;\n        flow.set('lastTelegramUsernameVideo', msg.payload);\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":1710,"y":160,"wires":[[]]},{"id":"245967b5.d39638","type":"link out","z":"7c56a241.1e88dc","name":"","links":["5e85c279.d9f46c"],"x":1415,"y":40,"wires":[]},{"id":"f25cb36f.09898","type":"function","z":"7c56a241.1e88dc","name":"busy = true","func":"msg.payload = true;\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":40,"wires":[["245967b5.d39638"]]},{"id":"6e0e2ea5.91521","type":"function","z":"7c56a241.1e88dc","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":760,"wires":[["cb9645f6.a71318","802f2087.1a5db","b0c86b6e.5f0448","10edf153.ea2cff"]]},{"id":"b0c86b6e.5f0448","type":"function","z":"7c56a241.1e88dc","name":"add video element to arrayVideos","func":"var array = global.get('arrayVideos') || [];\narray.unshift(msg.video);\n\nvar payload = array;\n\nreturn {payload};","outputs":1,"noerr":0,"x":2100,"y":900,"wires":[["8f3c42f6.f4e8"]]},{"id":"8f3c42f6.f4e8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["85c423a5.b5f07"],"x":2275,"y":900,"wires":[]},{"id":"7701862f.4b7868","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"return {payload: \"Video wird verarbeitet...\"};","outputs":1,"noerr":0,"x":1450,"y":80,"wires":[["b8fea96d.2450b8"]]},{"id":"b8fea96d.2450b8","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"120","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1630,"y":80,"wires":[]},{"id":"c7902211.1744e","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1300,"y":80,"wires":[["7701862f.4b7868"]]},{"id":"467cc9b0.81f1f8","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1030,"y":180,"wires":[]},{"id":"2804a714.736958","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"return {payload: \"Neues Video angekommen!\"};","outputs":1,"noerr":0,"x":850,"y":180,"wires":[["467cc9b0.81f1f8"]]},{"id":"542bc0a0.667d9","type":"function","z":"7c56a241.1e88dc","name":"clear folders","func":"msg.payload = \"sudo rm -rf \" + global.get('videos-incoming') + \"* && rm -rf \" + global.get('videos-preprocessing') + \"*\";\nreturn msg;\n","outputs":1,"noerr":0,"x":2210,"y":660,"wires":[["ad49ff1e.8974b"]]},{"id":"159c8022.4d496","type":"function","z":"7c56a241.1e88dc","name":"fileId -> payl.","func":"return {payload: msg.fileId};","outputs":1,"noerr":0,"x":1310,"y":500,"wires":[[]]},{"id":"9db3a5a8.3a6578","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"b242fa6a.175d28","order":3,"width":6,"height":1,"passthru":false,"label":"Reset Images","tooltip":"","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"0","payloadType":"num","topic":"","x":180,"y":3560,"wires":[["47128a2.14a4374"]]},{"id":"c55f041.3fb3cf8","type":"ui_toast","z":"dfa0e0a5.c8001","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":750,"y":3560,"wires":[["d4b5ee8a.d3314"]]},{"id":"d4b5ee8a.d3314","type":"function","z":"dfa0e0a5.c8001","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":890,"y":3560,"wires":[["18ccf7d5.67e628","9ecc2a87.5dea58","4ed088bd.01c288","d5a6eaa1.a7c8a8","cc21b846.ab0698","c0f0ed03.380c8"]]},{"id":"47128a2.14a4374","type":"function","z":"dfa0e0a5.c8001","name":"\"sicher?\"","func":"return {payload: \"Sämtliche Bilder werden gelöscht! Trotzdem fortfahren?\"};","outputs":1,"noerr":0,"x":600,"y":3560,"wires":[["c55f041.3fb3cf8"]]},{"id":"2cf5c8ed.5c0fc8","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"b242fa6a.175d28","order":4,"width":6,"height":1,"passthru":false,"label":"Reset Videos","tooltip":"","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"0","payloadType":"num","topic":"","x":170,"y":3600,"wires":[["17e4ba5.56d4946"]]},{"id":"2ebf00b9.e6be1","type":"ui_toast","z":"dfa0e0a5.c8001","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":750,"y":3600,"wires":[["fded0bff.5197f8"]]},{"id":"fded0bff.5197f8","type":"function","z":"dfa0e0a5.c8001","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":890,"y":3600,"wires":[["f9a57e9a.d198f","fbb06c1c.887b4","e4a68d8d.087a6","d5a6eaa1.a7c8a8","f529d98e.b7f7e8","7d0eddcb.aee194"]]},{"id":"17e4ba5.56d4946","type":"function","z":"dfa0e0a5.c8001","name":"\"sicher?\"","func":"return {payload: \"Sämtliche Videos werden gelöscht! Trotzdem fortfahren?\"};","outputs":1,"noerr":0,"x":600,"y":3600,"wires":[["2ebf00b9.e6be1"]]},{"id":"c0f0ed03.380c8","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Images reset / initalized!\"};","outputs":1,"noerr":0,"x":1310,"y":3440,"wires":[["855bc464.35f718"]]},{"id":"7d0eddcb.aee194","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Videos reset / initalized!\"};","outputs":1,"noerr":0,"x":1310,"y":3480,"wires":[["855bc464.35f718"]]},{"id":"3e6ba881.c71658","type":"exec","z":"5af1388b.ef9838","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1050,"y":4220,"wires":[[],[],["69a6450f.f46c4c"]]},{"id":"f0b0fca1.b92ca","type":"function","z":"5af1388b.ef9838","name":"remove element + delete file","func":"var i = flow.get('currentVideoIndex');\nvar array = global.get('arrayVideos');\nvar cmd = \"\";\n\ncmd = cmd + \"rm \" + global.get('videos-loop') + array[i].filename + \" \" + global.get('videos-loop') + array[i].filenameThumb;\n\narray.splice(i, 1);\n\nmsg.payload = cmd;\n\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":4220,"wires":[["3e6ba881.c71658"]]},{"id":"69a6450f.f46c4c","type":"function","z":"5af1388b.ef9838","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1200,"y":4220,"wires":[[],["9631b6fb.6bf2a8","22e0cc04.f962f4"]]},{"id":"8216943e.04e058","type":"ui_toast","z":"5af1388b.ef9838","position":"bottom right","displayTime":"5","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":1250,"y":4300,"wires":[]},{"id":"9631b6fb.6bf2a8","type":"function","z":"5af1388b.ef9838","name":"Gelöscht!","func":"return {payload: \"Video gelöscht!\"};","outputs":1,"noerr":0,"x":1080,"y":4300,"wires":[["8216943e.04e058"]]},{"id":"22e0cc04.f962f4","type":"link out","z":"5af1388b.ef9838","name":"","links":["85c423a5.b5f07","dfb24a84.063dd8"],"x":1315,"y":4200,"wires":[]},{"id":"dfb24a84.063dd8","type":"link in","z":"5af1388b.ef9838","name":"","links":["22e0cc04.f962f4"],"x":235,"y":4060,"wires":[["3d27329c.35b44e"]]},{"id":"1ba799e8.ce0a76","type":"link in","z":"5af1388b.ef9838","name":"navigate videos","links":["699efe5b.79aaf"],"x":455,"y":4100,"wires":[["25e42f88.5da1f"]]},{"id":"699efe5b.79aaf","type":"link out","z":"7c56a241.1e88dc","name":"","links":["1ba799e8.ce0a76"],"x":2275,"y":940,"wires":[]},{"id":"10edf153.ea2cff","type":"function","z":"7c56a241.1e88dc","name":"'start'","func":"msg.payload = \"start\";\nreturn msg;","outputs":1,"noerr":0,"x":2010,"y":940,"wires":[["699efe5b.79aaf"]]},{"id":"a5306045.8471f","type":"function","z":"5af1388b.ef9838","name":"gate if noStore==false","func":"if(!(global.get('noStorePlayerStatus') || false)){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":760,"y":540,"wires":[["f0febbb2.cdecf8"]]},{"id":"157f41d2.cdfd6e","type":"link in","z":"5af1388b.ef9838","name":"Start/Stop Notification","links":["cf207f67.3c883"],"x":1235,"y":1060,"wires":[["21caab0.4054556"]]},{"id":"cf207f67.3c883","type":"link out","z":"5af1388b.ef9838","name":"","links":["157f41d2.cdfd6e"],"x":555,"y":600,"wires":[]},{"id":"98c00bb2.6f0578","type":"function","z":"5af1388b.ef9838","name":"noStore true","func":"global.set('noStorePlayerStatus', true);\n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":3720,"wires":[["1f3ff909.cbf857","45b82b56.149bf4","f2193147.99e4f"]]},{"id":"470c03.aa5443fc","type":"function","z":"5af1388b.ef9838","name":"noStore false","func":"global.set('noStorePlayerStatus', false);\n\nreturn msg;","outputs":1,"noerr":0,"x":1450,"y":3780,"wires":[[]]},{"id":"45b82b56.149bf4","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1300,"y":3780,"wires":[["470c03.aa5443fc"]]},{"id":"e3c8035e.2187d","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Restart Kodi...\"};","outputs":1,"noerr":0,"x":1450,"y":1480,"wires":[["5a3ce8db.4f1ef8"]]},{"id":"3cca1d3d.a16312","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"reset","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2150,"y":60,"wires":[["4e854f6.a31ecb"]]},{"id":"4bea07df.762418","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":160,"wires":[["c6be6051.f6e5f"]]},{"id":"2c521d56.e8dc22","type":"comment","z":"5af1388b.ef9838","name":"Trash","info":"","x":150,"y":2140,"wires":[]},{"id":"8623ab88.bb4f58","type":"file in","z":"5af1388b.ef9838","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":370,"y":2380,"wires":[["d08579b.d5a3688"]]},{"id":"465ac9d9.0ff968","type":"comment","z":"5af1388b.ef9838","name":"Trash Dashboard Preview","info":"","x":270,"y":2320,"wires":[]},{"id":"d08579b.d5a3688","type":"base64","z":"5af1388b.ef9838","name":"","action":"str","property":"payload","x":500,"y":2380,"wires":[["2f8674ca.7a17cc"]]},{"id":"2f8674ca.7a17cc","type":"ui_template","z":"5af1388b.ef9838","group":"31e0ed7e.859452","name":"","order":2,"width":12,"height":4,"format":"<img width=\"100%\" height=\"100%\" alt=\"\" src=\"data:image/jpg;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":660,"y":2380,"wires":[[]]},{"id":"f4c9e1ac.9add8","type":"ui_table","z":"5af1388b.ef9838","group":"31e0ed7e.859452","name":"","order":5,"width":12,"height":8,"columns":[{"field":"id","title":"ID","width":"15","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"pic","title":"Bild","width":"115","align":"center","formatter":"image","formatterParams":{"target":"_blank"}},{"field":"text","title":"Nachricht","width":"99","align":"left","formatter":"html","formatterParams":{"target":"_blank"}},{"field":"user","title":"Absender","width":"75","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":770,"y":2240,"wires":[["43a4bf7.1fd184","64d38062.4b0f2"]]},{"id":"a6ba7a3.3e53088","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":180,"y":2200,"wires":[["f5439617.ce1af8"]]},{"id":"f5439617.ce1af8","type":"function","z":"5af1388b.ef9838","name":"prepare fs-array for table ","func":"var fileList = [];\n\nvar pic;\nvar text;\nvar user;\nvar id;\n\nvar array = global.get('arrayImages');\n\nvar domain = global.get('domain');\nif (domain.slice(-1) !== \"/\"){\n    domain = domain + \"/\";\n}\n\nvar j = 0;\nfor (var i=0; i < array.length; i++) {\n    \n    if (array[i].trashFlag){\n        \n        id = array[i].fileId;\n        user = array[i].user;\n        pic = \"http://\" + domain + \"telegram/images/03.loop/\" + array[i].filenamePicThumb;\n        \n        if (array[i].textFlag){\n            text = \"<small>\" + array[i].text + \"</small>\";\n        } else {\n            text = \"\";\n        }\n        fileList[j] = {id, pic, text, user};\n        j++;        \n    }\n}\n\nmsg.payload = fileList;\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":2240,"wires":[["49d091c2.f5d6b"]]},{"id":"43a4bf7.1fd184","type":"function","z":"5af1388b.ef9838","name":"get file","func":"var file;\n\nif (msg.topic === \"text\" && msg.payload.text !== \"\"){\n    file = msg.payload.id + \".text.dash.jpg\";\n\n} else {\n    file = msg.payload.id + \".pic.dash.jpg\";\n}\n\nvar filename = global.get('images-loop') + file;\n\nreturn {filename};","outputs":1,"noerr":0,"x":230,"y":2380,"wires":[["8623ab88.bb4f58"]]},{"id":"3746518d.48a34e","type":"ui_button","z":"5af1388b.ef9838","name":"","group":"31e0ed7e.859452","order":3,"width":6,"height":1,"passthru":false,"label":"Wiederherstellen","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Wirklich wiederherstellen?","payloadType":"str","topic":"","x":210,"y":2540,"wires":[["9b35d90.e644f28"]]},{"id":"63420aa1.18d0c4","type":"ui_text","z":"5af1388b.ef9838","group":"31e0ed7e.859452","order":1,"width":12,"height":1,"name":"","label":"","format":"{{msg.payload}}","layout":"row-right","x":650,"y":2440,"wires":[]},{"id":"64d38062.4b0f2","type":"function","z":"5af1388b.ef9838","name":"get fileId","func":"msg.payload = msg.payload.id;\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":2440,"wires":[["92b0452a.b0e828","5ebe2f67.7a30f"]]},{"id":"92b0452a.b0e828","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"currentTrashFileId","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":2480,"wires":[["51e3d51d.08afcc"]]},{"id":"20b65aba.c8c516","type":"function","z":"5af1388b.ef9838","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":530,"y":2540,"wires":[["3984b9c3.4ea916"]]},{"id":"9b35d90.e644f28","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":390,"y":2540,"wires":[["20b65aba.c8c516"]]},{"id":"3c74d42b.a71a5c","type":"ui_toast","z":"5af1388b.ef9838","position":"bottom right","displayTime":"5","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":1070,"y":2500,"wires":[]},{"id":"3035e00c.b4b0a","type":"function","z":"5af1388b.ef9838","name":"\"Wiederhergestellt\"","func":"return {payload: \"Wiederhergestellt!\"};","outputs":1,"noerr":0,"x":1010,"y":2540,"wires":[["3c74d42b.a71a5c"]]},{"id":"d74a39b6.3ecd38","type":"function","z":"5af1388b.ef9838","name":"remove element + delete files","func":"var i = flow.get('currentTrashIndex');\nvar array = global.get('arrayImages');\nvar cmd = \"\";\n\ncmd = cmd + \"rm \" + global.get('images-loop') + array[i].filenamePic + \" \";\ncmd = cmd + global.get('images-loop') + array[i].filenamePicDash + \" \";\ncmd = cmd + global.get('images-loop') + array[i].filenamePicThumb + \" \";\n\nif (array[i].textFlag){\n    cmd = cmd + global.get('images-loop') + array[i].filenameText + \" \";\n    cmd = cmd + global.get('images-loop') + array[i].filenameTextDash + \" \";\n    cmd = cmd + global.get('images-loop') + array[i].filenameTextThumb + \" \";\n}\n\narray.splice(i, 1);\n\nmsg.payload = cmd;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":720,"y":2600,"wires":[["e5945805.f25008"]]},{"id":"e5945805.f25008","type":"exec","z":"5af1388b.ef9838","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":910,"y":2600,"wires":[[],[],["b78e730a.e8896"]]},{"id":"b78e730a.e8896","type":"function","z":"5af1388b.ef9838","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1040,"y":2600,"wires":[[],["6958be77.1c1ff","ada16f09.67681"]]},{"id":"6958be77.1c1ff","type":"function","z":"5af1388b.ef9838","name":"Gelöscht!","func":"return {payload: \"Bild / Nachricht gelöscht!\"};","outputs":1,"noerr":0,"x":900,"y":2680,"wires":[["4073413e.0b532"]]},{"id":"4073413e.0b532","type":"ui_toast","z":"5af1388b.ef9838","position":"bottom right","displayTime":"5","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":1070,"y":2680,"wires":[]},{"id":"ada16f09.67681","type":"link out","z":"5af1388b.ef9838","name":"","links":["afffc469.d39e48","9da2920a.d3dcf"],"x":1155,"y":2600,"wires":[]},{"id":"5ebe2f67.7a30f","type":"function","z":"5af1388b.ef9838","name":"format text","func":"msg.payload = \"ID: \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":2440,"wires":[["63420aa1.18d0c4"]]},{"id":"aaa772b3.c5ef1","type":"ui_button","z":"5af1388b.ef9838","name":"","group":"31e0ed7e.859452","order":4,"width":6,"height":1,"passthru":false,"label":"Endgültig löschen","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Wirklich endgültig löschen?","payloadType":"str","topic":"","x":210,"y":2600,"wires":[["e64a4ae4.e9ad68"]]},{"id":"3e8a8995.e8d236","type":"function","z":"5af1388b.ef9838","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":530,"y":2600,"wires":[["d74a39b6.3ecd38"]]},{"id":"e64a4ae4.e9ad68","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":390,"y":2600,"wires":[["3e8a8995.e8d236"]]},{"id":"3984b9c3.4ea916","type":"function","z":"5af1388b.ef9838","name":"restore array element (set index 0)","func":"var array = global.get('arrayImages');\nvar i = flow.get('currentTrashIndex');\n\narray.unshift((array.splice(i, 1))[0]);\narray[0].trashFlag = false;\narray[0].stickFlag = false;\n\nmsg.payload = array;\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":2540,"wires":[["3035e00c.b4b0a","f92cc322.9e0af"]]},{"id":"51e3d51d.08afcc","type":"function","z":"5af1388b.ef9838","name":"set flow.currentTrashIndex","func":"array = global.get('arrayImages');\n\nfor (var i=0; i < array.length; i++) {\n \n    if (array[i].fileId === msg.payload){\n        flow.set('currentTrashIndex', i);\n        return {payload: i}\n    }\n}\n","outputs":1,"noerr":0,"x":720,"y":2480,"wires":[[]]},{"id":"f92cc322.9e0af","type":"link out","z":"5af1388b.ef9838","name":"","links":["afffc469.d39e48","d66bb54a.5ceb38","a287912.886f77","9da2920a.d3dcf"],"x":915,"y":2500,"wires":[]},{"id":"49d091c2.f5d6b","type":"function","z":"5af1388b.ef9838","name":"if empty","func":"if (msg.payload.length === 0){\n    \n    var msg2 = {payload: \"Papierkorb leer\"};\n    return [msg, msg2];\n    \n} else {\n    var msg2 = {payload: \"Kein Element ausgewählt\"};\n    return [msg, msg2];\n}\n","outputs":2,"noerr":0,"x":600,"y":2240,"wires":[["f4c9e1ac.9add8"],["2f8674ca.7a17cc","63420aa1.18d0c4"]]},{"id":"409f18d0.8a43a8","type":"ui_button","z":"5af1388b.ef9838","name":"stick","group":"6716ccf6.78cf14","order":4,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-paperclip","payload":"stick","payloadType":"str","topic":"","x":390,"y":1880,"wires":[["eb7966eb.f3d748"]]},{"id":"c9534005.ef975","type":"ui_button","z":"5af1388b.ef9838","name":"delete","group":"6716ccf6.78cf14","order":5,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"Wirklich löschen?","payloadType":"str","topic":"","x":190,"y":2060,"wires":[["7314feb7.545db"]]},{"id":"d49dfd93.4345e","type":"function","z":"5af1388b.ef9838","name":"get index","func":"msg.index = flow.get('currentBrowserIndex');\nmsg.restoreStatus = true;\n\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":2000,"wires":[["2ee33e7e.9478e2"]]},{"id":"2ee33e7e.9478e2","type":"link out","z":"5af1388b.ef9838","name":"","links":["6a49db86.c09794"],"x":535,"y":2000,"wires":[]},{"id":"415a6124.9570f","type":"function","z":"5af1388b.ef9838","name":"Gelöscht!","func":"return {payload: \"Gelöscht!\"};","outputs":1,"noerr":0,"x":800,"y":2000,"wires":[["ba46d065.19113"]]},{"id":"ba46d065.19113","type":"ui_toast","z":"5af1388b.ef9838","position":"bottom right","displayTime":"5","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":970,"y":2000,"wires":[]},{"id":"756bb1ab.440ed","type":"function","z":"5af1388b.ef9838","name":"trashFlag = true","func":"var array = global.get('arrayImages');\nvar arrayElement = array[flow.get('currentBrowserIndex')];\narrayElement.trashFlag = true;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":2060,"wires":[["415a6124.9570f","e1f2705d.dcf9c"]]},{"id":"e1f2705d.dcf9c","type":"link out","z":"5af1388b.ef9838","name":"","links":["2287a13a.7d44de","afffc469.d39e48","6fc7188d.772e58","9da2920a.d3dcf"],"x":775,"y":2060,"wires":[]},{"id":"2b61fb66.23dd04","type":"function","z":"5af1388b.ef9838","name":"set color","func":"var array = global.get('arrayImages');\nvar arrayElement = array[flow.get('currentBrowserIndex')];\n\nif(arrayElement.stickFlag){\n    msg.payload = \"#eb4034\";\n} else {\n    msg.payload = \"\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":1880,"wires":[["409f18d0.8a43a8","e772d0dc.29602"]]},{"id":"eb7966eb.f3d748","type":"function","z":"5af1388b.ef9838","name":"set stickFlag","func":"var array = global.get('arrayImages');\nvar arrayElement = array[flow.get('currentBrowserIndex')];\n\nif (arrayElement.stickFlag){\n    \n    arrayElement.stickFlag = false;\n    msg.payload.stickFlag = false;\n\n} else {\n    arrayElement.stickFlag =  true;\n    msg.payload.stickFlag = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1940,"wires":[["1664a1ac.abc21e","2b61fb66.23dd04"]]},{"id":"1664a1ac.abc21e","type":"link out","z":"5af1388b.ef9838","name":"","links":["afffc469.d39e48","9da2920a.d3dcf"],"x":535,"y":1940,"wires":[]},{"id":"e772d0dc.29602","type":"function","z":"5af1388b.ef9838","name":"if player ID == trash ID","func":"if (flow.get('currentBrowserFileId') === (global.get('currentImagePlayer')).fileId){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":540,"y":1840,"wires":[["9f79574e.a9f8e8"]]},{"id":"9f79574e.a9f8e8","type":"link out","z":"5af1388b.ef9838","name":"","links":["c6f23b9.44a68c8"],"x":695,"y":1840,"wires":[]},{"id":"c6f23b9.44a68c8","type":"link in","z":"5af1388b.ef9838","name":"","links":["9f79574e.a9f8e8"],"x":300,"y":1100,"wires":[["6ca0a6f5.8b6858"]]},{"id":"534ae1a2.e1d7c","type":"link in","z":"5af1388b.ef9838","name":"","links":["1627a60d.25447a"],"x":255,"y":1840,"wires":[["409f18d0.8a43a8"]]},{"id":"a6b49aab.c5a378","type":"function","z":"5af1388b.ef9838","name":"if player ID == trash ID","func":"if (flow.get('currentBrowserFileId') === (global.get('currentImagePlayer')).fileId){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":500,"y":1100,"wires":[["1627a60d.25447a"]]},{"id":"1627a60d.25447a","type":"link out","z":"5af1388b.ef9838","name":"","links":["534ae1a2.e1d7c"],"x":655,"y":1100,"wires":[]},{"id":"f57ee176.4af02","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1760,"y":600,"wires":[["e77e35ba.be7f28"],["f497dcbc.95ac","6e0e2ea5.91521"]]},{"id":"eaf80973.96d208","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1630,"y":600,"wires":[[],[],["f57ee176.4af02"]]},{"id":"b3990b58.8c4038","type":"function","z":"7c56a241.1e88dc","name":"create thumbnail","func":"var scale = \"-1:71\";\nvar posSec = msg.video.duration/2;\n\n\nmsg.payload = \"ffmpeg -i \" + global.get('videos-loop') + msg.video.filename + \" -vframes 1 -an -vf scale=\" + scale + \" -ss \" + posSec + \" \" + global.get('videos-loop') + msg.video.fileId + \".thumb.jpg\";\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":600,"wires":[["eaf80973.96d208"]]},{"id":"e77e35ba.be7f28","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1835,"y":540,"wires":[]},{"id":"7746634f.84282c","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8"],"x":2115,"y":440,"wires":[]},{"id":"d2a29d7b.73c96","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8"],"x":1515,"y":680,"wires":[]},{"id":"19e8aef9.44e0a1","type":"ui_table","z":"5af1388b.ef9838","group":"c51c9a95.f2cb68","name":"","order":12,"width":12,"height":8,"columns":[{"field":"id","title":"ID","width":"40","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"video","title":"Video","width":"134","align":"center","formatter":"image","formatterParams":{"target":"_blank"}},{"field":"duration","title":"Dauer","width":"60","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"user","title":"Absender","width":"93","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":810,"y":4480,"wires":[["772e312b.c813e","5dcde226.676a8c"]]},{"id":"82174c6e.c7915","type":"function","z":"5af1388b.ef9838","name":"prepare fs-array for table ","func":"var fileList = [];\n\nvar video;\nvar user;\nvar id;\nvar duration;\n\nvar array = global.get('arrayVideos');\n\nvar domain = global.get('domain');\nif (domain.slice(-1) !== \"/\"){\n    domain = domain + \"/\";\n}\n\nvar j = 0;\nfor (var i=0; i < array.length; i++) {\n    \n    id = array[i].fileId;\n    user = array[i].user;\n    duration = array[i].duration + \" s\";\n    video = \"http://\" + domain + \"telegram/videos/03.loop/\" + array[i].filenameThumb;\n    \n    fileList[j] = {id, video, user, duration};\n    j++;        \n}\n\nmsg.payload = fileList;\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":4480,"wires":[["aec4a46a.c75198"]]},{"id":"aec4a46a.c75198","type":"function","z":"5af1388b.ef9838","name":"if empty","func":"if (msg.payload.length === 0){\n    \n    var msg2 = {payload: \"Papierkorb leer\"};\n    return [msg, msg2];\n    \n} else {\n    var msg2 = {payload: \"Kein Element ausgewählt\"};\n    return [msg, msg2];\n}\n","outputs":2,"noerr":0,"x":660,"y":4480,"wires":[["19e8aef9.44e0a1"],[]]},{"id":"3e7e6426.1cb65c","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":260,"y":4520,"wires":[["82174c6e.c7915"]]},{"id":"c2ce12a5.26676","type":"comment","z":"5af1388b.ef9838","name":"Video Browser","info":"","x":240,"y":4420,"wires":[]},{"id":"772e312b.c813e","type":"function","z":"5af1388b.ef9838","name":"get file","func":"msg.payload = msg.payload.id + \".mp4\";\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":4480,"wires":[["68fc4dbf.54ee94"]]},{"id":"7230f944.ecc798","type":"link in","z":"5af1388b.ef9838","name":"","links":["68fc4dbf.54ee94"],"x":675,"y":4100,"wires":[["b41df9a9.decaf8"]]},{"id":"68fc4dbf.54ee94","type":"link out","z":"5af1388b.ef9838","name":"","links":["7230f944.ecc798"],"x":1055,"y":4480,"wires":[]},{"id":"5dcde226.676a8c","type":"function","z":"5af1388b.ef9838","name":"set flow.currentVideoIndex","func":"array = global.get('arrayVideos');\n\nfor (var i=0; i < array.length; i++) {\n \n    if (array[i].fileId === msg.payload.id){\n        flow.set('currentVideoIndex', i);\n        return {payload: i}\n    }\n}\n","outputs":1,"noerr":0,"x":1020,"y":4520,"wires":[[]]},{"id":"4f985e66.ad72a","type":"debug","z":"7c56a241.1e88dc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1600,"y":420,"wires":[]},{"id":"385b1490.00d44c","type":"exec","z":"dfa0e0a5.c8001","command":"kodi --standalone --debug","addpay":false,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":760,"y":260,"wires":[["5454e262.e5394c"],["5454e262.e5394c"],["5454e262.e5394c","33a5d166.6c9b6e"]]},{"id":"413ccf8a.91d4b","type":"exec","z":"dfa0e0a5.c8001","command":"sudo killall kodi.bin","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1290,"y":280,"wires":[[],[],["25d68590.a7275a"]]},{"id":"5454e262.e5394c","type":"debug","z":"dfa0e0a5.c8001","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":990,"y":240,"wires":[]},{"id":"9cbfda6b.a69bc8","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":200,"wires":[["385b1490.00d44c"]]},{"id":"262e0da1.5d3e52","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"stop","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":340,"wires":[["429214af.3becec"]]},{"id":"99d5fcde.6c115","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":860,"y":180,"wires":[["385b1490.00d44c","2b05e33c.64881c"]]},{"id":"6d5dac98.cd4d24","type":"comment","z":"dfa0e0a5.c8001","name":"Backup / restore persistent settings","info":"","x":240,"y":4240,"wires":[]},{"id":"b65a3dbd.d5d68","type":"function","z":"dfa0e0a5.c8001","name":"backup persistent files","func":"flow.set('arrayImagesBak3', (flow.get('arrayImagesBak2') || []).slice());\nflow.set('arrayImagesBak2', (flow.get('arrayImagesBak1') || []).slice());\nflow.set('arrayImagesBak1', (global.get('arrayImages') || []).slice());\n\nflow.set('arrayVideosBak3', (flow.get('arrayVideosBak2') || []).slice());\nflow.set('arrayVideosBak2', (flow.get('arrayVideosBak1') || []).slice());\nflow.set('arrayVideosBak1', (global.get('arrayVideos') || []).slice());\n\nflow.set('idCounterImagesBak3', (flow.get('idCounterImagesBak2') || 0));\nflow.set('idCounterImagesBak2', (flow.get('idCounterImagesBak1') || 0));\nflow.set('idCounterImagesBak1', (global.get('idCounterImages') || 0));\n\nflow.set('idCounterVideosBak3', (flow.get('idCounterVideosBak2') || 0));\nflow.set('idCounterVideosBak2', (flow.get('idCounterVideosBak1') || 0));\nflow.set('idCounterVideosBak1', (global.get('idCounterVideos') || 0));\n\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":4360,"wires":[[]]},{"id":"c4b7eecc.d928b","type":"schedex","z":"dfa0e0a5.c8001","name":"","passthroughunhandled":false,"suspended":false,"lat":"","lon":"","ontime":"04:30","ontopic":"","onpayload":"","onoffset":0,"onrandomoffset":0,"offtime":"","offtopic":"","offpayload":"","offoffset":0,"offrandomoffset":0,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":230,"y":4360,"wires":[["b65a3dbd.d5d68"]]},{"id":"9e10c477.6b6c08","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":4300,"wires":[["b65a3dbd.d5d68"]]},{"id":"33a5d166.6c9b6e","type":"function","z":"dfa0e0a5.c8001","name":"if code>0 && kodiFlag","func":"if (msg.payload.code > 0 && flow.get('kodiFlag')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1020,"y":280,"wires":[["413ccf8a.91d4b","6d7cc497.b0585c","99d5fcde.6c115","1a49155a.57471b"]]},{"id":"f4f1ec1.d42251","type":"comment","z":"dfa0e0a5.c8001","name":"old kodi stuff","info":"","x":1790,"y":180,"wires":[]},{"id":"1698948a.c1e5cb","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl restart nodered","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":360,"wires":[[],[],[]]},{"id":"429214af.3becec","type":"exec","z":"dfa0e0a5.c8001","command":"sudo killall kodi.bin","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":730,"y":340,"wires":[[],[],["3f4abf9a.40c88"]]},{"id":"fd5f912b.da1d7","type":"function","z":"dfa0e0a5.c8001","name":"reset","func":"return {reset: \"reset\"};","outputs":1,"noerr":0,"x":650,"y":200,"wires":[["2b05e33c.64881c","99d5fcde.6c115"]]},{"id":"10ce92fb.af61bd","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"reset","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":160,"wires":[["fd5f912b.da1d7"]]},{"id":"7fc36ad0.63e974","type":"function","z":"dfa0e0a5.c8001","name":"send kill","func":"return {kill: \"\"};","outputs":1,"noerr":0,"x":1840,"y":420,"wires":[[]]},{"id":"3f4abf9a.40c88","type":"exec","z":"dfa0e0a5.c8001","command":"sudo killall kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":940,"y":340,"wires":[[],[],[]]},{"id":"25d68590.a7275a","type":"exec","z":"dfa0e0a5.c8001","command":"sudo killall kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1500,"y":280,"wires":[[],[],[]]},{"id":"1a49155a.57471b","type":"function","z":"dfa0e0a5.c8001","name":"noStore true","func":"global.set('noStorePlayerStatus', true);\n\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":420,"wires":[["d731bb2a.1f4028","dcef49a8.ab5598"]]},{"id":"c50abdf2.e7caa","type":"function","z":"dfa0e0a5.c8001","name":"noStore false","func":"global.set('noStorePlayerStatus', false);\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":400,"wires":[[]]},{"id":"dcef49a8.ab5598","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":400,"wires":[["c50abdf2.e7caa"]]},{"id":"572d1ea9.97c9","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"currentImagePlayerIndex","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":400,"wires":[[]]},{"id":"99e2e4d5.3b8d18","type":"function","z":"5af1388b.ef9838","name":"get cuPlaInd","func":"flow.get('currentImagePlayerIndex');\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":400,"wires":[[]]},{"id":"1c0da4ed.bb3e3b","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":840,"y":80,"wires":[["f42d47dd.c226b8"]]},{"id":"ee15548c.601f18","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":320,"wires":[["37d37cd6.cb3ca4"]]},{"id":"30cb07ac.778f48","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":260,"wires":[["444b6d47.818b94"]]},{"id":"e7f0681b.7475d8","type":"comment","z":"dfa0e0a5.c8001","name":"Install dependencies","info":"","x":190,"y":4500,"wires":[]},{"id":"ebda0dc4.3c812","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":4560,"wires":[["ebf0a5aa.d66398"]]},{"id":"ebf0a5aa.d66398","type":"function","z":"dfa0e0a5.c8001","name":"(re-)Install dependencies","func":"var cmd = \"sudo apt --reinstall install kodi openvpn dnsmasq hostapd ffmpeg fish squid vnc imagemagick lighttpd -y\";\n\nmsg.payload = cmd;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":4560,"wires":[["8c6e2b18.fc9888"]]},{"id":"f6993771.9b7368","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"text","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":180,"y":2320,"wires":[["b52b9630.7e52d8"]]},{"id":"6f7b515f.68a59","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"textsize","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":170,"y":2380,"wires":[["5e500273.9d68ec"]]},{"id":"2caf7900.7507b8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"cropX","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":170,"y":2440,"wires":[["ef2c8b3d.753a08"]]},{"id":"24761ea6.87f582","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"cropY","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":170,"y":2500,"wires":[["aaac89fc.329128"]]},{"id":"252d78e.ca1cb88","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"gravity","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":170,"y":2560,"wires":[["9410ef73.863ed"]]},{"id":"c54cfc1e.f1e19","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"color","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":180,"y":2620,"wires":[["12b3fe5e.ae3b52"]]},{"id":"7e7fd7aa.023ec8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"undercolor","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":160,"y":2680,"wires":[["ee937359.72093"]]},{"id":"f3eaa8fb.793868","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"bgcolorDash","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":150,"y":2740,"wires":[["3c091299.6313ae"]]},{"id":"43da9e61.03042","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"bgalphaDash","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":150,"y":2800,"wires":[["957d0e2c.271cf"]]},{"id":"72a09f14.bf321","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"font","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":300,"y":2920,"wires":[["283f2e15.58bb02"]]},{"id":"3196dbe6.789214","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"nameTextsize","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":1190,"y":2820,"wires":[["a735c698.a32dc8"]]},{"id":"3187fa6a.573e46","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"gravityName","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":1190,"y":2880,"wires":[["ffb27b45.5c72e8"]]},{"id":"dd2c2b14.9a03c8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"userlist","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":280,"y":3180,"wires":[["859a3652.7d91d8"]]},{"id":"cf5c2621.0549e8","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"kodiPlayerStatus","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":790,"y":620,"wires":[["f0febbb2.cdecf8"]]},{"id":"de4bca63.9bf048","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"currentImagePlayerIndex","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":350,"y":400,"wires":[["572d1ea9.97c9"]]},{"id":"9198b8f9.ecd928","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"anzeigedauer","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":330,"y":2820,"wires":[["acb583ed.1f6e1"]]},{"id":"f9032f92.986d8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"anzeigedauer","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":2820,"wires":[[]]},{"id":"6432b250.4c529c","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"textActive","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":330,"y":2880,"wires":[["8936fbaa.4e7a78"]]},{"id":"e46b987f.e16a98","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"loopMax","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":340,"y":2940,"wires":[["3c457ef9.347f12"]]},{"id":"c22d23c1.bb33","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"trashMax","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":340,"y":3040,"wires":[["1bc5e035.452d1"]]},{"id":"bce3be58.2a57b","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"restartSlideshowOnPause","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":280,"y":3140,"wires":[["165566b4.482a19"]]},{"id":"86116da.8c1819","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"onScreenInfo","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":320,"y":3200,"wires":[["4272969d.207d08"]]},{"id":"adbe2b90.cfee08","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"onScreenInfoTime","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":3260,"wires":[["6bc91c2b.049a44"]]},{"id":"95100f1f.0e69","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"onScreenInfoTime","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":310,"y":3260,"wires":[["17d385c0.63330a"]]},{"id":"c6a7fd6f.da907","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"bgcolor","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":2740,"wires":[[]]},{"id":"9b34581b.181418","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"bgalpha","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":2800,"wires":[[]]},{"id":"f487f34c.aa417","type":"link out","z":"5af1388b.ef9838","name":"","links":["4735cc75.25aa54"],"x":1215,"y":3260,"wires":[]},{"id":"26fa3df5.c462f2","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"videoVolume","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":4320,"wires":[[]]},{"id":"bcf86818.725818","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"videoVolume","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":270,"y":4320,"wires":[["cf430ace.a1c7a8"]]},{"id":"de305de6.b0286","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"storedVideosMax","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":250,"y":4700,"wires":[["ad3acd0b.cbb95"]]},{"id":"b993945c.fcabe8","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"videoConvertFlag","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":250,"y":4760,"wires":[["26a4a22.d68375e"]]},{"id":"606dde8.2f11a2","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"displayOnoff","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":150,"y":260,"wires":[["65b2fd66.a9b1e4"]]},{"id":"1e337c36.cef1a4","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"turnOnTime","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":150,"y":460,"wires":[["c4d060eb.a68cb"]]},{"id":"28ca737e.ced88c","type":"change","z":"e00097c0.ad3088","name":"","rules":[{"t":"set","p":"turnOnTime","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":460,"wires":[[]]},{"id":"b84ac8af.d18a58","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"turnOffTime","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":150,"y":600,"wires":[["588ec493.a2088c"]]},{"id":"f30d6930.ad9ae8","type":"change","z":"e00097c0.ad3088","name":"","rules":[{"t":"set","p":"turnOffTime","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":600,"wires":[[]]},{"id":"b493d9f5.85a588","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"domainDdns","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":170,"y":1440,"wires":[["2436afd4.10e09"]]},{"id":"61b879a1.9a3fa8","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"freedns","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":190,"y":1400,"wires":[["536ec725.4d5598"]]},{"id":"68d8fb39.50bba4","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"wifiSsid","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":610,"y":1620,"wires":[["5ad71a79.0e9874"]]},{"id":"3c684eb2.6440a2","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"wifiPass","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":810,"y":1760,"wires":[["2d03b208.06c82e","4c01d487.6885ac"]]},{"id":"fc054f99.8d2d","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"displayWidth","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":180,"y":2000,"wires":[["f7532169.84116"]]},{"id":"d2980b2b.45f3e8","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"displayHeight","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":"1","x":180,"y":2040,"wires":[["e27c7715.f4ce48"]]},{"id":"b562fb95.b65638","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"kodi","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":140,"y":200,"wires":[["ee81297d.751808"]]},{"id":"4108f15b.bdb3","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"kodi","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":300,"wires":[[]]},{"id":"d5c3cb4b.1bbe28","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"lightdm","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":620,"wires":[[]]},{"id":"7e1a7986.cb0518","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"lightdm","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":130,"y":620,"wires":[["29fdcca4.a8b3a4"]]},{"id":"fe5c44fe.dd4d58","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"vnc","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":800,"wires":[[]]},{"id":"a024fc7b.543ff","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"vnc","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":120,"y":800,"wires":[["33bef5f6.dc20ba"]]},{"id":"2abf87db.766008","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"openvpn","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":120,"y":980,"wires":[["8b4c2698.95cbc8"]]},{"id":"c6fef062.0c30d","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"openvpn","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":980,"wires":[[]]},{"id":"e9103810.aca578","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"squid","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":130,"y":1160,"wires":[["d963dd26.eb315"]]},{"id":"75383c5b.0dd894","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"squid","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1160,"wires":[[]]},{"id":"39fb6720.0abcb8","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logViewer","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":180,"y":2380,"wires":[["a0962bd1.ff01d8"]]},{"id":"c76eb085.744ea","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logNotification","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":190,"y":2440,"wires":[["8e6050ec.de18"]]},{"id":"f42f0415.812ad8","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logTelegram","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":190,"y":2500,"wires":[["566f496d.8f83a8"]]},{"id":"681a3cb7.4f0934","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logImageProcessing","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":210,"y":2560,"wires":[["cb0302ed.86b68"]]},{"id":"73d4efab.22f49","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logVideoProcessing","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":210,"y":2620,"wires":[["c848e772.3372c8"]]},{"id":"8eb01068.33dba","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logKodi","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":170,"y":2680,"wires":[["92315135.c375"]]},{"id":"4efeb567.e569bc","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logKodiNotification","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":210,"y":2740,"wires":[["a9f1d6c0.bdad98"]]},{"id":"7aa1ef76.63b29","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logKodiLoadedFile","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":210,"y":2800,"wires":[["43ba01e7.71d22"]]},{"id":"9385eb50.21d0e8","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logKodiPlaylistPostition","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":220,"y":2860,"wires":[["dac1c7a9.36f708"]]},{"id":"c2eea243.64537","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"telegrampath","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2200,"wires":[[]]},{"id":"61005b5e.88a154","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"telegrampath","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":170,"y":2200,"wires":[["5e07aefb.00bfb"]]},{"id":"8c6e2b18.fc9888","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":670,"y":4560,"wires":[["cda6d660.862ae8"],["cda6d660.862ae8"],["cda6d660.862ae8"]]},{"id":"cda6d660.862ae8","type":"debug","z":"dfa0e0a5.c8001","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":810,"y":4560,"wires":[]},{"id":"a24ebee1.106a9","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":750,"y":4360,"wires":[[]]},{"id":"ede6f095.5ea5","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"arrayImages","pt":"global","to":"arrayImagesBak1","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":4360,"wires":[[]]},{"id":"9f266d4.c4d2f9","type":"link out","z":"5af1388b.ef9838","name":"","links":["afffc469.d39e48","9da2920a.d3dcf"],"x":1740,"y":2220,"wires":[]},{"id":"9da2920a.d3dcf","type":"link in","z":"5af1388b.ef9838","name":"refresh trash browser","links":["13cc72f0.8531ad","1664a1ac.abc21e","207052dd.0e26ee","7c84dde4.99eb74","9f266d4.c4d2f9","ada16f09.67681","b9c1dcf5.e51d2","d31afcc4.0f88d","e1f2705d.dcf9c","f92cc322.9e0af"],"x":215,"y":2240,"wires":[["f5439617.ce1af8"]]},{"id":"6125e22.fbeca1c","type":"ui_toast","z":"e00097c0.ad3088","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":370,"y":1020,"wires":[["a9cee197.5d2"]]},{"id":"a9cee197.5d2","type":"function","z":"e00097c0.ad3088","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":510,"y":1020,"wires":[["5d0078d8.20eb18","620a225.a1a7adc","8fef5da2.f5671"]]},{"id":"b80d9bb0.bb4fd8","type":"ui_toast","z":"e00097c0.ad3088","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":370,"y":900,"wires":[["c17f0ca6.dda43"]]},{"id":"c17f0ca6.dda43","type":"function","z":"e00097c0.ad3088","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":510,"y":900,"wires":[["e6b47c1d.0480e","4a6eb097.dc7a2","8fef5da2.f5671"]]},{"id":"7fb81b00.7b36a4","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"202cb3cc.ad24bc","order":1,"width":12,"height":1,"passthru":false,"label":"Restore Node-Red Settings","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Node-Red settings wiederherstellen?","payloadType":"str","topic":"","x":200,"y":1860,"wires":[["178e3419.f7c5ac"]]},{"id":"b6e897ad.5a1108","type":"comment","z":"dfa0e0a5.c8001","name":"Node-Red settings","info":"","x":150,"y":1780,"wires":[]},{"id":"65018559.3dd78c","type":"function","z":"dfa0e0a5.c8001","name":"restore files","func":"// restore icons\nvar cmd = \"sudo mv /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon64x64.png /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon64x64.png.orig && \";\ncmd = cmd + \"sudo mv /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon120x120.png /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon120x120.png.orig && \";\ncmd = cmd + \"sudo mv /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon192x192.png /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon192x192.png.orig && \";\ncmd = cmd + \"sudo chown pi /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon64x64.png.orig && \";\ncmd = cmd + \"sudo chown pi /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon120x120.png.orig && \";\ncmd = cmd + \"sudo chown pi /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon192x192.png.orig && \";\ncmd = cmd + \"sudo cp /home/pi/node-red/node-red-settings/icon64x64.png /home/pi/.node-red/node_modules/node-red-dashboard/dist/ && \";\ncmd = cmd + \"sudo cp /home/pi/node-red/node-red-settings/icon120x120.png /home/pi/.node-red/node_modules/node-red-dashboard/dist/ && \";\ncmd = cmd + \"sudo cp /home/pi/node-red/node-red-settings/icon192x192.png /home/pi/.node-red/node_modules/node-red-dashboard/dist/ && \";\ncmd = cmd + \"sudo chown pi /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon64x64.png && \";\ncmd = cmd + \"sudo chown pi /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon120x120.png && \";\ncmd = cmd + \"sudo chown pi /home/pi/.node-red/node_modules/node-red-dashboard/dist/icon192x192.png && \";\n\n// restore settings.json\ncmd = cmd + \"sudo mv /home/pi/.node-red/settings.js /home/pi/.node-red/settings.js.bak && \";\ncmd = cmd + \"sudo chown pi /home/pi/.node-red/settings.js.bak && \";\ncmd = cmd + \"sudo cp /home/pi/node-red/node-red-settings/settings.js /home/pi/.node-red/ && \";\ncmd = cmd + \"sudo chown pi /home/pi/.node-red/settings.js\";\n\nmsg.payload = cmd;\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1860,"wires":[["2e219dfc.63ac22","aedd323d.e7d6b"]]},{"id":"2e219dfc.63ac22","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":850,"y":1860,"wires":[[],[],["64bb06c2.1c6c88"]]},{"id":"2a5a0ac3.ca15e6","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Settings restored! Please restart Node-Red!\"};","outputs":1,"noerr":0,"x":1190,"y":1880,"wires":[["84b32ed9.28e16"]]},{"id":"64bb06c2.1c6c88","type":"function","z":"dfa0e0a5.c8001","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1020,"y":1860,"wires":[["d4ad3534.c38f78"],["2a5a0ac3.ca15e6"]]},{"id":"d4ad3534.c38f78","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Restore settings failed!\"};","outputs":1,"noerr":0,"x":1190,"y":1840,"wires":[["84b32ed9.28e16"]]},{"id":"aedd323d.e7d6b","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Restoring...\"};","outputs":1,"noerr":0,"x":890,"y":1800,"wires":[["d4015d5d.0ecd2"]]},{"id":"d4015d5d.0ecd2","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"10","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1070,"y":1800,"wires":[]},{"id":"84b32ed9.28e16","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1410,"y":1860,"wires":[]},{"id":"aa844b4c.844948","type":"function","z":"dfa0e0a5.c8001","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":550,"y":1860,"wires":[["65018559.3dd78c"]]},{"id":"178e3419.f7c5ac","type":"ui_toast","z":"dfa0e0a5.c8001","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":410,"y":1860,"wires":[["aa844b4c.844948"]]},{"id":"6b93d48c.30340c","type":"function","z":"dfa0e0a5.c8001","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":470,"y":1420,"wires":[["b5fc07be.191678","e3c8035e.2187d"]]},{"id":"92c15287.e352a","type":"ui_toast","z":"dfa0e0a5.c8001","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":330,"y":1420,"wires":[["6b93d48c.30340c"]]},{"id":"b3de9a95.64e188","type":"function","z":"dfa0e0a5.c8001","name":"if ok","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":510,"y":1360,"wires":[["55824b5a.c257b4"]]},{"id":"bf68e56.c6b7318","type":"ui_toast","z":"dfa0e0a5.c8001","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":370,"y":1360,"wires":[["b3de9a95.64e188"]]},{"id":"51a2c83.e7a1c38","type":"function","z":"5af1388b.ef9838","name":"incr. LoopNr","func":"// assign loopId to make sure just one loop is running\nvar loopId = flow.get('arrayImagesLoopId') || 0;\nloopId++;\nif (loopId === 100){\n    loopId = 0;\n}\nflow.set('arrayImagesLoopId', loopId);\n\nreturn msg;","outputs":1,"noerr":0,"x":2550,"y":40,"wires":[[]]},{"id":"c65be401.df3718","type":"http request","z":"5af1388b.ef9838","name":"http://127.0.0.1:8080/jsonrpc","method":"POST","ret":"obj","paytoqs":false,"url":"http://127.0.0.1:8080/jsonrpc","tls":"","persist":true,"proxy":"","authType":"","x":2700,"y":980,"wires":[["3d065ee5.7d52c2"]]},{"id":"3d065ee5.7d52c2","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2910,"y":980,"wires":[]},{"id":"b761f6a8.deb788","type":"function","z":"5af1388b.ef9838","name":"Player.PlayPause (Play)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.PlayPause\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":2,\n                \"play\":true\n            }\n        }\n};","outputs":1,"noerr":0,"x":1590,"y":780,"wires":[["b2efa2c8.3efc"]]},{"id":"6c875472.17344c","type":"link in","z":"5af1388b.ef9838","name":"Player.PlayPause (Play)","links":[],"x":1415,"y":780,"wires":[["b761f6a8.deb788"]]},{"id":"a50778fe.1e6818","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Play","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":780,"wires":[["b761f6a8.deb788"]]},{"id":"3f23e9a0.2fdf36","type":"function","z":"5af1388b.ef9838","name":"Player.PlayPause","func":"return {\n    payload: \n        {   \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.PlayPause\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":2\n            }\n        }\n};","outputs":1,"noerr":0,"x":1610,"y":740,"wires":[["b2efa2c8.3efc"]]},{"id":"902bfa2c.7ce158","type":"link in","z":"5af1388b.ef9838","name":"Player.PlayPause","links":["868cd190.6585a"],"x":1415,"y":740,"wires":[["3f23e9a0.2fdf36"]]},{"id":"f2ed38bb.d80c18","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Play/Pause","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1180,"y":740,"wires":[["3f23e9a0.2fdf36"]]},{"id":"11089eda.a17391","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"test","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":1120,"wires":[["da1ff016.0093"]]},{"id":"3d0b622.842ea9e","type":"websocket out","z":"5af1388b.ef9838","name":"","server":"","client":"b2bcaeaa.d8f43","x":2720,"y":880,"wires":[]},{"id":"bd1c59cd.73d6b8","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":60,"wires":[]},{"id":"4c4279bc.f76388","type":"websocket in","z":"5af1388b.ef9838","name":"","server":"","client":"b2bcaeaa.d8f43","x":230,"y":60,"wires":[["e1c04e21.5a6d8"]]},{"id":"e1c04e21.5a6d8","type":"json","z":"5af1388b.ef9838","name":"","property":"payload","action":"","pretty":false,"x":430,"y":60,"wires":[["bd1c59cd.73d6b8","de98e67.3745118","9073de8c.3ec3a","3cf00b11.b5d7c4","e964249b.2c71b8"]]},{"id":"cebe9c37.98ad4","type":"comment","z":"5af1388b.ef9838","name":"http","info":"","x":2630,"y":940,"wires":[]},{"id":"181959a5.538da6","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":1660,"wires":[["4ac0b440.3bc06c"]]},{"id":"4ac0b440.3bc06c","type":"function","z":"5af1388b.ef9838","name":"Settings.SetSettingValue: debug.showloginfo","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Settings.SetSettingValue\",\n            \"id\": 1,\n            \"params\":{\n                \"setting\":\"debug.showloginfo\",\n                \"value\":msg.payload\n            }\n        }\n};","outputs":1,"noerr":0,"x":1530,"y":1680,"wires":[["b2efa2c8.3efc"]]},{"id":"aa3ba74c.977e68","type":"link in","z":"5af1388b.ef9838","name":"debug.showloginfo","links":["30d11e0d.23a642"],"x":1315,"y":1680,"wires":[["4ac0b440.3bc06c"]]},{"id":"3790b0d4.0828c","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":1700,"wires":[["4ac0b440.3bc06c"]]},{"id":"30257a37.cd35e6","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"Kodi native debug","tooltip":"","group":"ed8a86bc.a4c3c8","order":23,"width":10,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":410,"y":2920,"wires":[["5ec755e3.8273cc","30d11e0d.23a642"]]},{"id":"5ec755e3.8273cc","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"logKodiNative","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":2920,"wires":[[]]},{"id":"2fdc6e83.4d0ff2","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"logKodiNative","payloadType":"flow","repeat":"","crontab":"","once":true,"onceDelay":"1","x":190,"y":2920,"wires":[["30257a37.cd35e6"]]},{"id":"30d11e0d.23a642","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["aa3ba74c.977e68"],"x":595,"y":2960,"wires":[]},{"id":"12e3717f.d9dfcf","type":"comment","z":"dfa0e0a5.c8001","name":"tail -f /home/pi/.kodi/temp/kodi.log","info":"","x":940,"y":2920,"wires":[]},{"id":"e964249b.2c71b8","type":"function","z":"5af1388b.ef9838","name":"gate logKodiPlaylistPostition","func":"try {\n    msg.payload = msg.payload.params.data.position;\n    if (msg.payload !== undefined){\n        return msg;\n    }\n} catch (e){}","outputs":1,"noerr":0,"x":660,"y":180,"wires":[["fdd5cee5.18dd"]]},{"id":"3cf00b11.b5d7c4","type":"function","z":"5af1388b.ef9838","name":"gate logKodiLoadedFile","func":"try {\n    msg.payload = msg.payload.params.data.item.file;\n    if (msg.payload !== undefined){\n        return msg;\n    }\n} catch (e){}","outputs":1,"noerr":0,"x":650,"y":140,"wires":[["6c383266.6aea0c"]]},{"id":"9073de8c.3ec3a","type":"function","z":"5af1388b.ef9838","name":"gate logKodiNotification","func":"try{\n    msg.payload = msg.payload.method;\n    if (msg.payload !== undefined){\n        return msg;\n    }\n} catch (e){}","outputs":1,"noerr":0,"x":650,"y":100,"wires":[["2faaf39e.10996c"]]},{"id":"2faaf39e.10996c","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":100,"wires":[]},{"id":"6c383266.6aea0c","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":140,"wires":[]},{"id":"cf705d52.66cdd","type":"comment","z":"5af1388b.ef9838","name":"websocket","info":"","x":2640,"y":840,"wires":[]},{"id":"1f9b8bc1.6dac54","type":"function","z":"5af1388b.ef9838","name":"Input.ExecuteAction: screenshot","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Input.ExecuteAction\",\n            \"id\": 1,\n            \"params\":{\n                \"action\":\"screenshot\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1570,"y":1760,"wires":[["b2efa2c8.3efc"]]},{"id":"12e7d659.8774ba","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1180,"y":1800,"wires":[["1f9b8bc1.6dac54"]]},{"id":"c40200ea.539fa","type":"link in","z":"5af1388b.ef9838","name":"Input.ExecuteAction: screenshot","links":["3de8c8cf.99de68"],"x":1315,"y":1760,"wires":[["1f9b8bc1.6dac54"]]},{"id":"f1a393cf.793fe","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"24b47441.d3db5c","order":1,"width":12,"height":1,"passthru":false,"label":"Take screenshot","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Kodi neu starten?","payloadType":"str","topic":"","x":160,"y":1620,"wires":[["68640868.9c5628","20d5c47.814bb3c"]]},{"id":"68640868.9c5628","type":"function","z":"dfa0e0a5.c8001","name":"remove old screenshot","func":"msg.payload = \"rm /home/pi/media/kodi/screenshot000.png\";\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":1620,"wires":[["e4da1730.746ab8"]]},{"id":"e4da1730.746ab8","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":1620,"wires":[[],[],["3de8c8cf.99de68","99c2596.32b61a8"]]},{"id":"3de8c8cf.99de68","type":"link out","z":"dfa0e0a5.c8001","name":"","links":["c40200ea.539fa"],"x":755,"y":1600,"wires":[]},{"id":"33b8cef2.b60072","type":"ui_template","z":"dfa0e0a5.c8001","group":"24b47441.d3db5c","name":"","order":2,"width":12,"height":5,"format":"<img width=\"100%\" height=\"100%\" alt=\"Image not loaded\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1440,"y":1640,"wires":[[]]},{"id":"597377f3.1b41d8","type":"base64","z":"dfa0e0a5.c8001","name":"","action":"str","property":"payload","x":1300,"y":1640,"wires":[["33b8cef2.b60072"]]},{"id":"2bc03882.eba9a8","type":"file in","z":"dfa0e0a5.c8001","name":"","filename":"/home/pi/media/kodi/screenshot000.png","format":"","chunk":false,"sendError":false,"encoding":"none","x":1060,"y":1640,"wires":[["597377f3.1b41d8"]]},{"id":"3815ee3c.04c832","type":"comment","z":"dfa0e0a5.c8001","name":"Kodi screenshot","info":"","x":140,"y":1560,"wires":[]},{"id":"99c2596.32b61a8","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":800,"y":1640,"wires":[["2bc03882.eba9a8","7f9e8d9e.74e6a4"]]},{"id":"20d5c47.814bb3c","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"Take screenshot...\"};","outputs":1,"noerr":0,"x":370,"y":1680,"wires":[["d6a0786f.2f5a18"]]},{"id":"d6a0786f.2f5a18","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"20","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":550,"y":1680,"wires":[]},{"id":"c8327ff1.b83b5","type":"ui_toast","z":"dfa0e0a5.c8001","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1150,"y":1680,"wires":[]},{"id":"7f9e8d9e.74e6a4","type":"function","z":"dfa0e0a5.c8001","name":"set message","func":"return {payload: \"finish!\"};","outputs":1,"noerr":0,"x":970,"y":1680,"wires":[["c8327ff1.b83b5"]]},{"id":"7c9f6e41.d18b","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2750,"y":280,"wires":[]},{"id":"8fef5da2.f5671","type":"function","z":"e00097c0.ad3088","name":"noStore true","func":"global.set('noStorePlayerStatus', true);\n\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":1100,"wires":[[]]},{"id":"fdcb078d.1d8558","type":"function","z":"e00097c0.ad3088","name":"noStore false","func":"global.set('noStorePlayerStatus', false);\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1100,"wires":[[]]},{"id":"e55fb536.3e45b8","type":"inject","z":"e00097c0.ad3088","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"1","x":220,"y":1100,"wires":[["fdcb078d.1d8558"]]},{"id":"7376de91.d7551","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1980,"y":120,"wires":[["8b9a1ad8.074a98"]]},{"id":"3a7752bc.a1cdae","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1980,"y":180,"wires":[["a4de161d.ffeba8"]]},{"id":"a4fb3429.bf80e8","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1980,"y":240,"wires":[["b11cb61d.0e3508"]]},{"id":"814d7a3a.4c9ed8","type":"function","z":"5af1388b.ef9838","name":"Player.Open (playlist id)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.Open\",\n            \"id\": 1,\n            \"params\":{\n                \"item\":{\n                    \"playlistid\":2,\n                    \"position\":6\n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":2330,"y":1480,"wires":[["b2efa2c8.3efc","1b3bfb05.61ff95"]]},{"id":"d10928a3.4e6958","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2270,"y":1440,"wires":[["814d7a3a.4c9ed8"]]},{"id":"894e40e.32060c","type":"function","z":"5af1388b.ef9838","name":"Player.Open (playlist id)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.Open\",\n            \"id\": 1,\n            \"params\":{\n                \"item\":{\n                    \"playlistid\":2,\n                    \"position\":flow.get('playlistPosStart', 'mem')\n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":2430,"y":1400,"wires":[["b2efa2c8.3efc"]]},{"id":"bbdc10cd.1a0e1","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2390,"y":1360,"wires":[["894e40e.32060c"]]},{"id":"506b51af.eb933","type":"function","z":"5af1388b.ef9838","name":"Playlist.Add","func":"return {\n    payload:{\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Playlist.Add\",\n            \"id\": 1,\n            \"params\":{\n                \"playlistid\":2,\n                \"item\":{\n                    \"file\":msg.payload\n                }\n            }\n        }\n};\n","outputs":1,"noerr":0,"x":1630,"y":580,"wires":[["b2efa2c8.3efc"]]},{"id":"393aa309.69aafc","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"/home/pi/media/telegram/images/03.loop/68.pic.jpg","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":580,"wires":[["506b51af.eb933"]]},{"id":"6b122469.00d63c","type":"function","z":"5af1388b.ef9838","name":"Player.Open (playlist id)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.Open\",\n            \"id\": 1,\n            \"params\":{\n                \"item\":{\n                    \"playlistid\":2,\n                    \"position\":2\n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":2150,"y":1620,"wires":[["b2efa2c8.3efc"]]},{"id":"83a6bfeb.d72e6","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2110,"y":1580,"wires":[["6b122469.00d63c"]]},{"id":"1a020892.b06987","type":"link in","z":"5af1388b.ef9838","name":"Playlist.Add","links":[],"x":1415,"y":580,"wires":[["506b51af.eb933"]]},{"id":"d707165c.196378","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo next","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.GoTo\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":2,\n                \"to\": \"next\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":2710,"y":1420,"wires":[["b2efa2c8.3efc"]]},{"id":"1b3bfb05.61ff95","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2550,"y":1480,"wires":[["d707165c.196378"]]},{"id":"7507b241.a10c7c","type":"comment","z":"5af1388b.ef9838","name":"Experimentieren","info":"","x":2200,"y":1320,"wires":[]},{"id":"76d192f4.fa460c","type":"function","z":"5af1388b.ef9838","name":"Player.Open (playlist pos [at start])","func":"if (msg.playlistPos >= 0){\n} else {\n    msg.playlistPos = flow.get('playlistPosStart');\n}\n\nreturn {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.Open\",\n            \"id\": 1,\n            \"params\":{\n                \"item\":{\n                    \"playlistid\":2,\n                    \"position\":msg.playlistPos\n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":1560,"y":520,"wires":[["b2efa2c8.3efc"]]},{"id":"ba634417.aae9d8","type":"link in","z":"5af1388b.ef9838","name":"Player.Open (playlist pos [at start])","links":[],"x":1355,"y":520,"wires":[["76d192f4.fa460c"]]},{"id":"d86fdfef.85095","type":"function","z":"5af1388b.ef9838","name":"reset","func":"msg.reset = \"reset\";\nreturn msg;\n","outputs":1,"noerr":0,"x":2310,"y":140,"wires":[["614af351.1651cc","839c9774.ce9878"]]},{"id":"e6e1a122.ff28b","type":"function","z":"5af1388b.ef9838","name":"Input.ExecuteAction","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Input.ExecuteAction\",\n            \"id\": 1,\n            \"params\":{\n                \"action\":\"showvideomenu\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":2640,"y":1600,"wires":[["b2efa2c8.3efc"]]},{"id":"c9d4ccf7.ea289","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2450,"y":1600,"wires":[["e6e1a122.ff28b"]]},{"id":"55d1d626.31b188","type":"function","z":"5af1388b.ef9838","name":"Input.Home","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Input.Home\",\n            \"id\": 1,\n        }\n};","outputs":1,"noerr":0,"x":2610,"y":1640,"wires":[["b2efa2c8.3efc"]]},{"id":"79db9739.dfcea8","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2450,"y":1640,"wires":[["55d1d626.31b188"]]},{"id":"484f2ff8.5a9b6","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo next","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"Player.GoTo\",\n            \"id\": 1,\n            \"params\":{\n                \"playerid\":2,\n                \"to\": \"start\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":2630,"y":1680,"wires":[["b2efa2c8.3efc"]]},{"id":"6ee6fe42.8402","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2450,"y":1680,"wires":[["484f2ff8.5a9b6"]]},{"id":"f3d29ff3.ead96","type":"function","z":"5af1388b.ef9838","name":"GUI.ActivateWindow (home)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"GUI.ActivateWindow\",\n            \"id\": 1,\n            \"params\":{\n                \"window\":\"home\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1580,"y":1900,"wires":[["b2efa2c8.3efc"]]},{"id":"edaf54a1.58ad28","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":1900,"wires":[["f3d29ff3.ead96"]]},{"id":"ecb73bf3.d0e198","type":"function","z":"5af1388b.ef9838","name":"GUI.ActivateWindow (settings)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"GUI.ActivateWindow\",\n            \"id\": 1,\n            \"params\":{\n                    \"window\":\"settings\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1570,"y":1940,"wires":[["b2efa2c8.3efc"]]},{"id":"96d09c7f.4b149","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":1940,"wires":[["ecb73bf3.d0e198"]]},{"id":"a37da21f.2d2ab","type":"comment","z":"5af1388b.ef9838","name":"Kodi activate windows","info":"","x":1600,"y":1860,"wires":[]},{"id":"a93fe2ac.28711","type":"link in","z":"5af1388b.ef9838","name":"GUI.ActivateWindow (home)","links":[],"x":1355,"y":1900,"wires":[["f3d29ff3.ead96"]]},{"id":"6d79ed7c.d77ec4","type":"link in","z":"5af1388b.ef9838","name":"GUI.ActivateWindow (settings)","links":[],"x":1355,"y":1940,"wires":[["ecb73bf3.d0e198"]]},{"id":"c3a6e913.cb23e8","type":"function","z":"5af1388b.ef9838","name":"GUI.ActivateWindow (programs/black)","func":"return {\n    payload: \n        {\n            \"jsonrpc\": \"2.0\",\n            \"method\":\"GUI.ActivateWindow\",\n            \"id\": 1,\n            \"params\":{\n                    \"window\":\"programs\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1550,"y":1980,"wires":[["b2efa2c8.3efc"]]},{"id":"f6e62d6e.70309","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":1980,"wires":[["c3a6e913.cb23e8"]]},{"id":"9244cd4e.75e28","type":"link in","z":"5af1388b.ef9838","name":"GUI.ActivateWindow (programs/black)","links":["f42d47dd.c226b8"],"x":1355,"y":1980,"wires":[["c3a6e913.cb23e8"]]},{"id":"e8f04b2.17639b8","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"4","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":480,"wires":[["76d192f4.fa460c"]]},{"id":"b7dd8ead.a4513","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1190,"y":520,"wires":[["76d192f4.fa460c"]]},{"id":"b137ce26.70996","type":"function","z":"5af1388b.ef9838","name":"set array playlistPos -1","func":"var array = global.get('arrayImages');\n\nfor (var i=0; i < array.length; i++) {\n    array[i].playlistPosPic = -1;\n    array[i].playlistPosText = -1;\n}\n    \nreturn msg;","outputs":1,"noerr":0,"x":2320,"y":200,"wires":[["bb086a54.b87bd8"]]},{"id":"7d7f8244.6fdcec","type":"function","z":"5af1388b.ef9838","name":"switch index / playlistPos","func":"var array = global.get('arrayImages');\n\nif (msg.index >= 0){} else {msg.index = 0;}\n\nif (array[msg.index].playlistPosPic > 0){\n    \n    var playlistPos = array[msg.index].playlistPosPic;\n    \n    if (array[msg.index].textFlag){\n        playlistPos = array[msg.index].playlistPosText;\n    }\n    \n    return [null, null, {playlistPos}]\n\n} else {\n    \n    if (msg.restoreStatus){\n        return [null, {index: msg.index}, null];\n    } else {\n        return [{index: msg.index}, null, null];\n    }\n}\n\n","outputs":3,"noerr":0,"x":1590,"y":440,"wires":[["c6be6051.f6e5f"],["444b6d47.818b94"],["76d192f4.fa460c"]]},{"id":"6a49db86.c09794","type":"link in","z":"5af1388b.ef9838","name":"switch index / playlistPos","links":["2ee33e7e.9478e2","d462771d.909b28"],"x":1415,"y":440,"wires":[["7d7f8244.6fdcec"]]},{"id":"42fa4686.b84728","type":"function","z":"5af1388b.ef9838","name":"\"Neueste Nachricht\"","func":"return {payload: \"Springe zu neuester Nachricht\"};","outputs":1,"noerr":0,"x":980,"y":360,"wires":[["8952a3c5.41966"]]},{"id":"8952a3c5.41966","type":"link out","z":"5af1388b.ef9838","name":"","links":["683c6b5e.62fc74"],"x":1115,"y":360,"wires":[]},{"id":"f2193147.99e4f","type":"function","z":"5af1388b.ef9838","name":"set arrayImages playlistPos -1","func":"var array = global.get('arrayImages');\n\nfor (var i=0; i < array.length; i++) {\n    array[i].playlistPosPic = -1;\n    array[i].playlistPosText = -1;\n}\n    \nreturn msg;","outputs":1,"noerr":0,"x":1490,"y":3680,"wires":[[]]},{"id":"78d7b134.662ae","type":"function","z":"5af1388b.ef9838","name":"Player.Open (playlist id)","func":"if (msg.payload.params.data.position !== undefined){\n    \n    var playlistPos = msg.payload.params.data.position;\n\n    if (playlistPos === (flow.get('playlistPosStart', 'mem')+1) || (playlistPos === (flow.get('playlistPosStart', 'mem')) && global.get('arrayImages').length === 1)){\n    \n        return {\n            payload:{\n                    \"jsonrpc\": \"2.0\",\n                    \"method\":\"Player.Open\",\n                    \"id\": 1,\n                    \"params\":{\n                        \"item\":{\n                            \"playlistid\":2,\n                            \"position\":flow.get('playlistPosStart', 'mem')\n                        }\n                    }\n            }\n        };\n    }\n}","outputs":1,"noerr":0,"x":2550,"y":440,"wires":[["b2efa2c8.3efc"]]},{"id":"fdd5cee5.18dd","type":"link out","z":"5af1388b.ef9838","name":"KodiPlaylistPostition","links":[],"x":655,"y":220,"wires":[]},{"id":"2f3df02b.6650b","type":"link in","z":"5af1388b.ef9838","name":"","links":["12c9de36.7ecd72"],"x":2400,"y":440,"wires":[["78d7b134.662ae"]]},{"id":"12c9de36.7ecd72","type":"link out","z":"5af1388b.ef9838","name":"kodi notification (images)","links":["2f3df02b.6650b"],"x":335,"y":580,"wires":[]},{"id":"4f1abe70.f27c4","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":180,"wires":[]},{"id":"53cc86d9.f90978","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"0.2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2430,"y":900,"wires":[["8b17631a.2904f","c65be401.df3718","5a5d642b.e6a34c","34a3a73e.784758"]]},{"id":"cb13b13b.9982c","type":"function","z":"5af1388b.ef9838","name":"reset","func":"msg.reset = \"reset\";\nreturn msg;\n","outputs":1,"noerr":0,"x":2410,"y":840,"wires":[["53cc86d9.f90978"]]},{"id":"7c92faf.1a60304","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"reset","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2410,"y":780,"wires":[["cb13b13b.9982c"]]},{"id":"b781e63d.ef97d8","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"0.6","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2630,"y":360,"wires":[["b2efa2c8.3efc"]]},{"id":"3d206168.13303e","type":"link in","z":"5af1388b.ef9838","name":"","links":["839c9774.ce9878"],"x":2475,"y":360,"wires":[["b781e63d.ef97d8"]]},{"id":"839c9774.ce9878","type":"link out","z":"5af1388b.ef9838","name":"","links":["3d206168.13303e"],"x":2495,"y":100,"wires":[]},{"id":"bbd5709b.4a53b","type":"q-gate","z":"5af1388b.ef9838","name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":1990,"y":200,"wires":[["1fea77e5.e58298"]]},{"id":"34a3a73e.784758","type":"function","z":"5af1388b.ef9838","name":"control qgate: queue","func":"return { payload: \"queue\", topic: \"control\"};\n\n","outputs":1,"noerr":0,"x":2620,"y":600,"wires":[["5144b94d.b5eef8"]]},{"id":"4da695bb.e7acbc","type":"link in","z":"5af1388b.ef9838","name":"","links":["5144b94d.b5eef8"],"x":2075,"y":280,"wires":[["bbd5709b.4a53b"]]},{"id":"5144b94d.b5eef8","type":"link out","z":"5af1388b.ef9838","name":"","links":["4da695bb.e7acbc"],"x":2795,"y":600,"wires":[]},{"id":"5a5d642b.e6a34c","type":"stoptimer","z":"5af1388b.ef9838","duration":"1500","units":"Millisecond","payloadtype":"num","payloadval":"0","name":"","x":2670,"y":700,"wires":[["b3713c79.fd19c"],[]]},{"id":"b3713c79.fd19c","type":"function","z":"5af1388b.ef9838","name":"control qgate: open","func":"return { payload: \"open\", topic: \"control\"};\n\n","outputs":1,"noerr":0,"x":2650,"y":640,"wires":[["5144b94d.b5eef8"]]},{"id":"1fea77e5.e58298","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":2130,"y":200,"wires":[["b137ce26.70996"]]},{"id":"829a82e2.9db1a","type":"function","z":"e00097c0.ad3088","name":"cp interfaces.nr.client","func":"msg.payload = \"sudo chown pi /etc/network/interfaces.nr.client /etc/network/interfaces.nr.hotspot\";\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1960,"wires":[["83a68f23.45d63"]]},{"id":"83a68f23.45d63","type":"exec","z":"e00097c0.ad3088","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":710,"y":1960,"wires":[[],[],["1896682a.418d28"]]},{"id":"fb8d8952.e5fe18","type":"comment","z":"e00097c0.ad3088","name":"change user rights for interfaces.nr.hotspot & interfaces.nr.client","info":"","x":530,"y":1900,"wires":[]},{"id":"f9f22923.5381e8","type":"ui_text","z":"e00097c0.ad3088","group":"e4f17352.69409","order":4,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-spread","x":890,"y":1280,"wires":[]},{"id":"e5ecb29a.86ded","type":"function","z":"dfa0e0a5.c8001","name":"restore xml-files","func":"var cmd = \"sudo cp /home/pi/node-red/kodi-settings/DialogNotification.xml /usr/share/kodi/addons/skin.estouchy/xml/ && \";\ncmd = cmd + \"sudo cp /home/pi/node-red/kodi-settings/Pointer.xml /usr/share/kodi/addons/skin.estouchy/xml/ && \";\ncmd = cmd + \"sudo cp /home/pi/node-red/kodi-settings/Font.xml /usr/share/kodi/addons/skin.estouchy/xml/ && \";\n\ncmd = cmd + \"sudo cp /home/pi/node-red/kodi-settings/touchscreen.xml /home/pi/.kodi/userdata/keymaps && \";\ncmd = cmd + \"sudo chown pi /home/pi/.kodi/userdata/keymaps/touchscreen.xml\";\n\nmsg.payload = cmd;\nreturn msg;\n","outputs":1,"noerr":0,"x":980,"y":1360,"wires":[["c0c2a62d.9db058"]]},{"id":"c0c2a62d.9db058","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1130,"y":1360,"wires":[[],[],["683b5111.9d863"]]}]