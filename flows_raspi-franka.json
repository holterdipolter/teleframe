[{"id":"5af1388b.ef9838","type":"tab","label":"Kodi","disabled":false,"info":""},{"id":"7c56a241.1e88dc","type":"tab","label":"Telegram","disabled":false,"info":""},{"id":"168e0b9d.9c19d4","type":"tab","label":"control","disabled":false,"info":""},{"id":"e00097c0.ad3088","type":"tab","label":"Einstellungen","disabled":false,"info":""},{"id":"dfa0e0a5.c8001","type":"tab","label":"Admin","disabled":false,"info":""},{"id":"ba1e4f7d.a87f3","type":"tab","label":"Dev","disabled":false,"info":""},{"id":"37ee46c5.d3e98a","type":"subflow","name":"Iterate","in":[{"x":220,"y":219,"wires":[{"id":"12b1ebc3.9fb144"}]}],"out":[{"x":454,"y":174,"wires":[{"id":"12b1ebc3.9fb144","port":0}]},{"x":455,"y":259,"wires":[{"id":"12b1ebc3.9fb144","port":1}]}]},{"id":"41df38c0.fb39c8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#00506f","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#408080","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#00506f","edited":true},"page-titlebar-backgroundColor":{"value":"#00506f","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0087bb","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#00506f","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"raspi-franka","hideToolbar":"false","allowSwipe":"false","lockMenu":"true","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":27,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"cbf02e0a.18499","type":"ui_group","z":"","name":"Display Auflösung","tab":"be0e5438.eb46b8","order":2,"disp":true,"width":8,"collapse":false},{"id":"aa40158d.83bf68","type":"persist-store","z":"","filename":"/home/pi/node-red/persistant-settings/persistance.json","interval":"60"},{"id":"29050d2.fa3cef2","type":"ui_group","z":"","name":"Anwendungen","tab":"be0e5438.eb46b8","order":1,"disp":true,"width":8,"collapse":false},{"id":"5758df94.472ad","type":"ui_group","z":"","name":"Konsole","tab":"be0e5438.eb46b8","order":7,"disp":true,"width":16,"collapse":false},{"id":"be0e5438.eb46b8","type":"ui_tab","z":"","name":"Admin","icon":"fa-cogs","order":5,"disabled":false,"hidden":false},{"id":"ca6d8830.a2dc48","type":"telegram bot","z":"","botname":"FrankaBilderrahmen","usernames":"","chatids":"","baseapiurl":"","updatemode":"polling","pollinterval":"300","usesocks":false,"sockshost":"","socksport":"6667","socksusername":"anonymous","sockspassword":"","bothost":"","localbotport":"8443","publicbotport":"8443","privatekey":"","certificate":"","useselfsignedcertificate":false,"sslterminated":false,"verboselogging":false},{"id":"8d10bcb3.ecd5","type":"kodi-controller","z":"","name":"","host":"127.0.0.1","port":"9090"},{"id":"bd2821f2.1ee81","type":"ui_tab","z":"","name":"Dev","icon":"dashboard","order":6,"disabled":true,"hidden":true},{"id":"838588b8.d90038","type":"ui_group","z":"","name":"fbi","tab":"bd2821f2.1ee81","order":4,"disp":true,"width":6,"collapse":false},{"id":"69cbfcd5.4478f4","type":"ui_group","z":"","name":"Power","tab":"be0e5438.eb46b8","order":3,"disp":true,"width":8,"collapse":false},{"id":"47e9fd6a.bb2c94","type":"ui_group","z":"","name":"omxplayer","tab":"bd2821f2.1ee81","order":6,"disp":true,"width":"6","collapse":false},{"id":"ac137d79.4eec5","type":"ui_group","z":"","name":"fim","tab":"bd2821f2.1ee81","order":5,"disp":true,"width":"6","collapse":false},{"id":"b6d48645.bc31d8","type":"ui_tab","z":"","name":"Telegram","icon":"fa-telegram","order":3,"disabled":false,"hidden":false},{"id":"f7a9f973.917ec8","type":"ui_group","z":"","name":"Navigate Images","tab":"bd2821f2.1ee81","order":2,"disp":true,"width":20,"collapse":false},{"id":"d353cd3f.37915","type":"ui_group","z":"","name":"Navigate Videos","tab":"bd2821f2.1ee81","order":3,"disp":true,"width":20,"collapse":false},{"id":"f7d8373.6ed35c8","type":"ui_spacer","name":"spacer","group":"f7a9f973.917ec8","order":2,"width":7,"height":1},{"id":"89bbbe7.8c0ce4","type":"ui_spacer","name":"spacer","group":"f7a9f973.917ec8","order":5,"width":7,"height":1},{"id":"a3b5e949.03ee68","type":"ui_spacer","name":"spacer","group":"d353cd3f.37915","order":2,"width":7,"height":1},{"id":"b168b834.dc1588","type":"ui_spacer","name":"spacer","group":"d353cd3f.37915","order":5,"width":7,"height":1},{"id":"4537c880.c405c8","type":"ui_tab","z":"","name":"Bilder","icon":"fa-picture-o","order":1,"disabled":false,"hidden":false},{"id":"43f81666.762748","type":"ui_group","z":"","name":"Navigation","tab":"4537c880.c405c8","order":1,"disp":true,"width":16,"collapse":false},{"id":"79173158.54b5a","type":"ui_group","z":"","name":"Bilderrahmen","tab":"e03e0a2.04b2ef8","order":1,"disp":true,"width":"16","collapse":true},{"id":"df1cecd4.4f555","type":"ui_group","z":"","name":"Textoverlay","tab":"e03e0a2.04b2ef8","order":2,"disp":true,"width":"16","collapse":true},{"id":"6ea23321.89550c","type":"ui_group","z":"","name":"Nutzerliste","tab":"b6d48645.bc31d8","order":1,"disp":true,"width":8,"collapse":false},{"id":"3e3a5d75.a251e2","type":"ui_group","z":"","name":"Neuer Nutzer","tab":"b6d48645.bc31d8","order":2,"disp":true,"width":8,"collapse":false},{"id":"a974a1dc.2318","type":"ui_group","z":"","name":"Nutzer löschen","tab":"b6d48645.bc31d8","order":3,"disp":true,"width":8,"collapse":false},{"id":"e03e0a2.04b2ef8","type":"ui_tab","z":"","name":"Einstellungen","icon":"build","order":4,"disabled":false,"hidden":false},{"id":"98f89e13.1f66c","type":"ui_group","z":"","name":"Bildschirm","tab":"e03e0a2.04b2ef8","order":6,"disp":true,"width":8,"collapse":false},{"id":"5024c415.87ce1c","type":"ui_tab","z":"","name":"Videos","icon":"fa-video-camera","order":2,"disabled":false,"hidden":false},{"id":"ed8a86bc.a4c3c8","type":"ui_group","z":"","name":"Log","tab":"be0e5438.eb46b8","order":8,"disp":true,"width":16,"collapse":false},{"id":"1229b955.63bec7","type":"ui_group","z":"","name":"Telegram-Ordner","tab":"be0e5438.eb46b8","order":4,"disp":true,"width":"8","collapse":false},{"id":"9ed2be8.851194","type":"ui_group","z":"","name":"Bot","tab":"bd2821f2.1ee81","order":1,"disp":true,"width":8,"collapse":false},{"id":"c51c9a95.f2cb68","type":"ui_group","z":"","name":"Navigation","tab":"5024c415.87ce1c","order":1,"disp":true,"width":16,"collapse":false},{"id":"68292322.19060c","type":"ui_group","z":"","name":"Lautsprecher","tab":"e03e0a2.04b2ef8","order":5,"disp":true,"width":8,"collapse":false},{"id":"d021848d.7c9d58","type":"ui_group","z":"","name":"Videos","tab":"e03e0a2.04b2ef8","order":3,"disp":true,"width":"16","collapse":true},{"id":"3912675.5619198","type":"ui_group","z":"","name":"Info wenn neue Nachricht","tab":"e03e0a2.04b2ef8","order":4,"disp":true,"width":"8","collapse":false},{"id":"bbe4de68.fd284","type":"ui_spacer","name":"spacer","group":"79173158.54b5a","order":5,"width":12,"height":1},{"id":"379b461f.3fa76a","type":"ui_spacer","name":"spacer","group":"df1cecd4.4f555","order":13,"width":4,"height":1},{"id":"b32f407e.ee0d3","type":"ui_spacer","name":"spacer","group":"df1cecd4.4f555","order":15,"width":4,"height":1},{"id":"b242fa6a.175d28","type":"ui_group","z":"","name":"Reset Q-Gates","tab":"be0e5438.eb46b8","order":6,"disp":true,"width":8,"collapse":false},{"id":"e4f17352.69409","type":"ui_group","z":"","name":"FreeDNS Update-URL","tab":"be0e5438.eb46b8","order":5,"disp":true,"width":8,"collapse":false},{"id":"475c031.1def4fc","type":"ui_spacer","name":"spacer","group":"29050d2.fa3cef2","order":2,"width":2,"height":1},{"id":"9fb9cb39.874f78","type":"ui_spacer","name":"spacer","group":"29050d2.fa3cef2","order":4,"width":2,"height":1},{"id":"40594ce8.388634","type":"comment","z":"dfa0e0a5.c8001","name":"Kodi","info":"","x":110,"y":340,"wires":[]},{"id":"b1559b66.b13608","type":"persist in","z":"dfa0e0a5.c8001","name":"kodi","storageNode":"aa40158d.83bf68","x":430,"y":440,"wires":[]},{"id":"e16556a1.a6cf78","type":"persist out","z":"dfa0e0a5.c8001","name":"kodi","storageNode":"aa40158d.83bf68","x":130,"y":440,"wires":[["ee81297d.751808"]]},{"id":"ee81297d.751808","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"kodi","tooltip":"","group":"29050d2.fa3cef2","order":1,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":400,"wires":[["448d0e97.8e5ff","b1559b66.b13608","9104c854.65d0d8"]]},{"id":"448d0e97.8e5ff","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":470,"y":400,"wires":[["a4de161d.ffeba8"],["8b9a1ad8.074a98"]]},{"id":"a4de161d.ffeba8","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":730,"y":380,"wires":[[],[],[]]},{"id":"8b9a1ad8.074a98","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":730,"y":440,"wires":[[],[],[]]},{"id":"6cd3950b.9e00ac","type":"comment","z":"dfa0e0a5.c8001","name":"Konsole","info":"","x":120,"y":1420,"wires":[]},{"id":"3dca4bde.f1fce4","type":"exec","z":"dfa0e0a5.c8001","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":420,"y":1480,"wires":[["c8efbfb.47c8f4"],["c8efbfb.47c8f4"],[]]},{"id":"cc6ee33b.21bbf","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"","tooltip":"","group":"5758df94.472ad","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"","x":200,"y":1480,"wires":[["3dca4bde.f1fce4"]]},{"id":"c8efbfb.47c8f4","type":"ui_text","z":"dfa0e0a5.c8001","group":"5758df94.472ad","order":2,"width":16,"height":7,"name":"","label":"","format":"{{msg.payload}}","layout":"row-left","x":630,"y":1480,"wires":[]},{"id":"d6b46b2e.94f648","type":"telegram receiver","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","saveDataDir":"","x":120,"y":180,"wires":[["1874c46c.dc959c","fdf976eb.414d08","695fd683.0af3d8","e0dbe779.1681b8"],["1874c46c.dc959c","fdf976eb.414d08","695fd683.0af3d8","e0dbe779.1681b8"]]},{"id":"b6f51156.34f41","type":"comment","z":"dfa0e0a5.c8001","name":"Power","info":"","x":110,"y":2300,"wires":[]},{"id":"52fd84f4.48542c","type":"exec","z":"dfa0e0a5.c8001","command":"sudo reboot","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":390,"y":2440,"wires":[[],[],[]]},{"id":"1a962367.79520d","type":"exec","z":"dfa0e0a5.c8001","command":"sudo poweroff","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":400,"y":2380,"wires":[[],[],[]]},{"id":"d29e809d.09503","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"69cbfcd5.4478f4","order":2,"width":8,"height":1,"passthru":false,"label":"Power off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":200,"y":2380,"wires":[["1a962367.79520d"]]},{"id":"f4a74376.3936d","type":"ui_button","z":"dfa0e0a5.c8001","name":"","group":"69cbfcd5.4478f4","order":1,"width":8,"height":1,"passthru":false,"label":"Reboot","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":200,"y":2440,"wires":[["52fd84f4.48542c"]]},{"id":"6fdc4e8e.2370d","type":"comment","z":"dfa0e0a5.c8001","name":"lightdm","info":"","x":110,"y":720,"wires":[]},{"id":"bde9ea0c.be08b8","type":"persist in","z":"dfa0e0a5.c8001","name":"lightdm","storageNode":"aa40158d.83bf68","x":440,"y":840,"wires":[]},{"id":"c5fd422f.cb21f","type":"persist out","z":"dfa0e0a5.c8001","name":"lightdm","storageNode":"aa40158d.83bf68","x":140,"y":840,"wires":[["29fdcca4.a8b3a4"]]},{"id":"29fdcca4.a8b3a4","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"lightdm","tooltip":"","group":"29050d2.fa3cef2","order":3,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":280,"y":800,"wires":[["3d7a77a3.b7a3c8","bde9ea0c.be08b8"]]},{"id":"3d7a77a3.b7a3c8","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":470,"y":800,"wires":[["b396fb4e.6efd08"],["b843bc6d.a6abf"]]},{"id":"b396fb4e.6efd08","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start lightdm","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":740,"y":780,"wires":[[],[],[]]},{"id":"b843bc6d.a6abf","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop lightdm","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":740,"y":840,"wires":[[],[],[]]},{"id":"6b411980.a2ece8","type":"kodi-out","z":"5af1388b.ef9838","name":"media-server kodi","controller":"8d10bcb3.ecd5","unit_number":"1","output":"1","kodicommand":"","x":1950,"y":1000,"wires":[],"info":"https://kodi.wiki/view/JSON-RPC_API/v9"},{"id":"9f706fb6.41096","type":"kodi-in","z":"5af1388b.ef9838","name":"","controller":"8d10bcb3.ecd5","x":90,"y":800,"wires":[["2a52a9ea.bcf6b6","cbdf7fed.a48c1","413ecc2f.d1b544"]]},{"id":"f67bcd76.e9764","type":"comment","z":"5af1388b.ef9838","name":"kodi","info":"","x":1130,"y":160,"wires":[]},{"id":"883c1b70.676b08","type":"function","z":"5af1388b.ef9838","name":"Player.Open (directory)","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.Open\",\n            \"args\":{\n                \"item\":{\n                    \"directory\":msg.payload   \n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":1380,"y":320,"wires":[["b2efa2c8.3efc"]]},{"id":"ffbdb28d.7c8a6","type":"function","z":"5af1388b.ef9838","name":"Player.PlayPause","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.PlayPause\",\n            \"params\":{\n                \"playerid\":2\n            }\n        }\n};","outputs":1,"noerr":0,"x":1390,"y":220,"wires":[["b2efa2c8.3efc"]]},{"id":"3e356f2e.d3986","type":"function","z":"5af1388b.ef9838","name":"Player.Open (file)","func":"return {\n    payload: \n        {\n            \"method\":\"Player.Open\",\n            \"params\":{\n                \"item\":{\n                    \"file\":msg.payload   \n                }\n                \n            }\n        }\n};","outputs":1,"noerr":0,"x":1410,"y":1800,"wires":[["b2efa2c8.3efc"]]},{"id":"6941cbb5.e2c064","type":"function","z":"5af1388b.ef9838","name":"Playlist.GetPlaylists","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.GetPlaylists\"\n        }\n};","outputs":1,"noerr":0,"x":1830,"y":160,"wires":[["b2efa2c8.3efc"]]},{"id":"dce22cd9.dca44","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1650,"y":160,"wires":[["6941cbb5.e2c064"]]},{"id":"e71a57f2.2c0be8","type":"function","z":"5af1388b.ef9838","name":"Playlist.GetActivePlayers","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.GetActivePlayers\",\n        }\n};","outputs":1,"noerr":0,"x":1850,"y":200,"wires":[["b2efa2c8.3efc"]]},{"id":"519686aa.b96248","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1650,"y":200,"wires":[["e71a57f2.2c0be8"]]},{"id":"6eb6fb45.cfdac4","type":"function","z":"5af1388b.ef9838","name":"Player.Stop","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.Stop\",\n            \"params\":{\n                \"playerid\":2\n            }\n        }\n};","outputs":1,"noerr":0,"x":1410,"y":260,"wires":[["b2efa2c8.3efc"]]},{"id":"6559cc36.1b5184","type":"file in","z":"5af1388b.ef9838","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":570,"y":740,"wires":[["5cf77f2.8adb28"]]},{"id":"985e9032.56967","type":"comment","z":"5af1388b.ef9838","name":"Dashboard Preview","info":"","x":490,"y":700,"wires":[]},{"id":"5cf77f2.8adb28","type":"base64","z":"5af1388b.ef9838","name":"","action":"str","property":"payload","x":700,"y":740,"wires":[["b40e2a53.8af888"]]},{"id":"b40e2a53.8af888","type":"ui_template","z":"5af1388b.ef9838","group":"43f81666.762748","name":"","order":1,"width":16,"height":"7","format":"<img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":840,"y":740,"wires":[[]]},{"id":"43f88de5.2f1884","type":"comment","z":"5af1388b.ef9838","name":"Ausgabe","info":"","x":1100,"y":100,"wires":[]},{"id":"74815107.7a996","type":"comment","z":"5af1388b.ef9838","name":"Navigation","info":"","x":380,"y":120,"wires":[]},{"id":"4b692df3.f4f474","type":"function","z":"5af1388b.ef9838","name":"get file","func":"try{\n    var filename = msg.payload.data.data.item.file.slice((msg.payload.data.data.item.file.lastIndexOf(\"/\")) + 1);\n    var status = msg.payload.notification;\n    \n    if(status === \"Player.OnPlay\"){\n        if(msg.topic){\n            \n            filename = global.get('images-dashboard') + filename.slice(0, 31) + \".dash.jpg.stick.jpg\";\n            \n        } else {\n            \n            filename = global.get('images-dashboard') + filename + \".dash.jpg\";\n            \n        }\n        msg = { filename };\n        return msg;\n    }\n} catch(e){\n    \n}\n","outputs":1,"noerr":0,"x":450,"y":740,"wires":[["6559cc36.1b5184"]]},{"id":"6e18904b.3731","type":"function","z":"5af1388b.ef9838","name":"Playlist.Add","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.Add\",\n            \"params\":{\n                \"playlistid\":2,\n                \"item\":{\n                    \"file\":msg.payload\n                }\n            }\n        }\n};","outputs":1,"noerr":0,"x":1410,"y":760,"wires":[["b2efa2c8.3efc"]]},{"id":"2bfde3a8.6783ac","type":"function","z":"5af1388b.ef9838","name":"Playlist.GetItems","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.GetItems\",\n            \"params\":{\n                \"playlistid\":2\n        }\n    }\n};","outputs":1,"noerr":0,"x":1830,"y":240,"wires":[["b2efa2c8.3efc"]]},{"id":"91e0d2.eadd6f3","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1650,"y":240,"wires":[["2bfde3a8.6783ac"]]},{"id":"f6f2588b.8879f8","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo next","func":"return {\n    payload: \n        {\n            \"method\":\"Player.GoTo\",\n            \"params\":{\n                \"playerid\":2,\n                \"to\": \"next\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1390,"y":480,"wires":[["b2efa2c8.3efc"]]},{"id":"93b3653f.741c78","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo previous","func":"return {\n    payload: \n        {\n            \"method\":\"Player.GoTo\",\n            \"params\":{\n                \"playerid\":2,\n                \"to\": \"previous\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1380,"y":440,"wires":[["b2efa2c8.3efc"]]},{"id":"5d370aff.d14a34","type":"ui_button","z":"5af1388b.ef9838","name":"pause","group":"43f81666.762748","order":3,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-pause","payload":"pause","payloadType":"str","topic":"","x":550,"y":160,"wires":[["ffbdb28d.7c8a6","c613e3ff.4f41e","39aabebe.9aab22"]]},{"id":"35814bc8.a20154","type":"ui_button","z":"5af1388b.ef9838","name":"stop","group":"43f81666.762748","order":4,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-stop","payload":"stop","payloadType":"str","topic":"","x":550,"y":220,"wires":[["6eb6fb45.cfdac4","c613e3ff.4f41e","39aabebe.9aab22"]]},{"id":"29ee9c53.3a5b84","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"43f81666.762748","order":5,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":550,"y":340,"wires":[["93b3653f.741c78"]]},{"id":"e94831cb.248ea","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"43f81666.762748","order":6,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":550,"y":380,"wires":[["f6f2588b.8879f8"]]},{"id":"aa8f2459.3432d8","type":"function","z":"5af1388b.ef9838","name":"Playlist.Clear","func":"return {\n    payload: \n        {\n            \"method\":\"Playlist.Clear\",\n            \"params\":{\n                \"playlistid\":2\n            }\n        }\n};","outputs":1,"noerr":0,"x":1410,"y":860,"wires":[["b2efa2c8.3efc"]]},{"id":"24dd70b4.86387","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1230,"y":900,"wires":[["aa8f2459.3432d8"]]},{"id":"99bf7b1a.41e4f8","type":"function","z":"5af1388b.ef9838","name":"Settings.SetSettingValue","func":"return {\n    payload: \n        {\n            \"method\":\"Settings.SetSettingValue\",\n            \"params\":{\n                \"setting\":\"slideshow.staytime\",\n                \"value\":msg.payload\n            }\n        }\n};","outputs":1,"noerr":0,"x":1370,"y":1200,"wires":[["b2efa2c8.3efc"]]},{"id":"acb583ed.1f6e1","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Anzeigedauer (sek.)","tooltip":"","group":"79173158.54b5a","order":1,"width":16,"height":1,"passthru":true,"outs":"end","topic":"","min":"3","max":"60","step":"3","x":510,"y":1340,"wires":[["ab1b6e6.0cf699","af647e03.8fe05"]]},{"id":"f065e78b.0b06e8","type":"ui_button","z":"5af1388b.ef9838","name":"play","group":"43f81666.762748","order":2,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-play","payload":"play","payloadType":"str","topic":"","x":550,"y":280,"wires":[["c613e3ff.4f41e","c6be6051.f6e5f","39aabebe.9aab22"]]},{"id":"c613e3ff.4f41e","type":"function","z":"5af1388b.ef9838","name":"set color","func":"if (msg.payload === \"play\" || msg.payload === \"kodiPlay\"){\n    var payload = \"\";\n    var msg2 = {payload};\n    msg.payload = \"#eb4034\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', true);\n    return [msg2, msg];\n\n} else if (msg.payload === \"pause\"){\n    if ((context.get('colorswitchPause') || false) && context.set('colorswitchPlay')){\n        msg.payload = \"#ebe534\";\n        context.set('colorswitchPause', false);\n    } else {\n        msg.payload = \"\";\n        context.set('colorswitchPause', true);\n    }\n    return [msg, null];\n\n} else if (msg.payload === \"kodiPause\"){\n    msg.payload = \"#ebe534\";\n    context.set('colorswitchPause', false);\n    return [msg, null];\n\n} else if (msg.payload === \"stop\" || msg.payload === \"kodiStop\"){\n    msg.payload = \"\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', false);\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":340,"y":220,"wires":[["5d370aff.d14a34"],["f065e78b.0b06e8"]]},{"id":"c6be6051.f6e5f","type":"function","z":"5af1388b.ef9838","name":"set folder images-frameloop","func":"msg.payload = global.get('images-frameloop');\nreturn msg;","outputs":1,"noerr":0,"x":960,"y":280,"wires":[["883c1b70.676b08"]]},{"id":"6ca0a6f5.8b6858","type":"ui_button","z":"5af1388b.ef9838","name":"stick","group":"43f81666.762748","order":7,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-paperclip","payload":"stick","payloadType":"str","topic":"","x":750,"y":880,"wires":[["833ed45c.3e3b58","c72480c6.b6957","793b21c7.52223"]]},{"id":"44c72ea3.e7ca1","type":"ui_button","z":"5af1388b.ef9838","name":"delete","group":"43f81666.762748","order":8,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"Wirklich löschen?","payloadType":"str","topic":"","x":550,"y":1100,"wires":[["6eb4a9aa.8de568"]]},{"id":"3c457ef9.347f12","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Max. Anzahl Bilder Schleife","tooltip":"","group":"79173158.54b5a","order":2,"width":16,"height":1,"passthru":true,"outs":"end","topic":"","min":"1","max":"300","step":1,"x":540,"y":1580,"wires":[["2de84ae9.85c9d6"]]},{"id":"a62c991d.72a4c8","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1140,"wires":[["47a50bf1.1a7ff4"],["47a50bf1.1a7ff4"],[]]},{"id":"a2cd0a5.02febf8","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1160,"wires":[["b5b89633.bb5a78"]]},{"id":"b5b89633.bb5a78","type":"function","z":"ba1e4f7d.a87f3","name":"create fbi cmd","func":"var duration = \"4\";\nvar folder = \"/home/pi/media/telegram/\";\n\n//msg.payload = \"sudo fbi -d /dev/fb0 -T 1 -a -t \" + duration + \" --noverbose --readahead --blend 3 \" + folder + \"*.jpg\";\nmsg.payload = \"sudo fbi -d /dev/fb0 -T 1 -a -t \" + duration + \" --readahead --blend 3 \" + folder + \"*.jpg\";\n\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1140,"wires":[["a62c991d.72a4c8"]]},{"id":"47a50bf1.1a7ff4","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1140,"wires":[]},{"id":"2652e9a9.77c7f6","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"838588b8.d90038","order":1,"width":0,"height":0,"passthru":false,"label":"start slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1120,"wires":[["b5b89633.bb5a78"]]},{"id":"471bacc.085f054","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1320,"wires":[["587a4cf5.59a2b4"]]},{"id":"587a4cf5.59a2b4","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall fbi\";\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1300,"wires":[["c22a84d4.60b528"]]},{"id":"7fe7bc48.58e114","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"838588b8.d90038","order":3,"width":0,"height":0,"passthru":false,"label":"stop slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1280,"wires":[["587a4cf5.59a2b4"]]},{"id":"6884e69e.c98708","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"838588b8.d90038","order":2,"width":0,"height":0,"passthru":false,"label":"restart slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1220,"wires":[["587a4cf5.59a2b4","403bb0af.7188"]]},{"id":"403bb0af.7188","type":"delay","z":"ba1e4f7d.a87f3","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1220,"wires":[["b5b89633.bb5a78"]]},{"id":"e8000f81.969be","type":"comment","z":"ba1e4f7d.a87f3","name":"fbi","info":"","x":100,"y":1060,"wires":[]},{"id":"c22a84d4.60b528","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1300,"wires":[["5d3ab0ee.c3228"],["5d3ab0ee.c3228"],[]]},{"id":"5d3ab0ee.c3228","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1300,"wires":[]},{"id":"4c25c5a7.1f563c","type":"function","z":"ba1e4f7d.a87f3","name":"create fbi cmd","func":"var file = msg.filename;\n//var file = \"/home/pi/media/telegram/*.jpg\";\n\n//msg.payload = \"sudo fbi -d /dev/fb0 -T 1 -a --noverbose --readahead --blend 3 \" + file;\nmsg.payload = \"sudo fbi -T 1 -a --noverbose --blend 3 \" + file;\n\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":380,"wires":[["c0a34b87.0e1ef8"]]},{"id":"704160c3.4bf8c","type":"comment","z":"ba1e4f7d.a87f3","name":"Navigation","info":"","x":120,"y":100,"wires":[]},{"id":"4cf866e1.ecc2e8","type":"ui_template","z":"ba1e4f7d.a87f3","group":"f7a9f973.917ec8","name":"","order":1,"width":20,"height":8,"format":"\n \n <img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1200,"y":220,"wires":[[]]},{"id":"bcb54f00.5bf98","type":"base64","z":"ba1e4f7d.a87f3","name":"","action":"str","property":"payload","x":1060,"y":220,"wires":[["4cf866e1.ecc2e8"]]},{"id":"834ec8e6.83e348","type":"file in","z":"ba1e4f7d.a87f3","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":810,"y":220,"wires":[["bcb54f00.5bf98"]]},{"id":"fd5bc185.4357b","type":"ui_button","z":"ba1e4f7d.a87f3","name":"left","group":"f7a9f973.917ec8","order":3,"width":3,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":150,"y":300,"wires":[["8c2b87fa.9e2b08","26a4ce3.ddf7532"]]},{"id":"c43edb74.939b68","type":"ui_button","z":"ba1e4f7d.a87f3","name":"right","group":"f7a9f973.917ec8","order":4,"width":3,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":150,"y":340,"wires":[["8c2b87fa.9e2b08","26a4ce3.ddf7532"]]},{"id":"aa5ff526.cb86a8","type":"function","z":"ba1e4f7d.a87f3","name":"navigate files","func":"var fileindex = global.get('fileindex-images') || 0;\nvar filelist = global.get('filelist-images');\nvar filelistlength = filelist.length;\n\nif (msg.payload === \"r\"){\n    if (fileindex === (filelistlength - 1)){\n        fileindex = 0;\n    } else {\n        fileindex = fileindex + 1;\n    }\n    \n} else {\n    if (fileindex === 0){\n        fileindex = filelistlength - 1;\n    } else {\n        fileindex = fileindex - 1;\n    }\n}\n\nglobal.set('fileindex-images', fileindex);\n\nvar filename = filelist[fileindex];\n\nmsg.payload = fileindex;\nmsg = { filename };\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":320,"wires":[["834ec8e6.83e348","a42fab94.f93608","4c25c5a7.1f563c","80c39c43.26de2"]]},{"id":"a42fab94.f93608","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":490,"y":400,"wires":[]},{"id":"db0c45ab.1d2bc8","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"l","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":400,"wires":[["26a4ce3.ddf7532"]]},{"id":"aa32d1aa.77cd9","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"r","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":440,"wires":[["26a4ce3.ddf7532"]]},{"id":"8c2b87fa.9e2b08","type":"fs-file-lister","z":"ba1e4f7d.a87f3","name":"","start":"/home/pi/media/telegram","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":320,"y":240,"wires":[["ac49c114.f4bf1"]]},{"id":"ac49c114.f4bf1","type":"change","z":"ba1e4f7d.a87f3","name":"","rules":[{"t":"set","p":"filelist-images","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":240,"wires":[[]]},{"id":"4f2e3cdf.49a614","type":"inject","z":"ba1e4f7d.a87f3","name":"start","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":150,"y":240,"wires":[["8c2b87fa.9e2b08"]]},{"id":"7d8d3f3e.57d96","type":"comment","z":"ba1e4f7d.a87f3","name":"Ausgabe","info":"","x":780,"y":100,"wires":[]},{"id":"9d3f0f5f.9aecd","type":"comment","z":"ba1e4f7d.a87f3","name":"Dashboard","info":"","x":820,"y":160,"wires":[]},{"id":"d9edc072.e5131","type":"comment","z":"ba1e4f7d.a87f3","name":"fbi","info":"","x":810,"y":320,"wires":[]},{"id":"c0a34b87.0e1ef8","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1000,"y":380,"wires":[["13b70a3f.181016"],["13b70a3f.181016"],[]]},{"id":"13b70a3f.181016","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":380,"wires":[]},{"id":"f1f94645.e8e398","type":"comment","z":"ba1e4f7d.a87f3","name":"Images","info":"","x":130,"y":160,"wires":[]},{"id":"d77b006a.92ff1","type":"ui_button","z":"ba1e4f7d.a87f3","name":"left","group":"d353cd3f.37915","order":3,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":150,"y":820,"wires":[["cf3725bb.2048f8","970c2d9.a21f3d"]]},{"id":"598130fe.ad4a1","type":"ui_button","z":"ba1e4f7d.a87f3","name":"right","group":"d353cd3f.37915","order":4,"width":3,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":150,"y":860,"wires":[["cf3725bb.2048f8","970c2d9.a21f3d"]]},{"id":"cfbd3682.bec5b8","type":"function","z":"ba1e4f7d.a87f3","name":"navigate files","func":"var fileindex = global.get('fileindex-videos') || 0;\nvar filelist = global.get('filelist-videos');\nvar filelistlength = filelist.length;\n\nif (msg.payload === \"r\"){\n    if (fileindex === (filelistlength - 1)){\n        fileindex = 0;\n    } else {\n        fileindex = fileindex + 1;\n    }\n    \n} else {\n    if (fileindex === 0){\n        fileindex = filelistlength - 1;\n    } else {\n        fileindex = fileindex - 1;\n    }\n}\n\nglobal.set('fileindex-videos', fileindex);\n\nvar filename = filelist[fileindex];\n\nmsg.payload = fileindex;\nmsg = { filename };\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":840,"wires":[["12fc1b0a.6db095","50190e2b.45b1e","7a6a8761.b8efd8"]]},{"id":"12fc1b0a.6db095","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":920,"wires":[]},{"id":"8afa9caf.ecc46","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"l","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":920,"wires":[["970c2d9.a21f3d"]]},{"id":"98ba7001.e0bc9","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"r","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":960,"wires":[["970c2d9.a21f3d"]]},{"id":"cf3725bb.2048f8","type":"fs-file-lister","z":"ba1e4f7d.a87f3","name":"","start":"/home/pi/media/telegram","pattern":"*.mp4","folders":"*","hidden":true,"lstype":"files","path":true,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":320,"y":760,"wires":[["3da6b2d5.19f27e"]]},{"id":"3da6b2d5.19f27e","type":"change","z":"ba1e4f7d.a87f3","name":"","rules":[{"t":"set","p":"filelist-videos","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":760,"wires":[[]]},{"id":"ab94beb2.5f0c7","type":"inject","z":"ba1e4f7d.a87f3","name":"start","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":760,"wires":[["cf3725bb.2048f8"]]},{"id":"646759e5.45d608","type":"comment","z":"ba1e4f7d.a87f3","name":"Videos","info":"","x":130,"y":680,"wires":[]},{"id":"d0a9483e.e4e7c8","type":"comment","z":"ba1e4f7d.a87f3","name":"omxplayer","info":"","x":820,"y":680,"wires":[]},{"id":"cd54d6f3.67e618","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1060,"y":820,"wires":[["88071f2c.6d173"],["88071f2c.6d173"],[]]},{"id":"88071f2c.6d173","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1250,"y":820,"wires":[]},{"id":"50190e2b.45b1e","type":"function","z":"ba1e4f7d.a87f3","name":"create omxplayer cmd","func":"var file = msg.filename;\n\nmsg.payload = \"sudo omxplayer -b \" + file;\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":820,"wires":[["cd54d6f3.67e618"]]},{"id":"d5bcf01b.6f5d1","type":"ui_template","z":"ba1e4f7d.a87f3","group":"d353cd3f.37915","name":"","order":1,"width":20,"height":8,"format":"\n \n <img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1200,"y":740,"wires":[[]]},{"id":"1f4fbf36.b4b801","type":"base64","z":"ba1e4f7d.a87f3","name":"","action":"str","property":"payload","x":1060,"y":740,"wires":[["d5bcf01b.6f5d1"]]},{"id":"7a6a8761.b8efd8","type":"file in","z":"ba1e4f7d.a87f3","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":810,"y":740,"wires":[["1f4fbf36.b4b801"]]},{"id":"970c2d9.a21f3d","type":"function","z":"ba1e4f7d.a87f3","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":840,"wires":[["cfbd3682.bec5b8"]]},{"id":"26a4ce3.ddf7532","type":"function","z":"ba1e4f7d.a87f3","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":320,"wires":[["aa5ff526.cb86a8"]]},{"id":"864d171b.28ec38","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1040,"y":540,"wires":[["4075bc9.bc2b144"],["4075bc9.bc2b144"],[]]},{"id":"662a25c4.b44dec","type":"function","z":"ba1e4f7d.a87f3","name":"create fim cmd","func":"//var file = msg.filename;\nvar file = \"/home/pi/media/telegram/*.jpg\";\n\nmsg.payload = \"sudo fim -a \" + file;\n\nreturn msg;","outputs":1,"noerr":0,"x":842,"y":540,"wires":[["864d171b.28ec38"]]},{"id":"4075bc9.bc2b144","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1230,"y":540,"wires":[]},{"id":"a597478f.ce79d8","type":"comment","z":"ba1e4f7d.a87f3","name":"fim","info":"","x":810,"y":480,"wires":[]},{"id":"80c39c43.26de2","type":"delay","z":"ba1e4f7d.a87f3","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":640,"y":460,"wires":[["8a6ff35e.ec044"]]},{"id":"8a6ff35e.ec044","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall fbi\";\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":420,"wires":[["c0a34b87.0e1ef8"]]},{"id":"8c730af9.2a5788","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1500,"wires":[["c398064d.3e5718"],["c398064d.3e5718"],[]]},{"id":"2d5857b7.ac2cc8","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1520,"wires":[["c840d4d3.0f7128"]]},{"id":"c840d4d3.0f7128","type":"function","z":"ba1e4f7d.a87f3","name":"create fim cmd","func":"var duration = \"4\";\nvar folder = \"/home/pi/media/telegram/\";\n\n\nmsg.payload = \"sudo fim -a --slideshow \" + duration + \" \" + folder + \"*.jpg\";\n\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1500,"wires":[["8c730af9.2a5788"]]},{"id":"c398064d.3e5718","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1500,"wires":[]},{"id":"ef5d29c9.1c9fe8","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"ac137d79.4eec5","order":1,"width":0,"height":0,"passthru":false,"label":"start slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1480,"wires":[["c840d4d3.0f7128"]]},{"id":"785822a9.c1debc","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1680,"wires":[["ac375e76.b805b"]]},{"id":"ac375e76.b805b","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall fim\";\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1660,"wires":[["74e393ec.efd44c"]]},{"id":"d6be8805.cc7ef8","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"ac137d79.4eec5","order":3,"width":0,"height":0,"passthru":false,"label":"stop slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":160,"y":1640,"wires":[["ac375e76.b805b"]]},{"id":"e753aea.eb2e95","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"ac137d79.4eec5","order":2,"width":0,"height":0,"passthru":false,"label":"restart slideshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1580,"wires":[["ac375e76.b805b","e0dd1470.4cb8d8"]]},{"id":"e0dd1470.4cb8d8","type":"delay","z":"ba1e4f7d.a87f3","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":1580,"wires":[["c840d4d3.0f7128"]]},{"id":"620c9d19.e77d34","type":"comment","z":"ba1e4f7d.a87f3","name":"fim","info":"","x":100,"y":1420,"wires":[]},{"id":"74e393ec.efd44c","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":580,"y":1660,"wires":[["99f08f1e.a5247"],["99f08f1e.a5247"],[]]},{"id":"99f08f1e.a5247","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":1660,"wires":[]},{"id":"23fd144.87a42ec","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":1880,"wires":[["16fa0e77.2ed662"],["16fa0e77.2ed662"],[]]},{"id":"4be812e8.6c5c0c","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1900,"wires":[["6630e260.67d91c"]]},{"id":"6630e260.67d91c","type":"function","z":"ba1e4f7d.a87f3","name":"create omxplayer cmd","func":"var folder = \"/home/pi/media/telegram/\";\n\nmsg.payload = \"sudo omxplayer -b \" + folder + \"*.mp4\";\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1880,"wires":[["23fd144.87a42ec"]]},{"id":"16fa0e77.2ed662","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":1880,"wires":[]},{"id":"473eaea.6e0955","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"47e9fd6a.bb2c94","order":1,"width":0,"height":0,"passthru":false,"label":"start videoshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1860,"wires":[["6630e260.67d91c"]]},{"id":"4737b0ac.35833","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":2000,"wires":[["6610924b.43c2dc"]]},{"id":"6610924b.43c2dc","type":"function","z":"ba1e4f7d.a87f3","name":"create kill cmd","func":"msg.payload = \"sudo killall omxplayer.bin\";\nreturn msg;","outputs":1,"noerr":0,"x":392,"y":1980,"wires":[["3e12acf.d557d54"]]},{"id":"2c1d8e1b.495b52","type":"ui_button","z":"ba1e4f7d.a87f3","name":"","group":"47e9fd6a.bb2c94","order":2,"width":0,"height":0,"passthru":false,"label":"stop videoshow","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":1960,"wires":[["6610924b.43c2dc"]]},{"id":"48900a05.f1d6a4","type":"comment","z":"ba1e4f7d.a87f3","name":"omxplayer ","info":"","x":120,"y":1800,"wires":[]},{"id":"3e12acf.d557d54","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":1980,"wires":[["c3efd311.79bcf"],["c3efd311.79bcf"],[]]},{"id":"c3efd311.79bcf","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":1980,"wires":[]},{"id":"5f31aa92.80caf4","type":"comment","z":"5af1388b.ef9838","name":"delete","info":"","x":510,"y":1060,"wires":[]},{"id":"6eb4a9aa.8de568","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":710,"y":1100,"wires":[["8789cd73.c6c3c"]]},{"id":"583882c6.a20d2c","type":"function","z":"5af1388b.ef9838","name":"Input.SendText","func":"return {\n    payload: \n        {\n            \"cmd\":\"Input.SendText\",\n            \"params\":{\n                \"text\":\"blubb\"\n            }\n        }\n};","outputs":1,"noerr":0,"x":1820,"y":280,"wires":[["b2efa2c8.3efc"]]},{"id":"beee446f.1b1f48","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"Start","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1650,"y":280,"wires":[["583882c6.a20d2c"]]},{"id":"ab1b6e6.0cf699","type":"function","z":"5af1388b.ef9838","name":"convert","func":"msg.payload = Math.round(msg.payload/3);\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":1260,"wires":[["99bf7b1a.41e4f8"]]},{"id":"f7056c7a.85c5c","type":"function","z":"7c56a241.1e88dc","name":"add user","func":"if(flow.get('newuserallow')){\n    \n    msg.payload = msg.payload.chatId;\n    \n    return msg;\n    \n}\n","outputs":1,"noerr":0,"x":420,"y":2820,"wires":[["9f2c06f5.e84578","762299e2.b08378","20f4a5de.5065ba"]]},{"id":"9f2c06f5.e84578","type":"ui_text","z":"7c56a241.1e88dc","group":"3e3a5d75.a251e2","order":2,"width":8,"height":1,"name":"","label":"Chat ID:","format":"{{msg.payload}}","layout":"row-spread","x":760,"y":2860,"wires":[]},{"id":"a13b8087.ca44b","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Name","tooltip":"","group":"3e3a5d75.a251e2","order":3,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":910,"y":2860,"wires":[["e7014a1b.9c3398"]]},{"id":"e6d51937.2ef0b8","type":"comment","z":"7c56a241.1e88dc","name":"Nachricht empfangen","info":"","x":140,"y":100,"wires":[]},{"id":"757faf3f.cc2c2","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"3e3a5d75.a251e2","order":4,"width":2,"height":1,"passthru":false,"label":"add","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":470,"y":2740,"wires":[["804ae741.99e948"]]},{"id":"451b6501.9ca6fc","type":"change","z":"7c56a241.1e88dc","name":"set newuserallow","rules":[{"t":"set","p":"newuserallow","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":2980,"wires":[[]]},{"id":"476d2ce0.c3db64","type":"ui_switch","z":"7c56a241.1e88dc","name":"","label":"Hinzufügen erlauben?","tooltip":"","group":"3e3a5d75.a251e2","order":1,"width":8,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":400,"y":2980,"wires":[["451b6501.9ca6fc","a90e0331.97fe"]]},{"id":"e7014a1b.9c3398","type":"change","z":"7c56a241.1e88dc","name":"set newusername","rules":[{"t":"set","p":"newusername","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":2860,"wires":[[]]},{"id":"804ae741.99e948","type":"function","z":"7c56a241.1e88dc","name":"add user to userlist","func":"// Variablen abspeichern\n\nvar userlist = global.get('userlist');\nvar name = flow.get('newusername');\nvar chatid = flow.get('newuserchatid') || \"\";\nvar user = { name,\n            chatid\n        }\n\n// Überprüfen ob Chat-ID bereits in Liste vorhanden\n\nif (chatid === \"\"){\n    msg.payload = \"Bitte Chat-ID eintragen\";\n    return [null, msg];\n}\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].chatid == user.chatid || userlist[i].name == user.name){\n        msg.payload = \"User oder Chat-ID bereits eingetragen\";\n        return [null, msg];\n    }\n}\n\n\nuserlist.push(user);\nglobal.set('userlist', userlist);\n\n\nmsg.payload = \"User \" + name + \" hinzugefügt!\";\n\nreturn [msg, null];","outputs":2,"noerr":0,"x":650,"y":2740,"wires":[["1b33b81b.c8c678","8e34fc29.95d0e"],["1b33b81b.c8c678"]]},{"id":"762299e2.b08378","type":"change","z":"7c56a241.1e88dc","name":"set newuserchatid","rules":[{"t":"set","p":"newuserchatid","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":2820,"wires":[[]]},{"id":"f0adc1e7.e4047","type":"function","z":"7c56a241.1e88dc","name":"reset userlist array","func":"var userlist = [];\n\nglobal.set('userlist', userlist);\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":2500,"wires":[["b1e0eefd.f5d6f"]]},{"id":"12b1ebc3.9fb144","type":"function","z":"37ee46c5.d3e98a","name":"Iterate","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    itt.outArray.push(msg.payload)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":347,"y":220,"wires":[[],[]]},{"id":"27dbf3c5.ea56ac","type":"persist in","z":"7c56a241.1e88dc","name":"userlist","storageNode":"aa40158d.83bf68","x":880,"y":2420,"wires":[]},{"id":"81133135.59e94","type":"persist out","z":"7c56a241.1e88dc","name":"userlist","storageNode":"aa40158d.83bf68","x":240,"y":2560,"wires":[["859a3652.7d91d8"]]},{"id":"dba4e951.a9efa8","type":"ui_button","z":"7c56a241.1e88dc","name":"Delete","group":"a974a1dc.2318","order":2,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"","payloadType":"str","topic":"","x":190,"y":3280,"wires":[["edf3d6a.2b23428"]]},{"id":"e8159558.7ba548","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Name","tooltip":"","group":"a974a1dc.2318","order":1,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":250,"y":3220,"wires":[["e786a2e1.b3a2b"]]},{"id":"a0dc3f6b.e367e","type":"function","z":"7c56a241.1e88dc","name":"delete user from userlist","func":"var userlist = global.get('userlist');\nvar name = flow.get('userdel');\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].name == name){\n        userlist.splice(i, 1);\n        msg.payload = \"User \" + name + \" gelöscht!\";\n        return msg;\n    }\n}\n\nmsg.payload = \"User \" + name + \" nicht vorhanden\";\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":3280,"wires":[["6cf1a068.8292a","fb805673.96fe38"]]},{"id":"e786a2e1.b3a2b","type":"change","z":"7c56a241.1e88dc","name":"set userdel","rules":[{"t":"set","p":"userdel","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":3220,"wires":[[]]},{"id":"20f4a5de.5065ba","type":"function","z":"7c56a241.1e88dc","name":"format text","func":"msg.payload = \"Neuer Nutzer mit der ChatID \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":2900,"wires":[["ffccee7f.7a23d"]]},{"id":"ffccee7f.7a23d","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":730,"y":2900,"wires":[]},{"id":"5b81269d.e5e4c8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":240,"y":2500,"wires":[["f0adc1e7.e4047"]]},{"id":"1874c46c.dc959c","type":"function","z":"7c56a241.1e88dc","name":"Gate user exists?","func":"// Variablen setzen\n\nvar userlist = global.get('userlist');\nvar chatid = msg.payload.chatId;\n\n// Überprüfen ob User in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    \n    if(userlist[i].chatid == chatid){\n        msg.payload.name = userlist[i].name;\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":370,"y":180,"wires":[["c66f4c4.35413b"]]},{"id":"acc8335f.4cf74","type":"telegram sender","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","x":580,"y":80,"wires":[[]]},{"id":"d08da02a.c9ddd","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":910,"y":860,"wires":[[],[],["f153fa65.e56d38"]]},{"id":"e21f5b8.47cd3a8","type":"function","z":"7c56a241.1e88dc","name":"wget Image","func":"try {\n    msg.payload = \"wget \" + msg.payload.weblink +\" -P \" + global.get('images-incoming');\n    return msg;\n} catch (e){}","outputs":1,"noerr":0,"x":760,"y":860,"wires":[["d08da02a.c9ddd"]]},{"id":"859e9bb8.08dea8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"25235235435","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":2820,"wires":[["6f5b8b48.395204"]]},{"id":"6f5b8b48.395204","type":"function","z":"7c56a241.1e88dc","name":"tele Message sim","func":"var chatId = msg.payload;\nvar messageId = 12;\nvar type = \"message\";\nvar content = \"blubb\"\n\nmsg.payload ={ chatId, messageId, type, content }\n\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":2880,"wires":[["f7056c7a.85c5c"]]},{"id":"9d2bef95.e1e3a","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":500,"y":3060,"wires":[["476d2ce0.c3db64"]]},{"id":"6cf1a068.8292a","type":"ui_toast","z":"7c56a241.1e88dc","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1090,"y":3280,"wires":[]},{"id":"3fc5248a.79ae4c","type":"comment","z":"7c56a241.1e88dc","name":"Nutzer löschen","info":"","x":200,"y":3160,"wires":[]},{"id":"7a84f3a9.010e6c","type":"comment","z":"7c56a241.1e88dc","name":"Nutzer hinzufügen","info":"","x":210,"y":2660,"wires":[]},{"id":"faa710fa.a3be","type":"comment","z":"7c56a241.1e88dc","name":"Nutzerliste","info":"","x":178.75,"y":2413.75,"wires":[]},{"id":"859a3652.7d91d8","type":"change","z":"7c56a241.1e88dc","name":"set userlist","rules":[{"t":"set","p":"userlist","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":2560,"wires":[["b1e0eefd.f5d6f"]]},{"id":"49556607.9cccc8","type":"function","z":"7c56a241.1e88dc","name":"format userlist","func":"var userlist = msg.payload;\nmsg.payload = \"\";\n\nfor (var i=0; i < userlist.length; i++) {\n    msg.payload = msg.payload + \"<tr><td>\" + userlist[i].name + \"</td><td>\" + userlist[i].chatid + \"</td></tr>\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":920,"y":2560,"wires":[["a3cb9891.1b4998"]]},{"id":"b1e0eefd.f5d6f","type":"change","z":"7c56a241.1e88dc","name":"get userlist","rules":[{"t":"set","p":"payload","pt":"msg","to":"userlist","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":2520,"wires":[["27dbf3c5.ea56ac","49556607.9cccc8","5ff7f213.dc881c"]]},{"id":"1b33b81b.c8c678","type":"ui_toast","z":"7c56a241.1e88dc","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":890,"y":2740,"wires":[[]]},{"id":"fdf976eb.414d08","type":"link out","z":"7c56a241.1e88dc","name":"","links":["11cd389c.d11267"],"x":235,"y":240,"wires":[]},{"id":"11cd389c.d11267","type":"link in","z":"7c56a241.1e88dc","name":"","links":["fdf976eb.414d08"],"x":280,"y":2720,"wires":[["f7056c7a.85c5c"]]},{"id":"7b771b5.e814ee4","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"234523","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":2780,"wires":[["6f5b8b48.395204"]]},{"id":"d3db6368.6ef7e","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"234","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":2740,"wires":[["6f5b8b48.395204"]]},{"id":"a90e0331.97fe","type":"function","z":"7c56a241.1e88dc","name":"true-> false","func":"if(msg.payload){\n    msg.payload = false;\n} else {\n    msg.reset = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":3060,"wires":[["9d2bef95.e1e3a"]]},{"id":"d6db478c.577268","type":"link in","z":"7c56a241.1e88dc","name":"","links":["8e34fc29.95d0e","fb805673.96fe38"],"x":615,"y":2560,"wires":[["b1e0eefd.f5d6f"]]},{"id":"8e34fc29.95d0e","type":"link out","z":"7c56a241.1e88dc","name":"","links":["d6db478c.577268"],"x":775,"y":2660,"wires":[]},{"id":"fb805673.96fe38","type":"link out","z":"7c56a241.1e88dc","name":"","links":["d6db478c.577268"],"x":1015,"y":3240,"wires":[]},{"id":"5ff7f213.dc881c","type":"ui_table","z":"7c56a241.1e88dc","group":"6ea23321.89550c","name":"","order":1,"width":8,"height":8,"columns":[{"field":"name","title":"Name","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"chatid","title":"Chat-ID","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":930,"y":2480,"wires":[["eaa29f3a.26b62"]]},{"id":"a3cb9891.1b4998","type":"template","z":"7c56a241.1e88dc","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n<head>\n<style>\nth {\n  text-align: center;\n}\n</style>\n</head>\n\n<body>\n<table style=\"width:100%; text-align:center\">\n  <tr>\n    <th>Name</th>\n    <th>Chat-ID</th> \n  </tr>\n    {{payload}}\n</table>\n\n</body>\n</html>\n","output":"str","x":1080,"y":2560,"wires":[[]]},{"id":"eaa29f3a.26b62","type":"function","z":"7c56a241.1e88dc","name":"get name","func":"try{\n    msg.payload = msg.payload.name;\n} catch (e){}\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":2480,"wires":[["4fd715d2.f30bec"]]},{"id":"4fd715d2.f30bec","type":"link out","z":"7c56a241.1e88dc","name":"","links":["8bc512af.c6d39"],"x":1215,"y":2480,"wires":[]},{"id":"8bc512af.c6d39","type":"link in","z":"7c56a241.1e88dc","name":"","links":["4fd715d2.f30bec"],"x":155,"y":3220,"wires":[["e8159558.7ba548"]]},{"id":"8b7c9098.b7c87","type":"ui_toast","z":"7c56a241.1e88dc","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":490,"y":3280,"wires":[["e0267b70.807be8"]]},{"id":"edf3d6a.2b23428","type":"function","z":"7c56a241.1e88dc","name":"delete?","func":"var name = flow.get('userdel');\n\nmsg.payload = \"User \" + name + \" wirklich löschen?\";\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":3280,"wires":[["8b7c9098.b7c87"]]},{"id":"e0267b70.807be8","type":"function","z":"7c56a241.1e88dc","name":"gate \"OK\"","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":640,"y":3280,"wires":[["a0dc3f6b.e367e"]]},{"id":"c67a9b7.e69db68","type":"comment","z":"7c56a241.1e88dc","name":"Add Text","info":"","x":140,"y":1340,"wires":[]},{"id":"2a0f261a.c87d7a","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":470,"y":1400,"wires":[[],[],["993d21d1.50d41"]]},{"id":"47b2d8c4.6cd5c8","type":"function","z":"7c56a241.1e88dc","name":"convert image add text","func":"var imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\n\nimagepath = imagepath + flow.get('filenameResize');\nresultpath = resultpath + flow.get('filenameResize') + \".addText.jpg\";\n\nvar bgalpha = flow.get('bgalpha') || \"00\";\nvar bgcolor = flow.get('bgcolor') || \"000000\";\nvar text = flow.get('lastTelegramMessage') || \"no text entered\";\nvar textsize = \"\";\nif (flow.get('textsize') > 0){\n    textsize = \" -pointsize \" + (flow.get('textsize') || 30);\n}\nvar sizeX = ((flow.get('lastImageWidth')) * (flow.get('lastImageResize'))/100) - flow.get('cropX');\nvar sizeY = ((flow.get('lastImageHeight')) * (flow.get('lastImageResize'))/100) - flow.get('cropY');\nvar gravity = flow.get('gravity') || \"center\";\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\nvar undercolor = \"\";\nif (flow.get('undercolor') !== \"off\"){\n    undercolor = \" -undercolor \" + (flow.get('undercolor') || black);\n}\n\nmsg.topic = \"textTrue\";\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + undercolor + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:'\" + text + \"' \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":1400,"wires":[["2a0f261a.c87d7a"]]},{"id":"90f79f30.5128a","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Beispieltext","tooltip":"","group":"df1cecd4.4f555","order":1,"width":16,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":310,"y":1780,"wires":[["e6038caa.89d","6660cfe.4d8bc3"]]},{"id":"ac2280f9.16249","type":"ui_slider","z":"7c56a241.1e88dc","name":"","label":"Textgröße (0 = Auto)","tooltip":"","group":"df1cecd4.4f555","order":5,"width":8,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"300","step":1,"x":340,"y":1820,"wires":[["fbf4878e.4717a8","6660cfe.4d8bc3"]]},{"id":"fbf4878e.4717a8","type":"change","z":"7c56a241.1e88dc","name":"set textsize","rules":[{"t":"set","p":"textsize","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1820,"wires":[["cfed2e53.218c4"]]},{"id":"dbda7118.3ce1","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"cropX","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1880,"wires":[["4044d43a.bedd7c"]]},{"id":"40429ec1.98ae4","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"cropY","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1940,"wires":[["28352150.11049e"]]},{"id":"3d21531.919c4ac","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Textfarbe","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":7,"width":6,"height":1,"passthru":true,"options":[{"label":"weiß","value":"white","type":"str"},{"label":"gelb","value":"yellow","type":"str"},{"label":"grün","value":"green","type":"str"}],"payload":"","topic":"","x":300,"y":2060,"wires":[["b0e629e7.3c2188","6660cfe.4d8bc3"]]},{"id":"b0e629e7.3c2188","type":"change","z":"7c56a241.1e88dc","name":"set color","rules":[{"t":"set","p":"color","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":2060,"wires":[["358d0942.7d2936"]]},{"id":"e6038caa.89d","type":"change","z":"7c56a241.1e88dc","name":"set text","rules":[{"t":"set","p":"text","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":1780,"wires":[["ed1b362e.9d5968"]]},{"id":"6d099478.6b2b4c","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"df1cecd4.4f555","order":14,"width":8,"height":1,"passthru":false,"label":"Vorschau","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"","payload":"preview","payloadType":"str","topic":"","x":1220,"y":1940,"wires":[["ef90c7f4.06d958","33dfef36.1813b"]]},{"id":"cbfecc82.1d24b","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Texthintergrundfarbe","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":8,"width":10,"height":1,"passthru":true,"options":[{"label":"schwarz","value":"black","type":"str"},{"label":"grau","value":"grey","type":"str"},{"label":"weiß","value":"white","type":"str"},{"label":"Aus","value":"off","type":"str"}],"payload":"","topic":"","x":340,"y":2120,"wires":[["8134f650.06c6e8","6660cfe.4d8bc3"]]},{"id":"8134f650.06c6e8","type":"change","z":"7c56a241.1e88dc","name":"set undercolor","rules":[{"t":"set","p":"undercolor","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":2120,"wires":[["83dbf2f.ff19f1"]]},{"id":"975f0fbb.92c15","type":"change","z":"7c56a241.1e88dc","name":"set bgcolor","rules":[{"t":"set","p":"bgcolor","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":2180,"wires":[[]]},{"id":"ef90c7f4.06d958","type":"function","z":"7c56a241.1e88dc","name":"set color","func":"if (msg.payload === \"\"){\n    msg.payload = \"#34eb5c\"; //green\n} else {\n    msg.payload = \"#ebe534\"; //yellow\n}\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":2000,"wires":[["6d099478.6b2b4c"]]},{"id":"6660cfe.4d8bc3","type":"function","z":"7c56a241.1e88dc","name":"set bt color","func":"msg.payload = \"\";\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":1940,"wires":[["6d099478.6b2b4c"]]},{"id":"33dfef36.1813b","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":1940,"wires":[["d0a83fff.6eaba"]]},{"id":"63c3affe.9cbca","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Font","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":6,"width":8,"height":1,"passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":610,"y":2300,"wires":[["78feb7ea.4a8028","6660cfe.4d8bc3"]]},{"id":"8c8ad3b9.a0ebf","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":280,"y":2300,"wires":[["7149253a.796c3c"]]},{"id":"8254dada.b94d58","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Crop X","tooltip":"","group":"df1cecd4.4f555","order":2,"width":4,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":290,"y":1880,"wires":[["dbda7118.3ce1","6660cfe.4d8bc3"]]},{"id":"1aa8b429.d2cb4c","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Crop Y","tooltip":"","group":"df1cecd4.4f555","order":3,"width":4,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":300,"y":1940,"wires":[["40429ec1.98ae4","6660cfe.4d8bc3"]]},{"id":"5d9fbd8b.699e44","type":"change","z":"7c56a241.1e88dc","name":"set gravity","rules":[{"t":"set","p":"gravity","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":2000,"wires":[["bd6139aa.649098"]]},{"id":"d180f32d.9e311","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Position","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":4,"width":8,"height":1,"passthru":true,"options":[{"label":"Mitte","value":"center","type":"str"},{"label":"Oben","value":"north","type":"str"},{"label":"Unten","value":"south","type":"str"},{"label":"Links","value":"west","type":"str"},{"label":"Rechts","value":"east","type":"str"},{"label":"Oben-links","value":"northwest","type":"str"},{"label":"Oben-rechts","value":"northeast","type":"str"},{"label":"Unten-links","value":"southwest","type":"str"},{"label":"Unten-rechts","value":"southeast","type":"str"}],"payload":"","topic":"","x":300,"y":2000,"wires":[["5d9fbd8b.699e44","6660cfe.4d8bc3"]]},{"id":"78feb7ea.4a8028","type":"change","z":"7c56a241.1e88dc","name":"set font","rules":[{"t":"set","p":"font","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":2300,"wires":[["ae65c529.28aca8"]]},{"id":"6d59b988.e1fa18","type":"ui_slider","z":"7c56a241.1e88dc","name":"","label":"Transparenz (0 = max)","tooltip":"","group":"df1cecd4.4f555","order":10,"width":10,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"255","step":"1","x":340,"y":2240,"wires":[["fbafa881.198c28","25f04c65.41db54"]]},{"id":"bea0cf56.50f72","type":"change","z":"7c56a241.1e88dc","name":"set bgalpha","rules":[{"t":"set","p":"bgalpha","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":2240,"wires":[[]]},{"id":"585a7ad.f3eb984","type":"ui_colour_picker","z":"7c56a241.1e88dc","name":"","label":"Hintergrundfarbe","group":"df1cecd4.4f555","format":"hex","outformat":"string","showSwatch":true,"showPicker":false,"showValue":false,"showHue":false,"showAlpha":false,"showLightness":true,"square":"false","dynOutput":"false","order":9,"width":6,"height":1,"passthru":true,"topic":"","x":330,"y":2180,"wires":[["6874c671.202dd8","1ffe1d7c.c14403"]]},{"id":"fbafa881.198c28","type":"function","z":"7c56a241.1e88dc","name":"-> hex","func":"msg.payload = msg.payload.toString(16);\n\nif(msg.payload.length < 2){\n    msg.payload = \"0\" + msg.payload;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":2240,"wires":[["bea0cf56.50f72","6660cfe.4d8bc3"]]},{"id":"7149253a.796c3c","type":"function","z":"7c56a241.1e88dc","name":"fonts options","func":"var options = [\"AvantGarde-Book\",\"AvantGarde-BookOblique\",\"AvantGarde-Demi\",\"AvantGarde-DemiOblique\",\"Bookman-Demi\",\"Bookman-DemiItalic\",\"Bookman-Light\",\"Bookman-LightItalic\",\"Century-Schoolbook-L-Bold\",\"Century-School\",\"ook-L-Bold-Italic\",\"Century-Schoolbook-L-Italic\",\"Century-Schoolbook-L-Roman\",\"Courier\",\"Courier-Bold\",\"Courier-BoldOblique\",\"Courier-Oblique\",\"DejaVuMathTeXGyre-Regular\",\"DejaVu-Sans\",\"DejaVu-Sans-Bold\",\"DejaVu-Sans-Bold-Oblique\",\"DejaVu-Sans-Condensed\",\"DejaVu-Sans-Condensed-Bold\",\"DejaVu-Sans-Condensed-Bold-Oblique\",\"DejaVu-Sans-Condensed-Oblique\",\"DejaVu-Sans-ExtraLight\",\"DejaVu-Sans-Mono\",\"DejaVu-Sans-Mono-Bold\",\"DejaVu-Sans-Mono-Bold-Oblique\",\"DejaVu-Sans-Mono-Oblique\",\"DejaVu-Sans-Oblique\",\"DejaVu-Serif\",\"DejaVu-Serif-Bold\",\"DejaVu-Serif-Bold-Italic\",\"DejaVu-Serif-Condensed\",\"DejaVu-Serif-Condensed-Bold\",\"DejaVu-Serif-Condensed-Bold-Italic\",\"DejaVu-Serif-Condensed-Italic\",\"DejaVu-Serif-Italic\",\"Dingbats\",\"Droid-Sans-Fallback\",\"fixed\",\"FreeMono\",\"FreeMono-Bold\",\"FreeMono-Bold-Oblique\",\"FreeMono-Oblique\",\"FreeSans\",\"FreeSans-Bold\",\"FreeSans-Bold-Oblique\",\"FreeSans-Oblique\",\"FreeSerif\",\"FreeSerif-Bold\",\"FreeSerif-Bold-Italic\",\"FreeSerif-Italic\",\"Helvetica\",\"Helvetica-Bold\",\"Helvetica-BoldOblique\",\"Helvetica-Narrow\",\"Helvetica-Narrow-Bold\",\"Helvetica-Narrow-BoldOblique\",\"Helvetica-Narrow-Oblique\",\"Helvetica-Oblique\",\"Liberation-Mono\",\"Liberation-Mono-Bold\",\"Liberation-Mono-Bold-Italic\",\"Liberation-Mono-Italic\",\"Liberation-Sans\",\"Liberation-Sans-Bold\",\"Liberation-Sans-Bold-Italic\",\"Liberation-Sans-Italic\",\"Liberation-Sans-Narrow\",\"Liberation-Sans-Narrow-Bold\",\"Liberation-Sans-Narrow-Bold-Italic\",\"Liberation-Sans-Narrow-Italic\",\"Liberation-Serif\",\"Liberation-Serif-Bold\",\"Liberation-Serif-Bold-Italic\",\"Liberation-Serif-Italic\",\"NewCenturySchlbk-Bold\",\"NewCenturySchlbk-BoldItalic\",\"NewCenturySchlbk-Italic\",\"NewCenturySchlbk-Roman\",\"Nimbus-Mono-L\",\"Nimbus-Mono-L-Bold\",\"Nimbus-Mono-L-Bold-Oblique\",\"Nimbus-Mono-L-Regular-Oblique\",\"Nimbus-Roman-No9-L\",\"Nimbus-Roman-No9-L-Medium\",\"Nimbus-Roman-No9-L-Medium-Italic\",\"Nimbus-Roman-No9-L-Regular-Italic\",\"Nimbus-Sans-L\",\"Nimbus-Sans-L-Bold\",\"Nimbus-Sans-L-Bold-Condensed\",\"Nimbus-Sans-L-Bold-Condensed-Italic\",\"Nimbus-Sans-L-Bold-Italic\",\"Nimbus-Sans-L-Regular-Condensed\",\"Nimbus-Sans-L-Regular-Condensed-Italic\",\"Nimbus-Sans-L-Regular-Italic\",\"Noto-Mono\",\"Palatino-Bold\",\"Palatino-BoldItalic\",\"Palatino-Italic\",\"Palatino-Roman\",\"Piboto-Bold\",\"Piboto-Bold-Italic\",\"Piboto-Condensed-Bold\",\"Piboto-Condensed-Bold-Italic\",\"Piboto-Condensed-Italic\",\"Piboto-Condensed-Regular\",\"Piboto-Italic\",\"Piboto-Light\",\"Piboto-Light-Italic\",\"PibotoLt-Bold\",\"PibotoLt-Bold-Italic\",\"PibotoLt-Italic\",\"PibotoLt-Regular\",\"Piboto-Regular\",\"Piboto-Thin\",\"Piboto-Thin-Italic\",\"Quicksand-Bold\",\"Quicksand-Light\",\"Quicksand-Medium\",\"Quicksand-Regular\",\"Standard-Symbols-L\",\"Symbol\",\"Times-Bold\",\"Times-BoldItalic\",\"Times-Italic\",\"Times-Roman\",\"URW-Bookman-L-Demi-Bold\",\"URW-Bookman-L-Demi-Bold-Italic\",\"URW-Bookman-L-Light\",\"URW-Bookman-L-Light-Italic\",\"URW-Chancery-L-Medium-Italic\",\"URW-Gothic-L-Book\",\"URW-Gothic-L-Book-Oblique\",\"URW-Gothic-L-Demi\",\"URW-Gothic-L-Demi-Oblique\",\"URW-Palladio-L-Bold\",\"URW-Palladio-L-Bold-Italic\",\"URW-Palladio-L-Italic\",\"URW-Palladio-L-Roman\"];\nmsg = {options};\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":2300,"wires":[["63c3affe.9cbca"]]},{"id":"91e306eb.14ef18","type":"file in","z":"7c56a241.1e88dc","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":1410,"y":2220,"wires":[["6054f05a.f0311"]]},{"id":"6054f05a.f0311","type":"base64","z":"7c56a241.1e88dc","name":"","action":"str","property":"payload","x":1560,"y":2220,"wires":[["a1cf66a1.500238"]]},{"id":"a1cf66a1.500238","type":"ui_template","z":"7c56a241.1e88dc","group":"df1cecd4.4f555","name":"Vorschau","order":16,"width":16,"height":7,"format":"<img width=\"100%\" height=\"100%\" alt=\"Image not found\" src=\"data:image/png;base64,{{msg.payload}}\" />\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1700,"y":2220,"wires":[[]]},{"id":"47377c6c.b062e4","type":"function","z":"7c56a241.1e88dc","name":"set file","func":"var filename = \"/home/pi/media/telegram/preview/previewText.jpg\";\nmsg = { filename };\nreturn msg;\n","outputs":1,"noerr":0,"x":1710,"y":2140,"wires":[["91e306eb.14ef18"]]},{"id":"9dfe85ae.25ea38","type":"comment","z":"7c56a241.1e88dc","name":"Resize incoming Images","info":"","x":190,"y":1180,"wires":[]},{"id":"bc5c689d.b3fa98","type":"comment","z":"dfa0e0a5.c8001","name":"Displayauflösung","info":"","x":140,"y":80,"wires":[]},{"id":"e27c7715.f4ce48","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"y","tooltip":"","group":"cbf02e0a.18499","order":2,"width":4,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":290,"y":220,"wires":[["7836b6e0.a8b778"]]},{"id":"f7532169.84116","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"x","tooltip":"","group":"cbf02e0a.18499","order":1,"width":4,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":290,"y":180,"wires":[["bc339cc2.9fc39"]]},{"id":"7836b6e0.a8b778","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"displayHeight","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":220,"wires":[["d0308973.9e7a18"]]},{"id":"bc339cc2.9fc39","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"displayWidth","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":180,"wires":[["6a9d0ab7.38fd44"]]},{"id":"2b7c62e2.d3c16e","type":"image-info","z":"7c56a241.1e88dc","name":"","x":730,"y":1040,"wires":[["dfb12308.fde7e"]]},{"id":"d8607587.5f2828","type":"function","z":"7c56a241.1e88dc","name":"set file","func":"var lastTelegramFilename = flow.get('lastTelegramFilename');\nvar filename = global.get('images-preprocessing') + lastTelegramFilename;\nmsg = { filename,\n        lastTelegramFilename };\nreturn msg;\n","outputs":1,"noerr":0,"x":290,"y":1020,"wires":[["4f5819a7.f38628"]]},{"id":"4f5819a7.f38628","type":"file in","z":"7c56a241.1e88dc","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":450,"y":1060,"wires":[["2b7c62e2.d3c16e"]]},{"id":"78b61229.97257c","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"lastImageWidth","pt":"flow","to":"width","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1190,"y":1040,"wires":[["c13975e4.57fb78"]]},{"id":"dfb12308.fde7e","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"lastImageHeight","pt":"flow","to":"height","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":1040,"wires":[["78b61229.97257c"]]},{"id":"cb9542d9.58ab5","type":"inject","z":"7c56a241.1e88dc","name":"Start","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":1060,"wires":[["d8607587.5f2828"]]},{"id":"c13975e4.57fb78","type":"function","z":"7c56a241.1e88dc","name":"convert image resize","func":"var imagepath = global.get('images-preprocessing');\nvar resultpath = imagepath;\n\nimagepath = imagepath + msg.lastTelegramFilename;\nresultpath = resultpath + msg.lastTelegramFilename + \".resize.jpg\";\n\nvar displayWidth = global.get('displayWidth');\nvar displayHeight = global.get('displayHeight');\nvar lastImageWidth = flow.get('lastImageWidth');\nvar lastImageHeight = flow.get('lastImageHeight');\n\nflow.set('filenameResize', (msg.lastTelegramFilename + \".resize.jpg\"));\n\nvar resize = \"\";\nif (lastImageWidth/lastImageHeight > displayWidth/displayHeight){\n    \n    resize = (displayWidth / lastImageWidth * 100);\n    \n} else {\n    \n    resize = (displayHeight / lastImageHeight * 100);\n}\n\nflow.set('lastImageResize', resize);\n\nmsg.payload = \"convert \" + imagepath + \" -size \" + displayWidth + \"x\" + displayHeight + \" -auto-orient -resize \" + resize + \"%\" + \" xc:black +swap -gravity center -composite \" + resultpath;\n\nreturn msg;\n\n\n\n\n","outputs":1,"noerr":0,"x":460,"y":1180,"wires":[["361dacd6.b27bd4"]]},{"id":"361dacd6.b27bd4","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":650,"y":1180,"wires":[[],[],["c0a9ff00.fadfe"]]},{"id":"695fd683.0af3d8","type":"debug","z":"7c56a241.1e88dc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":140,"wires":[]},{"id":"911c282a.81a5f8","type":"fs-file-lister","z":"7c56a241.1e88dc","name":"","start":"global.get('images-incoming')","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":570,"y":940,"wires":[["cbf661c0.35f29"]]},{"id":"cbf661c0.35f29","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"lastTelegramFilename","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":940,"wires":[["6792b03c.50821"]]},{"id":"6792b03c.50821","type":"function","z":"7c56a241.1e88dc","name":"rename + mv -> preproc-folder","func":"var filename = \"01.jpg\";\nmsg.payload = \"mv \" + global.get('images-incoming') + (flow.get('lastTelegramFilename')) + \" \" + global.get('images-preprocessing') + filename;\nflow.set('lastTelegramFilename', filename);\n\nreturn msg;","outputs":1,"noerr":0,"x":1060,"y":940,"wires":[["e111055e.e9f098","98da01cf.24f5d"]]},{"id":"e111055e.e9f098","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1280,"y":940,"wires":[[],[],["635f03a6.5b896c"]]},{"id":"3eb469a9.a3f486","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramUsername","func":"// Variablen abspeichern\n\nvar userlist = global.get('userlist');\n\n// Überprüfen ob User bereits in Liste vorhanden\n\nfor (var i=0; i < userlist.length; i++) {\n    if(userlist[i].chatid == msg.payload.chatId){\n        msg.payload = userlist[i].name;\n        flow.set('lastTelegramUsername', msg.payload);\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":730,"y":800,"wires":[[]]},{"id":"fd4afe8c.3fa31","type":"function","z":"7c56a241.1e88dc","name":"convert image add name","func":"// set variables\nvar imagepath = global.get('images-preprocessing');\nvar resultpath = global.get('images-frameloop');\nvar sizeX = global.get('displayWidth');\nvar sizeY = global.get('displayHeight');\nvar gravity = (flow.get('gravityName')) || \"southeast\";\nvar undercolor = \"black\"; //\n\n// fix variables\n\nif (msg.topic === \"textTrue\"){\n    imagepath = imagepath + flow.get('filenameResize') + \".addText.jpg\";\n    resultpath = resultpath + flow.get('filenameResize') + \".addText.jpg\";\n    \n} else {\n    imagepath = imagepath + flow.get('filenameResize');\n    resultpath = resultpath + flow.get('filenameResize') + \".addName.jpg\";\n}\n\nvar textsize = (flow.get('nameTextsize')) || 40;\nvar bgalpha = \"00\";\nvar bgcolor = \"000000\";\nvar text = flow.get('lastTelegramUsername') || \"no text entered\";\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\n\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + \" -undercolor \" + undercolor + \" -pointsize \" + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:'\" + text + \"' \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\nmsg.filepath = resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":1320,"wires":[["6bc46fb3.9cc96"]]},{"id":"6bc46fb3.9cc96","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1050,"y":1320,"wires":[[],[],["d8cfda78.815aa8"]]},{"id":"6eff0982.4d8e18","type":"comment","z":"7c56a241.1e88dc","name":"Add Name + move to frameloop","info":"","x":850,"y":1280,"wires":[]},{"id":"96e17660.84c2d8","type":"ui_slider","z":"7c56a241.1e88dc","name":"","label":"Textgröße Name","tooltip":"","group":"df1cecd4.4f555","order":12,"width":7,"height":1,"passthru":true,"outs":"end","topic":"","min":0,"max":"300","step":1,"x":1260,"y":2300,"wires":[["e3208cfc.d7d2b"]]},{"id":"e3208cfc.d7d2b","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"nameTextsize","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1470,"y":2300,"wires":[["dc56b1d6.a55fa"]]},{"id":"2acfda59.b19246","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"gravityName","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1470,"y":2360,"wires":[["7597dbe9.10b6c4"]]},{"id":"4a5f8ce2.694264","type":"ui_dropdown","z":"7c56a241.1e88dc","name":"","label":"Position Name","tooltip":"","place":"Select option","group":"df1cecd4.4f555","order":11,"width":9,"height":1,"passthru":true,"options":[{"label":"Mitte","value":"center","type":"str"},{"label":"Oben","value":"north","type":"str"},{"label":"Unten","value":"south","type":"str"},{"label":"Links","value":"west","type":"str"},{"label":"Rechts","value":"east","type":"str"},{"label":"Oben-links","value":"northwest","type":"str"},{"label":"Oben-rechts","value":"northeast","type":"str"},{"label":"Unten-links","value":"southwest","type":"str"},{"label":"Unten-rechts","value":"southeast","type":"str"}],"payload":"","topic":"","x":1260,"y":2360,"wires":[["2acfda59.b19246"]]},{"id":"7a0d1fb4.a96cb","type":"comment","z":"5af1388b.ef9838","name":"funktioniert nicht bisher","info":"","x":1680,"y":100,"wires":[]},{"id":"84851945.fe0028","type":"function","z":"7c56a241.1e88dc","name":"convert image downsize","func":"var resize = 42;\nvar quality = 50;\n\nvar imagepath = global.get('images-frameloop');\nvar resultpath = global.get('images-dashboard');\n\nvar filename = flow.get('filenameResize') + \".addName.jpg\";\nif(msg.topic === \"textTrue\"){\n    filename = flow.get('filenameResize') + \".addText.jpg\";\n}\n\nimagepath = imagepath + filename;\nresultpath = resultpath + filename + \".dash.jpg\";\n\nmsg.payload = \"convert \" + imagepath + \" -resize \" + resize + \"% \" + \"-quality \" + quality + \" \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":1440,"wires":[["ececc511.da15c8"]]},{"id":"ececc511.da15c8","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1360,"y":1440,"wires":[[],[],["831c855e.b960c8"]]},{"id":"23a08705.fbb988","type":"function","z":"7c56a241.1e88dc","name":"delete source files","func":"var path = global.get('images-preprocessing');\n\nmsg.payload = \"rm \" + path + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":1640,"wires":[["7064ec00.eec2c4"]]},{"id":"7064ec00.eec2c4","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1360,"y":1640,"wires":[[],[],["e744adc5.91cdb"]]},{"id":"c66f4c4.35413b","type":"function","z":"7c56a241.1e88dc","name":"image/video?","func":"var chatId = 0;\nvar type = \"message\";\nvar content = \"\";\nvar payload = { chatId,\n                type,\n                content\n};\nvar msg2 = {payload};\n\nglobal.set('lastMimeVideo', \"mp4\");\n\nif (msg.payload.type === \"document\"){\n    var mimetype = msg.payload.weblink.slice(msg.payload.weblink.lastIndexOf(\".\") + 1);\n    if (mimetype === \"jpg\" || mimetype === \"JPG\"){\n        msg.payload.type = \"photo\";\n    }\n    if (mimetype === \"mp4\" || mimetype === \"MP4\" || mimetype === \"mov\" || mimetype === \"MOV\" || mimetype === \"mkv\" || mimetype === \"MKV\"){\n        msg.payload.type = \"video\";\n        global.set('lastMimeVideo', mimetype);\n    }\n}\n\nif (msg.payload.type === \"photo\"){\n    msg2.payload.chatId = msg.payload.chatId;\n    msg2.payload.content = \"Danke \" + msg.payload.name + \"! Dein Bild ist angekommen.\";\n    return [msg2, null, msg];\n\n} else if (msg.payload.type === \"video\"){\n    msg2.payload.chatId = msg.payload.chatId;\n    msg2.payload.content = \"Danke \" + msg.payload.name + \"! Dein Video ist angekommen! Du bekommst eine Nachricht, sobald es verfügbar ist.\";\n    return [msg2, msg, null];\n\n} else {\n    msg2.payload.chatId = msg.payload.chatId;\n    msg2.payload.content = \"Sorry \" + msg.payload.name + \", Nachrichten kommen leider nur an, wenn sie ein Foto oder ein Video enthalten :-( !\";\n    return [msg2, null, null];\n}","outputs":3,"noerr":0,"x":580,"y":200,"wires":[["acc8335f.4cf74"],["f2f6a38.3e3456","66f528de.c282b8"],["4cb00f29.ea1a8","7579cd34.da5794"]]},{"id":"7042f23b.40a91c","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramMessage","func":"try{\n    flow.set('lastTelegramMessage', msg.payload.caption);\n} catch(e){}","outputs":1,"noerr":0,"x":730,"y":760,"wires":[[]]},{"id":"ed1b362e.9d5968","type":"persist in","z":"7c56a241.1e88dc","name":"text","storageNode":"aa40158d.83bf68","x":710,"y":1780,"wires":[]},{"id":"627cd965.29f9b8","type":"persist out","z":"7c56a241.1e88dc","name":"text","storageNode":"aa40158d.83bf68","x":170,"y":1780,"wires":[["90f79f30.5128a"]]},{"id":"941919ea.591298","type":"persist out","z":"7c56a241.1e88dc","name":"textsize","storageNode":"aa40158d.83bf68","x":160,"y":1820,"wires":[["ac2280f9.16249"]]},{"id":"423001b7.fec31","type":"persist out","z":"7c56a241.1e88dc","name":"cropX","storageNode":"aa40158d.83bf68","x":170,"y":1880,"wires":[["8254dada.b94d58"]]},{"id":"18ae099d.f64776","type":"persist out","z":"7c56a241.1e88dc","name":"cropY","storageNode":"aa40158d.83bf68","x":170,"y":1940,"wires":[["1aa8b429.d2cb4c"]]},{"id":"b489b02d.1c24a","type":"persist out","z":"7c56a241.1e88dc","name":"gravity","storageNode":"aa40158d.83bf68","x":170,"y":2000,"wires":[["d180f32d.9e311"]]},{"id":"f1719bff.7db518","type":"persist out","z":"7c56a241.1e88dc","name":"color","storageNode":"aa40158d.83bf68","x":170,"y":2060,"wires":[["3d21531.919c4ac"]]},{"id":"36027ae8.bee566","type":"persist out","z":"7c56a241.1e88dc","name":"undercolor","storageNode":"aa40158d.83bf68","x":150,"y":2120,"wires":[["cbfecc82.1d24b"]]},{"id":"f034466e.9f5538","type":"persist out","z":"7c56a241.1e88dc","name":"bgcolor","storageNode":"aa40158d.83bf68","x":160,"y":2180,"wires":[["585a7ad.f3eb984"]]},{"id":"27e44bc4.7c4484","type":"persist out","z":"7c56a241.1e88dc","name":"bgalpha","storageNode":"aa40158d.83bf68","x":160,"y":2240,"wires":[["6d59b988.e1fa18"]]},{"id":"867c6ca3.d1996","type":"persist out","z":"7c56a241.1e88dc","name":"font","storageNode":"aa40158d.83bf68","x":270,"y":2360,"wires":[["79c38f03.88609"]]},{"id":"cfed2e53.218c4","type":"persist in","z":"7c56a241.1e88dc","name":"textsize","storageNode":"aa40158d.83bf68","x":720,"y":1820,"wires":[]},{"id":"4044d43a.bedd7c","type":"persist in","z":"7c56a241.1e88dc","name":"cropX","storageNode":"aa40158d.83bf68","x":710,"y":1880,"wires":[]},{"id":"28352150.11049e","type":"persist in","z":"7c56a241.1e88dc","name":"cropY","storageNode":"aa40158d.83bf68","x":710,"y":1940,"wires":[]},{"id":"bd6139aa.649098","type":"persist in","z":"7c56a241.1e88dc","name":"gravity","storageNode":"aa40158d.83bf68","x":710,"y":2000,"wires":[]},{"id":"358d0942.7d2936","type":"persist in","z":"7c56a241.1e88dc","name":"color","storageNode":"aa40158d.83bf68","x":710,"y":2060,"wires":[]},{"id":"83dbf2f.ff19f1","type":"persist in","z":"7c56a241.1e88dc","name":"undercolor","storageNode":"aa40158d.83bf68","x":730,"y":2120,"wires":[]},{"id":"1ffe1d7c.c14403","type":"persist in","z":"7c56a241.1e88dc","name":"bgcolor","storageNode":"aa40158d.83bf68","x":840,"y":2160,"wires":[]},{"id":"25f04c65.41db54","type":"persist in","z":"7c56a241.1e88dc","name":"bgalpha","storageNode":"aa40158d.83bf68","x":840,"y":2220,"wires":[]},{"id":"ae65c529.28aca8","type":"persist in","z":"7c56a241.1e88dc","name":"font","storageNode":"aa40158d.83bf68","x":890,"y":2300,"wires":[]},{"id":"5a3cd9b0.9e2848","type":"persist out","z":"7c56a241.1e88dc","name":"nameTextsize","storageNode":"aa40158d.83bf68","x":1080,"y":2300,"wires":[["96e17660.84c2d8"]]},{"id":"dc56b1d6.a55fa","type":"persist in","z":"7c56a241.1e88dc","name":"nameTextsize","storageNode":"aa40158d.83bf68","x":1680,"y":2300,"wires":[]},{"id":"49929ebb.ba7cb","type":"persist out","z":"7c56a241.1e88dc","name":"gravityName","storageNode":"aa40158d.83bf68","x":1090,"y":2360,"wires":[["4a5f8ce2.694264"]]},{"id":"7597dbe9.10b6c4","type":"persist in","z":"7c56a241.1e88dc","name":"gravityName","storageNode":"aa40158d.83bf68","x":1670,"y":2360,"wires":[]},{"id":"1599a9f1.7608d6","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1440,"y":2060,"wires":[[],[],["5dafe331.de7f3c"]]},{"id":"d0a83fff.6eaba","type":"function","z":"7c56a241.1e88dc","name":"convert image add text","func":"var imagepath = global.get('path-preview') + \"preview1280x800.jpg\";\nvar resultpath = global.get('path-preview') + \"previewText.jpg\";\n\nvar bgalpha = flow.get('bgalpha') || \"00\";\nvar bgcolor = flow.get('bgcolor') || \"000000\";\nvar text = flow.get('text') || \"no text entered\";\nvar textsize = \"\";\nif (flow.get('textsize') > 0){\n    textsize = \" -pointsize \" + (flow.get('textsize') || 30);\n}\nvar sizeX = global.get('displayWidth') - flow.get('cropX');\nvar sizeY = global.get('displayHeight') - flow.get('cropY');\nvar gravity = flow.get('gravity') || \"center\";\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\nvar undercolor = \"\";\nif (flow.get('undercolor') !== \"off\"){\n    undercolor = \" -undercolor \" + (flow.get('undercolor') || black);\n}\n\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + undercolor + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:'\" + text + \"' \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":2060,"wires":[["1599a9f1.7608d6"]]},{"id":"5dafe331.de7f3c","type":"function","z":"7c56a241.1e88dc","name":"if ok","func":"if (msg.payload.code === 0){\n    return msg;\n}","outputs":1,"noerr":0,"x":1590,"y":2060,"wires":[["ec06cd21.3584f"]]},{"id":"838d0fa3.dfdf4","type":"persist out","z":"5af1388b.ef9838","name":"anzeigedauer","storageNode":"aa40158d.83bf68","x":300,"y":1340,"wires":[["acb583ed.1f6e1"]]},{"id":"af647e03.8fe05","type":"persist in","z":"5af1388b.ef9838","name":"anzeigedauer","storageNode":"aa40158d.83bf68","x":1000,"y":1340,"wires":[]},{"id":"6a9d0ab7.38fd44","type":"persist in","z":"dfa0e0a5.c8001","name":"displayX","storageNode":"aa40158d.83bf68","x":740,"y":180,"wires":[]},{"id":"a6bd4590.053718","type":"persist out","z":"dfa0e0a5.c8001","name":"displayX","storageNode":"aa40158d.83bf68","x":140,"y":180,"wires":[["f7532169.84116"]]},{"id":"d0308973.9e7a18","type":"persist in","z":"dfa0e0a5.c8001","name":"displayY","storageNode":"aa40158d.83bf68","x":740,"y":220,"wires":[]},{"id":"3b565283.bda0de","type":"persist out","z":"dfa0e0a5.c8001","name":"displayY","storageNode":"aa40158d.83bf68","x":140,"y":220,"wires":[["e27c7715.f4ce48"]]},{"id":"79c38f03.88609","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":430,"y":2360,"wires":[["63c3affe.9cbca"]]},{"id":"6874c671.202dd8","type":"function","z":"7c56a241.1e88dc","name":"no #","func":"if (msg.payload.includes('#')){\n    msg.payload = msg.payload.slice(1);\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":2180,"wires":[["975f0fbb.92c15","6660cfe.4d8bc3"]]},{"id":"e0bd1910.7e6ac8","type":"comment","z":"7c56a241.1e88dc","name":"Settings Text","info":"","x":150,"y":1720,"wires":[]},{"id":"3e32eae9.dd5636","type":"function","z":"7c56a241.1e88dc","name":"switch if text","func":"if((flow.get('lastTelegramMessage') || false ) === false){\n    msg.topic = \"name\";\n    return [msg, null];\n} else {\n    msg.topic = \"textFalse\";\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":330,"y":1260,"wires":[["fd4afe8c.3fa31"],["47b2d8c4.6cd5c8"]]},{"id":"e1aec8f5.2b7b28","type":"comment","z":"7c56a241.1e88dc","name":"create thumbnails","info":"","x":930,"y":1400,"wires":[]},{"id":"a1bd3724.340b78","type":"comment","z":"7c56a241.1e88dc","name":"delete source files","info":"","x":930,"y":1640,"wires":[]},{"id":"ec06cd21.3584f","type":"function","z":"7c56a241.1e88dc","name":"convert image add name","func":"// set variables\nvar imagepath = global.get('path-preview');\nvar resultpath = imagepath;\nvar sizeX = global.get('displayWidth');\nvar sizeY = global.get('displayHeight');\nvar gravity = (flow.get('gravityName')) || \"southeast\";\nvar undercolor = \"black\"; //\n\n// fix variables\n\nimagepath = imagepath + \"previewText.jpg\";\nresultpath = resultpath + \"previewText.jpg\";\n\nvar textsize = (flow.get('nameTextsize')) || 40;\nvar bgalpha = \"00\";\nvar bgcolor = \"000000\";\nvar text = \"Name\";\nvar color = flow.get('color') || white;\nvar font = flow.get('font') || \"Liberation-Sans\";\n\nmsg.payload = \"convert -background '#\" + bgcolor + bgalpha + \"' -gravity \" + gravity + \" -fill \" + color + \" -undercolor \" + undercolor + \" -pointsize \" + textsize + \" -font \" + font + \" -size \" + sizeX + \"x\" + sizeY + \" caption:'\" + text + \"' \" + imagepath + \" +swap -gravity \" + gravity + \" -composite \" + resultpath;\n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":2140,"wires":[["ef800132.712b4"]]},{"id":"ef800132.712b4","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1440,"y":2140,"wires":[["ef90c7f4.06d958"],[],["cc682995.5cfca8"]]},{"id":"cc682995.5cfca8","type":"function","z":"7c56a241.1e88dc","name":"if ok","func":"if (msg.payload.code === 0){\n    return msg;\n}","outputs":1,"noerr":0,"x":1590,"y":2140,"wires":[["47377c6c.b062e4"]]},{"id":"1bc5e035.452d1","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Max. Anzahl Bilder Papierkorb","tooltip":"","group":"79173158.54b5a","order":3,"width":16,"height":1,"passthru":true,"outs":"end","topic":"","min":"1","max":"99","step":1,"x":550,"y":1640,"wires":[["afd767a1.e9d978"]]},{"id":"cc323c1e.9684c","type":"exec","z":"ba1e4f7d.a87f3","command":"","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":690,"y":2300,"wires":[["a6961568.21e038"],["a6961568.21e038"],["a6961568.21e038"]]},{"id":"d94018d9.852338","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"sudo cat /dev/tty1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":530,"y":2280,"wires":[["cc323c1e.9684c"]]},{"id":"a6961568.21e038","type":"debug","z":"ba1e4f7d.a87f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":2300,"wires":[]},{"id":"d088436c.e3048","type":"inject","z":"ba1e4f7d.a87f3","name":"","topic":"","payload":"sudo killall cat","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":510,"y":2320,"wires":[["cc323c1e.9684c"]]},{"id":"73b94e53.aa703","type":"function","z":"7c56a241.1e88dc","name":"move to stackText folder","func":"var file = flow.get('lastTelegramFilename');\nmsg.payload = \"mv \" + global.get('images-frameloop') + file + \".resize.jpg.addText.jpg \" + global.get('images-stackText') + \" && mv \" + global.get('images-dashboard') + file + \".resize.jpg.addText.jpg.dash.jpg \" + global.get('images-stackText');\n\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":1540,"wires":[["6529177f.e752a8","e039a271.eb952"]]},{"id":"6529177f.e752a8","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1360,"y":1540,"wires":[[],[],["ae82a07c.73067"]]},{"id":"bf3e7368.028ab","type":"comment","z":"7c56a241.1e88dc","name":"move to stackText folder if textActive true","info":"","x":900,"y":1500,"wires":[]},{"id":"8936fbaa.4e7a78","type":"ui_switch","z":"5af1388b.ef9838","name":"","label":"Text","tooltip":"","group":"79173158.54b5a","order":4,"width":4,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":470,"y":1420,"wires":[["f34c1177.b2b79","a8cc1088.83d24","86592564.faf2a8"]]},{"id":"f34c1177.b2b79","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"textActive","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":1420,"wires":[["ac44fda1.7d4db"]]},{"id":"2fe3f906.94a046","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":240,"wires":[[],[],["a4cb96a3.782c78"]]},{"id":"2de84ae9.85c9d6","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"loopMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":1580,"wires":[["9896db89.201e78"]]},{"id":"71a6d4a2.4e899c","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-frameloop')","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":760,"y":240,"wires":[["b1196f8b.4987a"]]},{"id":"4b9edd86.f48ea4","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":260,"wires":[["868dbac2.4fdcd8"]]},{"id":"ab515b4c.cf8af8","type":"function","z":"168e0b9d.9c19d4","name":"frameloop: rename + 1","func":"if(msg.payload !== \"Empty Folder\" && msg.topic === false){\n    var file = msg.payload;\n    var fileNew = \"temp.\";\n    var folder = \"\";\n    var x = parseInt(file.slice(0, 2));\n    \n    if (Number.isInteger(x)){\n        \n        x = x + 1;\n        \n        if(x > global.get('loopMax')){\n            \n            fileNew = fileNew + \"01.trash.\" + file;\n            \n            msg.payload = \"mv \" + global.get('images-frameloop') + file + \" \" + global.get('images-trash') + fileNew;\n            msg.folder = global.get('images-trash');\n        \n        } else {\n            var postfix = file.slice(2);\n            \n            if (x < 10){\n                fileNew = fileNew + \"0\" + x + postfix;\n            } else {\n                fileNew = fileNew + x + postfix;\n            }\n            msg.payload = \"mv \" + global.get('images-frameloop') + file + \" \" + global.get('images-frameloop') + fileNew;\n            msg.folder = global.get('images-frameloop');\n        }\n        \n        msg.file = fileNew;\n        \n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":1120,"y":240,"wires":[["2fe3f906.94a046"]]},{"id":"afd767a1.e9d978","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"trashMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":1640,"wires":[["a9b46012.6e6f7"]]},{"id":"868dbac2.4fdcd8","type":"function","z":"168e0b9d.9c19d4","name":"incr. filenr","func":"\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":320,"wires":[["c93f4389.6be24","9742198d.4b0aa8","b2e5c8eb.7405b8","24a0011a.efcabe","b67172dc.15445"]]},{"id":"12dba3de.11751c","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":300,"wires":[[],[],["a4cb96a3.782c78"]]},{"id":"785e58cb.603a18","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-dashboard')","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":760,"y":300,"wires":[["51c1503.13febb"]]},{"id":"8cc533cc.f535d","type":"function","z":"168e0b9d.9c19d4","name":"dashboard: rename + 1","func":"if(msg.payload !== \"Empty Folder\" && msg.topic === false){\n    var file = msg.payload;\n    var fileNew = \"temp.\";\n    var folder = \"\";\n    var x = parseInt(file.slice(0, 2));\n    \n    if (Number.isInteger(x)){\n        \n        x = x + 1;\n\n        if(x > global.get('loopMax')){\n            \n            fileNew = fileNew + \"01.trash.\" + file;\n            \n            msg.payload = \"mv \" + global.get('images-dashboard') + file + \" \" + global.get('images-trash') + fileNew;\n            msg.folder = global.get('images-trash');\n        \n        } else {\n            var postfix = file.slice(2);\n\n            if (x < 10){\n                fileNew = fileNew + \"0\" + x + postfix;\n            } else {\n                fileNew = fileNew + x + postfix;\n            }\n            \n            msg.payload = \"mv \" + global.get('images-dashboard') + file + \" \" + global.get('images-dashboard') + fileNew;\n            msg.folder = global.get('images-dashboard');\n        }\n        \n        msg.file = fileNew;\n        \n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":1130,"y":300,"wires":[["12dba3de.11751c"]]},{"id":"bcb49c90.a2675","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":360,"wires":[[],[],["a4cb96a3.782c78"]]},{"id":"675066d.02ed398","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-stackText')","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":760,"y":360,"wires":[["704f959a.c6e00c"]]},{"id":"d844bcc5.32b1f","type":"function","z":"168e0b9d.9c19d4","name":"stackText: rename + 1","func":"if(msg.payload !== \"Empty Folder\" && msg.topic === false){\n    var file = msg.payload;\n    var fileNew = \"temp.\";\n    var folder = \"\"; \n    var x = parseInt(file.slice(0, 2));\n    \n    if (Number.isInteger(x)){\n        \n        x = x + 1;\n\n        if(x > global.get('loopMax')){\n            \n            fileNew = fileNew + \"01.trash.\" + file;\n            \n            msg.payload = \"mv \" + global.get('images-stackText') + file + \" \" + global.get('images-trash') + fileNew;\n            msg.folder = global.get('images-trash');\n        \n        } else {\n            var postfix = file.slice(2);\n            \n            if (x < 10){\n                fileNew = fileNew + \"0\" + x + postfix;\n            } else {\n                fileNew = fileNew + x + postfix;\n            }\n            \n            msg.payload = \"mv \" + global.get('images-stackText') + file + \" \" + global.get('images-stackText') + fileNew;\n            msg.folder = global.get('images-stackText');\n        }\n        \n        msg.file = fileNew;\n        \n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":1120,"y":360,"wires":[["bcb49c90.a2675"]]},{"id":"1113e99f.336446","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":420,"wires":[[],[],["a4cb96a3.782c78"]]},{"id":"9864f6a2.cf29a8","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-trash')","pattern":"*.jpg","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":760,"y":420,"wires":[["47725c45.851374","a6dd565f.ad3e98"]]},{"id":"a6dd565f.ad3e98","type":"function","z":"168e0b9d.9c19d4","name":"trash: rename + 1","func":"if(msg.payload !== \"Empty Folder\"){\n    var file = msg.payload;\n    var fileNew = \"temp.\";\n    var folder = \"\";\n    var trash = file.slice(3, 8);\n    var x = parseInt(file.slice(0, 2));\n        \n    if (Number.isInteger(x)){    \n        \n        if (trash === \"trash\"){\n            \n            var postfix = file.slice(2);\n            x = x + 1;\n            if (x < 10){\n                fileNew = fileNew + \"0\" + x + postfix;\n            } else {\n                fileNew = fileNew + x + postfix;\n            }\n            \n        } else {\n            fileNew = fileNew + \"01.trash.\" + file;\n            x = 1;\n        }\n        \n        msg.file = fileNew;\n        \n        if(x > (global.get('trashMax'))){\n            msg.payload = \"rm \" + global.get('images-trash') + file;\n            msg.file = \"deleted\";\n            flow.set('counter', flow.get('counter') - 1);\n        } else {\n            msg.payload = \"mv \" + global.get('images-trash') + file + \" \" + global.get('images-trash') + fileNew;\n            msg.folder = global.get('images-trash');\n        }\n        \n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":1110,"y":420,"wires":[["1113e99f.336446"]]},{"id":"f0b57d5c.3e53e","type":"link in","z":"168e0b9d.9c19d4","name":"incr. filenr","links":["98da01cf.24f5d","654fe6d1.53aa68"],"x":155,"y":320,"wires":[["868dbac2.4fdcd8"]]},{"id":"98da01cf.24f5d","type":"link out","z":"7c56a241.1e88dc","name":"","links":["f0b57d5c.3e53e"],"x":1245,"y":880,"wires":[]},{"id":"4e79dda9.59f3b4","type":"comment","z":"5af1388b.ef9838","name":"Settings","info":"","x":280,"y":1260,"wires":[]},{"id":"a8cc1088.83d24","type":"function","z":"5af1388b.ef9838","name":"move files","func":"if(msg.payload){\n  \n    msg.payload = \"mv \" + global.get('images-stackText') + \"*.*.*.*.addText.*.dash.* \" + global.get('images-dashboard') + \" && mv \" + global.get('images-stackText') + \"*.*.*.*.addText.* \" + global.get('images-frameloop');\n    \n} else {\n    \n    msg.payload = \"mv \" + global.get('images-dashboard') + \"*.*.*.*.addText.*.dash.* \" + global.get('images-stackText') + \" && mv \" + global.get('images-frameloop') + \"*.*.*.*.addText.* \" + global.get('images-stackText');\n}\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":1480,"wires":[["35723607.2c8e9a"]]},{"id":"35723607.2c8e9a","type":"exec","z":"5af1388b.ef9838","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1010,"y":1480,"wires":[[],[],[]]},{"id":"32ecf211.b8518e","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1590,"y":700,"wires":[[],[],["62e7c5f1.54bb5c"]]},{"id":"a0fbaae7.33ae68","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":530,"y":60,"wires":[[],[],[]]},{"id":"b88e43fe.7f40f","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":60,"wires":[["6de55ceb.b38e64"]]},{"id":"6de55ceb.b38e64","type":"function","z":"168e0b9d.9c19d4","name":"clean up folders","func":"msg.payload = \"rm \" + global.get('images-dashboard') + \"* && rm \" + global.get('images-frameloop') + \"* && rm \" + global.get('images-stackText') + \"* && rm \" + global.get('images-preprocessing') + \"* && rm \" + global.get('images-trash') + \"*\";\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":60,"wires":[["a0fbaae7.33ae68"]]},{"id":"eca4f699.a2e5e8","type":"persist out","z":"5af1388b.ef9838","name":"textActive","storageNode":"aa40158d.83bf68","x":320,"y":1420,"wires":[["8936fbaa.4e7a78"]]},{"id":"ac44fda1.7d4db","type":"persist in","z":"5af1388b.ef9838","name":"textActive","storageNode":"aa40158d.83bf68","x":1020,"y":1420,"wires":[]},{"id":"ed0af056.6b6d5","type":"persist out","z":"5af1388b.ef9838","name":"loopMax","storageNode":"aa40158d.83bf68","x":320,"y":1580,"wires":[["3c457ef9.347f12"]]},{"id":"b1c05f38.e988c","type":"persist out","z":"5af1388b.ef9838","name":"trashMax","storageNode":"aa40158d.83bf68","x":320,"y":1640,"wires":[["1bc5e035.452d1"]]},{"id":"9896db89.201e78","type":"persist in","z":"5af1388b.ef9838","name":"loopMax","storageNode":"aa40158d.83bf68","x":1020,"y":1580,"wires":[]},{"id":"a9b46012.6e6f7","type":"persist in","z":"5af1388b.ef9838","name":"trashMax","storageNode":"aa40158d.83bf68","x":1020,"y":1640,"wires":[]},{"id":"c4d060eb.a68cb","type":"ui_dropdown","z":"e00097c0.ad3088","name":"","label":"","tooltip":"","place":"","group":"98f89e13.1f66c","order":3,"width":6,"height":1,"passthru":true,"options":[{"label":"timer off","value":"timerOff","type":"str"},{"label":"06:00","value":"06:00","type":"str"},{"label":"","value":"06:15","type":"str"},{"label":"","value":"06:30","type":"str"},{"label":"","value":"06:45","type":"str"},{"label":"","value":"07:00","type":"str"},{"label":"","value":"07:15","type":"str"},{"label":"","value":"07:30","type":"str"},{"label":"","value":"07:45","type":"str"},{"label":"","value":"08:00","type":"str"},{"label":"","value":"08:15","type":"str"},{"label":"","value":"08:30","type":"str"},{"label":"","value":"08:45","type":"str"},{"label":"","value":"09:00","type":"str"},{"label":"","value":"09:15","type":"str"},{"label":"","value":"09:30","type":"str"},{"label":"","value":"09:45","type":"str"},{"label":"","value":"10:00","type":"str"},{"label":"","value":"10:15","type":"str"},{"label":"","value":"10:30","type":"str"},{"label":"","value":"10:45","type":"str"},{"label":"","value":"11:00","type":"str"},{"label":"","value":"11:15","type":"str"},{"label":"","value":"11:30","type":"str"},{"label":"","value":"11:45","type":"str"},{"label":"","value":"12:00","type":"str"},{"label":"","value":"12:15","type":"str"},{"label":"","value":"12:30","type":"str"},{"label":"","value":"12:45","type":"str"},{"label":"","value":"13:00","type":"str"},{"label":"","value":"13:15","type":"str"},{"label":"","value":"13:30","type":"str"},{"label":"","value":"13:45","type":"str"},{"label":"","value":"14:00","type":"str"},{"label":"","value":"14:15","type":"str"},{"label":"","value":"14:30","type":"str"},{"label":"","value":"14:45","type":"str"},{"label":"","value":"15:00","type":"str"},{"label":"","value":"15:15","type":"str"},{"label":"","value":"15:30","type":"str"},{"label":"","value":"15:45","type":"str"},{"label":"","value":"16:00","type":"str"},{"label":"","value":"16:15","type":"str"},{"label":"","value":"16:30","type":"str"},{"label":"","value":"16:45","type":"str"},{"label":"","value":"17:00","type":"str"},{"label":"","value":"17:15","type":"str"},{"label":"","value":"17:30","type":"str"},{"label":"","value":"17:45","type":"str"},{"label":"","value":"18:00","type":"str"},{"label":"","value":"18:15","type":"str"},{"label":"","value":"18:30","type":"str"},{"label":"","value":"18:45","type":"str"},{"label":"","value":"19:00","type":"str"},{"label":"","value":"19:15","type":"str"},{"label":"","value":"19:30","type":"str"},{"label":"","value":"19:45","type":"str"},{"label":"","value":"20:00","type":"str"},{"label":"","value":"20:15","type":"str"},{"label":"","value":"20:30","type":"str"},{"label":"","value":"20:45","type":"str"},{"label":"","value":"21:00","type":"str"},{"label":"","value":"21:15","type":"str"},{"label":"","value":"21:30","type":"str"},{"label":"","value":"21:45","type":"str"},{"label":"","value":"22:00","type":"str"},{"label":"","value":"22:15","type":"str"},{"label":"","value":"","type":"str"},{"label":"","value":"22:30","type":"str"},{"label":"","value":"22:45","type":"str"},{"label":"","value":"23:00","type":"str"},{"label":"","value":"23:15","type":"str"},{"label":"","value":"23:30","type":"str"},{"label":"","value":"23:45","type":"str"},{"label":"","value":"00:00","type":"str"},{"label":"","value":"00:15","type":"str"},{"label":"","value":"00:30","type":"str"},{"label":"","value":"00:45","type":"str"},{"label":"","value":"01:00","type":"str"},{"label":"","value":"01:15","type":"str"},{"label":"","value":"01:30","type":"str"},{"label":"","value":"01:45","type":"str"},{"label":"","value":"02:00","type":"str"},{"label":"","value":"02:15","type":"str"},{"label":"","value":"02:30","type":"str"},{"label":"","value":"02:45","type":"str"},{"label":"","value":"03:00","type":"str"},{"label":"","value":"03:15","type":"str"},{"label":"","value":"03:30","type":"str"},{"label":"","value":"03:45","type":"str"},{"label":"","value":"04:00","type":"str"},{"label":"","value":"04:15","type":"str"},{"label":"","value":"04:30","type":"str"},{"label":"","value":"04:45","type":"str"},{"label":"","value":"05:00","type":"str"},{"label":"","value":"05:15","type":"str"},{"label":"","value":"05:30","type":"str"},{"label":"","value":"05:45","type":"str"}],"payload":"","topic":"timeOn","x":350,"y":460,"wires":[["fc007af8.4b0098","2f2c6d12.96cd32"]]},{"id":"fc007af8.4b0098","type":"function","z":"e00097c0.ad3088","name":"create timer input","func":"if (msg.payload === \"timerOff\"){\n    msg.payload = { suspended:true };\n} else if (msg.topic === \"timeOn\"){\n    msg.payload = { ontime:msg.payload, suspended:false };\n} else if (msg.topic === \"timeOff\"){\n    msg.payload = { offtime:msg.payload, suspended:false };\n} else return null;\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":540,"wires":[["3062f612.357daa"]]},{"id":"3062f612.357daa","type":"schedex","z":"e00097c0.ad3088","name":"Timer","passthroughunhandled":false,"suspended":false,"lat":"","lon":"","ontime":"","ontopic":"","onpayload":"1","onoffset":0,"onrandomoffset":0,"offtime":"","offtopic":"","offpayload":"0","offoffset":0,"offrandomoffset":0,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":790,"y":540,"wires":[["219171dc.c5a49e"]]},{"id":"219171dc.c5a49e","type":"function","z":"e00097c0.ad3088","name":"convert string -> int","func":"if (msg.payload === \"1\") {\n    msg.payload = 1;\n}\nelse {\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":540,"wires":[["65b2fd66.a9b1e4"]]},{"id":"588ec493.a2088c","type":"ui_dropdown","z":"e00097c0.ad3088","name":"","label":"","tooltip":"","place":"","group":"98f89e13.1f66c","order":6,"width":6,"height":1,"passthru":true,"options":[{"label":"timer off","value":"timerOff","type":"str"},{"label":"","value":"06:00","type":"str"},{"label":"","value":"06:15","type":"str"},{"label":"","value":"06:30","type":"str"},{"label":"","value":"06:45","type":"str"},{"label":"","value":"07:00","type":"str"},{"label":"","value":"07:15","type":"str"},{"label":"","value":"07:30","type":"str"},{"label":"","value":"07:45","type":"str"},{"label":"","value":"08:00","type":"str"},{"label":"","value":"08:15","type":"str"},{"label":"","value":"08:30","type":"str"},{"label":"","value":"08:45","type":"str"},{"label":"","value":"09:00","type":"str"},{"label":"","value":"09:15","type":"str"},{"label":"","value":"09:30","type":"str"},{"label":"","value":"09:45","type":"str"},{"label":"","value":"10:00","type":"str"},{"label":"","value":"10:15","type":"str"},{"label":"","value":"10:30","type":"str"},{"label":"","value":"10:45","type":"str"},{"label":"","value":"11:00","type":"str"},{"label":"","value":"11:15","type":"str"},{"label":"","value":"11:30","type":"str"},{"label":"","value":"11:45","type":"str"},{"label":"","value":"12:00","type":"str"},{"label":"","value":"12:15","type":"str"},{"label":"","value":"12:30","type":"str"},{"label":"","value":"12:45","type":"str"},{"label":"","value":"13:00","type":"str"},{"label":"","value":"13:15","type":"str"},{"label":"","value":"13:30","type":"str"},{"label":"","value":"13:45","type":"str"},{"label":"","value":"14:00","type":"str"},{"label":"","value":"14:15","type":"str"},{"label":"","value":"14:30","type":"str"},{"label":"","value":"14:45","type":"str"},{"label":"","value":"15:00","type":"str"},{"label":"","value":"15:15","type":"str"},{"label":"","value":"15:30","type":"str"},{"label":"","value":"15:45","type":"str"},{"label":"","value":"16:00","type":"str"},{"label":"","value":"16:15","type":"str"},{"label":"","value":"16:30","type":"str"},{"label":"","value":"16:45","type":"str"},{"label":"","value":"17:00","type":"str"},{"label":"","value":"17:15","type":"str"},{"label":"","value":"17:30","type":"str"},{"label":"","value":"17:45","type":"str"},{"label":"","value":"18:00","type":"str"},{"label":"","value":"18:15","type":"str"},{"label":"","value":"18:30","type":"str"},{"label":"","value":"18:45","type":"str"},{"label":"","value":"19:00","type":"str"},{"label":"","value":"19:15","type":"str"},{"label":"","value":"19:30","type":"str"},{"label":"","value":"19:45","type":"str"},{"label":"","value":"20:00","type":"str"},{"label":"","value":"20:15","type":"str"},{"label":"","value":"20:30","type":"str"},{"label":"","value":"20:45","type":"str"},{"label":"","value":"21:00","type":"str"},{"label":"","value":"21:15","type":"str"},{"label":"","value":"21:30","type":"str"},{"label":"","value":"21:45","type":"str"},{"label":"","value":"22:00","type":"str"},{"label":"","value":"22:15","type":"str"},{"label":"","value":"22:30","type":"str"},{"label":"","value":"22:45","type":"str"},{"label":"","value":"23:00","type":"str"},{"label":"","value":"23:15","type":"str"},{"label":"","value":"23:30","type":"str"},{"label":"","value":"23:45","type":"str"},{"label":"","value":"00:00","type":"str"},{"label":"","value":"00:15","type":"str"},{"label":"","value":"00:30","type":"str"},{"label":"","value":"00:45","type":"str"},{"label":"","value":"01:00","type":"str"},{"label":"","value":"01:15","type":"str"},{"label":"","value":"01:30","type":"str"},{"label":"","value":"01:45","type":"str"},{"label":"","value":"02:00","type":"str"},{"label":"","value":"02:15","type":"str"},{"label":"","value":"02:30","type":"str"},{"label":"","value":"02:45","type":"str"},{"label":"","value":"03:00","type":"str"},{"label":"","value":"03:15","type":"str"},{"label":"","value":"03:30","type":"str"},{"label":"","value":"03:45","type":"str"},{"label":"","value":"04:00","type":"str"},{"label":"","value":"04:15","type":"str"},{"label":"","value":"04:30","type":"str"},{"label":"","value":"04:45","type":"str"},{"label":"","value":"05:00","type":"str"},{"label":"","value":"05:15","type":"str"},{"label":"","value":"05:30","type":"str"},{"label":"","value":"05:45","type":"str"}],"payload":"","topic":"timeOff","x":350,"y":600,"wires":[["fc007af8.4b0098","83242b7b.dca458"]]},{"id":"a8c60203.b8af1","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":4,"width":2,"height":1,"name":"","label":"Uhr","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":500,"wires":[]},{"id":"fa2ce4df.75bec8","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":7,"width":2,"height":1,"name":"","label":"Uhr","format":"{{msg.payload}}","layout":"row-spread","x":410,"y":640,"wires":[]},{"id":"cf226409.f192c8","type":"comment","z":"e00097c0.ad3088","name":"Display On/Off","info":"","x":180,"y":100,"wires":[]},{"id":"bcbbb945.48f918","type":"exec","z":"e00097c0.ad3088","command":"vcgencmd display_power 0","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":840,"y":280,"wires":[[],[],[]]},{"id":"2951b8b6.676678","type":"exec","z":"e00097c0.ad3088","command":"vcgencmd display_power 1","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":840,"y":220,"wires":[[],[],[]]},{"id":"5f4c3995.ed98f8","type":"inject","z":"e00097c0.ad3088","name":"Display off","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":520,"y":180,"wires":[["bcbbb945.48f918"]]},{"id":"89f91e00.3f566","type":"inject","z":"e00097c0.ad3088","name":"Display on","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":520,"y":140,"wires":[["2951b8b6.676678"]]},{"id":"65b2fd66.a9b1e4","type":"ui_switch","z":"e00097c0.ad3088","name":"","label":"aus / an","tooltip":"","group":"98f89e13.1f66c","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":440,"y":260,"wires":[["1d8775e4.7c3f0a","f6e96d1d.c2c99"]]},{"id":"1d8775e4.7c3f0a","type":"switch","z":"e00097c0.ad3088","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":260,"wires":[["2951b8b6.676678"],["bcbbb945.48f918"]]},{"id":"f6e96d1d.c2c99","type":"persist in","z":"e00097c0.ad3088","name":"displayOnOff","storageNode":"aa40158d.83bf68","x":590,"y":300,"wires":[]},{"id":"74c7673f.dd4d28","type":"persist out","z":"e00097c0.ad3088","name":"displayOnOff","storageNode":"aa40158d.83bf68","x":250,"y":260,"wires":[["65b2fd66.a9b1e4"]]},{"id":"9c0d31fe.b5e8c","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":2,"width":8,"height":1,"name":"","label":"Bildschirm an","format":"{{msg.payload}}","layout":"row-spread","x":340,"y":420,"wires":[]},{"id":"8489dec8.3f46b","type":"ui_text","z":"e00097c0.ad3088","group":"98f89e13.1f66c","order":5,"width":8,"height":1,"name":"","label":"Bildschirm aus","format":"{{msg.payload}}","layout":"row-spread","x":340,"y":560,"wires":[]},{"id":"b6697f46.5fd87","type":"persist out","z":"e00097c0.ad3088","name":"turnOnTime","storageNode":"aa40158d.83bf68","x":170,"y":460,"wires":[["c4d060eb.a68cb"]]},{"id":"11a7bd67.c88f33","type":"persist out","z":"e00097c0.ad3088","name":"turnOffTime","storageNode":"aa40158d.83bf68","x":170,"y":600,"wires":[["588ec493.a2088c"]]},{"id":"2f2c6d12.96cd32","type":"persist in","z":"e00097c0.ad3088","name":"turnOnTime","storageNode":"aa40158d.83bf68","x":550,"y":460,"wires":[]},{"id":"83242b7b.dca458","type":"persist in","z":"e00097c0.ad3088","name":"turnOffTime","storageNode":"aa40158d.83bf68","x":550,"y":600,"wires":[]},{"id":"57bc4739.705b68","type":"comment","z":"168e0b9d.9c19d4","name":"increment filenr","info":"","x":220,"y":180,"wires":[]},{"id":"e84b8926.5492f8","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":860,"wires":[["798c5829.61a1a8"]]},{"id":"798c5829.61a1a8","type":"function","z":"168e0b9d.9c19d4","name":"global.get currentFile","func":"msg.payload = global.get('currentFile');\nflow.set('currentFileDel', global.get('currentFile'));\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":900,"wires":[["50d656c2.bd1d18"]]},{"id":"1ff305c8.393f9a","type":"link in","z":"168e0b9d.9c19d4","name":"delete file","links":["b64ff816.331a88"],"x":255,"y":900,"wires":[["798c5829.61a1a8"]]},{"id":"4d06230b.8ecc3c","type":"comment","z":"168e0b9d.9c19d4","name":"delete file","info":"","x":220,"y":800,"wires":[]},{"id":"419474a5.fd8ecc","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1290,"y":900,"wires":[[],[],["f9c3ea3d.aa6888"]]},{"id":"28f4d1ba.a8ea5e","type":"function","z":"168e0b9d.9c19d4","name":"move to trash","func":"if(msg.payload !== \"Empty Folder\"){\n    var file = msg.payload.slice(msg.payload.lastIndexOf(\"/\") + 1);\n    \n    msg.payload = \"mv \" + msg.payload + \" \" + global.get('images-trash') + \"00.trash.\" + file;\n\n    return msg;\n}","outputs":1,"noerr":0,"x":1120,"y":900,"wires":[["419474a5.fd8ecc"]]},{"id":"13194866.0b12b8","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('path-images')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":false,"depth":"1","stat":false,"showWarnings":true,"x":960,"y":900,"wires":[["28f4d1ba.a8ea5e"]]},{"id":"50d656c2.bd1d18","type":"function","z":"168e0b9d.9c19d4","name":"set FL file pattern (nr) + folder","func":"var startfile = msg.payload.lastIndexOf(\"/\") + 1;\nvar start = global.get('path-images');\nvar pattern = \"\";\n\nif (global.get('stickFlag')){\n    pattern = msg.payload.slice(startfile, startfile+4) + \".*\";\n} else {\n    pattern = msg.payload.slice(startfile, startfile+2) + \".*\";\n}\n\nmsg.payload = {start, pattern};\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":900,"wires":[["13194866.0b12b8"]]},{"id":"43fa2ef5.cc77a","type":"link in","z":"168e0b9d.9c19d4","name":"frameloop filenr +1","links":[],"x":475,"y":240,"wires":[["b67172dc.15445"]]},{"id":"14c23020.4d2ad","type":"link in","z":"168e0b9d.9c19d4","name":"dashboard filenr +1","links":[],"x":475,"y":300,"wires":[["24a0011a.efcabe"]]},{"id":"6cb92d0d.4c8784","type":"link in","z":"168e0b9d.9c19d4","name":"stackText filenr +1","links":[],"x":475,"y":360,"wires":[["b2e5c8eb.7405b8"]]},{"id":"e34da76.5634d58","type":"link in","z":"168e0b9d.9c19d4","name":"trash filenr +1","links":["24183ade.d58876","a5ef733e.6cb3a","34f63059.53c4e"],"x":475,"y":420,"wires":[["9742198d.4b0aa8"]]},{"id":"a5ef733e.6cb3a","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["e34da76.5634d58","300fc85d.3126d8"],"x":1795,"y":900,"wires":[]},{"id":"8789cd73.c6c3c","type":"function","z":"5af1388b.ef9838","name":"if ok delete","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":890,"y":1100,"wires":[["b64ff816.331a88","442ce2f1.aae81c"]]},{"id":"af1fd754.2f7da8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"currentFile","pt":"global","to":"payload.data.data.item.file","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":920,"wires":[[]]},{"id":"b64ff816.331a88","type":"link out","z":"5af1388b.ef9838","name":"","links":["1ff305c8.393f9a"],"x":1015,"y":1100,"wires":[]},{"id":"880bb959.cfc0a8","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":1040,"wires":[["924eb351.0aacd"]]},{"id":"924eb351.0aacd","type":"function","z":"168e0b9d.9c19d4","name":"stick file","func":"return msg;","outputs":1,"noerr":0,"x":640,"y":1060,"wires":[["702a3df4.7558c4"]]},{"id":"aa6fc960.ab2d08","type":"link in","z":"168e0b9d.9c19d4","name":"stick file","links":["793b21c7.52223"],"x":135,"y":1100,"wires":[["cb711e58.62298"]]},{"id":"22ba6e36.135602","type":"comment","z":"168e0b9d.9c19d4","name":"(un-)stick file","info":"","x":230,"y":1000,"wires":[]},{"id":"3fa5e56f.a066ca","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1430,"y":1060,"wires":[[],[],["5e8bd0a5.e8873"]]},{"id":"eabbc1ef.5dcca","type":"function","z":"168e0b9d.9c19d4","name":"rename to \"stick\"","func":"if(msg.payload !== \"Empty Folder\"){\n    \n    var file = msg.payload.slice((msg.payload.lastIndexOf(\"/\")) + 1);\n    var folder = msg.payload.slice(0, (msg.payload.lastIndexOf(\"/\")) + 1);\n    file = file.slice(2);\n    \n    msg.payload = \"mv \" + msg.payload + \" \" + folder + \"1000\" + file + \".stick.jpg\";\n\n    return msg;\n}","outputs":1,"noerr":0,"x":1270,"y":1060,"wires":[["3fa5e56f.a066ca"]]},{"id":"6363796d.970b38","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('path-images')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":false,"depth":"1","stat":false,"showWarnings":true,"x":1080,"y":1060,"wires":[["eabbc1ef.5dcca"]]},{"id":"702a3df4.7558c4","type":"function","z":"168e0b9d.9c19d4","name":"set FL file pattern (nr) + folder","func":"var startfile = msg.payload.lastIndexOf(\"/\") + 1;\nvar pattern = msg.payload.slice(startfile, startfile+2) + \".*\";\nvar start = global.get('path-images');\n\nmsg.payload = {start, pattern};\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":1060,"wires":[["6363796d.970b38"]]},{"id":"10b21058.f480c","type":"comment","z":"5af1388b.ef9838","name":"stick","info":"","x":590,"y":840,"wires":[]},{"id":"793b21c7.52223","type":"link out","z":"5af1388b.ef9838","name":"","links":["aa6fc960.ab2d08"],"x":1035,"y":880,"wires":[]},{"id":"bf63c1dd.c767b","type":"function","z":"5af1388b.ef9838","name":"set color","func":"if(msg.topic){\n    msg.payload = \"#eb4034\";\n} else {\n    msg.payload = \"\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":880,"wires":[["6ca0a6f5.8b6858"]]},{"id":"2a52a9ea.bcf6b6","type":"debug","z":"5af1388b.ef9838","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":270,"y":1040,"wires":[]},{"id":"6407c025.f7455","type":"function","z":"5af1388b.ef9838","name":"set topic: if stick","func":"try{\n    var file = msg.payload.data.data.item.file;\n    var index = file.lastIndexOf('jpg');\n    \n    if (file.slice(index -6, index -1) === \"stick\"){\n        msg.topic = true;\n    } else {\n        msg.topic = false;\n    }\n    \n    return msg;\n} catch(e){}","outputs":1,"noerr":0,"x":360,"y":860,"wires":[["bf63c1dd.c767b","4b692df3.f4f474","cd835703.413928"]]},{"id":"cd835703.413928","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"stickFlag","pt":"global","to":"topic","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":980,"wires":[[]]},{"id":"eb469493.266bd8","type":"switch","z":"168e0b9d.9c19d4","name":"stick / unstick","property":"stickFlag","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":440,"y":1100,"wires":[["924eb351.0aacd"],["3f1fff6a.78965"]]},{"id":"3f1fff6a.78965","type":"function","z":"168e0b9d.9c19d4","name":"unstick file","func":"return msg;","outputs":1,"noerr":0,"x":650,"y":1280,"wires":[["f0dd7684.99c7b8"]]},{"id":"9d4e7a7d.84d948","type":"function","z":"168e0b9d.9c19d4","name":"stick files nr + 1","func":"if(msg.payload !== \"Empty Folder\"){\n    var file = msg.payload.slice((msg.payload.lastIndexOf(\"/\")) + 1);\n    var folder = msg.payload.slice(0, (msg.payload.lastIndexOf(\"/\")) + 1);\n    var fileNew = \"temp.\";\n    var x = parseInt(file.slice(0, 4));\n    \n    if (Number.isInteger(x)){\n        var postfix = file.slice(4);\n        x = x + 1;\n\n        fileNew = fileNew + x + postfix;\n        \n        msg.file = fileNew;\n\n        msg.payload = \"mv \" + msg.payload + \" \" + folder + fileNew;\n        msg.folder = folder;\n\n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":1080,"y":1140,"wires":[["533aa3d6.b8922c"]]},{"id":"ace68935.3bf2f8","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"/home/pi/media/telegram","pattern":"*.stick.jpg","folders":"*","hidden":true,"lstype":"files","path":true,"single":false,"depth":"1","stat":false,"showWarnings":true,"x":920,"y":1140,"wires":[["9d4e7a7d.84d948"]]},{"id":"533aa3d6.b8922c","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1230,"y":1140,"wires":[[],[],["cdeeeed.b17dc1"]]},{"id":"be7d9840.2c1338","type":"function","z":"168e0b9d.9c19d4","name":"remove \"temp\"","func":"if(msg.payload.code === 0){\n    \n    var folder = msg.folder;\n    \n    var file = msg.file;\n    var fileNew = file.slice(5);\n\n    msg.payload = \"mv \" + folder + file + \" \" + folder + fileNew;\n\n    return msg;\n}","outputs":1,"noerr":0,"x":1560,"y":1140,"wires":[["4cdaa9f9.86eab8"]]},{"id":"cdeeeed.b17dc1","type":"delay","z":"168e0b9d.9c19d4","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1390,"y":1140,"wires":[["be7d9840.2c1338"]]},{"id":"4cdaa9f9.86eab8","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1710,"y":1140,"wires":[[],[],[]]},{"id":"b1196f8b.4987a","type":"function","z":"168e0b9d.9c19d4","name":"topic: if stick","func":"try{\n    var file = msg.payload;\n    var index = file.lastIndexOf('jpg');\n    \n    if (file.slice(index -6, index -1) === \"stick\"){\n        msg.topic = true;\n    } else {\n        msg.topic = false;\n    }\n    \n    return msg;\n} catch(e){}","outputs":1,"noerr":0,"x":910,"y":240,"wires":[["ab515b4c.cf8af8","47725c45.851374"]]},{"id":"51c1503.13febb","type":"function","z":"168e0b9d.9c19d4","name":"topic: if stick","func":"try{\n    var file = msg.payload;\n    var index = file.lastIndexOf('jpg');\n    \n    if (file.slice(index -6, index -1) === \"stick\"){\n        msg.topic = true;\n    } else {\n        msg.topic = false;\n    }\n    \n    return msg;\n} catch(e){}","outputs":1,"noerr":0,"x":910,"y":300,"wires":[["8cc533cc.f535d","47725c45.851374"]]},{"id":"704f959a.c6e00c","type":"function","z":"168e0b9d.9c19d4","name":"topic: if stick","func":"try{\n    var file = msg.payload;\n    var index = file.lastIndexOf('jpg');\n    \n    if (file.slice(index -6, index -1) === \"stick\"){\n        msg.topic = true;\n    } else {\n        msg.topic = false;\n    }\n    \n    return msg;\n} catch(e){}","outputs":1,"noerr":0,"x":910,"y":360,"wires":[["d844bcc5.32b1f","47725c45.851374"]]},{"id":"f09dafcf.319c4","type":"function","z":"168e0b9d.9c19d4","name":"rename to 01.*","func":"if(msg.payload !== \"Empty Folder\"){\n    \n    var file = msg.payload.slice((msg.payload.lastIndexOf(\"/\")) + 1);\n    file = (file.slice(0, file.lastIndexOf('jpg') - 7)).slice(5);\n    var folder = msg.payload.slice(0, (msg.payload.lastIndexOf(\"/\")) + 1);\n    \n    if (global.get('imageBusy') || false){\n        msg.payload = \"mv \" + msg.payload + \" \" + folder + \"01.\" + file;\n    } else {\n        msg.payload = \"mv \" + msg.payload + \" \" + folder + \"00.\" + file;\n    }\n    \n    return msg;\n}\n","outputs":1,"noerr":0,"x":1420,"y":1280,"wires":[["5a66ec3f.74a8c4"]]},{"id":"5a66ec3f.74a8c4","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1570,"y":1280,"wires":[[],[],["a663d06f.2b899"]]},{"id":"654fe6d1.53aa68","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["f0b57d5c.3e53e"],"x":1855,"y":1280,"wires":[]},{"id":"9f0cbd7a.e5653","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('path-images')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":false,"depth":"1","stat":false,"showWarnings":true,"x":1260,"y":1280,"wires":[["f09dafcf.319c4"]]},{"id":"2ff22d2b.2cdc72","type":"function","z":"168e0b9d.9c19d4","name":"set FL file pattern (nr) + folder","func":"var startfile = msg.payload.lastIndexOf(\"/\") + 1;\n\nvar pattern = msg.payload.slice(startfile, startfile+4) + \".*\";\nvar start = global.get('path-images');\n\nmsg.payload = {start, pattern};\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":1280,"wires":[["9f0cbd7a.e5653"]]},{"id":"f0dd7684.99c7b8","type":"delay","z":"168e0b9d.9c19d4","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":820,"y":1280,"wires":[["2ff22d2b.2cdc72"]]},{"id":"47725c45.851374","type":"function","z":"168e0b9d.9c19d4","name":"counter up","func":"if(msg.payload !== \"Empty Folder\" && msg.topic === false){\n    var counter = flow.get('counter') || 0;\n    counter = counter + 1;\n    flow.set('counter', counter);\n    msg.payload = counter;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1130,"y":700,"wires":[[]]},{"id":"62e7c5f1.54bb5c","type":"function","z":"168e0b9d.9c19d4","name":"counter down","func":"if(msg.payload.code === 0){\n    flow.set('counter', flow.get('counter') - 1);\n    if(flow.get('counter') === 0){\n        msg.payload = \"ok\";\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":1760,"y":700,"wires":[["127833e4.06e0dc","a815c236.5c89e"]]},{"id":"e5053a8d.ea6e68","type":"function","z":"168e0b9d.9c19d4","name":"remove \"temp\"","func":"if(msg.payload.code === 0 && msg.file !== \"deleted\"){\n    var folder = msg.folder;\n    var file = msg.file;\n    var fileNew = file.slice(5);\n    \n    msg.payload = \"mv \" + folder + file + \" \" + folder + fileNew;\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":1440,"y":700,"wires":[["32ecf211.b8518e"]]},{"id":"a4cb96a3.782c78","type":"delay","z":"168e0b9d.9c19d4","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1550,"y":400,"wires":[["e5053a8d.ea6e68"]]},{"id":"c93f4389.6be24","type":"function","z":"168e0b9d.9c19d4","name":"counter set zero","func":"flow.set('counter', 0);","outputs":1,"noerr":0,"x":540,"y":700,"wires":[[]]},{"id":"127833e4.06e0dc","type":"link out","z":"168e0b9d.9c19d4","name":"","links":[],"x":1895,"y":700,"wires":[]},{"id":"19f420bd.ed901f","type":"function","z":"7c56a241.1e88dc","name":"wget video","func":"try {\n    msg.payload = \"wget \" + msg.payload.weblink + \" -P \" + global.get('videos-incoming');\n    return msg;\n} catch (e){}","outputs":1,"noerr":0,"x":1290,"y":200,"wires":[["103f13b1.59e58c","50774bbf.0fa3a4"]]},{"id":"103f13b1.59e58c","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1450,"y":200,"wires":[[],[],["f7d23ddc.32e82"]]},{"id":"4c611dba.ec1c54","type":"comment","z":"dfa0e0a5.c8001","name":"Log","info":"","x":110,"y":1560,"wires":[]},{"id":"e6a526da.126ff8","type":"ui_text","z":"dfa0e0a5.c8001","group":"ed8a86bc.a4c3c8","order":1,"width":16,"height":4,"name":"","label":"","format":"{{msg.payload}}","layout":"col-center","x":330,"y":1640,"wires":[]},{"id":"3e3aa4c4.10f0ac","type":"link in","z":"dfa0e0a5.c8001","name":"Log","links":["e0dbe779.1681b8"],"x":220,"y":1640,"wires":[["e6a526da.126ff8"]]},{"id":"e0dbe779.1681b8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["3e3aa4c4.10f0ac"],"x":235,"y":280,"wires":[]},{"id":"5e07aefb.00bfb","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"","tooltip":"Ordnerpfad","group":"1229b955.63bec7","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":"100","topic":"","x":280,"y":1820,"wires":[["4052e58d.3b49bc","1b8f0442.7e744c"]]},{"id":"d74046c4.67d498","type":"comment","z":"dfa0e0a5.c8001","name":"telegrampath","info":"","x":130,"y":1740,"wires":[]},{"id":"bdc73cbc.476d8","type":"persist out","z":"dfa0e0a5.c8001","name":"telegrampath","storageNode":"aa40158d.83bf68","x":150,"y":1880,"wires":[["5e07aefb.00bfb"]]},{"id":"4052e58d.3b49bc","type":"persist in","z":"dfa0e0a5.c8001","name":"telegrampath","storageNode":"aa40158d.83bf68","x":450,"y":1880,"wires":[]},{"id":"1b8f0442.7e744c","type":"function","z":"dfa0e0a5.c8001","name":"add \"/\"","func":"if(msg.payload.slice(-1) !== \"/\"){\n    msg.payload = msg.payload + \"/\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1820,"wires":[["6cfad06a.94f4f"]]},{"id":"6cfad06a.94f4f","type":"function","z":"dfa0e0a5.c8001","name":"set folders","func":"// Images\nvar imagefolder = \"images/\";\nimagefolder = msg.payload + imagefolder;\n\nglobal.set('path-images', imagefolder);\nglobal.set('images-incoming', (imagefolder + \"01.incoming/\"));\nglobal.set('images-preprocessing', (imagefolder + \"02.preprocessing/\"));\nglobal.set('images-dashboard', (imagefolder + \"03.dashboard/\"));\nglobal.set('images-frameloop', (imagefolder + \"03.frameloop/\"));\nglobal.set('images-stackText', (imagefolder + \"03.stackText/\"));\nglobal.set('images-trash', (imagefolder + \"04.trash/\"));\n\n\n// Videos\nvar videofolder = \"videos/\";\nvideofolder = msg.payload + videofolder;\n\nglobal.set('path-videos', videofolder);\nglobal.set('videos-incoming', (videofolder + \"01.incoming/\"));\nglobal.set('videos-preprocessing', (videofolder + \"02.preprocessing/\"));\nglobal.set('videos-frameloop', (videofolder + \"03.frameloop/\"));\n\n\n// Preview\nvar previewfolder = \"preview/\";\npreviewfolder = msg.payload + previewfolder;\n\nglobal.set('path-preview', previewfolder);","outputs":1,"noerr":0,"x":710,"y":1820,"wires":[[]]},{"id":"c52d3fad.85dbf","type":"function","z":"7c56a241.1e88dc","name":"set FL Folder","func":"msg.payload = {start: global.get('images-incoming')};\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":940,"wires":[["911c282a.81a5f8"]]},{"id":"b67172dc.15445","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder","func":"msg.payload = {start: global.get('images-frameloop')};\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":240,"wires":[["71a6d4a2.4e899c"]]},{"id":"24a0011a.efcabe","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder","func":"msg.payload = {start: global.get('images-dashboard')};\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":300,"wires":[["785e58cb.603a18"]]},{"id":"b2e5c8eb.7405b8","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder","func":"msg.payload = {start: global.get('images-stackText')};\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":360,"wires":[["675066d.02ed398"]]},{"id":"9742198d.4b0aa8","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder","func":"msg.payload = {start: global.get('images-trash')};\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":420,"wires":[["9864f6a2.cf29a8"]]},{"id":"44d2ac7c.eb4154","type":"function","z":"168e0b9d.9c19d4","name":"set FL Folder","func":"msg.payload = {start: global.get('path-images')};\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":1140,"wires":[["ace68935.3bf2f8"]]},{"id":"6dcb1ff9.6492a","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Botname","tooltip":"","group":"9ed2be8.851194","order":1,"width":8,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":220,"y":3420,"wires":[["c74df752.9be8d8"]]},{"id":"c74df752.9be8d8","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"botname","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":3420,"wires":[[]]},{"id":"6960b4be.57d08c","type":"comment","z":"7c56a241.1e88dc","name":"Bot","info":"","x":170,"y":3360,"wires":[]},{"id":"bb264c6b.11645","type":"ui_text_input","z":"7c56a241.1e88dc","name":"","label":"Token","tooltip":"","group":"9ed2be8.851194","order":2,"width":8,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":210,"y":3460,"wires":[["250a2aca.4bd9d6"]]},{"id":"250a2aca.4bd9d6","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"bottoken","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":3460,"wires":[[]]},{"id":"53e50bc7.b9b854","type":"comment","z":"5af1388b.ef9838","name":"IMAGES","info":"","x":160,"y":60,"wires":[]},{"id":"4e5fff10.24769","type":"comment","z":"5af1388b.ef9838","name":"VIDEOS","info":"","x":270,"y":1780,"wires":[]},{"id":"df26ac7e.fef28","type":"ui_button","z":"5af1388b.ef9838","name":"pause","group":"c51c9a95.f2cb68","order":4,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-pause","payload":"pause","payloadType":"str","topic":"","x":690,"y":1860,"wires":[["20afec52.82efa4","bbcc94e4.472028"]]},{"id":"927e6904.449578","type":"ui_button","z":"5af1388b.ef9838","name":"stop","group":"c51c9a95.f2cb68","order":5,"width":2,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-stop","payload":"stop","payloadType":"str","topic":"","x":690,"y":1920,"wires":[["1bc2dc85.dafca3","bbcc94e4.472028"]]},{"id":"2e1296c7.66d7ca","type":"ui_button","z":"5af1388b.ef9838","name":"play","group":"c51c9a95.f2cb68","order":3,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-play","payload":"play","payloadType":"str","topic":"","x":690,"y":1980,"wires":[["25ecf2e8.488cfe","bbcc94e4.472028","3dc142d0.bec18e"]]},{"id":"5e8cf1c6.62138","type":"ui_button","z":"5af1388b.ef9838","name":"left","group":"c51c9a95.f2cb68","order":6,"width":3,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"l","payloadType":"str","topic":"","x":350,"y":2080,"wires":[["20d45bdb.5dda64"]]},{"id":"3d27329c.35b44e","type":"ui_button","z":"5af1388b.ef9838","name":"right","group":"c51c9a95.f2cb68","order":7,"width":3,"height":1,"passthru":true,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"r","payloadType":"str","topic":"","x":350,"y":2120,"wires":[["20d45bdb.5dda64"]]},{"id":"76bd882a.b637c8","type":"ui_button","z":"5af1388b.ef9838","name":"delete","group":"c51c9a95.f2cb68","order":8,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-trash","payload":"Wirklich löschen?","payloadType":"str","topic":"","x":570,"y":2200,"wires":[["f97aa165.c7016"]]},{"id":"f97aa165.c7016","type":"ui_toast","z":"5af1388b.ef9838","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Abbrechen","raw":false,"topic":"","name":"","x":730,"y":2200,"wires":[["1d9b5bde.6fb704"]]},{"id":"da1ff016.0093","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification top (5sec)","func":"return {\n    payload: \n        {\n            \"method\":\"GUI.ShowNotification\",\n            \"params\":{\n                \"title\":msg.payload,\n                \"message\":\"\",\n                \"displaytime\":5000\n            }\n        }\n};","outputs":1,"noerr":0,"x":1350,"y":540,"wires":[["b2efa2c8.3efc"]]},{"id":"683c6b5e.62fc74","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification (5sec) [msg.payload]","links":[],"x":1115,"y":540,"wires":[["da1ff016.0093"]]},{"id":"db37d715.647218","type":"link in","z":"5af1388b.ef9838","name":"Playlist.Add [msg.payload]","links":["aaa7dbf6.eac568"],"x":1195,"y":760,"wires":[["6e18904b.3731"]]},{"id":"150ea929.65ef47","type":"inject","z":"5af1388b.ef9838","name":"add file","topic":"","payload":"/home/pi/media/telegram/images/03_frameloop/07.jpg.resize.jpg.addName.jpg","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1230,"y":800,"wires":[["6e18904b.3731"]]},{"id":"1c6d8031.edaa7","type":"link in","z":"5af1388b.ef9838","name":"Player.PlayPause","links":["841060cb.d13c4"],"x":1195,"y":220,"wires":[["ffbdb28d.7c8a6"]]},{"id":"f4cce95d.56b828","type":"link in","z":"5af1388b.ef9838","name":"Player.Stop","links":["d4a38631.f4e108","1f3ff909.cbf857"],"x":1195,"y":260,"wires":[["6eb6fb45.cfdac4"]]},{"id":"8a4057ea.301c48","type":"link in","z":"5af1388b.ef9838","name":"Player.Open (directory) [msg.payload]","links":[],"x":1195,"y":320,"wires":[["883c1b70.676b08"]]},{"id":"b4807c19.dfde6","type":"link in","z":"5af1388b.ef9838","name":"Playlist.Clear","links":[],"x":1195,"y":860,"wires":[["aa8f2459.3432d8"]]},{"id":"d49976cb.46b698","type":"link in","z":"5af1388b.ef9838","name":"Player.Open (file) [msg.payload]","links":["1f3ff909.cbf857"],"x":1215,"y":1800,"wires":[["3e356f2e.d3986"]]},{"id":"92da4955.9fdbf8","type":"link in","z":"5af1388b.ef9838","name":"Player.Open \"images-frameloop\" (play/pause)","links":["5b173a11.dc2234","9765f902.6a5578","dc11438c.48568"],"x":835,"y":340,"wires":[["90b8f088.745ed"]]},{"id":"dc11438c.48568","type":"link out","z":"7c56a241.1e88dc","name":"","links":["8fc9fac9.cd53f8","92da4955.9fdbf8"],"x":1935,"y":1640,"wires":[]},{"id":"86802c5.4587dd","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"msg.payload = \"Neue Nachricht von \" + flow.get('lastTelegramUsername') + \"!\"\nreturn msg;","outputs":1,"noerr":0,"x":1830,"y":1760,"wires":[["228bd998.c359d6"]]},{"id":"228bd998.c359d6","type":"link out","z":"7c56a241.1e88dc","name":"","links":["844330d1.62789"],"x":1935,"y":1760,"wires":[]},{"id":"21caab0.4054556","type":"function","z":"5af1388b.ef9838","name":"Start/Stop Notification","func":"if(msg.payload === \"kodiPause\"){\n    msg.payload = \"Pause\";\n    return msg;\n} else if (msg.payload === \"kodiPlay\"){\n    msg.payload = \"Start\";\n    return msg;\n}\n","outputs":1,"noerr":0,"x":580,"y":540,"wires":[["941d2d96.42468"]]},{"id":"1ab6439d.6ea0dc","type":"rbe","z":"5af1388b.ef9838","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":350,"y":560,"wires":[["21caab0.4054556","c613e3ff.4f41e","f0febbb2.cdecf8"]]},{"id":"9765f902.6a5578","type":"link out","z":"5af1388b.ef9838","name":"","links":["8fc9fac9.cd53f8","92da4955.9fdbf8"],"x":655,"y":1480,"wires":[]},{"id":"86592564.faf2a8","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":560,"y":1480,"wires":[["9765f902.6a5578"]]},{"id":"941d2d96.42468","type":"function","z":"5af1388b.ef9838","name":"gate if noDashPressed","func":"if(global.get('noDashPressed')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":800,"y":540,"wires":[["da1ff016.0093"]]},{"id":"39aabebe.9aab22","type":"link out","z":"5af1388b.ef9838","name":"","links":["8fc9fac9.cd53f8"],"x":740,"y":140,"wires":[]},{"id":"442ce2f1.aae81c","type":"link out","z":"5af1388b.ef9838","name":"","links":["2208e8fb.66fdc8"],"x":1015,"y":1060,"wires":[]},{"id":"f0febbb2.cdecf8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"kodiPlayerStatus","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":400,"wires":[[]]},{"id":"bbf54ac6.e639a8","type":"comment","z":"5af1388b.ef9838","name":"GUI Notification","info":"","x":500,"y":460,"wires":[]},{"id":"8fc9fac9.cd53f8","type":"link in","z":"5af1388b.ef9838","name":"DashPressed","links":["39aabebe.9aab22","9765f902.6a5578","dc11438c.48568"],"x":395,"y":620,"wires":[["c6e667df.ca8978"]]},{"id":"c6e667df.ca8978","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"noDashPressed","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":620,"wires":[["2a80d81d.87e388"]]},{"id":"51399278.a350fc","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"noDashPressed","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":680,"wires":[[]]},{"id":"2a80d81d.87e388","type":"stoptimer","z":"5af1388b.ef9838","duration":"1500","units":"Millisecond","payloadtype":"num","payloadval":"0","name":"","x":810,"y":620,"wires":[["51399278.a350fc"],[]]},{"id":"b2efa2c8.3efc","type":"function","z":"5af1388b.ef9838","name":"node","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1770,"y":1000,"wires":[["6b411980.a2ece8","8b17631a.2904f"]]},{"id":"8b17631a.2904f","type":"debug","z":"5af1388b.ef9838","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1890,"y":1100,"wires":[]},{"id":"90b8f088.745ed","type":"function","z":"5af1388b.ef9838","name":"if play/pause","func":"if (global.get('kodiPlayerStatus') === \"kodiPlay\" || global.get('kodiPlayerStatus') === \"kodiPause\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":960,"y":340,"wires":[["c6be6051.f6e5f"]]},{"id":"571e5a0d.8510f4","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1660,"y":1760,"wires":[["86802c5.4587dd","2d21f7f6.6b8dc8"]]},{"id":"91926304.7daef","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification top (10sec)","func":"return {\n    payload: \n        {\n            \"method\":\"GUI.ShowNotification\",\n            \"params\":{\n                \"title\":msg.payload,\n                \"message\":\"\",\n                \"displaytime\":10000\n            }\n        }\n};","outputs":1,"noerr":0,"x":1340,"y":580,"wires":[["b2efa2c8.3efc"]]},{"id":"844330d1.62789","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification (10sec) [msg.payload]","links":["228bd998.c359d6"],"x":1115,"y":580,"wires":[["91926304.7daef"]]},{"id":"af2ac4df.613cf8","type":"ui_media","z":"5af1388b.ef9838","group":"c51c9a95.f2cb68","name":"","width":"16","height":"13","order":1,"category":"","file":"file_80.mp4","layout":"adjust","showcontrols":true,"loop":false,"onstart":false,"scope":"local","tooltip":"","x":1490,"y":2140,"wires":[[]]},{"id":"b41df9a9.decaf8","type":"function","z":"5af1388b.ef9838","name":"import file","func":"var category = \"telegram\";\nvar name = msg.payload;\nglobal.set('currentVideo', msg.payload);\nmsg.payload = { category, name }\nreturn msg;","outputs":1,"noerr":0,"x":1300,"y":2140,"wires":[["af2ac4df.613cf8"]]},{"id":"984de336.6051c","type":"function","z":"5af1388b.ef9838","name":"pause","func":"msg.play = false;\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":2100,"wires":[["af2ac4df.613cf8"]]},{"id":"1347604e.6e3f5","type":"function","z":"5af1388b.ef9838","name":"play","func":"msg.play = true;\nreturn msg;","outputs":1,"noerr":0,"x":1310,"y":2060,"wires":[["af2ac4df.613cf8"]]},{"id":"25ecf2e8.488cfe","type":"function","z":"5af1388b.ef9838","name":"add folder","func":"msg.payload = global.get('videos-frameloop')  + global.get('currentVideo');\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":1980,"wires":[["1f3ff909.cbf857","490b41ca.1b986"]]},{"id":"1f3ff909.cbf857","type":"link out","z":"5af1388b.ef9838","name":"","links":["d49976cb.46b698","f4cce95d.56b828"],"x":1035,"y":1980,"wires":[]},{"id":"20afec52.82efa4","type":"function","z":"5af1388b.ef9838","name":"Player.PlayPause","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.PlayPause\",\n            \"params\":{\n                \"playerid\":1\n            }\n        }\n};","outputs":1,"noerr":0,"x":890,"y":1860,"wires":[["78797928.e3a228","490b41ca.1b986"]]},{"id":"1bc2dc85.dafca3","type":"function","z":"5af1388b.ef9838","name":"Player.Stop","func":"return {\n    payload: \n        {\n            \"cmd\":\"Player.Stop\",\n            \"params\":{\n                \"playerid\":1\n            }\n        }\n};","outputs":1,"noerr":0,"x":870,"y":1920,"wires":[["e27f5805.51bfb8","490b41ca.1b986"]]},{"id":"74cb4c3d.327cb4","type":"link in","z":"5af1388b.ef9838","name":"","links":["e27f5805.51bfb8","78797928.e3a228"],"x":1535,"y":980,"wires":[["b2efa2c8.3efc"]]},{"id":"78797928.e3a228","type":"link out","z":"5af1388b.ef9838","name":"","links":["74cb4c3d.327cb4"],"x":1035,"y":1860,"wires":[]},{"id":"e27f5805.51bfb8","type":"link out","z":"5af1388b.ef9838","name":"","links":["74cb4c3d.327cb4","cd187329.675f9"],"x":1035,"y":1920,"wires":[]},{"id":"2208e8fb.66fdc8","type":"link in","z":"5af1388b.ef9838","name":"Player.GoTo next","links":["442ce2f1.aae81c"],"x":1195,"y":480,"wires":[["f6f2588b.8879f8"]]},{"id":"eb78734a.657a7","type":"link in","z":"5af1388b.ef9838","name":"Player.GoTo previous","links":[],"x":1195,"y":440,"wires":[["93b3653f.741c78"]]},{"id":"dead4164.e5222","type":"function","z":"5af1388b.ef9838","name":"Player.GoTo payload","func":"return {\n    payload: \n        {\n            \"method\":\"Player.GoTo\",\n            \"params\":{\n                \"playerid\":2,\n                \"to\": msg.payload\n            }\n        }\n};","outputs":1,"noerr":0,"x":1820,"y":340,"wires":[["b2efa2c8.3efc"]]},{"id":"f1dd710c.19179","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"/home/pi/media/telegram/images/03_frameloop/03.jpg.resize.jpg.addName.jpg","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1650,"y":340,"wires":[["dead4164.e5222"]]},{"id":"b108c115.2edbe","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('path-images')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":false,"depth":"1","stat":false,"showWarnings":true,"x":1000,"y":560,"wires":[["e01c60d1.eba73"]]},{"id":"e01c60d1.eba73","type":"function","z":"168e0b9d.9c19d4","name":"rename -1","func":"if(msg.payload !== \"Empty Folder\"){\n    var filenrThreshold = flow.get('filenr');\n    var file = msg.payload.slice(msg.payload.lastIndexOf(\"/\") + 1);\n    var path = msg.payload.slice(0, msg.payload.lastIndexOf(\"/\") + 1);\n    var filenr = parseInt(file.slice(0, 2));\n    \n    var noStick = true;\n    if (file.slice(file.lastIndexOf('jpg') -6, file.lastIndexOf('jpg') -1) === \"stick\"){\n        noStick = false;\n    }\n    \n    if (Number.isInteger(filenr) && (filenr > filenrThreshold) && (filenr > 1) && noStick){\n        filenr = filenr - 1;\n        var fileNew = \"temp.\";\n        if (filenr < 10){\n            fileNew = fileNew + \"0\" + filenr + file.slice(2);\n        } else {\n            fileNew = fileNew + filenr + file.slice(2);\n        }\n        \n        msg.payload = \"mv \" + path + file + \" \" + path + fileNew;\n        \n        msg.file = fileNew;\n        msg.folder = path;\n        \n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":1150,"y":560,"wires":[["4ce75980.70c5d8","47725c45.851374"]]},{"id":"f670d93b.0351c8","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder (stackText)","func":"msg.payload = {start: global.get('images-stackText')};\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":600,"wires":[["b108c115.2edbe"]]},{"id":"e4c37b78.ceb7b8","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder (dashboard)","func":"msg.payload = {start: global.get('images-dashboard')};\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":560,"wires":[["b108c115.2edbe"]]},{"id":"714902c.47617fc","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder (frameloop)","func":"msg.payload = {start: global.get('images-frameloop')};\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":520,"wires":[["b108c115.2edbe"]]},{"id":"3dd9a487.5b56ac","type":"comment","z":"168e0b9d.9c19d4","name":"decrement subsequent files","info":"","x":260,"y":480,"wires":[]},{"id":"4ce75980.70c5d8","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":560,"wires":[[],[],["a4cb96a3.782c78"]]},{"id":"9f85d0f1.1b0cd","type":"function","z":"168e0b9d.9c19d4","name":"set filnr","func":"var file = msg.payload.lastIndexOf(\"/\") + 1;\nvar nr = parseInt(msg.payload.slice(file, file+2));\nflow.set('filenr', nr);\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":560,"wires":[["714902c.47617fc","e4c37b78.ceb7b8","f670d93b.0351c8"]]},{"id":"300fc85d.3126d8","type":"link in","z":"168e0b9d.9c19d4","name":"decrement subsequent files","links":["a5ef733e.6cb3a","caa7a429.a06a28","34f63059.53c4e","b85d7672.0400d8"],"x":155,"y":560,"wires":[["bb2f01af.10b53"]]},{"id":"bb2f01af.10b53","type":"function","z":"168e0b9d.9c19d4","name":"decrement subsequent files","func":"return msg;","outputs":1,"noerr":0,"x":320,"y":560,"wires":[["c93f4389.6be24","9f85d0f1.1b0cd"]]},{"id":"833ed45c.3e3b58","type":"function","z":"5af1388b.ef9838","name":"set stickFlag","func":"if(global.get('stickFlag')){\n    global.set('stickFlag', false);\n    msg.topic = false;\n} else {\n    global.set('stickFlag', true);\n    msg.topic = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":940,"wires":[["bf63c1dd.c767b"]]},{"id":"94850725.2bc858","type":"ui_switch","z":"e00097c0.ad3088","name":"","label":"Alarm bei neuer Nachricht","tooltip":"","group":"68292322.19060c","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":1080,"wires":[[]]},{"id":"c72480c6.b6957","type":"delay","z":"5af1388b.ef9838","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":840,"wires":[["5b173a11.dc2234"]]},{"id":"5b173a11.dc2234","type":"link out","z":"5af1388b.ef9838","name":"","links":["92da4955.9fdbf8"],"x":1035,"y":840,"wires":[]},{"id":"5fd0e3e8.826e3c","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":640,"wires":[["38dc5900.1add38"]]},{"id":"38dc5900.1add38","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl status kodi","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":440,"y":600,"wires":[["b6f90e5.a1af1f"],[],[]]},{"id":"b6f90e5.a1af1f","type":"function","z":"dfa0e0a5.c8001","name":"check kodi status","func":"if(msg.payload.search(\"Active: active\") > 0){\n    msg.payload = true;\n} else {\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":600,"wires":[["7a7b4064.9fef1"]]},{"id":"7a7b4064.9fef1","type":"switch","z":"dfa0e0a5.c8001","name":"if false","property":"payload","propertyType":"msg","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":670,"y":540,"wires":[["a4de161d.ffeba8"]]},{"id":"9104c854.65d0d8","type":"function","z":"dfa0e0a5.c8001","name":"start/stop loop","func":"var reset = true;\n\nif(msg.payload){\n    return msg;\n} else {\n    msg = { reset }\n    return msg;\n}","outputs":1,"noerr":0,"x":240,"y":520,"wires":[["31323f6d.b2ab3"]]},{"id":"31323f6d.b2ab3","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"60","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":520,"wires":[["9104c854.65d0d8","37fc5c70.a64a94"]]},{"id":"37fc5c70.a64a94","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"25","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":200,"y":600,"wires":[["38dc5900.1add38"]]},{"id":"f4df8844.e49288","type":"function","z":"5af1388b.ef9838","name":"Application.SetVolume","func":"return {\n    payload: \n        {\n            \"method\":\"Application.SetVolume\",\n            \"params\": msg.payload\n        }\n};","outputs":1,"noerr":0,"x":1380,"y":1040,"wires":[["b2efa2c8.3efc"]]},{"id":"cf430ace.a1c7a8","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Lautstärke","tooltip":"","group":"c51c9a95.f2cb68","order":2,"width":0,"height":0,"passthru":true,"outs":"end","topic":"","min":0,"max":"100","step":1,"x":350,"y":2340,"wires":[["897b5e4b.2bec8","e654f1c6.d2c53"]]},{"id":"897b5e4b.2bec8","type":"link out","z":"5af1388b.ef9838","name":"","links":["f76c0a3a.f3b438"],"x":500,"y":2340,"wires":[]},{"id":"f76c0a3a.f3b438","type":"link in","z":"5af1388b.ef9838","name":"Application.SetVolume","links":["897b5e4b.2bec8"],"x":1215,"y":1040,"wires":[["f4df8844.e49288"]]},{"id":"75af0c10.faa9a4","type":"comment","z":"5af1388b.ef9838","name":"Settings","info":"","x":220,"y":2460,"wires":[]},{"id":"ad3acd0b.cbb95","type":"ui_slider","z":"5af1388b.ef9838","name":"","label":"Max. Anzahl Videos im Speicher","tooltip":"","group":"d021848d.7c9d58","order":1,"width":0,"height":0,"passthru":true,"outs":"end","topic":"","min":0,"max":"100","step":1,"x":450,"y":2520,"wires":[["7954fe1a.7e9b5","698ba4d3.4d460c"]]},{"id":"7125cd28.04d1b4","type":"persist out","z":"5af1388b.ef9838","name":"storedVideosMax","storageNode":"aa40158d.83bf68","x":190,"y":2520,"wires":[["ad3acd0b.cbb95"]]},{"id":"7954fe1a.7e9b5","type":"persist in","z":"5af1388b.ef9838","name":"storedVideosMax","storageNode":"aa40158d.83bf68","x":730,"y":2520,"wires":[]},{"id":"a6d10ded.a4c82","type":"persist out","z":"5af1388b.ef9838","name":"videoVolume","storageNode":"aa40158d.83bf68","x":190,"y":2380,"wires":[["cf430ace.a1c7a8"]]},{"id":"e654f1c6.d2c53","type":"persist in","z":"5af1388b.ef9838","name":"videoVolume","storageNode":"aa40158d.83bf68","x":530,"y":2380,"wires":[]},{"id":"470a98ff.077548","type":"function","z":"5af1388b.ef9838","name":"GUI.ShowNotification bottom","func":"return {\n    payload: \n        {\n            \"method\":\"GUI.ShowNotification\",\n            \"params\":{\n                \"title\":\"\",\n                \"message\":msg.payload,\n                \"displaytime\":global.get('onScreenInfoTime')\n            }\n        }\n};","outputs":1,"noerr":0,"x":1350,"y":620,"wires":[["b2efa2c8.3efc"]]},{"id":"6b933baa.2f9ff4","type":"link in","z":"5af1388b.ef9838","name":"GUI.ShowNotification bottom","links":["6901f99a.715428"],"x":1015,"y":620,"wires":[["a20e9b1f.b230e8"]]},{"id":"b7ab9bbc.8e91c8","type":"inject","z":"5af1388b.ef9838","name":"","topic":"","payload":"start testestetset dgdgfdg dfgdfgfdg dfgdfgdf end","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1110,"y":700,"wires":[["470a98ff.077548"]]},{"id":"beec3265.79a38","type":"function","z":"7c56a241.1e88dc","name":"set message","func":"msg.payload = \"Neue Nachricht von \" + flow.get('lastTelegramUsername') + \"!\"\nreturn msg;","outputs":1,"noerr":0,"x":1830,"y":1820,"wires":[["6901f99a.715428"]]},{"id":"6901f99a.715428","type":"link out","z":"7c56a241.1e88dc","name":"","links":["6b933baa.2f9ff4"],"x":1935,"y":1820,"wires":[]},{"id":"2d21f7f6.6b8dc8","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1660,"y":1820,"wires":[["beec3265.79a38"]]},{"id":"16ed3103.71c30f","type":"comment","z":"e00097c0.ad3088","name":"On screen info","info":"","x":220,"y":760,"wires":[]},{"id":"c1beedab.b5413","type":"ui_slider","z":"e00097c0.ad3088","name":"","label":"Zeitdauer (in min.)","tooltip":"","group":"3912675.5619198","order":2,"width":0,"height":0,"passthru":true,"outs":"end","topic":"","min":"1","max":"50","step":1,"x":410,"y":900,"wires":[["a7ec62ec.0c6dc","850bc3f7.e5ccc"]]},{"id":"a652b509.621958","type":"change","z":"e00097c0.ad3088","name":"","rules":[{"t":"set","p":"onScreenInfo","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":860,"wires":[[]]},{"id":"a8973839.500498","type":"ui_switch","z":"e00097c0.ad3088","name":"","label":"Aus / An","tooltip":"","group":"3912675.5619198","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":380,"y":820,"wires":[["a652b509.621958","a1b7d4fd.4ab978"]]},{"id":"a20e9b1f.b230e8","type":"function","z":"5af1388b.ef9838","name":"gate","func":"if(global.get('onScreenInfo')){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1110,"y":620,"wires":[["470a98ff.077548"]]},{"id":"a1b7d4fd.4ab978","type":"persist in","z":"e00097c0.ad3088","name":"onScreenInfo","storageNode":"aa40158d.83bf68","x":610,"y":820,"wires":[]},{"id":"2fd01760.1e8ba8","type":"persist out","z":"e00097c0.ad3088","name":"onScreenInfo","storageNode":"aa40158d.83bf68","x":170,"y":820,"wires":[["a8973839.500498"]]},{"id":"284da8cc.a4ff78","type":"persist out","z":"e00097c0.ad3088","name":"onScreenInfoTime","storageNode":"aa40158d.83bf68","x":190,"y":900,"wires":[["c1beedab.b5413"]]},{"id":"a7ec62ec.0c6dc","type":"persist in","z":"e00097c0.ad3088","name":"onScreenInfoTime","storageNode":"aa40158d.83bf68","x":630,"y":900,"wires":[]},{"id":"850bc3f7.e5ccc","type":"function","z":"e00097c0.ad3088","name":"set onScreenInfoTime","func":"msg.payload = 1000 * 60;\nglobal.set('onScreenInfoTime', msg.payload);","outputs":1,"noerr":0,"x":640,"y":940,"wires":[[]]},{"id":"bae46ed.a8acd9","type":"function","z":"7c56a241.1e88dc","name":"set FL Folder","func":"msg.payload = {start: global.get('videos-incoming')};\nreturn msg;","outputs":1,"noerr":0,"x":1790,"y":200,"wires":[["da9c1c87.525a7"]]},{"id":"da9c1c87.525a7","type":"fs-file-lister","z":"7c56a241.1e88dc","name":"","start":"global.get('images-incoming')","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":1940,"y":200,"wires":[["92d49688.3a73e8"]]},{"id":"92d49688.3a73e8","type":"change","z":"7c56a241.1e88dc","name":"","rules":[{"t":"set","p":"lastTelegramFilenameVideo","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":300,"wires":[["f7710099.9acc3"]]},{"id":"a4cae3d9.5fd0d","type":"function","z":"7c56a241.1e88dc","name":"rename + mv -> folder","func":"var filename = \"01\" + flow.get('lastTelegramFilenameVideo').slice((flow.get('lastTelegramFilenameVideo').lastIndexOf(\".\")));\n\nif(flow.get('lastVideoHeight') > 800){\n    msg.payload = \"mv \" + global.get('videos-incoming') + (flow.get('lastTelegramFilenameVideo')) + \" \" + global.get('videos-preprocessing') + filename;\n    flow.set('lastTelegramFilenameVideo', filename);\n    return [null, msg];\n} else {\n    msg.payload = \"mv \" + global.get('videos-incoming') + (flow.get('lastTelegramFilenameVideo')) + \" \" + global.get('videos-frameloop') + filename;\n    flow.set('lastTelegramFilenameVideo', filename);\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1120,"y":420,"wires":[["11414e1a.10be62"],["5f0269e5.e50b08"]]},{"id":"11414e1a.10be62","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":420,"wires":[[],[],["afda48f.8eb1fb8"]]},{"id":"50774bbf.0fa3a4","type":"link out","z":"7c56a241.1e88dc","name":"","links":["4925047.13a76fc"],"x":1415,"y":160,"wires":[]},{"id":"410eafc9.73cb7","type":"comment","z":"168e0b9d.9c19d4","name":"IMAGES","info":"","x":100,"y":140,"wires":[]},{"id":"edaa8999.862268","type":"comment","z":"168e0b9d.9c19d4","name":"VIDEOS","info":"","x":150,"y":1380,"wires":[]},{"id":"563c4f7f.082f1","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":1480,"wires":[["ae57aa2a.cd4c28"]]},{"id":"ae57aa2a.cd4c28","type":"function","z":"168e0b9d.9c19d4","name":"incr. filenr","func":"\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":1540,"wires":[["9d2e5aca.ee58a8"]]},{"id":"9d2e5aca.ee58a8","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder","func":"msg.payload = {start: global.get('videos-frameloop')};\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1540,"wires":[["7faeee9a.2e60d"]]},{"id":"7faeee9a.2e60d","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('images-frameloop')","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":640,"y":1540,"wires":[["50b2720e.4a1dec"]]},{"id":"50b2720e.4a1dec","type":"function","z":"168e0b9d.9c19d4","name":"frameloop: rename + 1","func":"if(msg.payload !== \"Empty Folder\"){\n    var file = msg.payload;\n    var fileNew = \"temp.\";\n    var folder = \"\";\n    var x = parseInt(file.slice(0, 2));\n    \n    if (Number.isInteger(x)){\n        \n        x = x + 1;\n        \n        if(x > global.get('storedVideosMax')){\n            msg.payload = \"rm \" + global.get('videos-frameloop') + file;\n            msg.file = \"deleted\";\n            flow.set('counter', flow.get('counter') - 1);\n        \n        } else {\n            var postfix = file.slice(2);\n            \n            if (x < 10){\n                fileNew = fileNew + \"0\" + x + postfix;\n            } else {\n                fileNew = fileNew + x + postfix;\n            }\n            msg.payload = \"mv \" + global.get('videos-frameloop') + file + \" \" + global.get('videos-frameloop') + fileNew;\n            msg.folder = global.get('videos-frameloop');\n            \n            msg.file = fileNew;\n        }\n        \n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":820,"y":1540,"wires":[["4bf82265.eb6e8c"]]},{"id":"4bf82265.eb6e8c","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":990,"y":1540,"wires":[[],[],["8b4fb520.808238"]]},{"id":"8b4fb520.808238","type":"delay","z":"168e0b9d.9c19d4","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1150,"y":1540,"wires":[["5c6b153a.5d58ec"]]},{"id":"5c6b153a.5d58ec","type":"function","z":"168e0b9d.9c19d4","name":"remove \"temp\"","func":"if(msg.payload.code === 0 && msg.file !== \"deleted\"){\n    var folder = msg.folder;\n    var file = msg.file;\n    var fileNew = file.slice(5);\n    \n    msg.payload = \"mv \" + folder + file + \" \" + folder + fileNew;\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":1320,"y":1540,"wires":[["ae17c4f2.b80708"]]},{"id":"ae17c4f2.b80708","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1470,"y":1540,"wires":[[],[],[]]},{"id":"698ba4d3.4d460c","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"storedVideosMax","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":2580,"wires":[[]]},{"id":"4925047.13a76fc","type":"link in","z":"168e0b9d.9c19d4","name":"incr. filenr videos","links":["50774bbf.0fa3a4"],"x":215,"y":1540,"wires":[["ae57aa2a.cd4c28"]]},{"id":"2ee6133.932a1ec","type":"comment","z":"7c56a241.1e88dc","name":"IMAGES","info":"","x":120,"y":580,"wires":[]},{"id":"205b49ad.7c7bc6","type":"comment","z":"7c56a241.1e88dc","name":"VIDEOS","info":"","x":810,"y":80,"wires":[]},{"id":"f2f6a38.3e3456","type":"q-gate","z":"7c56a241.1e88dc","name":"","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":1110,"y":200,"wires":[["1123a7a4.f5d7c8","636bd24c.cb112c","19f420bd.ed901f"]]},{"id":"f497dcbc.95ac","type":"function","z":"7c56a241.1e88dc","name":"trigger gate","func":"msg.payload = \"trigger\";\nmsg.topic = \"control\";\nglobal.set('videoBusy', false);\nreturn msg;","outputs":1,"noerr":0,"x":1830,"y":600,"wires":[["eaf3347e.d1bcf8"]]},{"id":"24215993.10e486","type":"function","z":"7c56a241.1e88dc","name":"open gate if not busy","func":"if(global.get('videoBusy')){}\nelse {\n    msg.payload = \"trigger\";\n    msg.topic = \"control\";\n    return msg;\n}","outputs":1,"noerr":0,"x":1020,"y":140,"wires":[["f2f6a38.3e3456"]]},{"id":"eaf3347e.d1bcf8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["5e85c279.d9f46c","721a2160.2ab1c"],"x":1935,"y":600,"wires":[]},{"id":"721a2160.2ab1c","type":"link in","z":"7c56a241.1e88dc","name":"","links":["eaf3347e.d1bcf8"],"x":895,"y":220,"wires":[["f2f6a38.3e3456"]]},{"id":"1123a7a4.f5d7c8","type":"function","z":"7c56a241.1e88dc","name":"set videoBusy","func":"global.set('videoBusy', true);\nreturn msg;\n","outputs":1,"noerr":0,"x":1300,"y":100,"wires":[["245967b5.d39638"]]},{"id":"66f528de.c282b8","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":830,"y":140,"wires":[["24215993.10e486"]]},{"id":"4cb00f29.ea1a8","type":"delay","z":"7c56a241.1e88dc","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":250,"y":640,"wires":[["e56403d5.de7c2"]]},{"id":"7579cd34.da5794","type":"q-gate","z":"7c56a241.1e88dc","name":"","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":350,"y":800,"wires":[["7042f23b.40a91c","3eb469a9.a3f486","98b8ca51.fe0458","85e552a1.fba43","e21f5b8.47cd3a8"]]},{"id":"e56403d5.de7c2","type":"function","z":"7c56a241.1e88dc","name":"open gate if not busy","func":"if(global.get('imageBusy')){}\nelse {\n    msg.payload = \"trigger\";\n    msg.topic = \"control\";\n    return msg;\n}","outputs":1,"noerr":0,"x":260,"y":700,"wires":[["7579cd34.da5794"]]},{"id":"98b8ca51.fe0458","type":"function","z":"7c56a241.1e88dc","name":"set imageBusy","func":"global.set('imageBusy', true);\n","outputs":1,"noerr":0,"x":480,"y":860,"wires":[[]]},{"id":"7cd117f2.69c9e8","type":"function","z":"7c56a241.1e88dc","name":"trigger gate","func":"msg.payload = \"trigger\";\nmsg.topic = \"control\";\nglobal.set('imageBusy', false);\nreturn msg;","outputs":1,"noerr":0,"x":1790,"y":1620,"wires":[["bb5fc45c.c23d28","571e5a0d.8510f4","dc11438c.48568"]]},{"id":"bb5fc45c.c23d28","type":"link out","z":"7c56a241.1e88dc","name":"","links":["85c98d5d.3969"],"x":1935,"y":1600,"wires":[]},{"id":"85c98d5d.3969","type":"link in","z":"7c56a241.1e88dc","name":"","links":["bb5fc45c.c23d28"],"x":135,"y":760,"wires":[["7579cd34.da5794"]]},{"id":"f7710099.9acc3","type":"function","z":"7c56a241.1e88dc","name":"ffprobe (get video res.)","func":"msg.payload = \"ffprobe -v quiet -print_format json -show_format -show_streams \" + global.get('videos-incoming') + flow.get('lastTelegramFilenameVideo');\nreturn msg;","outputs":1,"noerr":0,"x":1440,"y":300,"wires":[["4de2421.fccdbbc"]]},{"id":"4de2421.fccdbbc","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1610,"y":300,"wires":[["5ccfd479.98db4c"],[],[]]},{"id":"5ccfd479.98db4c","type":"json","z":"7c56a241.1e88dc","name":"","property":"payload","action":"","pretty":false,"x":1750,"y":300,"wires":[["657aae50.e4cf7"]]},{"id":"4a7cd7ee.60f248","type":"function","z":"7c56a241.1e88dc","name":"if error","func":"msg.payload = \"sudo rm -rf \" + global.get('videos-incoming') + \"* && rm -rf \" + global.get('videos-preprocessing') + \"*\";\nreturn msg;\n","outputs":1,"noerr":0,"x":1790,"y":480,"wires":[["ad49ff1e.8974b","f497dcbc.95ac","90f93e17.9dce9"]]},{"id":"fcb4b999.51c3b8","type":"link in","z":"7c56a241.1e88dc","name":"if video error ","links":["4d122063.c606b","e4408f27.40fa7","ef093438.0da098","218fba47.5eccb6","50707f01.e68c6","12baf267.a1255e","12cd364b.7e356a","2bb3d940.2e4a26","2a80e21f.ac415e","34c3fcd6.c0f464","a184344e.42a328","e57f2a84.ef08d8"],"x":1695,"y":480,"wires":[["4a7cd7ee.60f248"]]},{"id":"ad49ff1e.8974b","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1950,"y":480,"wires":[[],[],[]]},{"id":"4d3649a4.d33218","type":"function","z":"7c56a241.1e88dc","name":"if error","func":"msg.payload = \"sudo rm -rf \" + global.get('images-incoming') + \"* && rm -rf \" + global.get('images-preprocessing') + \"*\";\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1810,"y":1540,"wires":[["c83370c8.48945","7cd117f2.69c9e8","4e9ca213.3d056c"]]},{"id":"c83370c8.48945","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1990,"y":1540,"wires":[[],[],[]]},{"id":"46c8e873.b01a88","type":"link in","z":"7c56a241.1e88dc","name":"if image error ","links":["722656da.556c18","5d59ba7d.48c784","641823b2.89a2ec","bd729108.a8b66","1a18fb2b.a9feb5","f7528269.e3f37","c6f19bf8.ca97d8","dad59521.45c408","73c987ec.d39ab8","8679564f.58e298","3d6d789b.565ee8","af7658f5.2d7f78","752fdb30.528944","401843c8.f4d2dc","598f636f.837b1c","37966aa1.cfaed6"],"x":1715,"y":1540,"wires":[["4d3649a4.d33218"]]},{"id":"657aae50.e4cf7","type":"function","z":"7c56a241.1e88dc","name":"flow.set video res.","func":"try{\n    flow.set('lastVideoWidth', msg.payload.streams[0].width);\n    flow.set('lastVideoHeight', msg.payload.streams[0].coded_height);\n    \n} catch(e){}\n\nvar msg2 = {payload: \"\"};\nreturn msg2;","outputs":1,"noerr":0,"x":1910,"y":300,"wires":[["a4cae3d9.5fd0d"]]},{"id":"f605d689.b29478","type":"function","z":"7c56a241.1e88dc","name":"ffmpeg","func":"global.get('lastMimeVideo');\n\nmsg.payload = \"ffmpeg -i \" + global.get('videos-preprocessing') + msg.payload + \" -vf scale=-1:800 \" + global.get('videos-preprocessing') + \"tmp.\" + msg.payload;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1200,"y":520,"wires":[["4688a835.e5e458"]]},{"id":"5f0269e5.e50b08","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":590,"y":540,"wires":[[],[],["754dccc3.6cf1e4"]]},{"id":"e78683dd.58ce9","type":"comment","z":"7c56a241.1e88dc","name":"reseize using ffmpeg if height > 800","info":"","x":740,"y":460,"wires":[]},{"id":"dc9d5266.a89f4","type":"function","z":"7c56a241.1e88dc","name":"set FL Folder","func":"msg.payload = {start: global.get('videos-preprocessing')};\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":520,"wires":[["d27845d5.80ea68"]]},{"id":"d27845d5.80ea68","type":"fs-file-lister","z":"7c56a241.1e88dc","name":"","start":"global.get('images-preprocessing')","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":false,"depth":0,"stat":false,"showWarnings":true,"x":1060,"y":520,"wires":[["f605d689.b29478"]]},{"id":"4688a835.e5e458","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":520,"wires":[[],[],["f086681c.bfe8b8"]]},{"id":"7328fe2e.e840c","type":"function","z":"7c56a241.1e88dc","name":"rename + mv -> folder","func":"msg.payload = \"mv \" + global.get('videos-preprocessing') + \"tmp.01.\" + global.get('lastMimeVideo') + \" \" + global.get('videos-frameloop') + \"01.\" + global.get('lastMimeVideo') + \" && rm \" + global.get('videos-preprocessing') + \"01.\" + global.get('lastMimeVideo');\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1160,"y":620,"wires":[["8af81c35.06ae1"]]},{"id":"8af81c35.06ae1","type":"exec","z":"7c56a241.1e88dc","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":620,"wires":[[],[],["fa7e0ea.63f90f"]]},{"id":"f7d23ddc.32e82","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1600,"y":180,"wires":[["12cd364b.7e356a"],["bae46ed.a8acd9"]]},{"id":"6a2b3bc7.b395d4","type":"ui_button","z":"5af1388b.ef9838","name":"","group":"c51c9a95.f2cb68","order":9,"width":2,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"{{msg.payload}}","icon":"fa-arrow-circle-down","payload":"","payloadType":"str","topic":"","x":570,"y":2260,"wires":[[]]},{"id":"a2416246.4cc2b","type":"function","z":"5af1388b.ef9838","name":"set color","func":"if(global.get('videoBusy')){\n    msg.payload = \"#eb4034\";\n} else {\n    msg.payload = \"\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":2260,"wires":[["6a2b3bc7.b395d4"]]},{"id":"5e85c279.d9f46c","type":"link in","z":"5af1388b.ef9838","name":"busy","links":["245967b5.d39638","eaf3347e.d1bcf8"],"x":335,"y":2260,"wires":[["a2416246.4cc2b"]]},{"id":"245967b5.d39638","type":"link out","z":"7c56a241.1e88dc","name":"","links":["5e85c279.d9f46c"],"x":1415,"y":100,"wires":[]},{"id":"cb9645f6.a71318","type":"function","z":"7c56a241.1e88dc","name":"send video ready","func":"var chatId = flow.get('lastTelegramChatidVideo');\nvar type = \"message\";\nvar content = \"Fertig! Dein Video ist jetzt unter *Link* abspielbereit.\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1730,"y":680,"wires":[["628f7588.5cbbbc"]]},{"id":"628f7588.5cbbbc","type":"telegram sender","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","x":2040,"y":680,"wires":[[]]},{"id":"12cd364b.7e356a","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1715,"y":160,"wires":[]},{"id":"afda48f.8eb1fb8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1480,"y":420,"wires":[["2bb3d940.2e4a26"],["f497dcbc.95ac"]]},{"id":"2bb3d940.2e4a26","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1595,"y":400,"wires":[]},{"id":"f086681c.bfe8b8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1480,"y":520,"wires":[["2a80e21f.ac415e"],["7328fe2e.e840c"]]},{"id":"2a80e21f.ac415e","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1595,"y":500,"wires":[]},{"id":"fa7e0ea.63f90f","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1480,"y":620,"wires":[["34c3fcd6.c0f464"],["f497dcbc.95ac","cb9645f6.a71318"]]},{"id":"34c3fcd6.c0f464","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":1595,"y":600,"wires":[]},{"id":"f153fa65.e56d38","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1060,"y":860,"wires":[["73c987ec.d39ab8"],["c52d3fad.85dbf"]]},{"id":"73c987ec.d39ab8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1165,"y":850,"wires":[]},{"id":"635f03a6.5b896c","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1420,"y":940,"wires":[["8679564f.58e298"],["d8607587.5f2828"]]},{"id":"8679564f.58e298","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1525,"y":930,"wires":[]},{"id":"c0a9ff00.fadfe","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":800,"y":1180,"wires":[["3d6d789b.565ee8"],["3e32eae9.dd5636"]]},{"id":"3d6d789b.565ee8","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":905,"y":1170,"wires":[]},{"id":"993d21d1.50d41","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":620,"y":1400,"wires":[["af7658f5.2d7f78"],["fd4afe8c.3fa31"]]},{"id":"af7658f5.2d7f78","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":755,"y":1380,"wires":[]},{"id":"d8cfda78.815aa8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1190,"y":1320,"wires":[["752fdb30.528944"],["84851945.fe0028"]]},{"id":"752fdb30.528944","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1295,"y":1310,"wires":[]},{"id":"ae82a07c.73067","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1500,"y":1540,"wires":[["401843c8.f4d2dc"],["23a08705.fbb988"]]},{"id":"401843c8.f4d2dc","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1605,"y":1530,"wires":[]},{"id":"e744adc5.91cdb","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1500,"y":1640,"wires":[["598f636f.837b1c"],["7cd117f2.69c9e8","abd4ce3.6fb663"]]},{"id":"598f636f.837b1c","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1595,"y":1600,"wires":[]},{"id":"831c855e.b960c8","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1500,"y":1440,"wires":[["37966aa1.cfaed6"],["c15dd310.15d33"]]},{"id":"37966aa1.cfaed6","type":"link out","z":"7c56a241.1e88dc","name":"","links":["46c8e873.b01a88"],"x":1605,"y":1430,"wires":[]},{"id":"a184344e.42a328","type":"link out","z":"7c56a241.1e88dc","name":"","links":["fcb4b999.51c3b8","e10d0caa.50ec5"],"x":855,"y":580,"wires":[]},{"id":"754dccc3.6cf1e4","type":"function","z":"7c56a241.1e88dc","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":740,"y":540,"wires":[["a184344e.42a328"],["dc9d5266.a89f4"]]},{"id":"636bd24c.cb112c","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramChatidVideo","func":"flow.set('lastTelegramChatidVideo', msg.payload.chatId);","outputs":1,"noerr":0,"x":1320,"y":60,"wires":[[]]},{"id":"bd4a312.50889d","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"b242fa6a.175d28","order":1,"width":0,"height":0,"passthru":false,"label":"Reset Q-Gate Videos","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":820,"y":340,"wires":[["c3de6857.ab3b68"]]},{"id":"c9ccef4c.121da","type":"ui_button","z":"7c56a241.1e88dc","name":"","group":"b242fa6a.175d28","order":2,"width":0,"height":0,"passthru":false,"label":"Reset Q-Gate Images","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":140,"y":900,"wires":[["8fc7a884.818988"]]},{"id":"ff5edf4a.f2d6f","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1460,"y":1760,"wires":[["86802c5.4587dd"]]},{"id":"b089cb87.b44da8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1460,"y":1820,"wires":[["beec3265.79a38"]]},{"id":"abd4ce3.6fb663","type":"function","z":"7c56a241.1e88dc","name":"send image ready","func":"var chatId = flow.get('lastTelegramChatidImage');\nvar type = \"message\";\nvar content = \"Dein Bild wird ab jetzt angezeigt!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1850,"y":1680,"wires":[["aafb3fbd.52af3"]]},{"id":"aafb3fbd.52af3","type":"telegram sender","z":"7c56a241.1e88dc","name":"","bot":"ca6d8830.a2dc48","x":2120,"y":1680,"wires":[[]]},{"id":"85e552a1.fba43","type":"function","z":"7c56a241.1e88dc","name":"flow.set lastTelegramChatidImage","func":"flow.set('lastTelegramChatidImage', msg.payload.chatId);","outputs":1,"noerr":0,"x":740,"y":720,"wires":[[]]},{"id":"c3de6857.ab3b68","type":"function","z":"7c56a241.1e88dc","name":"reset q-gate","func":"global.set('videoBusy', false);\nmsg.topic = \"control\";\nmsg.payload = \"reset\";\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":280,"wires":[["f2f6a38.3e3456"]]},{"id":"8fc7a884.818988","type":"function","z":"7c56a241.1e88dc","name":"reset q-gate","func":"global.set('imageBusy', false);\nmsg.topic = \"control\";\nmsg.payload = \"reset\";\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":840,"wires":[["7579cd34.da5794"]]},{"id":"25e42f88.5da1f","type":"function","z":"5af1388b.ef9838","name":"navigate files","func":"var filelist = msg.payload;\nvar fileindex = flow.get('fileListVideoIndex') || 0;\nvar filelistlength = filelist.length;\n\nif (msg.navi === \"r\"){\n    if (fileindex >= (filelistlength - 1)){\n        fileindex = 0;\n    } else {\n        fileindex = fileindex + 1;\n    }\n    \n} else if (msg.navi === \"l\"){\n    if (fileindex <= 0){\n        fileindex = filelistlength - 1;\n    } else {\n        fileindex = fileindex - 1;\n    }\n}\n\nflow.set('fileListVideoIndex', fileindex);\n\nglobal.set('currentVideo', filelist[fileindex]);\nmsg.payload = filelist[fileindex];\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1050,"y":2100,"wires":[["b41df9a9.decaf8"]]},{"id":"31be1b8e.f65444","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1590,"y":2000,"wires":[[],[],["c417dcf9.77cab"]]},{"id":"8ce178f.023f988","type":"inject","z":"168e0b9d.9c19d4","name":"Start","topic":"","payload":"01","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":1720,"wires":[["aaa9b328.089d8"]]},{"id":"aaa9b328.089d8","type":"function","z":"168e0b9d.9c19d4","name":"delete file","func":"msg.file = global.get('currentVideo');\nmsg.payload = \"rm \" + global.get('videos-frameloop') + global.get('currentVideo');\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":1760,"wires":[["4fc8b8a1.377b88"]]},{"id":"6e3607df.ad23e8","type":"link in","z":"168e0b9d.9c19d4","name":"delete videoFile","links":["ef4fb262.7acf7"],"x":235,"y":1760,"wires":[["aaa9b328.089d8"]]},{"id":"71bd1282.325d9c","type":"comment","z":"168e0b9d.9c19d4","name":"delete file","info":"","x":180,"y":1640,"wires":[]},{"id":"4fc8b8a1.377b88","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":630,"y":1760,"wires":[[],[],["d80f555f.4e3f18"]]},{"id":"c417dcf9.77cab","type":"function","z":"168e0b9d.9c19d4","name":"counter down","func":"if(msg.payload.code === 0){\n    flow.set('counter2', flow.get('counter2') - 1);\n    if(flow.get('counter2') === 0){\n        msg.payload = \"ok\";\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":1760,"y":2000,"wires":[[]]},{"id":"4a9ca54d.a088bc","type":"function","z":"168e0b9d.9c19d4","name":"remove \"temp\"","func":"if(msg.payload.code === 0){\n    var folder = msg.folder;\n    var file = msg.file;\n    var fileNew = file.slice(5);\n    \n    msg.payload = \"mv \" + folder + file + \" \" + folder + fileNew;\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":1440,"y":2000,"wires":[["31be1b8e.f65444"]]},{"id":"e6f1145e.5f0a08","type":"fs-file-lister","z":"168e0b9d.9c19d4","name":"","start":"global.get('path-videos')","pattern":"","folders":"*","hidden":true,"lstype":"files","path":true,"single":false,"depth":"1","stat":false,"showWarnings":true,"x":1000,"y":1920,"wires":[["bf72c106.89ba2"]]},{"id":"bf72c106.89ba2","type":"function","z":"168e0b9d.9c19d4","name":"rename -1","func":"if(msg.payload !== \"Empty Folder\"){\n    var filenrThreshold = flow.get('filenrThreshold');\n    var file = msg.payload.slice(msg.payload.lastIndexOf(\"/\") + 1);\n    var path = msg.payload.slice(0, msg.payload.lastIndexOf(\"/\") + 1);\n    var filenr = parseInt(file.slice(0, 2));\n\n    if (Number.isInteger(filenr) && (filenr > filenrThreshold) && (filenr > 1)){\n        filenr = filenr - 1;\n        var fileNew = \"temp.\";\n        if (filenr < 10){\n            fileNew = fileNew + \"0\" + filenr + file.slice(2);\n        } else {\n            fileNew = fileNew + filenr + file.slice(2);\n        }\n        \n        msg.payload = \"mv \" + path + file + \" \" + path + fileNew;\n        \n        msg.file = fileNew;\n        msg.folder = path;\n        \n        return msg;\n    }\n}","outputs":1,"noerr":0,"x":1150,"y":1920,"wires":[["d11144dd.78c048","28fe9d42.bb4fc2"]]},{"id":"f710f158.ead4d","type":"function","z":"168e0b9d.9c19d4","name":"set FL folder (frameloop)","func":"msg.payload = {start: global.get('videos-frameloop')};\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":1920,"wires":[["e6f1145e.5f0a08"]]},{"id":"48a50281.b1577c","type":"comment","z":"168e0b9d.9c19d4","name":"decrement subsequent files","info":"","x":240,"y":1840,"wires":[]},{"id":"d11144dd.78c048","type":"exec","z":"168e0b9d.9c19d4","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1330,"y":1920,"wires":[[],[],["869f10e.bd35df"]]},{"id":"b5e81859.023db8","type":"function","z":"168e0b9d.9c19d4","name":"flow.set filenrThreshold","func":"flow.set('filenrThreshold', parseInt(msg.file.slice(0, 2)));\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":1920,"wires":[["f710f158.ead4d"]]},{"id":"58cb1be6.059dd4","type":"function","z":"168e0b9d.9c19d4","name":"decrement subsequent files","func":"return msg;","outputs":1,"noerr":0,"x":300,"y":1920,"wires":[["b5e81859.023db8","50669825.d77398"]]},{"id":"d7ececf4.8bae7","type":"comment","z":"168e0b9d.9c19d4","name":"increment filenr","info":"","x":200,"y":1440,"wires":[]},{"id":"869f10e.bd35df","type":"delay","z":"168e0b9d.9c19d4","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1490,"y":1920,"wires":[["4a9ca54d.a088bc"]]},{"id":"1d9b5bde.6fb704","type":"function","z":"5af1388b.ef9838","name":"if ok delete","func":"if(msg.payload === \"OK\"){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":890,"y":2200,"wires":[["ef4fb262.7acf7","3d27329c.35b44e"]]},{"id":"ef4fb262.7acf7","type":"link out","z":"5af1388b.ef9838","name":"","links":["6e3607df.ad23e8"],"x":1015,"y":2200,"wires":[]},{"id":"d80f555f.4e3f18","type":"function","z":"168e0b9d.9c19d4","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":780,"y":1760,"wires":[[],["58cb1be6.059dd4","7bd9f5bc.40208c"]]},{"id":"c6e1ce9b.3035","type":"fs-file-lister","z":"5af1388b.ef9838","name":"","start":"global.get('images-frameloop')","pattern":"*.*","folders":"*","hidden":true,"lstype":"files","path":false,"single":true,"depth":0,"stat":false,"showWarnings":true,"x":860,"y":2100,"wires":[["b0aa4d5.14c34b","25e42f88.5da1f"]]},{"id":"b0aa4d5.14c34b","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"fileListVideo","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":2060,"wires":[[]]},{"id":"20d45bdb.5dda64","type":"function","z":"5af1388b.ef9838","name":"set FL Folder, store nav commands","func":"var navi = msg.payload;\nmsg = {navi};\nmsg.payload = {start: global.get('videos-frameloop')};\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":2100,"wires":[["c6e1ce9b.3035"]]},{"id":"f9c3ea3d.aa6888","type":"function","z":"168e0b9d.9c19d4","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1440,"y":900,"wires":[[],["8acfb3b1.1e7c9"]]},{"id":"8acfb3b1.1e7c9","type":"function","z":"168e0b9d.9c19d4","name":"flow.get currentFileDel","func":"msg.payload = flow.get('currentFileDel');\nreturn msg;","outputs":1,"noerr":0,"x":1640,"y":900,"wires":[["a5ef733e.6cb3a","f4e6b208.92afc"]]},{"id":"cb711e58.62298","type":"function","z":"168e0b9d.9c19d4","name":"get currentFile","func":"msg.payload = global.get('currentFile');\nflow.set('currentFileStick', global.get('currentFile'));\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":1100,"wires":[["eb469493.266bd8"]]},{"id":"b85d7672.0400d8","type":"link out","z":"168e0b9d.9c19d4","name":"","links":["300fc85d.3126d8"],"x":1935,"y":1060,"wires":[]},{"id":"5e8bd0a5.e8873","type":"function","z":"168e0b9d.9c19d4","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1580,"y":1060,"wires":[[],["6b54631b.9a18fc"]]},{"id":"6b54631b.9a18fc","type":"function","z":"168e0b9d.9c19d4","name":"flow.get currentFileDel","func":"msg.payload = flow.get('currentFileStick');\nreturn msg;\n","outputs":1,"noerr":0,"x":1780,"y":1060,"wires":[["b85d7672.0400d8","44d2ac7c.eb4154"]]},{"id":"a663d06f.2b899","type":"function","z":"168e0b9d.9c19d4","name":"ok/error","func":"if(msg.payload.code === 0){\n    return [null, msg];\n} else {\n    return [msg, null];\n}","outputs":2,"noerr":0,"x":1720,"y":1280,"wires":[[],["654fe6d1.53aa68"]]},{"id":"a815c236.5c89e","type":"debug","z":"168e0b9d.9c19d4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1860,"y":620,"wires":[]},{"id":"5556ae61.0e312","type":"ui_toast","z":"168e0b9d.9c19d4","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1170,"y":1760,"wires":[]},{"id":"7bd9f5bc.40208c","type":"function","z":"168e0b9d.9c19d4","name":"set message","func":"msg.payload = \"Video gelöscht!\";\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":1760,"wires":[["5556ae61.0e312"]]},{"id":"28fe9d42.bb4fc2","type":"function","z":"168e0b9d.9c19d4","name":"counter up","func":"if(msg.payload !== \"Empty Folder\" && msg.topic === false){\n    var counter = flow.get('counter2') || 0;\n    counter = counter + 1;\n    flow.set('counter2', counter);\n    msg.payload = counter;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":1230,"y":2000,"wires":[[]]},{"id":"50669825.d77398","type":"function","z":"168e0b9d.9c19d4","name":"counter set zero","func":"flow.set('counter2', 0);","outputs":1,"noerr":0,"x":540,"y":2000,"wires":[[]]},{"id":"ae8d8002.3d3fd","type":"function","z":"168e0b9d.9c19d4","name":"set message","func":"msg.payload = \"Bild gelöscht!\";\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":960,"wires":[["ffc4fd59.845a"]]},{"id":"ffc4fd59.845a","type":"ui_toast","z":"168e0b9d.9c19d4","position":"top right","displayTime":"3","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":1990,"y":960,"wires":[]},{"id":"aca9ebc6.e394b8","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"noDashPressed","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1720,"y":1920,"wires":[[]]},{"id":"110ad02.332b43","type":"stoptimer","z":"5af1388b.ef9838","duration":"5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1480,"y":1920,"wires":[["aca9ebc6.e394b8"],[]]},{"id":"490b41ca.1b986","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"noDashPressed","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1260,"y":1920,"wires":[["110ad02.332b43"]]},{"id":"bbcc94e4.472028","type":"function","z":"5af1388b.ef9838","name":"set color","func":"if (msg.payload === \"play\" || msg.payload === \"kodiPlay\"){\n    var payload = \"\";\n    var msg2 = {payload};\n    msg.payload = \"#eb4034\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', true);\n    return [msg2, msg];\n\n} else if (msg.payload === \"pause\"){\n    if ((context.get('colorswitchPause') || false) && context.set('colorswitchPlay')){\n        msg.payload = \"#ebe534\";\n        context.set('colorswitchPause', false);\n    } else {\n        msg.payload = \"\";\n        context.set('colorswitchPause', true);\n    }\n    return [msg, null];\n\n} else if (msg.payload === \"kodiPause\"){\n    msg.payload = \"#ebe534\";\n    context.set('colorswitchPause', false);\n    return [msg, null];\n\n} else if (msg.payload === \"stop\" || msg.payload === \"kodiStop\"){\n    msg.payload = \"\";\n    context.set('colorswitchPause', true);\n    context.set('colorswitchPlay', false);\n    return [msg, msg];\n}\n","outputs":2,"noerr":0,"x":500,"y":1920,"wires":[["df26ac7e.fef28"],["2e1296c7.66d7ca"]]},{"id":"623c93eb.43012c","type":"rbe","z":"5af1388b.ef9838","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":310,"y":1920,"wires":[["bbcc94e4.472028","690a4ce2.2ba8f4","efe1988.7c76268"]]},{"id":"690a4ce2.2ba8f4","type":"function","z":"5af1388b.ef9838","name":"gate \"kodiStop\"","func":"if(msg.payload === \"kodiStop\"){\n    if (flow.get('stopLock')){\n        flow.set('stopLock', false);\n    } else {\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":500,"y":1840,"wires":[["927e6904.449578"]]},{"id":"cbdf7fed.a48c1","type":"function","z":"5af1388b.ef9838","name":"gate images","func":"try{\n    if (msg.payload.data.data.item.type === \"picture\"){\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":150,"y":700,"wires":[["82df6bdd.e98f78","ad1ea8ed.3c9d48","6407c025.f7455","af1fd754.2f7da8"]]},{"id":"ad1ea8ed.3c9d48","type":"function","z":"5af1388b.ef9838","name":"get stop","func":"try{\n    if (msg.payload.notification === \"Player.OnStop\"){\n        msg.payload = \"kodiStop\";\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":160,"y":560,"wires":[["1ab6439d.6ea0dc"]]},{"id":"82df6bdd.e98f78","type":"function","z":"5af1388b.ef9838","name":"get speed","func":"try{\n    if (msg.payload.data.data.player.speed === 0){\n        msg.payload = \"kodiPause\";\n        return msg;\n    } else if (msg.payload.data.data.player.speed === 1){\n        msg.payload = \"kodiPlay\";\n        return msg;\n    }\n\n} catch(e){}\n","outputs":1,"noerr":0,"x":160,"y":600,"wires":[["1ab6439d.6ea0dc"]]},{"id":"413ecc2f.d1b544","type":"function","z":"5af1388b.ef9838","name":"gate videos","func":"try{\n    if (msg.payload.data.data.item.type === \"movie\"){\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":130,"y":1820,"wires":[["999114d1.275808","b0cfd4bd.6afb78"]]},{"id":"b0cfd4bd.6afb78","type":"function","z":"5af1388b.ef9838","name":"get speed","func":"try{\n    if (msg.payload.data.data.player.speed === 0){\n        msg.payload = \"kodiPause\";\n        return msg;\n    } else if (msg.payload.data.data.player.speed === 1){\n        msg.payload = \"kodiPlay\";\n        return msg;\n    }\n\n} catch(e){}\n","outputs":1,"noerr":0,"x":160,"y":1940,"wires":[["623c93eb.43012c"]]},{"id":"999114d1.275808","type":"function","z":"5af1388b.ef9838","name":"get stop","func":"try{\n    if (msg.payload.notification === \"Player.OnStop\"){\n        msg.payload = \"kodiStop\";\n        return msg;\n    }\n    \n} catch(e){}\n","outputs":1,"noerr":0,"x":160,"y":1900,"wires":[["623c93eb.43012c"]]},{"id":"cd187329.675f9","type":"link in","z":"5af1388b.ef9838","name":"Player.Open \"images-frameloop\"","links":["e27f5805.51bfb8"],"x":775,"y":280,"wires":[["c6be6051.f6e5f"]]},{"id":"3dc142d0.bec18e","type":"function","z":"5af1388b.ef9838","name":"flow.set stopLock","func":"if((global.get('kodiPlayerVideoStatus') === \"kodiPlay\") || (global.get('kodiPlayerVideoStatus') === \"kodiPause\")){\n    flow.set('stopLock', true);\n}","outputs":1,"noerr":0,"x":890,"y":2020,"wires":[[]]},{"id":"efe1988.7c76268","type":"change","z":"5af1388b.ef9838","name":"","rules":[{"t":"set","p":"kodiPlayerVideoStatus","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1800,"wires":[[]]},{"id":"4e9ca213.3d056c","type":"function","z":"7c56a241.1e88dc","name":"send image faulty","func":"var chatId = flow.get('lastTelegramChatidImage');\nvar type = \"message\";\nvar content = \"Irgendwas ist leider schiefgelaufen :(. Probiere es doch einfach nochmal!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":2030,"y":1480,"wires":[["aafb3fbd.52af3"]]},{"id":"90f93e17.9dce9","type":"function","z":"7c56a241.1e88dc","name":"send video faulty","func":"var chatId = flow.get('lastTelegramChatidVideo');\nvar type = \"message\";\nvar content = \"Irgendwas ist leider schiefgelaufen :(. Probiere es doch einfach nochmal!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1990,"y":540,"wires":[["628f7588.5cbbbc"]]},{"id":"e039a271.eb952","type":"debug","z":"7c56a241.1e88dc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1750,"y":1480,"wires":[]},{"id":"f4e6b208.92afc","type":"delay","z":"168e0b9d.9c19d4","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1640,"y":960,"wires":[["ae8d8002.3d3fd"]]},{"id":"c15dd310.15d33","type":"function","z":"7c56a241.1e88dc","name":"if textActive false -> move to stackText","func":"if (msg.topic === \"textTrue\" && global.get('textActive') === false){\n    return [msg, null];\n} else if (msg.topic === \"name\" || msg.topic === \"textTrue\") {\n    return [null, msg];\n}","outputs":2,"noerr":0,"x":870,"y":1560,"wires":[["73b94e53.aa703"],["23a08705.fbb988"]]},{"id":"1772bc20.33bfa4","type":"comment","z":"dfa0e0a5.c8001","name":"ddns (freedns.afraid.org)","info":"","x":170,"y":1980,"wires":[]},{"id":"e15f94eb.063b48","type":"http request","z":"dfa0e0a5.c8001","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":510,"y":2060,"wires":[["83339488.7458a8"]]},{"id":"83339488.7458a8","type":"debug","z":"dfa0e0a5.c8001","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":710,"y":2060,"wires":[]},{"id":"4532964f.781bc8","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"600","crontab":"","once":true,"onceDelay":0.1,"x":160,"y":2060,"wires":[["e472071a.d6afa8"]]},{"id":"abb2fbe7.76eff8","type":"persist in","z":"dfa0e0a5.c8001","name":"ddns","storageNode":"aa40158d.83bf68","x":450,"y":2200,"wires":[]},{"id":"1c75620d.de0ade","type":"ui_text_input","z":"dfa0e0a5.c8001","name":"","label":"","tooltip":"Ordnerpfad","group":"e4f17352.69409","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":"100","topic":"","x":300,"y":2140,"wires":[["abb2fbe7.76eff8","61e1a247.9fd18c"]]},{"id":"d9643cdd.6e996","type":"persist out","z":"dfa0e0a5.c8001","name":"ddns","storageNode":"aa40158d.83bf68","x":150,"y":2200,"wires":[["1c75620d.de0ade"]]},{"id":"61e1a247.9fd18c","type":"change","z":"dfa0e0a5.c8001","name":"","rules":[{"t":"set","p":"freedns","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":2140,"wires":[[]]},{"id":"e472071a.d6afa8","type":"function","z":"dfa0e0a5.c8001","name":"set url","func":"var url = flow.get('freedns') || \"https://freedns.afraid.org/dynamic/update.php?cUlQenlDY3BDcWxzclgycGoyQXc5eHg0OjE5MDYzMTA5\";\nmsg = {url};\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":2060,"wires":[["e15f94eb.063b48"]]},{"id":"fb025f37.84049","type":"comment","z":"dfa0e0a5.c8001","name":"squid","info":"","x":110,"y":1200,"wires":[]},{"id":"5471ffdb.a7bbf","type":"persist in","z":"dfa0e0a5.c8001","name":"squid","storageNode":"aa40158d.83bf68","x":430,"y":1320,"wires":[]},{"id":"1e704d62.e903f3","type":"persist out","z":"dfa0e0a5.c8001","name":"squid","storageNode":"aa40158d.83bf68","x":130,"y":1320,"wires":[["d963dd26.eb315"]]},{"id":"d963dd26.eb315","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"squid","tooltip":"","group":"29050d2.fa3cef2","order":3,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":1280,"wires":[["d996463d.31d538","5471ffdb.a7bbf"]]},{"id":"d996463d.31d538","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":470,"y":1280,"wires":[["8beeb916.aa55c8"],["afe21bfb.85b978"]]},{"id":"8beeb916.aa55c8","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start squid","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":740,"y":1260,"wires":[[],[],[]]},{"id":"afe21bfb.85b978","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop squid","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":740,"y":1320,"wires":[[],[],[]]},{"id":"de4f51c9.94983","type":"comment","z":"dfa0e0a5.c8001","name":"frankabilderrahmentmp.mooo.com","info":"","x":560,"y":2020,"wires":[]},{"id":"2fd28b39.2cd434","type":"comment","z":"dfa0e0a5.c8001","name":"openvpn","info":"","x":120,"y":960,"wires":[]},{"id":"59352b39.4a6ea4","type":"persist in","z":"dfa0e0a5.c8001","name":"openvpn","storageNode":"aa40158d.83bf68","x":440,"y":1080,"wires":[]},{"id":"9e69e5d1.7e9378","type":"persist out","z":"dfa0e0a5.c8001","name":"openvpn","storageNode":"aa40158d.83bf68","x":140,"y":1080,"wires":[["8b4c2698.95cbc8"]]},{"id":"8b4c2698.95cbc8","type":"ui_switch","z":"dfa0e0a5.c8001","name":"","label":"openvpn","tooltip":"","group":"29050d2.fa3cef2","order":3,"width":6,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":280,"y":1040,"wires":[["779c625.b0a5e9c","59352b39.4a6ea4"]]},{"id":"779c625.b0a5e9c","type":"function","z":"dfa0e0a5.c8001","name":"if false","func":"if (msg.payload === true) {\n    return [ msg, null ];\n} else {\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"x":470,"y":1040,"wires":[["5dc133a4.8b68cc"],["5b8bf566.f2229c"]]},{"id":"5dc133a4.8b68cc","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl start openvpn@jablServ","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":780,"y":1020,"wires":[[],[],[]]},{"id":"5b8bf566.f2229c","type":"exec","z":"dfa0e0a5.c8001","command":"sudo systemctl stop openvpn@jablServ","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":780,"y":1080,"wires":[[],[],[]]},{"id":"b354a455.3f6448","type":"comment","z":"dfa0e0a5.c8001","name":"Ping","info":"","x":110,"y":2540,"wires":[]},{"id":"b701d55c.bfb1f8","type":"debug","z":"dfa0e0a5.c8001","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":2700,"wires":[]},{"id":"839c67b8.b8e4d8","type":"function","z":"dfa0e0a5.c8001","name":"is online","func":"var chatId = 146276326;\nvar type = \"message\";\nvar content = \"Bilderrahmen ist online!\";\n\nmsg.payload = { chatId,\n                type,\n                content\n};\n\nreturn msg;\n","outputs":1,"noerr":0,"x":880,"y":2600,"wires":[["891173e7.25217"]]},{"id":"891173e7.25217","type":"telegram sender","z":"dfa0e0a5.c8001","name":"","bot":"ca6d8830.a2dc48","x":1040,"y":2600,"wires":[[]]},{"id":"26c2d35f.99a50c","type":"inject","z":"dfa0e0a5.c8001","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"5","x":180,"y":2620,"wires":[["cf06479b.e142d8"]]},{"id":"37d649ee.eeccc6","type":"function","z":"dfa0e0a5.c8001","name":"if ping -> true","func":"if (msg.payload === false){\n\n} else {\n    msg.payload = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":2620,"wires":[["cdd8e16.17b112","b701d55c.bfb1f8"]]},{"id":"cf06479b.e142d8","type":"adv ping","z":"dfa0e0a5.c8001","name":"","host":"8.8.8.8","x":350,"y":2620,"wires":[["37d649ee.eeccc6"]]},{"id":"cdd8e16.17b112","type":"switch","z":"dfa0e0a5.c8001","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":2620,"wires":[["839c67b8.b8e4d8"],["e9a2e1f3.4a0ae"]]},{"id":"e9a2e1f3.4a0ae","type":"delay","z":"dfa0e0a5.c8001","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":2720,"wires":[["cf06479b.e142d8"]]},{"id":"dadc16b7.9632e8","type":"inject","z":"7c56a241.1e88dc","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":2940,"wires":[["6f5b8b48.395204"]]}]